

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=dark>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/blog/img/fluid.png">
  <link rel="icon" href="/blog/img/icon/dw.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="Memory">
  <meta name="keywords" content="">
  
    <meta name="description" content="MemorySearch å¿†æœé˜å¼€å‘åŸºæœ¬æµç¨‹">
<meta property="og:type" content="article">
<meta property="og:title" content="MemorySearch å¿†æœé˜-å¼€å‘æ–‡æ¡£">
<meta property="og:url" content="https://deng-2022.gitee.io/blog/2023/08/26/MemorySearch%20%E5%BF%86%E6%90%9C%E9%98%81-%E5%BC%80%E5%8F%91%E6%96%87%E6%A1%A3/index.html">
<meta property="og:site_name" content="Memory&#39;s blog">
<meta property="og:description" content="MemorySearch å¿†æœé˜å¼€å‘åŸºæœ¬æµç¨‹">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://deng-2022.gitee.io/blog/img/artical/ren.jpg">
<meta property="article:published_time" content="2023-08-26T14:09:22.000Z">
<meta property="article:modified_time" content="2024-02-19T12:22:54.000Z">
<meta property="article:author" content="Memory">
<meta property="article:tag" content="é¡¹ç›®">
<meta property="article:tag" content="å¼€å‘ç»éªŒ">
<meta property="article:tag" content="Elasticsearch">
<meta property="article:tag" content="Logstash">
<meta property="article:tag" content="Kibana">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://deng-2022.gitee.io/blog/img/artical/ren.jpg">
  
  
  
  <title>MemorySearch å¿†æœé˜-å¼€å‘æ–‡æ¡£ - Memory&#39;s blog</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- ä¸»é¢˜ä¾èµ–çš„å›¾æ ‡åº“ï¼Œä¸è¦è‡ªè¡Œä¿®æ”¹ -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/blog/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/blog/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/blog/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"deng-2022.gitee.io","root":"/blog/","version":"1.9.4","typing":{"enable":true,"typeSpeed":100,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":false,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":true,"follow_dnt":true,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/blog/local-search.xml"};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/blog/js/utils.js" ></script>
  <script  src="/blog/js/color-schema.js" ></script>
  

  

  

  

  

  

  

  



  
<meta name="generator" content="Hexo 5.4.2"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 75vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/blog/">
      <strong>Memory&#39;s blog</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/blog/">
                <i class="iconfont icon-home-fill"></i>
                <span>é¦–é¡µ</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/blog/archives/">
                <i class="iconfont icon-archive-fill"></i>
                <span>å½’æ¡£</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/blog/categories/">
                <i class="iconfont icon-category-fill"></i>
                <span>åˆ†ç±»</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/blog/tags/">
                <i class="iconfont icon-tags-fill"></i>
                <span>æ ‡ç­¾</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/blog/about/">
                <i class="iconfont icon-user-fill"></i>
                <span>å…³äº</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/blog/links/">
                <i class="iconfont icon-link-fill"></i>
                <span>å‹é“¾</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/blog/img/newBG/girl.jpg') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="MemorySearch å¿†æœé˜-å¼€å‘æ–‡æ¡£"></span>
          
        </div>

        
          
  <div class="mt-3">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-author" aria-hidden="true"></i>
        Memory
      </span>
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2023-08-26 22:09" pubdate>
          2023å¹´8æœˆ26æ—¥ æ™šä¸Š
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          102k å­—
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          255 åˆ†é’Ÿ
        
      </span>
    

    
    
      
        <span id="leancloud-page-views-container" class="post-meta" style="display: none">
          <i class="iconfont icon-eye" aria-hidden="true"></i>
          <span id="leancloud-page-views"></span> æ¬¡
        </span>
        
      
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar category-bar" style="margin-right: -1rem">
    





<div class="category-list">
  
  
    
    
    
    <div class="category row nomargin-x">
      <a class="category-item 
          list-group-item category-item-action col-10 col-md-11 col-xm-11" title="é¡¹ç›®"
        id="heading-31ecc0e65b4cd3e6b12577382bb56d6a" role="tab" data-toggle="collapse" href="#collapse-31ecc0e65b4cd3e6b12577382bb56d6a"
        aria-expanded="true"
      >
        é¡¹ç›®
        <span class="list-group-count">(6)</span>
        <i class="iconfont icon-arrowright"></i>
      </a>
      
      <div class="category-collapse collapse show" id="collapse-31ecc0e65b4cd3e6b12577382bb56d6a"
           role="tabpanel" aria-labelledby="heading-31ecc0e65b4cd3e6b12577382bb56d6a">
        
        
          
          
  <div class="category-post-list">
    
    
  </div>

          
  
    
    
    
    <div class="category-sub row nomargin-x">
      <a class="category-subitem 
          list-group-item category-item-action col-10 col-md-11 col-xm-11" title="å¼€å‘ç»éªŒ"
        id="heading-bfd19ce0478d81a44ceb5a9a1aa94202" role="tab" data-toggle="collapse" href="#collapse-bfd19ce0478d81a44ceb5a9a1aa94202"
        aria-expanded="true"
      >
        å¼€å‘ç»éªŒ
        <span class="list-group-count">(5)</span>
        <i class="iconfont icon-arrowright"></i>
      </a>
      
      <div class="category-collapse collapse show" id="collapse-bfd19ce0478d81a44ceb5a9a1aa94202"
           role="tabpanel" aria-labelledby="heading-bfd19ce0478d81a44ceb5a9a1aa94202">
        
        
          
          
  <div class="category-post-list">
    
    
      
      
        <a href="/blog/2023/03/17/Memory%20%E7%94%A8%E6%88%B7%E4%B8%AD%E5%BF%83%E7%B3%BB%E7%BB%9F-%E5%BC%80%E5%8F%91%E6%96%87%E6%A1%A3/" title="Memory ç”¨æˆ·ä¸­å¿ƒä¸­å¿ƒ-å¼€å‘æ–‡æ¡£"
           class="list-group-item list-group-item-action
           ">
          <span class="category-post">Memory ç”¨æˆ·ä¸­å¿ƒä¸­å¿ƒ-å¼€å‘æ–‡æ¡£</span>
        </a>
      
    
      
      
        <a href="/blog/2023/06/20/Typora%E6%93%8D%E4%BD%9C%E6%8A%80%E5%B7%A7/" title="ç¾è½®ç¾å¥‚çš„æ–‡æ¡£è‰ºæœ¯ï¼šTyporaçš„ä½¿ç”¨æŠ€å·§å’Œå®è·µ"
           class="list-group-item list-group-item-action
           ">
          <span class="category-post">ç¾è½®ç¾å¥‚çš„æ–‡æ¡£è‰ºæœ¯ï¼šTyporaçš„ä½¿ç”¨æŠ€å·§å’Œå®è·µ</span>
        </a>
      
    
      
      
        <a href="/blog/2023/08/02/PicMemories%20%E5%A3%81%E7%BA%B8%E5%88%86%E4%BA%AB%E5%B0%8F%E7%A8%8B%E5%BA%8F%20-%20%E5%BC%80%E5%8F%91%E6%96%87%E6%A1%A3/" title="PicMemories-å¼€å‘æ–‡æ¡£"
           class="list-group-item list-group-item-action
           ">
          <span class="category-post">PicMemories-å¼€å‘æ–‡æ¡£</span>
        </a>
      
    
      
      
        <a href="/blog/2023/08/07/TaskMemories%20-%20%E5%BC%80%E5%8F%91%E6%96%87%E6%A1%A3/" title="TaskMemories-å¼€å‘æ–‡æ¡£"
           class="list-group-item list-group-item-action
           ">
          <span class="category-post">TaskMemories-å¼€å‘æ–‡æ¡£</span>
        </a>
      
    
  </div>

          
  
    
    
    
    <div class="category-sub row nomargin-x">
      <a class="category-subitem 
          list-group-item category-item-action col-10 col-md-11 col-xm-11" title="Elasticsearch"
        id="heading-45e23a169652aaf95ce80da844f3df0d" role="tab" data-toggle="collapse" href="#collapse-45e23a169652aaf95ce80da844f3df0d"
        aria-expanded="true"
      >
        Elasticsearch
        <span class="list-group-count">(1)</span>
        <i class="iconfont icon-arrowright"></i>
      </a>
      
      <div class="category-collapse collapse show" id="collapse-45e23a169652aaf95ce80da844f3df0d"
           role="tabpanel" aria-labelledby="heading-45e23a169652aaf95ce80da844f3df0d">
        
        
          
          
  <div class="category-post-list">
    
    
  </div>

          
  
    
    
    
    <div class="category-sub row nomargin-x">
      <a class="category-subitem 
          list-group-item category-item-action col-10 col-md-11 col-xm-11" title="Logstash"
        id="heading-65859d7d6b0c6a5327b8f0b0c09653ad" role="tab" data-toggle="collapse" href="#collapse-65859d7d6b0c6a5327b8f0b0c09653ad"
        aria-expanded="true"
      >
        Logstash
        <span class="list-group-count">(1)</span>
        <i class="iconfont icon-arrowright"></i>
      </a>
      
      <div class="category-collapse collapse show" id="collapse-65859d7d6b0c6a5327b8f0b0c09653ad"
           role="tabpanel" aria-labelledby="heading-65859d7d6b0c6a5327b8f0b0c09653ad">
        
        
          
          
  <div class="category-post-list">
    
    
  </div>

          
  
    
    
    
    <div class="category-sub row nomargin-x">
      <a class="category-subitem 
          list-group-item category-item-action col-10 col-md-11 col-xm-11" title="Kibana"
        id="heading-5228fdd6f613af63fc73ee7c02ef8fb5" role="tab" data-toggle="collapse" href="#collapse-5228fdd6f613af63fc73ee7c02ef8fb5"
        aria-expanded="true"
      >
        Kibana
        <span class="list-group-count">(1)</span>
        <i class="iconfont icon-arrowright"></i>
      </a>
      
      <div class="category-collapse collapse show" id="collapse-5228fdd6f613af63fc73ee7c02ef8fb5"
           role="tabpanel" aria-labelledby="heading-5228fdd6f613af63fc73ee7c02ef8fb5">
        
        
          
  <div class="category-post-list">
    
    
      
      
        <a href="/blog/2023/08/26/MemorySearch%20%E5%BF%86%E6%90%9C%E9%98%81-%E5%BC%80%E5%8F%91%E6%96%87%E6%A1%A3/" title="MemorySearch å¿†æœé˜-å¼€å‘æ–‡æ¡£"
           class="list-group-item list-group-item-action
           active">
          <span class="category-post">MemorySearch å¿†æœé˜-å¼€å‘æ–‡æ¡£</span>
        </a>
      
    
  </div>

        
      </div>
    </div>
  
        
      </div>
    </div>
  
        
      </div>
    </div>
  
        
      </div>
    </div>
  
    
    
    
    <div class="category-sub row nomargin-x">
      <a class="category-subitem collapsed
          list-group-item category-item-action col-10 col-md-11 col-xm-11" title="é¡¹ç›®éƒ¨ç½²"
        id="heading-50be5e3b1697e929a38352262896962e" role="tab" data-toggle="collapse" href="#collapse-50be5e3b1697e929a38352262896962e"
        aria-expanded="false"
      >
        é¡¹ç›®éƒ¨ç½²
        <span class="list-group-count">(1)</span>
        <i class="iconfont icon-arrowright"></i>
      </a>
      
      <div class="category-collapse collapse " id="collapse-50be5e3b1697e929a38352262896962e"
           role="tabpanel" aria-labelledby="heading-50be5e3b1697e929a38352262896962e">
        
        
          
          
  <div class="category-post-list">
    
    
  </div>

          
  
    
    
    
    <div class="category-sub row nomargin-x">
      <a class="category-subitem collapsed
          list-group-item category-item-action col-10 col-md-11 col-xm-11" title="å¼€å‘ç»éªŒ"
        id="heading-bfd19ce0478d81a44ceb5a9a1aa94202" role="tab" data-toggle="collapse" href="#collapse-bfd19ce0478d81a44ceb5a9a1aa94202"
        aria-expanded="false"
      >
        å¼€å‘ç»éªŒ
        <span class="list-group-count">(1)</span>
        <i class="iconfont icon-arrowright"></i>
      </a>
      
      <div class="category-collapse collapse " id="collapse-bfd19ce0478d81a44ceb5a9a1aa94202"
           role="tabpanel" aria-labelledby="heading-bfd19ce0478d81a44ceb5a9a1aa94202">
        
        
          
          
  <div class="category-post-list">
    
    
  </div>

          
  
    
    
    
    <div class="category-sub row nomargin-x">
      <a class="category-subitem collapsed
          list-group-item category-item-action col-10 col-md-11 col-xm-11" title="ç½‘ç«™"
        id="heading-beb6c0bd8a66cea600c8ce40167eeb57" role="tab" data-toggle="collapse" href="#collapse-beb6c0bd8a66cea600c8ce40167eeb57"
        aria-expanded="false"
      >
        ç½‘ç«™
        <span class="list-group-count">(1)</span>
        <i class="iconfont icon-arrowright"></i>
      </a>
      
      <div class="category-collapse collapse " id="collapse-beb6c0bd8a66cea600c8ce40167eeb57"
           role="tabpanel" aria-labelledby="heading-beb6c0bd8a66cea600c8ce40167eeb57">
        
        
          
  <div class="category-post-list">
    
    
      
      
        <a href="/blog/2023/06/04/%E6%8F%AD%E7%A7%98%E9%A1%B9%E7%9B%AE%E9%83%A8%E7%BD%B2%E4%B8%8A%E7%BA%BF%E4%B9%8B%E8%B7%AF%EF%BC%9A%E6%B5%81%E7%A8%8B%E3%80%81%E6%8C%91%E6%88%98%E4%B8%8E%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/" title="æ­ç§˜é¡¹ç›®éƒ¨ç½²ä¸Šçº¿ä¹‹è·¯ï¼šæµç¨‹ã€æŒ‘æˆ˜ä¸è§£å†³æ–¹æ¡ˆ"
           class="list-group-item list-group-item-action
           ">
          <span class="category-post">æ­ç§˜é¡¹ç›®éƒ¨ç½²ä¸Šçº¿ä¹‹è·¯ï¼šæµç¨‹ã€æŒ‘æˆ˜ä¸è§£å†³æ–¹æ¡ˆ</span>
        </a>
      
    
  </div>

        
      </div>
    </div>
  
        
      </div>
    </div>
  
        
      </div>
    </div>
  
        
      </div>
    </div>
  
</div>


  </aside>


    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">MemorySearch å¿†æœé˜-å¼€å‘æ–‡æ¡£</h1>
            
              <p class="note note-success">
                
                  
                    æœ¬æ–‡æœ€åæ›´æ–°äºï¼š14 å¤©å‰
                  
                
              </p>
            
            
              <div class="markdown-body">
                
                <h1 id="MemorySearch-å¿†æœé˜"><a href="#MemorySearch-å¿†æœé˜" class="headerlink" title="MemorySearch å¿†æœé˜"></a>MemorySearch å¿†æœé˜</h1><p>å‰ç«¯ä»£ç ä»“åº“ï¼š<a target="_blank" rel="noopener" href="https://gitee.com/deng-2022/memory-search-frontend">memory-search-frontend</a></p>
<h2 id="â˜•-é¡¹ç›®æ¦‚è¿°"><a href="#â˜•-é¡¹ç›®æ¦‚è¿°" class="headerlink" title="â˜• é¡¹ç›®æ¦‚è¿°"></a>â˜• é¡¹ç›®æ¦‚è¿°</h2><p>è¿™ä¸ªé¡¹ç›®æ˜¯ä¸€ä¸ªåŸºäº <strong>Spring Boot + Elastic Stack æŠ€æœ¯æ ˆ + Vue.js</strong> çš„<code>èšåˆæœç´¢ä¸­å°</code>ã€‚å®ƒä¸ä»…æ˜¯ä¸€ä¸ªå¼ºå¤§çš„æœç´¢å¼•æ“ï¼Œæ›´æ˜¯ä¸€ä¸ªå†…å®¹ä¸°å¯Œçš„ç¤¾åŒºå¹³å°ã€‚</p>
<p>è¿™ä¸ªé¡¹ç›®çš„ç›®æ ‡æ˜¯æä¾›ä¸€ä¸ª<strong>ä¸€ç«™å¼çš„æœç´¢ã€ç®¡ç†å’Œäº’åŠ¨ä½“éªŒ</strong>ï¼Œæ»¡è¶³å„ç§ç”¨æˆ·éœ€æ±‚ã€‚</p>
<h2 id="ğŸ¥˜-æ•ˆæœå±•ç¤º"><a href="#ğŸ¥˜-æ•ˆæœå±•ç¤º" class="headerlink" title="ğŸ¥˜ æ•ˆæœå±•ç¤º"></a>ğŸ¥˜ æ•ˆæœå±•ç¤º</h2><h3 id="ç”¨æˆ·ç™»å½•"><a href="#ç”¨æˆ·ç™»å½•" class="headerlink" title="ç”¨æˆ·ç™»å½•"></a>ç”¨æˆ·ç™»å½•</h3><p><img src="https://gitee.com/deng-2022/pictures/raw/master/images/image-20240222202351543.png" alt="image-20240222202351543"></p>
<h3 id="å›¾ç‰‡æœç´¢"><a href="#å›¾ç‰‡æœç´¢" class="headerlink" title="å›¾ç‰‡æœç´¢"></a>å›¾ç‰‡æœç´¢</h3><p><img src="https://gitee.com/deng-2022/pictures/raw/master/images/image-20240222203543310.png" alt="image-20240222203543310"></p>
<h3 id="æ–‡ç« ä¸Šä¼ "><a href="#æ–‡ç« ä¸Šä¼ " class="headerlink" title="æ–‡ç« ä¸Šä¼ "></a>æ–‡ç« ä¸Šä¼ </h3><p><img src="https://gitee.com/deng-2022/pictures/raw/master/images/image-20240222203451920.png" alt="image-20240222203451920"></p>
<h3 id="ç»Ÿè®¡åˆ†æ"><a href="#ç»Ÿè®¡åˆ†æ" class="headerlink" title="ç»Ÿè®¡åˆ†æ"></a>ç»Ÿè®¡åˆ†æ</h3><p><img src="https://gitee.com/deng-2022/pictures/raw/master/images/image-20240222213338497.png" alt="image-20240222213338497"></p>
<h2 id="ğŸš-ä½¿ç”¨åœºæ™¯"><a href="#ğŸš-ä½¿ç”¨åœºæ™¯" class="headerlink" title="ğŸš ä½¿ç”¨åœºæ™¯"></a>ğŸš ä½¿ç”¨åœºæ™¯</h2><ul>
<li> ä¼ä¸šå†…éƒ¨å¤šé¡¹ç›®æ•°æ®æœç´¢ï¼šè¯¥å¹³å°èƒ½å¤Ÿæ»¡è¶³ä¼ä¸šå†…éƒ¨å¤šä¸ªé¡¹ç›®çš„æ•°æ®æœç´¢éœ€æ±‚ï¼Œé¿å…æ¯ä¸ªé¡¹ç›®éƒ½å•ç‹¬å¼€å‘æœç´¢åŠŸèƒ½ï¼Œæå‡å¼€å‘æ•ˆç‡å¹¶é™ä½ç³»ç»Ÿç»´æŠ¤æˆæœ¬ã€‚</li>
<li> å¤šæºå†…å®¹èšåˆæœç´¢ï¼šå½“éœ€è¦èšåˆä¸åŒæ¥æºã€ä¸åŒç±»å‹çš„å†…å®¹æ—¶ï¼Œè¯¥å¹³å°å¯ä»¥æä¾›ä¸€ç«™å¼çš„æœç´¢é¡µé¢ï¼Œä¾¿äºç”¨æˆ·å¿«é€ŸæŸ¥æ‰¾æ‰€éœ€ä¿¡æ¯ï¼Œæé«˜å·¥ä½œæ•ˆç‡ã€‚</li>
<li> ä¼ä¸šçº§æœç´¢éœ€æ±‚ï¼šå¯¹äºæœ‰å¤§è§„æ¨¡æœç´¢éœ€æ±‚çš„ä¼ä¸šï¼Œè¯¥å¹³å°æä¾›äº†ç¨³å®šçš„ã€é«˜æ•ˆçš„æœç´¢åŠŸèƒ½ï¼Œæ»¡è¶³ä¼ä¸šçš„æœç´¢éœ€æ±‚ï¼Œå¹¶æ”¯æŒæ•°æ®æºæ¥å…¥å’Œç®¡ç†ã€‚</li>
</ul>
<h2 id="ğŸ¥£-æ ¸å¿ƒåŠŸèƒ½ä¸ç‰¹ç‚¹"><a href="#ğŸ¥£-æ ¸å¿ƒåŠŸèƒ½ä¸ç‰¹ç‚¹" class="headerlink" title="ğŸ¥£ æ ¸å¿ƒåŠŸèƒ½ä¸ç‰¹ç‚¹"></a>ğŸ¥£ æ ¸å¿ƒåŠŸèƒ½ä¸ç‰¹ç‚¹</h2><ul>
<li><p> <strong>é«˜æ•ˆå¤šå…ƒæœç´¢</strong> ï¼šç”¨æˆ·å¯ä»¥åœ¨æœç´¢æ¡†ä¸­è¾“å…¥å…³é”®è¯ï¼Œç³»ç»Ÿä¼šæä¾›å¿«é€Ÿã€å‡†ç¡®çš„æœç´¢ç»“æœã€‚æœç´¢ç»“æœä¼šæ ¹æ®å†…å®¹ç±»å‹ï¼ˆæ–‡æœ¬ã€å›¾ç‰‡ã€è§†é¢‘ï¼‰è¿›è¡Œåˆ†ç±»å±•ç¤ºï¼Œå¹¶æä¾›å…³é”®è¯é«˜äº®å’Œæœç´¢å»ºè®®ï¼Œä½¿ç”¨æˆ·èƒ½å¿«é€Ÿæ‰¾åˆ°æ‰€éœ€å†…å®¹ã€‚</p>
</li>
<li><p> <strong>äº’åŠ¨åˆ›ä½œå¹³å°</strong> ï¼šç”¨æˆ·å¯ä»¥åœ¨è¿™ä¸ªæ¨¡å—ä¸­å‘å¸ƒæ–‡ç« ã€ä¸Šä¼ å›¾ç‰‡ï¼Œä¸å…¶ä»–ç”¨æˆ·äº’åŠ¨ã€‚ç³»ç»Ÿä¼šè‡ªåŠ¨æ¨èçƒ­é—¨å†…å®¹ï¼Œå¼•å¯¼ç”¨æˆ·å‘ç°æ›´å¤šä¼˜è´¨å†…å®¹ã€‚ç”¨æˆ·è¿˜å¯ä»¥å¯¹æ–‡ç« ã€å›¾ç‰‡è¿›è¡Œç‚¹èµã€è¯„è®ºå’Œæ”¶è—ï¼Œå½¢æˆä¸€ä¸ªæ´»è·ƒçš„å†…å®¹åˆ›ä½œç¤¾åŒºã€‚</p>
</li>
<li><p> <strong>æµé‡ç»Ÿè®¡åˆ†æ</strong> ï¼šç³»ç»Ÿä¼šè‡ªåŠ¨ç»Ÿè®¡æ¯ä¸ªå…³é”®è¯çš„æœç´¢æµé‡ï¼Œå¹¶æŒ‰ç…§æ—¶é—´ã€å…³é”®è¯ç±»å‹ç­‰ç»´åº¦è¿›è¡Œåˆ†æã€‚ç”¨æˆ·å¯ä»¥æŸ¥çœ‹çƒ­æœè¯ç±»åˆ«å’Œæœç´¢æµé‡é«˜å³°ï¼Œäº†è§£å†…å®¹è¶‹åŠ¿å’Œç”¨æˆ·è¡Œä¸ºã€‚</p>
</li>
<li><p> <strong>ä¸ªäººä¸­å¿ƒç®¡ç†</strong> ï¼šç”¨æˆ·å¯ä»¥åœ¨ä¸ªäººä¸­å¿ƒæŸ¥çœ‹å’Œç¼–è¾‘ä¸ªäººä¿¡æ¯ï¼ŒåŒ…æ‹¬å¤´åƒã€æ˜µç§°ã€ç®€ä»‹ç­‰ã€‚ç”¨æˆ·è¿˜å¯ä»¥æŸ¥çœ‹è‡ªå·±çš„ç‚¹èµã€è¯„è®ºå’Œæ”¶è—çš„å†…å®¹ï¼Œä»¥åŠè‡ªå·±åˆ›ä½œçš„æ–‡ç« å’Œä¸‹è½½çš„å›¾ç‰‡ã€è§†é¢‘ç­‰ã€‚</p>
</li>
<li><p> <strong>èµ„æºå…¨é¢ç®¡ç†</strong> ï¼šè¿™ä¸ªæ¨¡å—ä»…å¯¹ç®¡ç†å‘˜å¯è§ï¼Œç®¡ç†å‘˜å¯ä»¥å¯¹å…¨ç«™èµ„æºï¼ˆæ–‡ç« ã€å›¾ç‰‡ã€è§†é¢‘ã€ç”¨æˆ·ç­‰ï¼‰è¿›è¡Œå…¨é¢ç®¡ç†ã€‚ç®¡ç†å‘˜å¯ä»¥å¯¹èµ„æºè¿›è¡Œæ·»åŠ ã€åˆ é™¤ã€ä¿®æ”¹ç­‰æ“ä½œï¼Œä¿è¯èµ„æºçš„å‡†ç¡®æ€§å’Œå®Œæ•´æ€§ã€‚</p>
</li>
<li><p> <strong>å›¾ç‰‡é¢„è§ˆåˆ†äº«</strong> ï¼šé€šè¿‡é›†æˆçš„å›¾ç‰‡é¢„è§ˆåŠŸèƒ½ï¼Œç”¨æˆ·å¯ä»¥åƒæµè§ˆç›¸å†Œä¸€æ ·æŸ¥çœ‹é¡µé¢ä¸­çš„å›¾ç‰‡ï¼Œå¹¶æ”¯æŒç¼©æ”¾å’Œåˆ†äº«åˆ°ç¤¾äº¤åª’ä½“å¹³å°ã€‚</p>
</li>
</ul>
<h2 id="ğŸœ-è®¿é—®åœ°å€"><a href="#ğŸœ-è®¿é—®åœ°å€" class="headerlink" title="ğŸœ è®¿é—®åœ°å€"></a>ğŸœ è®¿é—®åœ°å€</h2><p>æš‚æœªéƒ¨ç½²ä¸Šçº¿ï¼Œç‚¹å‡»è·³è½¬è‡³ï¼š<a href="https://deng-2022.gitee.io/blog/2023/08/26/Memory%20%E8%81%9A%E5%90%88%E6%90%9C%E7%B4%A2%E5%B9%B3%E5%8F%B0-%E5%BC%80%E5%8F%91%E6%96%87%E6%A1%A3/">ä¸ªäººåšå®¢ MemorySearch å¼€å‘æ–‡æ¡£</a></p>
<h2 id="ğŸ-æ¶æ„è®¾è®¡"><a href="#ğŸ-æ¶æ„è®¾è®¡" class="headerlink" title="ğŸ æ¶æ„è®¾è®¡"></a>ğŸ æ¶æ„è®¾è®¡</h2><p>åŸå›¾é“¾æ¥ï¼š<a target="_blank" rel="noopener" href="https://www.yuque.com/huiyiruchu-7jxo6/ckx99i/lxw5okzip8hktuln?singleDoc#">é¡¹ç›®æ¶æ„å›¾</a></p>
<p><img src="https://gitee.com/deng-2022/pictures/raw/master/images/image-20240221231907060.png" alt="image-20240221231907060"></p>
<h2 id="ğŸº-æŠ€æœ¯é€‰å‹"><a href="#ğŸº-æŠ€æœ¯é€‰å‹" class="headerlink" title="ğŸº æŠ€æœ¯é€‰å‹"></a>ğŸº æŠ€æœ¯é€‰å‹</h2><h3 id="åç«¯"><a href="#åç«¯" class="headerlink" title="åç«¯"></a>åç«¯</h3><ul>
<li>Spring Bootï¼šä½œä¸ºé¡¹ç›®çš„æ ¸å¿ƒæ¡†æ¶ï¼Œæä¾›å¿«é€Ÿæ„å»º RESTful API çš„èƒ½åŠ›ã€‚</li>
<li>Elasticsearchï¼šä½œä¸ºæœç´¢å¼•æ“çš„æ ¸å¿ƒï¼Œæä¾›å…¨æ–‡æœç´¢ã€ç»“æ„åŒ–æœç´¢å’Œæ¨èç­‰åŠŸèƒ½ã€‚</li>
<li>Elasticsearch JDBCï¼šç”¨äºå°†å…³ç³»å‹æ•°æ®åº“ä¸­çš„æ•°æ®åŒæ­¥åˆ° Elasticsearch ä¸­ã€‚</li>
<li>Spring Data Elasticsearchï¼šæä¾›ä¸ Elasticsearch çš„é›†æˆï¼Œç®€åŒ– Elasticsearch æ“ä½œã€‚</li>
<li>Logstashï¼šç”¨äºæ—¥å¿—æ”¶é›†ã€è§£æå’Œä¼ è¾“ï¼Œä¾¿äºç›‘æ§å’Œè°ƒè¯•ã€‚</li>
<li>Kibanaï¼šç”¨äºå¯è§†åŒ–å±•ç¤º Elasticsearch ä¸­çš„æ•°æ®ï¼Œæä¾›å¼ºå¤§çš„æ•°æ®åˆ†æå’Œå¯è§†åŒ–åŠŸèƒ½ã€‚</li>
<li>Mybatisï¼šä½œä¸ºæŒä¹…å±‚æ¡†æ¶ï¼Œç”¨äºæ“ä½œå…³ç³»å‹æ•°æ®åº“ã€‚</li>
<li>Redisï¼šä½œä¸ºç¼“å­˜æ•°æ®åº“ï¼Œæé«˜ç³»ç»Ÿæ€§èƒ½ã€‚</li>
<li>Swaggerï¼šç”¨äº API æ–‡æ¡£çš„ç®¡ç†å’Œå±•ç¤ºã€‚</li>
</ul>
<h3 id="å‰ç«¯"><a href="#å‰ç«¯" class="headerlink" title="å‰ç«¯"></a>å‰ç«¯</h3><ul>
<li>Vue.jsï¼šä½œä¸ºå‰ç«¯æ¡†æ¶ï¼Œæä¾›å“åº”å¼è®¾è®¡å’Œç»„ä»¶åŒ–å¼€å‘çš„èƒ½åŠ›ã€‚</li>
<li>Element UIï¼šä½œä¸º Vue.js çš„ UI ç»„ä»¶åº“ï¼Œæä¾›ä¸°å¯Œçš„ç•Œé¢å…ƒç´ å’Œæ ·å¼ã€‚</li>
<li>Axiosï¼šç”¨äºå‘é€ HTTP è¯·æ±‚ï¼Œä¸åç«¯ API è¿›è¡Œäº¤äº’ã€‚</li>
<li>Vue Routerï¼šç”¨äºå®ç°å‰ç«¯è·¯ç”±ï¼Œç®¡ç†é¡µé¢è·³è½¬ã€‚</li>
<li>Vuexï¼šç”¨äºç®¡ç†å‰ç«¯çŠ¶æ€ï¼Œå®ç°ç»„ä»¶ä¹‹é—´çš„æ•°æ®å…±äº«å’Œé€šä¿¡ã€‚</li>
<li>EChartsï¼šç”¨äºæ•°æ®å¯è§†åŒ–ï¼Œå±•ç¤ºç»Ÿè®¡å›¾è¡¨ã€‚</li>
</ul>
<h2 id="ğŸ°-å¿«é€Ÿå¯åŠ¨"><a href="#ğŸ°-å¿«é€Ÿå¯åŠ¨" class="headerlink" title="ğŸ° å¿«é€Ÿå¯åŠ¨"></a>ğŸ° å¿«é€Ÿå¯åŠ¨</h2><Badge text="beta" type="warning"/>

<Badge text="Vdoingä¸»é¢˜"/>

<p>æ‹‰å–ä»£ç åï¼Œ å¦‚ä½•<code>å¿«é€Ÿè¿è¡Œè¯¥é¡¹ç›®</code>ï¼Ÿ</p>
<h3 id="åç«¯-1"><a href="#åç«¯-1" class="headerlink" title="åç«¯"></a>åç«¯</h3><ul>
<li>é…ç½® MySQLã€Redisã€Elasticsearch ä¸ºæœ¬æœºåœ°å€ï¼š</li>
</ul>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-comment"># MySQLé…ç½®</span><br><span class="hljs-attr">datasource:</span><br>  <span class="hljs-attr">driver-class-name:</span> <span class="hljs-string">com.mysql.cj.jdbc.Driver</span><br>  <span class="hljs-attr">url:</span> <span class="hljs-string">jdbc:mysql://localhost:3306/xxx</span><br>  <span class="hljs-attr">username:</span> <span class="hljs-string">xxx</span><br>  <span class="hljs-attr">password:</span> <span class="hljs-string">xxx</span><br></code></pre></td></tr></table></figure>

<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-comment"># Redis é…ç½®</span><br><span class="hljs-attr">redis:</span><br>  <span class="hljs-attr">database:</span> <span class="hljs-number">0</span><br>  <span class="hljs-attr">host:</span> <span class="hljs-string">localhost</span><br>  <span class="hljs-attr">port:</span> <span class="hljs-number">6379</span><br>  <span class="hljs-attr">timeout:</span> <span class="hljs-number">5000</span><br>  <span class="hljs-attr">password:</span> <span class="hljs-string">Dw990831</span><br></code></pre></td></tr></table></figure>

<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-comment"># ES é…ç½®</span><br><span class="hljs-attr">elasticsearch:</span><br>  <span class="hljs-attr">uris:</span> <span class="hljs-string">http://localhost:9200</span><br>  <span class="hljs-attr">username:</span> <span class="hljs-string">root</span><br>  <span class="hljs-attr">password:</span> <span class="hljs-number">123456</span><br></code></pre></td></tr></table></figure>

<h4 id="é¢å¤–å®‰è£…"><a href="#é¢å¤–å®‰è£…" class="headerlink" title="é¢å¤–å®‰è£…"></a>é¢å¤–å®‰è£…</h4><ul>
<li>åœ¨æœ¬åœ°å®‰è£… Elasticsearchã€Kibanaã€Logstash</li>
<li>åœ¨ <code>ES çš„ bin ç›®å½•</code>ä¸‹æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œå¯åŠ¨ ESï¼š</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">Elasticsearch.bat<br></code></pre></td></tr></table></figure>

<ul>
<li>åœ¨ <code>Kibana çš„ bin ç›®å½•</code>ä¸‹æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œå¯åŠ¨ Kibanaï¼š</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">Kibana.bat<br></code></pre></td></tr></table></figure>

<ul>
<li>åœ¨ <code>Logstash çš„ config ç›®å½•</code>ä¸‹æ–°å¢ .conf æ–‡ä»¶ï¼Œç¼–å†™é…ç½®æ–‡ä»¶ï¼Œåšå¥½æ•°æ®æ˜ å°„ï¼ˆä»¥ä¸‹é…ç½®ä¿¡æ¯å¯ä½œä¸ºå‚è€ƒï¼‰</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># Sample Logstash configuration for receiving</span><br><span class="hljs-comment"># UDP syslog messages over port 514</span><br><br>input &#123;<br>  jdbc &#123;<br>    jdbc_driver_library =&gt; <span class="hljs-string">&quot;D:\softWare\logstash\logstash-7.17.9\config\mysql-connector-java-8.0.29.jar&quot;</span><br>    jdbc_driver_class =&gt; <span class="hljs-string">&quot;com.mysql.jdbc.Driver&quot;</span><br>    jdbc_connection_string =&gt; <span class="hljs-string">&quot;jdbc:mysql://localhost:3306/******&quot;</span><br>    jdbc_user =&gt; <span class="hljs-string">&quot;******&quot;</span><br>    jdbc_password =&gt; <span class="hljs-string">&quot;******&quot;</span><br>    statement =&gt; <span class="hljs-string">&quot;SELECT * from post where updateTime &gt; :sql_last_value and updateTime &lt; now() order by updateTime desc&quot;</span><br>    use_column_value =&gt; <span class="hljs-literal">true</span><br>    tracking_column_type =&gt; <span class="hljs-string">&quot;timestamp&quot;</span><br>    tracking_column =&gt; <span class="hljs-string">&quot;updatetime&quot;</span><br>    schedule =&gt; <span class="hljs-string">&quot;*/5 * * * * *&quot;</span><br>    jdbc_default_timezone =&gt; <span class="hljs-string">&quot;Asia/Shanghai&quot;</span><br>  &#125;<br>&#125;<br><br>filter &#123;<br>  mutate &#123;<br>    rename =&gt; &#123;<br>      <span class="hljs-string">&quot;updatetime&quot;</span> =&gt; <span class="hljs-string">&quot;updateTime&quot;</span><br>      <span class="hljs-string">&quot;userid&quot;</span> =&gt; <span class="hljs-string">&quot;userId&quot;</span><br>      <span class="hljs-string">&quot;createtime&quot;</span> =&gt; <span class="hljs-string">&quot;createTime&quot;</span><br>      <span class="hljs-string">&quot;isdelete&quot;</span> =&gt; <span class="hljs-string">&quot;isDelete&quot;</span><br>    &#125;<br>    remove_field =&gt; [<span class="hljs-string">&quot;thumbnum&quot;</span>, <span class="hljs-string">&quot;favournum&quot;</span>]<br>  &#125;<br>&#125;<br><br>output &#123;<br>  stdout &#123; codec =&gt; rubydebug &#125;<br><br>  elasticsearch &#123;<br>    hosts =&gt; <span class="hljs-string">&quot;127.0.0.1:9200&quot;</span><br>    index =&gt; <span class="hljs-string">&quot;******&quot;</span><br>    document_id =&gt; <span class="hljs-string">&quot;%&#123;id&#125;&quot;</span><br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<ul>
<li>åœ¨ Logstash çš„<code>æ ¹ç›®å½•</code>ä¸‹æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œ<strong>åŠ è½½é…ç½®æ–‡ä»¶å¹¶å¯åŠ¨ Logstash</strong>ï¼š</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">.\bin\logstash.bat -f .\config\myTask.conf<br></code></pre></td></tr></table></figure>

<h3 id="å‰ç«¯-1"><a href="#å‰ç«¯-1" class="headerlink" title="å‰ç«¯"></a>å‰ç«¯</h3><p>::: warning æ³¨æ„<br>ç¡®ä¿æœ¬åœ° <code>Node.js ç¯å¢ƒé…ç½®</code>å®Œæˆï¼Œç‰ˆæœ¬ä¸º <code>v18.x.x</code>åŠä»¥ä¸Š<br>:::</p>
<ul>
<li>æ ¹æ®<code>åç«¯æ¥å£æ–‡æ¡£</code>ï¼Œä¸€é”®ç”Ÿæˆå‰ç«¯ HTTP è¯·æ±‚æ¥å£ï¼š</li>
</ul>
<blockquote>
<p>ğŸ– å®˜æ–¹æ–‡æ¡£ï¼š<a target="_blank" rel="noopener" href="https://github.com/ferdikoomen/openapi-typescript-codegen">ferdikoomen/openapi-typescript-codegen (github.com)</a></p>
</blockquote>
<p>å®‰è£…ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">npm install openapi-typescript-codegen --save-dev<br></code></pre></td></tr></table></figure>

<p>æ‰§è¡Œå‘½ä»¤ç”Ÿæˆä»£ç ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">openapi --input http://localhost:8104/api/v2/api-docs?group=memory-search --output ./generated --client axios<br></code></pre></td></tr></table></figure>

<ul>
<li>æ‰§è¡ŒæˆåŠŸåï¼Œåœ¨ OpenAPI.ts æ–‡ä»¶ä¸‹ï¼Œä¿®æ”¹è¯·æ±‚çš„åç«¯åœ°å€ï¼š</li>
</ul>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs ts"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title class_">OpenAPI</span>: <span class="hljs-title class_">OpenAPIConfig</span> = &#123;<br>  <span class="hljs-attr">BASE</span>: <span class="hljs-string">&quot;http://localhost:8104&quot;</span>,<br>  <span class="hljs-attr">VERSION</span>: <span class="hljs-string">&quot;1.0&quot;</span>,<br>  <span class="hljs-attr">WITH_CREDENTIALS</span>: <span class="hljs-literal">true</span>,<br>  <span class="hljs-attr">CREDENTIALS</span>: <span class="hljs-string">&quot;include&quot;</span>,<br>  <span class="hljs-attr">TOKEN</span>: <span class="hljs-literal">undefined</span>,<br>  <span class="hljs-attr">USERNAME</span>: <span class="hljs-literal">undefined</span>,<br>  <span class="hljs-attr">PASSWORD</span>: <span class="hljs-literal">undefined</span>,<br>  <span class="hljs-attr">HEADERS</span>: <span class="hljs-literal">undefined</span>,<br>  <span class="hljs-attr">ENCODE_PATH</span>: <span class="hljs-literal">undefined</span>,<br>&#125;;<br></code></pre></td></tr></table></figure>

<ul>
<li>æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œ<code>ä¸€é”®å¯åŠ¨</code>å‰ç«¯é¡¹ç›®ï¼š</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">npm run serve<br></code></pre></td></tr></table></figure>

<h2 id="ğŸ¥©-æŒç»­ä¼˜åŒ–"><a href="#ğŸ¥©-æŒç»­ä¼˜åŒ–" class="headerlink" title="ğŸ¥© æŒç»­ä¼˜åŒ–"></a>ğŸ¥© æŒç»­ä¼˜åŒ–</h2><p>éšç€é¡¹ç›®çš„å‘å±•å’Œç”¨æˆ·éœ€æ±‚çš„å¢åŠ ï¼Œæˆ‘ä»¬å°†æŒç»­ä¼˜åŒ–ç³»ç»Ÿæ€§èƒ½ï¼Œæå‡ç”¨æˆ·ä½“éªŒã€‚</p>
<p>åŠ å¼ºç³»ç»Ÿçš„å®‰å…¨æ€§æªæ–½ï¼Œå®šæœŸè¿›è¡Œå®‰å…¨å®¡è®¡å’Œæ¼æ´æ‰«æï¼Œç¡®ä¿ç”¨æˆ·æ•°æ®çš„å®‰å…¨ã€‚å¼•å…¥å¾®æœåŠ¡æ¶æ„å°†é¡¹ç›®å‘å®¹å™¨åŒ–éƒ¨ç½²å‘å±•ï¼Œç¡®ä¿ç³»ç»Ÿçš„å¯æ‰©å±•æ€§å’Œçµæ´»æ€§ã€‚</p>
<p>åŒæ—¶å°†å¼•å…¥æŒç»­é›†æˆä¸éƒ¨ç½²çš„æµç¨‹ï¼Œå®ç°è‡ªåŠ¨åŒ–æµ‹è¯•å’Œéƒ¨ç½²ä¸Šçº¿ï¼Œé™ä½è¿ç»´æˆæœ¬ã€‚</p>
<h1 id="æ­£æ–‡"><a href="#æ­£æ–‡" class="headerlink" title="æ­£æ–‡"></a>æ­£æ–‡</h1><h2 id="Day1"><a href="#Day1" class="headerlink" title="Day1"></a>Day1</h2><ul>
<li>å‰ç«¯é¡¹ç›®åˆå§‹åŒ– âœ”</li>
<li>åç«¯é¡¹ç›®åˆå§‹åŒ– âœ”</li>
<li>å‰ç«¯å°è£…å…¨å±€Axiosã€Indexé¡µé¢è®¾è®¡ âœ”</li>
<li>å®ç°ç”¨æˆ·æ”¹å˜é¡µé¢ï¼ŒURLåŒæ­¥æ”¹å˜</li>
<li>å‰åç«¯è”è°ƒæˆåŠŸ âœ”</li>
</ul>
<h3 id="è®°å½•"><a href="#è®°å½•" class="headerlink" title="è®°å½•"></a>è®°å½•</h3><ul>
<li>ä½¿ç”¨Ant Design Vueå¿«é€Ÿæ„å»ºäº†å‰ç«¯é¡¹ç›®ï¼Œå¿«æ·æ–¹ä¾¿ï¼Œé¡¹ç›®æ„å»ºçš„å®ç°æµç¨‹å…¨éƒ¨è®°å½•åœ¨ã€Šã€‹ä¸€æ–‡</li>
<li>æˆ‘ä½¿ç”¨äº†ä¸€å¥—æ¨¡æ¿ï¼Œå¿«é€Ÿå®ç°äº†åç«¯é¡¹ç›®åˆå§‹åŒ–</li>
<li>å‰ç«¯å°è£…å…¨å±€Axiosã€routerè·¯ç”±ã€åµŒå¥—è·¯ç”±ç­‰åŸºç¡€æ“ä½œï¼ŒåŒæ ·è®°å½•åœ¨äº†ã€Šã€‹ä¸€æ–‡ä¸­</li>
<li>åç«¯é€ äº†å‡ æ¡postè¯„è®ºå‡æ•°æ®ï¼Œå‰ç«¯ä½¿ç”¨åˆ—è¡¨ç»„ä»¶ï¼Œç®€å•å±•ç¤º</li>
<li>URLåŒæ­¥é¡µé¢çŠ¶æ€æ”¹å˜ï¼Œå¯éš¾æ­»æˆ‘äº†ï¼š<ul>
<li>ä½¿ç”¨urlè®°å½•é¡µé¢æœç´¢çŠ¶æ€ï¼Œå½“ç”¨æˆ·åˆ·æ–°é¡µé¢æ—¶ï¼Œèƒ½å¤Ÿä»urlä¸­è¿˜åŸä¹‹å‰çš„æœç´¢çŠ¶æ€</li>
<li>å®ç°ï¼šç”¨æˆ·æ“ä½œé¡µé¢ï¼Œèƒ½å¤Ÿæ”¹å˜urlåœ°å€ï¼ˆæœç´¢å†…å®¹åŒæ­¥å¡«å……åœ¨urlï¼Œåˆ‡æ¢tabé¡µæ—¶ï¼Œä¹Ÿè¦å¡«å……ï¼‰</li>
<li>urlæ”¹å˜ï¼Œå»æ”¹å˜å¯¹åº”é¡µé¢çŠ¶æ€</li>
</ul>
</li>
</ul>
<h2 id="Day2"><a href="#Day2" class="headerlink" title="Day2"></a>Day2</h2><ul>
<li><h5 id="åç«¯è·å–åˆ°æ–‡ç« ã€ç”¨æˆ·ã€å›¾ç‰‡ä¿¡æ¯"><a href="#åç«¯è·å–åˆ°æ–‡ç« ã€ç”¨æˆ·ã€å›¾ç‰‡ä¿¡æ¯" class="headerlink" title="åç«¯è·å–åˆ°æ–‡ç« ã€ç”¨æˆ·ã€å›¾ç‰‡ä¿¡æ¯"></a>åç«¯è·å–åˆ°æ–‡ç« ã€ç”¨æˆ·ã€å›¾ç‰‡ä¿¡æ¯</h5></li>
<li><p>äº†è§£æ•°æ®æŠ“å–çš„å‡ ç§æ–¹å¼</p>
</li>
</ul>
<h3 id="æ•°æ®æŠ“å–æµç¨‹"><a href="#æ•°æ®æŠ“å–æµç¨‹" class="headerlink" title="æ•°æ®æŠ“å–æµç¨‹"></a>æ•°æ®æŠ“å–æµç¨‹</h3><ul>
<li>åˆ†ææ•°æ®ï¼Œæ€ä¹ˆæŠ“å–</li>
<li>æ‹¿åˆ°æ•°æ®åï¼Œæ€ä¹ˆå¤„ç†</li>
<li>å†™å…¥æ•°æ®åº“ï¼ŒæŒä¹…åŒ–å­˜å‚¨</li>
</ul>
<h3 id="æ•°æ®æŠ“å–çš„å‡ ç§æ–¹å¼"><a href="#æ•°æ®æŠ“å–çš„å‡ ç§æ–¹å¼" class="headerlink" title="æ•°æ®æŠ“å–çš„å‡ ç§æ–¹å¼"></a>æ•°æ®æŠ“å–çš„å‡ ç§æ–¹å¼</h3><ul>
<li><p>ç›´æ¥è¯·æ±‚æ•°æ®æ¥å£ï¼ˆæœ€æ–¹ä¾¿ï¼‰ï¼Œå¯ä½¿ç”¨HttpClientã€Hutoolç­‰å®¢æˆ·ç«¯å‘é€è¯·æ±‚</p>
</li>
<li><p>è§£æ<strong>HTMLæ–‡æ¡£/JSONå­—ç¬¦ä¸²</strong>ä¸­çš„ç½‘é¡µå†…å®¹ï¼Œè·å–æ•°æ®</p>
</li>
<li><p>jsoupè§£æåº“ï¼Œæ”¯æŒå‘é€è¯·æ±‚è·å–HTMLæ–‡æ¡£ï¼Œè§£ææ•°æ®</p>
</li>
</ul>
<h3 id="æ–‡ç« è·å–"><a href="#æ–‡ç« è·å–" class="headerlink" title="æ–‡ç« è·å–"></a>æ–‡ç« è·å–</h3><ul>
<li><p>å»å…¶ä»–ç½‘ç«™æŠ“å–ï¼ŒæŒä¹…åŒ–å­˜å‚¨åˆ°æ•°æ®åº“ä¸­</p>
</li>
<li><h5 id="ä»äº’è”ç½‘ä¸Šè·å–æ•°æ®-gt-çˆ¬è™«"><a href="#ä»äº’è”ç½‘ä¸Šè·å–æ•°æ®-gt-çˆ¬è™«" class="headerlink" title="ä»äº’è”ç½‘ä¸Šè·å–æ•°æ® -&gt; çˆ¬è™«"></a>ä»äº’è”ç½‘ä¸Šè·å–æ•°æ® -&gt; çˆ¬è™«</h5></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs java">  <span class="hljs-comment">// 1. è·å–æ•°æ®</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">json</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;&#123;\&quot;current\&quot;:1,\&quot;pageSize\&quot;:8,\&quot;sortField\&quot;:\&quot;createTime\&quot;,\&quot;sortOrder\&quot;:\&quot;descend\&quot;,\&quot;category\&quot;:\&quot;æ–‡ç« \&quot;,\&quot;reviewStatus\&quot;:1&#125;&quot;</span>;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">url</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;https://www.code-nav.cn/api/post/search/page/vo&quot;</span>;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> HttpRequest<br>                .post(url)<br>                .body(json)<br>                .execute()<br>                .body();<br><span class="hljs-comment">//        System.out.println(result);</span><br>        <span class="hljs-comment">// 2. json è½¬å¯¹è±¡</span><br>        Map&lt;String, Object&gt; map = JSONUtil.toBean(result, Map.class);<br>        <span class="hljs-type">JSONObject</span> <span class="hljs-variable">data</span> <span class="hljs-operator">=</span> (JSONObject) map.get(<span class="hljs-string">&quot;data&quot;</span>);<br>        <span class="hljs-type">JSONArray</span> <span class="hljs-variable">records</span> <span class="hljs-operator">=</span> (JSONArray) data.get(<span class="hljs-string">&quot;records&quot;</span>);<br>        List&lt;Post&gt; articleList = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br>        <span class="hljs-keyword">for</span> (Object record : records) &#123;<br>            <span class="hljs-type">JSONObject</span> <span class="hljs-variable">tempRecord</span> <span class="hljs-operator">=</span> (JSONObject) record;<br>            <span class="hljs-type">Post</span> <span class="hljs-variable">post</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Post</span>();<br>            post.setTitle(tempRecord.getStr(<span class="hljs-string">&quot;title&quot;</span>));<br>            post.setContent(tempRecord.getStr(<span class="hljs-string">&quot;content&quot;</span>));<br>            <span class="hljs-type">JSONArray</span> <span class="hljs-variable">tags</span> <span class="hljs-operator">=</span> (JSONArray) tempRecord.get(<span class="hljs-string">&quot;tags&quot;</span>);<br>            List&lt;String&gt; tagList = tags.toList(String.class);<br>            post.setTags(JSONUtil.toJsonStr(tagList));<br>            post.setUserId(<span class="hljs-number">1L</span>);<br>            articleList.add(post);<br>        &#125;<br><span class="hljs-comment">//        System.out.println(articleList);</span><br>        <span class="hljs-comment">// 3. æ•°æ®å…¥åº“</span><br>        <span class="hljs-type">boolean</span> <span class="hljs-variable">b</span> <span class="hljs-operator">=</span> postService.saveBatch(articleList);<br>        Assertions.assertTrue(b);<br>    &#125;<br></code></pre></td></tr></table></figure>



<h3 id="ç”¨æˆ·è·å–"><a href="#ç”¨æˆ·è·å–" class="headerlink" title="ç”¨æˆ·è·å–"></a>ç”¨æˆ·è·å–</h3><ul>
<li>æœ¬åœ°æ•°æ®ï¼Œæ¯ä¸ªç½‘ç«™çš„ç”¨æˆ·åŸºæœ¬éƒ½æ˜¯è‡ªå·±çš„ï¼Œæ— éœ€ä»å¤–ç«™è·å–</li>
</ul>
<h3 id="å›¾ç‰‡è·å–"><a href="#å›¾ç‰‡è·å–" class="headerlink" title="å›¾ç‰‡è·å–"></a>å›¾ç‰‡è·å–</h3><ul>
<li>å®æ—¶æŠ“å–ï¼Œè¿™éƒ¨åˆ†æ•°æ®ä¸å­˜æ”¾åœ¨æœ¬åœ°æ•°æ®åº“ï¼Œç›´æ¥ä»åˆ«äººçš„æ¥å£ï¼ˆç½‘ç«™/æ•°æ®åº“ï¼‰ä¸­è·å–</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs java">  <span class="hljs-type">long</span> <span class="hljs-variable">current</span> <span class="hljs-operator">=</span> currentPage - <span class="hljs-number">1</span>;<br>        <span class="hljs-comment">// éç©ºæ¡ä»¶ï¼Œè½¬ç </span><br>        <span class="hljs-keyword">if</span> (StringUtils.isNotBlank(searchText)) &#123;<br>            searchText = URLEncoder.encode(searchText, <span class="hljs-string">&quot;UTF-8&quot;</span>);<br>        &#125;<br><br>        <span class="hljs-type">String</span> <span class="hljs-variable">url</span> <span class="hljs-operator">=</span> String.format(<span class="hljs-string">&quot;https://cn.bing.com/images/search?q=%s&amp;first=%s&quot;</span>, searchText, current);<br>        <span class="hljs-type">Document</span> <span class="hljs-variable">doc</span> <span class="hljs-operator">=</span> Jsoup.connect(url).get();<br>        <span class="hljs-type">Elements</span> <span class="hljs-variable">elements</span> <span class="hljs-operator">=</span> doc.select(<span class="hljs-string">&quot;.iuscp.isv&quot;</span>);<br>        List&lt;Picture&gt; pictureList = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br>        <span class="hljs-keyword">for</span> (Element element : elements) &#123;<br>            <span class="hljs-comment">// å–å›¾ç‰‡åœ°å€ï¼ˆmurlï¼‰</span><br>            <span class="hljs-type">String</span> <span class="hljs-variable">m</span> <span class="hljs-operator">=</span> element.select(<span class="hljs-string">&quot;.iusc&quot;</span>).get(<span class="hljs-number">0</span>).attr(<span class="hljs-string">&quot;m&quot;</span>);<br>            Map&lt;String, Object&gt; map = JSONUtil.toBean(m, Map.class);<br>            <span class="hljs-type">String</span> <span class="hljs-variable">murl</span> <span class="hljs-operator">=</span> (String) map.get(<span class="hljs-string">&quot;murl&quot;</span>);<br><span class="hljs-comment">//            System.out.println(murl);</span><br>            <span class="hljs-comment">// å–æ ‡é¢˜</span><br>            <span class="hljs-type">String</span> <span class="hljs-variable">title</span> <span class="hljs-operator">=</span> element.select(<span class="hljs-string">&quot;.inflnk&quot;</span>).get(<span class="hljs-number">0</span>).attr(<span class="hljs-string">&quot;aria-label&quot;</span>);<br><span class="hljs-comment">//            System.out.println(title);</span><br>            <span class="hljs-type">Picture</span> <span class="hljs-variable">picture</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Picture</span>();<br>            picture.setTitle(title);<br>            picture.setUrl(murl);<br>            pictureList.add(picture);<br>        &#125;<br><br>        Page&lt;Picture&gt; picturePage = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Page</span>&lt;&gt;(pageSize, currentPage);<br>        picturePage.setRecords(pictureList);<br><br>        <span class="hljs-keyword">return</span> picturePage;<br></code></pre></td></tr></table></figure>



<h2 id="Day3"><a href="#Day3" class="headerlink" title="Day3"></a>Day3</h2><h3 id="ç°æœ‰ä¸šåŠ¡åœºæ™¯åˆ†æ"><a href="#ç°æœ‰ä¸šåŠ¡åœºæ™¯åˆ†æ" class="headerlink" title="ç°æœ‰ä¸šåŠ¡åœºæ™¯åˆ†æ"></a>ç°æœ‰ä¸šåŠ¡åœºæ™¯åˆ†æ</h3><p>å®ç°äº†åœ¨é¡µé¢è·å–æ–‡ç« ã€ç”¨æˆ·å’Œå›¾ç‰‡æ•°æ®</p>
<p>å‡ ç§ä¸åŒçš„ä¸šåŠ¡åœºæ™¯åˆ†æï¼š</p>
<ul>
<li>å¯ä»¥æ ¹æ®<strong>ä¸åŒçš„Tabé¡µï¼Œå‘é€ä¸åŒçš„è¯·æ±‚</strong>ï¼Œå½“ç”¨æˆ·ç‚¹å‡»åˆ‡æ¢æ ‡ç­¾é¡µï¼Œå‘é€ä¸åŒçš„è¯·æ±‚</li>
<li>å¦‚æœæ˜¯<strong>èšåˆå†…å®¹</strong>çš„ç½‘é¡µï¼Œå¯ä»¥è€ƒè™‘è®¾è®¡åç«¯ç»Ÿä¸€è¯·æ±‚æ¥å£ï¼Œè®¾è®¡ä¸€ä¸ªè¯·æ±‚æå®šæ‰€æœ‰æœç´¢æŸ¥è¯¢è¯·æ±‚</li>
<li>è€ƒè™‘åˆ°ä¸šåŠ¡çš„æ‰©å±•æ€§ï¼šæ›´å¤šçš„æœç´¢æ¡ä»¶ï¼Œæœç´¢æ›´å¤šçš„ä¿¡æ¯ã€‚æ¯”å¦‚ä¸ç›´æ¥è¿”å›æ•°æ®ï¼Œä½†è¿”å›æ•°æ®æ€»æ•°ï¼Œç»™äºˆç”¨æˆ·åé¦ˆ</li>
</ul>
<h3 id="èšåˆæœç´¢"><a href="#èšåˆæœç´¢" class="headerlink" title="èšåˆæœç´¢"></a>èšåˆæœç´¢</h3><ol>
<li>æµè§ˆå™¨å¯èƒ½ä¼šé™åˆ¶è¯·æ±‚æ•°é‡ï¼Œå¯ä»¥è€ƒè™‘åç«¯ç»Ÿä¸€æ¥å£ï¼Œä¸€ä¸ªæ¥å£æå®šæ‰€æœ‰æŸ¥è¯¢è¯·æ±‚æ•°æ®ï¼ˆåç«¯å¯ä»¥å¹¶å‘ï¼‰</li>
<li><strong>è®¾è®¡å¤šä¸ªç‰¹å®šçš„æ¥å£ï¼Œåˆ†åˆ«æ¥æ”¶ä¸åŒçš„æŸ¥è¯¢è¯·æ±‚</strong>ï¼šä¸åŒçš„æ¥å£æ¥æ”¶çš„<strong>å‚æ•°ä¸ä¸€è‡´</strong>ï¼Œå¢åŠ äº†å‰åç«¯æ²Ÿé€šçš„è´Ÿæ‹…ï¼Œå¯ä»¥è€ƒè™‘ç”¨ä¸€ä¸ªæ¥å£å°†è¯·æ±‚å‚æ•°ç»Ÿä¸€ï¼Œå‰ç«¯åªéœ€ä¼ å…¥å›ºå®šçš„å‚æ•°ï¼Œåç«¯è´Ÿè´£è½¬æ¢å’Œå¤„ç†å‚æ•°ï¼Œå‡è½»å‰ç«¯å‹åŠ›  -&gt; <strong>æ¯”å¦‚ç¼–ç¨‹å¯¼èˆªçš„åˆ†ç±»è¯·æ±‚</strong></li>
</ol>
<h3 id="Javaå¹¶å‘"><a href="#Javaå¹¶å‘" class="headerlink" title="Javaå¹¶å‘"></a>Javaå¹¶å‘</h3><ul>
<li>å¼‚æ­¥æ‰§è¡Œï¼Œæå‡æ€§èƒ½</li>
</ul>
<h3 id="é€‚é…å™¨æ¨¡å¼"><a href="#é€‚é…å™¨æ¨¡å¼" class="headerlink" title="é€‚é…å™¨æ¨¡å¼"></a>é€‚é…å™¨æ¨¡å¼</h3><ul>
<li><p><a target="_blank" rel="noopener" href="https://juejin.cn/post/6844903541413249032">é€‚é…å™¨æ¨¡å¼ï¼ˆAdapter Patternï¼‰ - æ˜é‡‘ (juejin.cn)</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://juejin.cn/post/7030820543909593102">è®¾è®¡æ¨¡å¼ä¹‹é€‚é…å™¨æ¨¡å¼(Adapter Pattern)ä¸€ - æ˜é‡‘ (juejin.cn)</a></p>
</li>
</ul>
<h3 id="æ³¨å†Œå™¨æ¨¡å¼"><a href="#æ³¨å†Œå™¨æ¨¡å¼" class="headerlink" title="æ³¨å†Œå™¨æ¨¡å¼"></a>æ³¨å†Œå™¨æ¨¡å¼</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@PostConstruct</span><br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doInit</span><span class="hljs-params">()</span> &#123;<br>      System.out.println(<span class="hljs-number">1</span>);<br>      typeDataSourceMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>() &#123;&#123;<br>          put(SearchTypeEnum.POST.getValue(), postDataSource);<br>          put(SearchTypeEnum.USER.getValue(), userDataSource);<br>          put(SearchTypeEnum.PICTURE.getValue(), pictureDataSource);<br>      &#125;&#125;;<br>  &#125;<br></code></pre></td></tr></table></figure>



<h5 id="ä½¿ç”¨é€‚é…å™¨æ¨¡å¼ï¼Œå¹²æ‰äº†å†—é•¿å¤æ‚çš„-switch"><a href="#ä½¿ç”¨é€‚é…å™¨æ¨¡å¼ï¼Œå¹²æ‰äº†å†—é•¿å¤æ‚çš„-switch" class="headerlink" title="ä½¿ç”¨é€‚é…å™¨æ¨¡å¼ï¼Œå¹²æ‰äº†å†—é•¿å¤æ‚çš„ switch"></a>ä½¿ç”¨é€‚é…å™¨æ¨¡å¼ï¼Œå¹²æ‰äº†å†—é•¿å¤æ‚çš„ switch</h5><h2 id="Day4"><a href="#Day4" class="headerlink" title="Day4"></a>Day4</h2><h4 id="æ ¹æ®é¡µé¢ï¼Œé€‰æ‹©æ€§æŸ¥è¯¢å¯¹åº”é¡µé¢çš„æ•°æ®"><a href="#æ ¹æ®é¡µé¢ï¼Œé€‰æ‹©æ€§æŸ¥è¯¢å¯¹åº”é¡µé¢çš„æ•°æ®" class="headerlink" title="æ ¹æ®é¡µé¢ï¼Œé€‰æ‹©æ€§æŸ¥è¯¢å¯¹åº”é¡µé¢çš„æ•°æ®"></a>æ ¹æ®é¡µé¢ï¼Œé€‰æ‹©æ€§æŸ¥è¯¢å¯¹åº”é¡µé¢çš„æ•°æ®</h4><p>æˆ‘ä»¬å®ç°å‰ç«¯åˆ‡æ¢æ–‡ç« ã€ç”¨æˆ·å’Œå›¾ç‰‡çš„Tabé¡µé¢æ—¶ï¼Œä¼ å…¥typeï¼ˆé¡µé¢ç±»å‹ï¼‰å‚æ•°ï¼Œç”¨æ¥æŒ‡å®šæœç´¢<strong>å“ªä¸ªé¡µé¢çš„æ•°æ®</strong>ï¼Œè€Œéå…¨éƒ¨æœç´¢</p>
<p>å‰ç«¯ä¼ å…¥typeï¼ˆç±»å‹ï¼‰å‚æ•°ï¼Œé€šçŸ¥åç«¯ï¼Œæ ¹æ®<strong>ç±»å‹</strong>æœç´¢<strong>å¯¹åº”é¡µé¢</strong>çš„æ•°æ®</p>
<p>é»˜è®¤typeä¸ºç©ºï¼Œåˆ™æœç´¢æ‰€æœ‰é¡µé¢æ•°æ®</p>
<h2 id="Day5"><a href="#Day5" class="headerlink" title="Day5"></a>Day5</h2><ul>
<li>å†æˆåŠŸåœ°å°†ES å’Œ MySQLæ•°æ®åŒæ­¥åï¼Œç»ˆäºå¯ä»¥è¿›è¡Œä¸‹ä¸€æ­¥äº†</li>
</ul>
<h3 id="æœç´¢é«˜äº®"><a href="#æœç´¢é«˜äº®" class="headerlink" title="æœç´¢é«˜äº®"></a>æœç´¢é«˜äº®</h3><ul>
<li><h5 id="å®˜æ–¹æ–‡æ¡£ï¼š-Highlighting-Elasticsearch-Guide-7-17-Elastic"><a href="#å®˜æ–¹æ–‡æ¡£ï¼š-Highlighting-Elasticsearch-Guide-7-17-Elastic" class="headerlink" title="å®˜æ–¹æ–‡æ¡£ï¼š[Highlighting | Elasticsearch Guide 7.17] | Elastic"></a>å®˜æ–¹æ–‡æ¡£ï¼š[Highlighting | Elasticsearch Guide <a target="_blank" rel="noopener" href="https://www.elastic.co/guide/en/elasticsearch/reference/7.17/highlighting.html">7.17] | Elastic</a></h5></li>
<li><h5 id="å¦‚ä½•ä½¿æœç´¢è¯é«˜äº®ï¼ŸESæ–‡æ¡£é‡Œæœ‰ç°æˆçš„demoï¼š"><a href="#å¦‚ä½•ä½¿æœç´¢è¯é«˜äº®ï¼ŸESæ–‡æ¡£é‡Œæœ‰ç°æˆçš„demoï¼š" class="headerlink" title="å¦‚ä½•ä½¿æœç´¢è¯é«˜äº®ï¼ŸESæ–‡æ¡£é‡Œæœ‰ç°æˆçš„demoï¼š"></a>å¦‚ä½•ä½¿æœç´¢è¯é«˜äº®ï¼ŸESæ–‡æ¡£é‡Œæœ‰ç°æˆçš„demoï¼š</h5></li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">GET</span> <span class="hljs-operator">/</span>_search<br>&#123;<br>  &quot;query&quot;: &#123;<br>    &quot;match&quot;: &#123; &quot;content&quot;: &quot;kimchy&quot; &#125;<br>  &#125;,<br>  &quot;highlight&quot;: &#123;<br>    &quot;fields&quot;: &#123;<br>      &quot;content&quot;: &#123;&#125;<br>    &#125;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<ul>
<li>æˆ‘ä»¬æ‰§è¡Œæœç´¢ï¼Œèƒ½å¾—åˆ°å¦‚ä¸‹æ ‡è¯†å‡ºæ¥çš„é«˜äº®è¯ï¼š</li>
</ul>
<p><img src="C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20231001205230841.png" alt="image-20231001205230841"></p>
<h4 id="åç«¯-2"><a href="#åç«¯-2" class="headerlink" title="åç«¯"></a>åç«¯</h4><ul>
<li><h5 id="æˆ‘ä»¬ä½¿ç”¨-Javaå®¢æˆ·ç«¯ï¼Œè¿™æ ·ç¼–å†™ï¼š"><a href="#æˆ‘ä»¬ä½¿ç”¨-Javaå®¢æˆ·ç«¯ï¼Œè¿™æ ·ç¼–å†™ï¼š" class="headerlink" title="æˆ‘ä»¬ä½¿ç”¨ Javaå®¢æˆ·ç«¯ï¼Œè¿™æ ·ç¼–å†™ï¼š"></a>æˆ‘ä»¬ä½¿ç”¨ Javaå®¢æˆ·ç«¯ï¼Œè¿™æ ·ç¼–å†™ï¼š</h5></li>
<li><h5 id="ä½¿æ‰€æœ‰å­—æ®µå†…åŒ¹é…çš„å…³é”®å­—é«˜äº®ï¼š-ï¼ˆ2023-10-01æ™šï¼‰"><a href="#ä½¿æ‰€æœ‰å­—æ®µå†…åŒ¹é…çš„å…³é”®å­—é«˜äº®ï¼š-ï¼ˆ2023-10-01æ™šï¼‰" class="headerlink" title="ä½¿æ‰€æœ‰å­—æ®µå†…åŒ¹é…çš„å…³é”®å­—é«˜äº®ï¼š ï¼ˆ2023/10/01æ™šï¼‰"></a>ä½¿æ‰€æœ‰å­—æ®µå†…åŒ¹é…çš„å…³é”®å­—é«˜äº®ï¼š <strong>ï¼ˆ2023/10/01æ™šï¼‰</strong></h5></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// æœç´¢å…³é”®è¯é«˜äº®</span><br><span class="hljs-type">HighlightBuilder</span> <span class="hljs-variable">highlightBuilder</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">HighlightBuilder</span>();<br>highlightBuilder.field(<span class="hljs-string">&quot;*&quot;</span>)<br>        .preTags(<span class="hljs-string">&quot;&lt;font color=&#x27;#eea6b7&#x27;&gt;&quot;</span>)<br>        .postTags(<span class="hljs-string">&quot;&lt;/font&gt;&quot;</span>); <span class="hljs-comment">//æ‰€æœ‰çš„å­—æ®µéƒ½é«˜äº®</span><br>highlightBuilder.requireFieldMatch(<span class="hljs-literal">false</span>);<span class="hljs-comment">//å¦‚æœè¦å¤šä¸ªå­—æ®µé«˜äº®,è¿™é¡¹è¦ä¸ºfalse</span><br></code></pre></td></tr></table></figure>

<ul>
<li><h5 id="æˆ–è€…æŒ‡å®šå›ºå®šå­—æ®µå†…çš„å…³é”®è¯é«˜äº®ï¼š"><a href="#æˆ–è€…æŒ‡å®šå›ºå®šå­—æ®µå†…çš„å…³é”®è¯é«˜äº®ï¼š" class="headerlink" title="æˆ–è€…æŒ‡å®šå›ºå®šå­—æ®µå†…çš„å…³é”®è¯é«˜äº®ï¼š"></a>æˆ–è€…æŒ‡å®šå›ºå®šå­—æ®µå†…çš„å…³é”®è¯é«˜äº®ï¼š</h5></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//æŸ¥è¯¢å¸¦highlightï¼Œæ ‡é¢˜å’Œå†…å®¹éƒ½å¸¦ä¸Š</span><br>      <span class="hljs-type">HighlightBuilder</span> <span class="hljs-variable">highlightBuilder</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">HighlightBuilder</span>()<br>              .field(<span class="hljs-string">&quot;content&quot;</span>)<br>              .requireFieldMatch(<span class="hljs-literal">false</span>)<br>              .preTags(<span class="hljs-string">&quot;&lt;font color=&#x27;#eea6b7&#x27;&gt;&quot;</span>)<br>              .postTags(<span class="hljs-string">&quot;&lt;/font&gt;&quot;</span>);<br>      highlightBuilder.field(<span class="hljs-string">&quot;title&quot;</span>)<br>              .requireFieldMa<br></code></pre></td></tr></table></figure>

<ul>
<li><h5 id="åœ¨æ„é€ æŸ¥è¯¢ä¸­ï¼Œé…ç½®å…³é”®å­—é«˜äº®æ˜¾ç¤ºï¼š"><a href="#åœ¨æ„é€ æŸ¥è¯¢ä¸­ï¼Œé…ç½®å…³é”®å­—é«˜äº®æ˜¾ç¤ºï¼š" class="headerlink" title="åœ¨æ„é€ æŸ¥è¯¢ä¸­ï¼Œé…ç½®å…³é”®å­—é«˜äº®æ˜¾ç¤ºï¼š"></a>åœ¨æ„é€ æŸ¥è¯¢ä¸­ï¼Œé…ç½®å…³é”®å­—é«˜äº®æ˜¾ç¤ºï¼š</h5></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// æ„é€ æŸ¥è¯¢</span><br>     <span class="hljs-type">NativeSearchQuery</span> <span class="hljs-variable">searchQuery</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">NativeSearchQueryBuilder</span>()<br>             .withQuery(boolQueryBuilder)<br>             .withHighlightBuilder(highlightBuilder)<br>             .withPageable(pageRequest)<br>             .withSorts(sortBuilder).build();<br></code></pre></td></tr></table></figure>

<ul>
<li><h5 id="æˆ‘ä»¬æŠ½è±¡å‡ºä¸€ä¸ªç±»ï¼Œå­˜æ”¾è·å–çš„é«˜äº®å…³é”®è¯ï¼š"><a href="#æˆ‘ä»¬æŠ½è±¡å‡ºä¸€ä¸ªç±»ï¼Œå­˜æ”¾è·å–çš„é«˜äº®å…³é”®è¯ï¼š" class="headerlink" title="æˆ‘ä»¬æŠ½è±¡å‡ºä¸€ä¸ªç±»ï¼Œå­˜æ”¾è·å–çš„é«˜äº®å…³é”®è¯ï¼š"></a>æˆ‘ä»¬æŠ½è±¡å‡ºä¸€ä¸ªç±»ï¼Œå­˜æ”¾è·å–çš„é«˜äº®å…³é”®è¯ï¼š</h5></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java">List&lt;SearchHit&lt;PostEsDTO&gt;&gt; searchHitList = searchHits.getSearchHits();<br>         <span class="hljs-comment">// æœç´¢å…³é”®è¯é«˜äº®</span><br>         Map&lt;Long, PostEsHighlightData&gt; highlightDataMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br>         <span class="hljs-keyword">for</span> (SearchHit hit : searchHits.getSearchHits()) &#123;<br>             <span class="hljs-type">PostEsHighlightData</span> <span class="hljs-variable">data</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">PostEsHighlightData</span>();<br>             data.setId(Long.valueOf(hit.getId()));<br>             <span class="hljs-keyword">if</span> (hit.getHighlightFields().get(<span class="hljs-string">&quot;title&quot;</span>) != <span class="hljs-literal">null</span>) &#123;<br>                 <span class="hljs-type">String</span> <span class="hljs-variable">highlightTitle</span> <span class="hljs-operator">=</span> String.valueOf(hit.getHighlightFields().get(<span class="hljs-string">&quot;title&quot;</span>));<br>                 data.setTitle(highlightTitle.substring(<span class="hljs-number">1</span>, highlightTitle.length() - <span class="hljs-number">1</span>));<br>                 System.out.println(data.getTitle());<br>             &#125;<br>             <span class="hljs-keyword">if</span> (hit.getHighlightFields().get(<span class="hljs-string">&quot;content&quot;</span>) != <span class="hljs-literal">null</span>) &#123;<br>                 <span class="hljs-type">String</span> <span class="hljs-variable">highlightContent</span> <span class="hljs-operator">=</span> String.valueOf(hit.getHighlightFields().get(<span class="hljs-string">&quot;content&quot;</span>));<br>                 data.setContent(highlightContent.substring(<span class="hljs-number">1</span>, highlightContent.length() - <span class="hljs-number">1</span>));<br>                 System.out.println(data.getContent());<br>             &#125;<br>             highlightDataMap.put(data.getId(), data);<br>         &#125;<br></code></pre></td></tr></table></figure>

<ul>
<li><h5 id="æ ¹æ®-id-æ‹¿åˆ°æ¯ä¸€ä¸ª-Postå¯¹è±¡ï¼Œä½¿ç”¨é«˜äº®å…³é”®è¯æ›¿æ¢åŸæ–‡æœ¬ï¼Œè¿”å›ç»“æœï¼š"><a href="#æ ¹æ®-id-æ‹¿åˆ°æ¯ä¸€ä¸ª-Postå¯¹è±¡ï¼Œä½¿ç”¨é«˜äº®å…³é”®è¯æ›¿æ¢åŸæ–‡æœ¬ï¼Œè¿”å›ç»“æœï¼š" class="headerlink" title="æ ¹æ® id æ‹¿åˆ°æ¯ä¸€ä¸ª Postå¯¹è±¡ï¼Œä½¿ç”¨é«˜äº®å…³é”®è¯æ›¿æ¢åŸæ–‡æœ¬ï¼Œè¿”å›ç»“æœï¼š"></a>æ ¹æ® id æ‹¿åˆ°æ¯ä¸€ä¸ª Postå¯¹è±¡ï¼Œä½¿ç”¨é«˜äº®å…³é”®è¯æ›¿æ¢åŸæ–‡æœ¬ï¼Œè¿”å›ç»“æœï¼š</h5></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// idåˆ—è¡¨</span><br>       List&lt;Long&gt; postIdList = searchHitList.stream().map(searchHit -&gt; searchHit.getContent().getId())<br>               .collect(Collectors.toList());<br>       <span class="hljs-comment">// æ ¹æ®idæŸ¥æ‰¾æ•°æ®é›†</span><br>       List&lt;Post&gt; postList = baseMapper.selectBatchIds(postIdList);<br>       <span class="hljs-keyword">if</span> (postList != <span class="hljs-literal">null</span>) &#123;<br>           Map&lt;Long, List&lt;Post&gt;&gt; idPostMap = postList.stream().collect(Collectors.groupingBy(Post::getId));<br>           postIdList.forEach(postId -&gt; &#123;<br>               <span class="hljs-keyword">if</span> (idPostMap.containsKey(postId)) &#123;<br>                   <span class="hljs-comment">// æœç´¢å…³é”®è¯é«˜äº®æ›¿æ¢</span><br>                   <span class="hljs-type">Post</span> <span class="hljs-variable">post</span> <span class="hljs-operator">=</span> idPostMap.get(postId).get(<span class="hljs-number">0</span>);<br>                   <span class="hljs-type">String</span> <span class="hljs-variable">hl_title</span> <span class="hljs-operator">=</span> highlightDataMap.get(postId).getTitle();<br>                   <span class="hljs-type">String</span> <span class="hljs-variable">hl_content</span> <span class="hljs-operator">=</span> highlightDataMap.get(postId).getContent();<br>                   <span class="hljs-keyword">if</span> (hl_title != <span class="hljs-literal">null</span> &amp;&amp; hl_title.trim() != <span class="hljs-string">&quot;&quot;</span>) &#123;<br>                       post.setTitle(hl_title);<br>                   &#125;<br>                   <span class="hljs-keyword">if</span> (hl_content != <span class="hljs-literal">null</span> &amp;&amp; hl_content.trim() != <span class="hljs-string">&quot;&quot;</span>) &#123;<br>                       post.setContent(hl_content);<br>                   &#125;<br>                   resourceList.add(post);<br>               &#125; <span class="hljs-keyword">else</span> &#123;<br>                   <span class="hljs-comment">// ä» es æ¸…ç©º db å·²ç‰©ç†åˆ é™¤çš„æ•°æ®</span><br>                   <span class="hljs-type">String</span> <span class="hljs-variable">delete</span> <span class="hljs-operator">=</span> elasticsearchRestTemplate.delete(String.valueOf(postId), PostEsDTO.class);<br>                   log.info(<span class="hljs-string">&quot;delete post &#123;&#125;&quot;</span>, delete);<br>               &#125;<br>           &#125;);<br>       &#125;<br>   &#125;<br><br></code></pre></td></tr></table></figure>

<h4 id="å‰ç«¯-2"><a href="#å‰ç«¯-2" class="headerlink" title="å‰ç«¯"></a>å‰ç«¯</h4><ul>
<li>åç«¯å·²ç»å°†å…³é”®è¯é«˜äº®ç‰¹æ®Šå¤„ç†äº†ï¼Œå‰ç«¯åº”è¯¥åšä»€ä¹ˆå‘¢ï¼Ÿ</li>
<li>å°†åç«¯å“åº”çš„æ–‡æœ¬ä¿¡æ¯ï¼Œæ”¾å…¥ <strong>v-html å±æ€§</strong>ä¸­ï¼Œå³å¯<strong>è§£æå‡ºæ–‡æœ¬çš„ CSS æ ·å¼</strong>ï¼š</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;!--æ ‡é¢˜--&gt;<br>        &lt;template #title&gt;<br>          &lt;a href=&quot;https://www.antdv.com/&quot; v-html=&quot;item.title&quot;&gt;&lt;/a&gt;<br>        &lt;/template&gt;<br>        &lt;!--å¤´åƒ--&gt;<br>        &lt;template #avatar&gt;<br>          &lt;a-avatar src=&quot;https://zos.alipayobjects.com/rmsportal/ODTLcjxAfvqbxHnVXCYX.png&quot;/&gt;<br>        &lt;/template&gt;<br>        &lt;template #description&gt;<br>          &lt;div v-html=&quot;item.content&quot; style=&quot;margin-bottom: 10px&quot;&gt;&lt;/div&gt;<br>        &lt;/template&gt;<br></code></pre></td></tr></table></figure>

<ul>
<li>è¿™å°±æ˜¯æœ€ç»ˆçš„çš„å®ç°æ•ˆæœäº†ï¼š</li>
</ul>
<p><img src="C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20231001210038270.png" alt="image-20231001210038270"></p>
<ul>
<li>è¿™è®©æˆ‘æƒ³èµ·äº†å‰ä¸¤å¤©åˆšå®ç°è¿‡çš„<strong>å‰ç«¯è§£æ Markdown æ ¼å¼æ–‡ä»¶</strong>çš„æ–¹æ³•ï¼š <strong>ï¼ˆ2023/10/01æ™šï¼‰</strong></li>
</ul>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs ts"><span class="hljs-keyword">import</span> <span class="hljs-title class_">MarkdownIt</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;markdown-it&#x27;</span>;<br><br><span class="hljs-comment">// Markdownè¯­æ³•</span><br><span class="hljs-keyword">const</span> parsedContent = <span class="hljs-title function_">ref</span>()<br><span class="hljs-keyword">const</span> md = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MarkdownIt</span>();<br><span class="hljs-comment">// ä½¿ç”¨Markdownè¯­æ³•æ¥æ”¶æ–‡ç« å†…å®¹</span><br>parsedContent.<span class="hljs-property">value</span> = md.<span class="hljs-title function_">render</span>(articleInfo.<span class="hljs-property">value</span>.<span class="hljs-property">content</span>);<br></code></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;div v-html=&quot;parsedContent&quot;<br>      style=&quot;position: absolute; margin-left: 10px; margin-right: 10px; margin-top: 20px;&quot;&gt;<br> &lt;/div&gt;<br></code></pre></td></tr></table></figure>

<h4 id="æœç´¢é«˜äº®è¯­æ³•"><a href="#æœç´¢é«˜äº®è¯­æ³•" class="headerlink" title="æœç´¢é«˜äº®è¯­æ³•"></a>æœç´¢é«˜äº®è¯­æ³•</h4><ul>
<li>æœç´¢é«˜äº®è¯­æ³•ï¼Œå°±æ˜¯æŸ¥è¯¢è¯å’ŒæŒ‡ç¤ºé«˜äº®å­—æ®µç›¸é…åˆçš„ç»“æœï¼š</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">GET</span> post_v1<span class="hljs-operator">/</span>_search<br>&#123;<br>  &quot;query&quot;: &#123;<br>    &quot;match&quot;: &#123; &quot;author&quot;: &quot;æœç”«&quot; &#125;<br>  &#125;,<br>    &quot;highlight&quot;: &#123;<br>    &quot;fields&quot;: &#123;<br>      &quot;author&quot;: &#123;&#125;<br>    &#125;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><img src="https://gitee.com/deng-2022/pictures/raw/master/images/image-20231203205450161.png" alt="image-20231203205450161"></p>
<h3 id="æœç´¢è¯å»ºè®®"><a href="#æœç´¢è¯å»ºè®®" class="headerlink" title="æœç´¢è¯å»ºè®®"></a>æœç´¢è¯å»ºè®®</h3><ul>
<li>è·ç¦»ä¸Šæ¬¡ææœç´¢å»ºè®®ï¼Œå·²ç»è¿‡å»åŠä¸ªå¤šæœˆäº† <strong>ï¼ˆ2023/12/03æ™šï¼‰</strong></li>
</ul>
<blockquote>
<p>ğŸ– æ¨èé˜…è¯»ï¼š[ElasticSearchçš„æœç´¢å»ºè®®åŠŸèƒ½suggest search(completion suggest)_es suggest-CSDNåšå®¢](<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_41489540/article/details/121865225?ops_request_misc=%7B&quot;request_id&quot;:&quot;170159810516800211543981&quot;,&quot;scm&quot;:&quot;20140713.130102334.pc_all.&quot;%7D&amp;request_id=170159810516800211543981&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~first_rank_ecpm_v1~rank_v31_ecpm-1-121865225-null-null.142%5Ev96%5Epc_search_result_base5&amp;utm_term=es">https://blog.csdn.net/qq_41489540/article/details/121865225?ops_request_misc={&quot;request_id&quot;%3A&quot;170159810516800211543981&quot;%2C&quot;scm&quot;%3A&quot;20140713.130102334.pc_all.&quot;}&amp;request_id=170159810516800211543981&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~first_rank_ecpm_v1~rank_v31_ecpm-1-121865225-null-null.142^v96^pc_search_result_base5&amp;utm_term=es</a> suggest æœç´¢å»ºè®®&amp;spm=1018.2226.3001.4187)</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">GET</span> post_v3<span class="hljs-operator">/</span>_search<br>&#123;<br>  &quot;query&quot;: &#123;<br>    &quot;match&quot;: &#123; &quot;title&quot;: &quot;æ˜æ—¥&quot; &#125;<br>  &#125;,<br>    &quot;highlight&quot;: &#123;<br>    &quot;fields&quot;: &#123;<br>      &quot;title&quot;: &#123;&#125;<br>    &#125;<br>  &#125;,<br>    &quot;suggest&quot;: &#123;<span class="hljs-operator">/</span><span class="hljs-operator">/</span>è¿™ä¸ªå­—æ®µæ˜¯å…³é”®å­—,ä¸èƒ½éšä¾¿èµ·å<br>    &quot;my-suggest&quot;: &#123; <span class="hljs-operator">/</span><span class="hljs-operator">/</span> è¿™ä¸ªæ˜¯è‡ªå·±èµ·çš„åå­—<br>      &quot;prefix&quot;: &quot;æ˜&quot;, <span class="hljs-operator">/</span><span class="hljs-operator">/</span> è¿™ä¸ªæ˜¯å‰ç¼€<br>      &quot;completion&quot;: &#123;<br>        &quot;field&quot;: &quot;title.suggest&quot; <span class="hljs-operator">/</span><span class="hljs-operator">/</span>è¿™ä¸ªæ˜¯ä½ è‡ªå·±å®šä¹‰çš„ç´¢å¼•<br>      &#125;<br>    &#125;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><img src="https://gitee.com/deng-2022/pictures/raw/master/images/image-20231203205643525.png" alt="image-20231203205643525"></p>
<ul>
<li>ä»€ä¹ˆæ˜¯æœç´¢å»ºè®®ï¼Ÿå°±æ˜¯æ ¹æ®ç´¢å¼•ä¸­çš„æŸä¸ªå­—æ®µï¼Œä½¿ç”¨å‰ç¼€åŒ¹é…æ¥é¢„å…ˆè¿”å›è¯¥ç´¢å¼•å­—æ®µä¸­çš„éƒ¨åˆ†æ–‡æ¡£ï¼Œå°±èƒ½å®ç°æœç´¢å»ºè®®</li>
<li>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¦æƒ³ä½¿æŸä¸ªå­—æ®µæ”¯æŒæœç´¢å»ºè®®ï¼Œè¯¥å­—æ®µçš„å€¼çš„ç±»å‹ä¸€å®šè¦æ˜¯ <code>completion</code> çš„ï¼Œè¿™é‡Œç»™äº›<strong>ä»£ç ç¤ºä¾‹</strong>ï¼Œå¦‚ä¸‹ï¼š</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs sql">PUT <span class="hljs-operator">/</span>post_v3<span class="hljs-operator">/</span>_mapping<br>&#123;<br>&quot;mappings&quot;: &#123;<br>	&quot;properties&quot;: &#123;<br>		&quot;title&quot;: &#123;<br>			&quot;type&quot;: &quot;text&quot;,<br>			&quot;analyzer&quot;: &quot;ik_max_word&quot;,<br>			&quot;search_analyzer&quot;: &quot;ik_smart&quot;,<br>            &quot;fields&quot;: &#123;<br>                &quot;keyword&quot;: &#123;<br>                    &quot;type&quot;: &quot;keyword&quot;,<br>                    &quot;ignore_above&quot;: <span class="hljs-number">256</span><br>                &#125;,<br>                &quot;suggest&quot;: &#123;  <br>                    &quot;type&quot;: &quot;completion&quot;, <span class="hljs-operator">/</span><span class="hljs-operator">/</span>ç±»å‹æ˜¯completion,å°±æ˜¯è‡ªåŠ¨è¡¥å…¨<br>                    &quot;analyzer&quot;: &quot;ik_max_word&quot;  <br>                &#125;<br>		 &#125;,<br>		 &quot;content&quot;: &#123;<br>			&quot;type&quot;: &quot;text&quot;,<br>			&quot;analyzer&quot;: &quot;ik_max_word&quot;,<br>			&quot;search_analyzer&quot;: &quot;ik_smart&quot;,<br>			&quot;fields&quot;: &#123;<br>				&quot;keyword&quot;: &#123;<br>				&quot;type&quot;: &quot;completion&quot;,<br>				&quot;ignore_above&quot;: <span class="hljs-number">256</span><br>			&#125;, <br>				&quot;suggest&quot;: &#123;  <br>            		&quot;type&quot;: &quot;completion&quot;, <span class="hljs-operator">/</span><span class="hljs-operator">/</span>ç±»å‹æ˜¯completion,å°±æ˜¯è‡ªåŠ¨è¡¥å…¨<br>           			&quot;analyzer&quot;: &quot;ik_max_word&quot;  <br>         		 &#125;<br>			&#125;<br>		  &#125;,<br>		  &quot;userId&quot;: &#123;<br>			&quot;type&quot;: &quot;keyword&quot;<br>		  &#125;,<br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sql">PUT <span class="hljs-operator">/</span>post_v3<span class="hljs-operator">/</span>_doc<span class="hljs-operator">/</span><span class="hljs-number">1</span><br>&#123;<br>&quot;title&quot;: &quot;æ˜æ—¥ä¹‹å&quot;,<br>&quot;content&quot;: &quot;æ‹‰æ‰ç½—å¤«ï¼Œæˆ‘å¸¦ä½ å›å®¶ï¼&quot;,<br>&quot;userId&quot;:&quot;1008611&quot;<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">GET</span> post_v3<span class="hljs-operator">/</span>_search<br>&#123;<br>  &quot;query&quot;: &#123;<br>    &quot;match&quot;: &#123; &quot;title&quot;: &quot;æ˜æ—¥&quot; &#125;<br>  &#125;,<br>    &quot;highlight&quot;: &#123;<br>    &quot;fields&quot;: &#123;<br>      &quot;title&quot;: &#123;&#125;<br>    &#125;<br>  &#125;,<br>    &quot;suggest&quot;: &#123; <br>    &quot;my-suggest&quot;: &#123; <br>      &quot;prefix&quot;: &quot;æ˜&quot;, <span class="hljs-operator">/</span><span class="hljs-operator">/</span> è¿™ä¸ªæ˜¯å‰ç¼€<br>      &quot;completion&quot;: &#123;<br>        &quot;field&quot;: &quot;title.suggest&quot; <span class="hljs-operator">/</span><span class="hljs-operator">/</span> è¿™ä¸ªæ˜¯ä½ è‡ªå·±å®šä¹‰çš„ç´¢å¼•<br>      &#125;<br>    &#125;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<ul>
<li>æŸ¥è¯¢ç»“æœå°±æ˜¯ä¸Šé¢å±•ç¤ºçš„æŸ¥è¯¢ç»“æœäº†ï¼Œè¿™é‡Œæ¨èé˜…è¯»è¿™ç¯‡åšå®¢å…¥é—¨ï¼š[ElasticSearchçš„æœç´¢å»ºè®®åŠŸèƒ½suggest search(completion suggest)_es suggest-CSDNåšå®¢](<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_41489540/article/details/121865225?ops_request_misc=%7B&quot;request_id&quot;:&quot;170159810516800211543981&quot;,&quot;scm&quot;:&quot;20140713.130102334.pc_all.&quot;%7D&amp;request_id=170159810516800211543981&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~first_rank_ecpm_v1~rank_v31_ecpm-1-121865225-null-null.142%5Ev96%5Epc_search_result_base5&amp;utm_term=es">https://blog.csdn.net/qq_41489540/article/details/121865225?ops_request_misc={&quot;request_id&quot;%3A&quot;170159810516800211543981&quot;%2C&quot;scm&quot;%3A&quot;20140713.130102334.pc_all.&quot;}&amp;request_id=170159810516800211543981&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~first_rank_ecpm_v1~rank_v31_ecpm-1-121865225-null-null.142^v96^pc_search_result_base5&amp;utm_term=es</a> suggest æœç´¢å»ºè®®&amp;spm=1018.2226.3001.4187)</li>
<li>è¿™ç¯‡åšå®¢æœ€ç»ˆåªèƒ½ç®—æ˜¯å…¥é—¨ï¼Œè¿˜æœ‰å¾ˆå¤šç»†èŠ‚æ²¡æœ‰è®²æ¸…æ¥šï¼Œé€šè¿‡äº†è§£å­¦ä¹ ï¼Œæˆ‘ä¹Ÿé€æ¸ç†Ÿæ‚‰äº† ES çš„ DSL è¯­æ³•ï¼ŒåŒ…æ‹¬ç®€å•çš„å»ºç«‹ç´¢å¼•ç»“æ„ã€å­å­—æ®µçš„ä½œç”¨ã€æ’å…¥æ–‡æ¡£æ•°æ®ã€æŸ¥è¯¢æ–‡æ¡£ã€å­—æ®µé«˜äº®æœç´¢ã€æœç´¢å»ºè®®ç­‰ç­‰ï¼Œæ…¢æ…¢ç†è§£æŒæ¡å§ï¼ˆ2023/12/03æ™šï¼‰</li>
<li>æœ€åæ”¾ä¸€äº› AI å›ç­”ç»“æœï¼š<strong>ï¼ˆ2023/12/03æ™šï¼‰</strong></li>
</ul>
<blockquote>
<p>æ˜¯çš„ï¼Œåªæœ‰é…ç½®ä¸ºcompletionå­—æ®µçš„å­—æ®µæ‰æ”¯æŒæœç´¢å»ºè®®åŠŸèƒ½ã€‚Completionå­—æ®µæ˜¯Elasticsearchä¸­ä¸“é—¨ç”¨äºå®ç°æœç´¢å»ºè®®åŠŸèƒ½çš„å­—æ®µç±»å‹ã€‚å®ƒå¯ä»¥å°†è¾“å…¥çš„å‰ç¼€æ˜ å°„åˆ°æŸä¸ªå®Œæ•´çš„è¯ï¼Œå¹¶å­˜å‚¨åœ¨ç´¢å¼•ä¸­ï¼Œä»¥ä¾¿åœ¨æœç´¢æ—¶æä¾›å»ºè®®ã€‚</p>
<p>å½“ä½ åœ¨å­—æ®µä¸Šé…ç½®äº†completionç±»å‹æ—¶ï¼ŒElasticsearchä¼šä¸ºè¯¥å­—æ®µåˆ›å»ºä¸€ä¸ªè‡ªåŠ¨å®Œæˆçš„å­—å…¸ï¼Œå¹¶å°†è¾“å…¥çš„å‰ç¼€æ˜ å°„åˆ°å­—å…¸ä¸­çš„å®Œæ•´è¯ã€‚ç„¶åï¼Œåœ¨æœç´¢æ—¶ï¼ŒElasticsearchä¼šæ ¹æ®ç”¨æˆ·è¾“å…¥çš„å‰ç¼€æ¥æŸ¥æ‰¾åŒ¹é…çš„å»ºè®®ï¼Œå¹¶å°†å®ƒä»¬è¿”å›ç»™ç”¨æˆ·ã€‚</p>
<p>å› æ­¤ï¼Œå¦‚æœä½ å¸Œæœ›åœ¨Elasticsearchç´¢å¼•ä¸­ä½¿ç”¨æœç´¢å»ºè®®åŠŸèƒ½ï¼Œä½ éœ€è¦ç¡®ä¿ç›¸å…³å­—æ®µè¢«é…ç½®ä¸ºcompletionç±»å‹ï¼Œä»¥ä¾¿æ”¯æŒè¯¥åŠŸèƒ½ã€‚</p>
</blockquote>
<blockquote>
<p>åœ¨Elasticsearchä¸­ï¼Œä¸ºå­—æ®µåˆ›å»ºå­å­—æ®µä¸»è¦æ˜¯ä¸ºäº†å®ç°å¤šå­—æ®µç´¢å¼•å’Œæœç´¢éœ€æ±‚ã€‚åœ¨æ‚¨çš„ç¤ºä¾‹ä¸­ï¼Œé€šè¿‡åœ¨â€titleâ€å­—æ®µä¸‹åˆ›å»ºä¸€ä¸ªåä¸ºâ€suggestâ€çš„å­å­—æ®µï¼Œå¹¶å°†å…¶ç±»å‹è®¾ç½®ä¸ºâ€completionâ€ï¼Œæ‚¨å¯ä»¥å®ç°ä»¥ä¸‹å®é™…åº”ç”¨åœºæ™¯ï¼š</p>
<ol>
<li>æœç´¢å»ºè®®ï¼šå½“ç”¨æˆ·åœ¨æœç´¢æ—¶è¾“å…¥â€titleâ€å­—æ®µä¸­çš„æŸä¸ªå‰ç¼€æ—¶ï¼ŒElasticsearchå¯ä»¥åŸºäºâ€suggestâ€å­å­—æ®µä¸­çš„è‡ªåŠ¨å®Œæˆå­—å…¸æä¾›æœç´¢å»ºè®®ã€‚è¿™äº›å»ºè®®å¯ä»¥å¸®åŠ©ç”¨æˆ·æ›´å¿«åœ°æ‰¾åˆ°ä»–ä»¬æƒ³è¦çš„ç»“æœï¼Œæé«˜æœç´¢æ•ˆç‡ã€‚</li>
<li>ä¸åŒçš„ç´¢å¼•æ–¹å¼ï¼šåœ¨â€titleâ€å­—æ®µä¸‹åˆ›å»ºâ€suggestâ€å­å­—æ®µï¼Œå¯ä»¥è®©æ‚¨åœ¨åŒä¸€å­—æ®µä¸Šä½¿ç”¨ä¸åŒçš„ç´¢å¼•æ–¹å¼ã€‚ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥å°†â€titleâ€å­—æ®µçš„ä¸»è¦éƒ¨åˆ†ä½œä¸ºæ–‡æœ¬è¿›è¡Œç´¢å¼•ï¼Œä»¥æ”¯æŒå…¨æ–‡æœç´¢ï¼ŒåŒæ—¶å°†ç›¸åŒå­—æ®µçš„å¦ä¸€ä¸ªéƒ¨åˆ†ä½œä¸ºcompletionå­—æ®µè¿›è¡Œç´¢å¼•ï¼Œä»¥æ”¯æŒæœç´¢å»ºè®®åŠŸèƒ½ã€‚</li>
</ol>
<p>æ€»ä¹‹ï¼Œé€šè¿‡åœ¨å­—æ®µä¸‹åˆ›å»ºå­å­—æ®µï¼Œæ‚¨å¯ä»¥å®ç°æ›´çµæ´»å’Œç‰¹å®šçš„ç´¢å¼•å’Œæœç´¢éœ€æ±‚ã€‚è¿™åœ¨å¤„ç†å¤šè¯­è¨€æ•°æ®ã€è¿›è¡Œç‰¹å®šé¢†åŸŸçš„æœç´¢ä¼˜åŒ–æˆ–æé«˜ç”¨æˆ·ä½“éªŒç­‰æ–¹é¢éå¸¸æœ‰ç”¨ã€‚</p>
</blockquote>
<h3 id="è‡ªåŠ¨åˆ›å»ºç´¢å¼•ç»“æ„"><a href="#è‡ªåŠ¨åˆ›å»ºç´¢å¼•ç»“æ„" class="headerlink" title="è‡ªåŠ¨åˆ›å»ºç´¢å¼•ç»“æ„"></a>è‡ªåŠ¨åˆ›å»ºç´¢å¼•ç»“æ„</h3><ul>
<li>å¦‚æœä¸åˆ›å»ºç´¢å¼•ç»“æ„ï¼Œè€Œç›´æ¥æ’å…¥æ–‡æ¡£æ•°æ®ï¼ŒElasticsearch åº•å±‚æ˜¯ä¼šè‡ªåŠ¨åˆ›å»ºç´¢å¼•ç»“æ„çš„å¯¹å§ï¼Ÿ</li>
</ul>
<blockquote>
<p>æ˜¯çš„ï¼ŒElasticsearchåº•å±‚ä¼šè‡ªåŠ¨åˆ›å»ºç´¢å¼•ç»“æ„ã€‚å½“ä½ å‘Elasticsearchæ’å…¥æ–‡æ¡£æ•°æ®æ—¶ï¼ŒElasticsearchä¼šæ ¹æ®æ–‡æ¡£ä¸­çš„å­—æ®µå’Œç±»å‹è‡ªåŠ¨åˆ›å»ºç›¸åº”çš„ç´¢å¼•æ˜ å°„å’Œç±»å‹å®šä¹‰ã€‚</p>
<p>åœ¨Elasticsearchä¸­ï¼Œè‡ªåŠ¨åˆ›å»ºçš„ç´¢å¼•ç»“æ„çš„å­—æ®µç±»å‹å–å†³äºæ–‡æ¡£ä¸­çš„å­—æ®µå’Œæ•°æ®ã€‚Elasticsearchæ”¯æŒå¤šç§å­—æ®µç±»å‹ï¼ŒåŒ…æ‹¬æ–‡æœ¬ã€æ•°å­—ã€æ—¥æœŸã€å¸ƒå°”ç±»å‹ç­‰ã€‚</p>
<p>åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œå¦‚æœæ–‡æ¡£ä¸­åŒ…å«ä¸€ä¸ªå­—æ®µï¼Œä¸”è¯¥å­—æ®µçš„å€¼æ˜¯å­—ç¬¦ä¸²ç±»å‹ï¼Œé‚£ä¹ˆElasticsearchä¼šå°†è¯¥å­—æ®µçš„ç±»å‹è®¾ç½®ä¸ºâ€textâ€ç±»å‹ã€‚æ­¤å¤–ï¼Œå¦‚æœä¸€ä¸ªå­—æ®µçš„å€¼æ˜¯ä¸€ä¸ªæ•°å­—æˆ–æ—¥æœŸç±»å‹ï¼Œé‚£ä¹ˆElasticsearchä¼šå°†è¯¥å­—æ®µçš„ç±»å‹è®¾ç½®ä¸ºç›¸åº”çš„æ•°å­—æˆ–æ—¥æœŸç±»å‹ã€‚ </p>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œå¦‚æœæ–‡æ¡£ä¸­åŒ…å«æœªåœ¨æ˜ å°„ä¸­å®šä¹‰çš„å­—æ®µï¼ŒElasticsearchå¯èƒ½ä¼šè‡ªåŠ¨åˆ›å»ºé¢å¤–çš„ç´¢å¼•æ˜ å°„å’Œç±»å‹å®šä¹‰ã€‚è¿™å¯èƒ½ä¼šå¯¼è‡´é¢å¤–çš„å¼€é”€å’Œèµ„æºæ¶ˆè€—ï¼Œå› æ­¤å»ºè®®åœ¨åˆ›å»ºç´¢å¼•ä¹‹å‰æ˜ç¡®å®šä¹‰æ˜ å°„ã€‚</p>
<p>æ€»ä¹‹ï¼Œè™½ç„¶Elasticsearchåº•å±‚ä¼šè‡ªåŠ¨åˆ›å»ºç´¢å¼•ç»“æ„ï¼Œä½†åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œä¸ºäº†æ›´å¥½çš„æ€§èƒ½å’Œå¯ç»´æŠ¤æ€§ï¼Œå»ºè®®åœ¨åˆ›å»ºç´¢å¼•ä¹‹å‰æ˜ç¡®å®šä¹‰æ˜ å°„ã€‚</p>
</blockquote>
<h3 id="12æœˆä»½çš„ä¼˜åŒ–"><a href="#12æœˆä»½çš„ä¼˜åŒ–" class="headerlink" title="12æœˆä»½çš„ä¼˜åŒ–"></a>12æœˆä»½çš„ä¼˜åŒ–</h3><ul>
<li>åˆ›å»ºç´¢å¼•</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs sql">PUT <span class="hljs-operator">/</span>article_v2 <br>&#123;  <br>  &quot;mappings&quot;: &#123;  <br>    &quot;properties&quot;: &#123;  <br>      &quot;title&quot;: &#123;  <br>        &quot;type&quot;: &quot;text&quot;,  <br>        &quot;analyzer&quot;: &quot;ik_max_word&quot;,  <br>        &quot;search_analyzer&quot;: &quot;ik_smart&quot;,  <br>        &quot;fields&quot;: &#123;  <br>          &quot;keyword&quot;: &#123;  <br>            &quot;type&quot;: &quot;keyword&quot;,  <br>            &quot;ignore_above&quot;: <span class="hljs-number">256</span>  <br>          &#125;,  <br>          &quot;suggest&quot;: &#123;    <br>            &quot;type&quot;: &quot;completion&quot;,   <br>            &quot;analyzer&quot;: &quot;ik_max_word&quot;    <br>          &#125;  <br>        &#125;  <br>      &#125;,  <br>      &quot;content&quot;: &#123;  <br>        &quot;type&quot;: &quot;text&quot;,  <br>        &quot;analyzer&quot;: &quot;ik_max_word&quot;,  <br>        &quot;search_analyzer&quot;: &quot;ik_smart&quot;,  <br>        &quot;fields&quot;: &#123;  <br>          &quot;suggest&quot;: &#123;    <br>            &quot;type&quot;: &quot;completion&quot;,   <br>            &quot;analyzer&quot;: &quot;ik_max_word&quot;    <br>          &#125;  <br>        &#125;  <br>      &#125;<br>    &#125;  <br>  &#125;  <br>&#125;<br></code></pre></td></tr></table></figure>

<ul>
<li>æ’å…¥æ•°æ®</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql">PUT <span class="hljs-operator">/</span>article_v2<span class="hljs-operator">/</span>_doc<span class="hljs-operator">/</span><span class="hljs-number">1</span><br>&#123;<br>&quot;title&quot;: &quot;æ˜æ—¥ä¹‹å&quot;,<br>&quot;content&quot;: &quot;æ‹‰æ‰ç½—å¤«ï¼Œæˆ‘å¸¦ä½ å›å®¶ï¼&quot;<br>&#125;<br></code></pre></td></tr></table></figure>

<ul>
<li>æœç´¢å»ºè®®</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">GET</span> article_v2<span class="hljs-operator">/</span>_search<br>&#123;<br>  &quot;query&quot;: &#123;<br>    &quot;match&quot;: &#123; &quot;title&quot;: &quot;æµ‹è¯•&quot; &#125;<br>  &#125;,<br>    &quot;highlight&quot;: &#123;<br>    &quot;fields&quot;: &#123;<br>      &quot;title&quot;: &#123;&#125;<br>    &#125;<br>  &#125;,<br>    &quot;suggest&quot;: &#123;<span class="hljs-operator">/</span><span class="hljs-operator">/</span>è¿™ä¸ªå­—æ®µæ˜¯å…³é”®å­—,ä¸èƒ½éšä¾¿èµ·å<br>    &quot;my-suggest&quot;: &#123; <span class="hljs-operator">/</span><span class="hljs-operator">/</span> è¿™ä¸ªæ˜¯è‡ªå·±èµ·çš„åå­—<br>      &quot;prefix&quot;: &quot;æµ‹è¯•&quot;, <span class="hljs-operator">/</span><span class="hljs-operator">/</span> è¿™ä¸ªæ˜¯å‰ç¼€<br>      &quot;completion&quot;: &#123;<br>        &quot;field&quot;: &quot;title.suggest&quot; <span class="hljs-operator">/</span><span class="hljs-operator">/</span>è¿™ä¸ªæ˜¯ä½ è‡ªå·±å®šä¹‰çš„ç´¢å¼•<br>      &#125;<br>    &#125;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<ul>
<li>æ”¹å˜å­˜åœ¨çš„ç´¢å¼•ç»“æ„ï¼š</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs sql">PUT <span class="hljs-operator">/</span>article_v3<span class="hljs-operator">/</span>_mapping<br>&#123;  <br>    &quot;properties&quot;: &#123;  <br>    &quot;title&quot;: &#123;  <br>      &quot;type&quot;: &quot;text&quot;,  <br>      &quot;analyzer&quot;: &quot;ik_max_word&quot;,  <br>      &quot;search_analyzer&quot;: &quot;ik_smart&quot;,  <br>      &quot;fields&quot;: &#123;  <br>        &quot;keyword&quot;: &#123;  <br>          &quot;type&quot;: &quot;keyword&quot;,  <br>          &quot;ignore_above&quot;: <span class="hljs-number">256</span>  <br>        &#125;,  <br>        &quot;suggest&quot;: &#123;  <br>          &quot;type&quot;: &quot;completion&quot;,  <br>          &quot;analyzer&quot;: &quot;ik_max_word&quot;  <br>        &#125;  <br>      &#125;  <br>    &#125;,  <br>    &quot;content&quot;: &#123;  <br>      &quot;type&quot;: &quot;binary&quot;,  <br>      &quot;fields&quot;: &#123;  <br>        &quot;suggest&quot;: &#123;  <br>          &quot;type&quot;: &quot;completion&quot;,  <br>          &quot;analyzer&quot;: &quot;ik_max_word&quot;  <br>        &#125;  <br>      &#125;  <br>    &#125;  <br>  &#125;  <br>&#125;<br></code></pre></td></tr></table></figure>



<h2 id="æŒç»­ä¼˜åŒ–"><a href="#æŒç»­ä¼˜åŒ–" class="headerlink" title="æŒç»­ä¼˜åŒ–"></a>æŒç»­ä¼˜åŒ–</h2><blockquote>
<h5 id="Memory-èšåˆæœç´¢å¹³å°ä¼˜åŒ–ï¼š"><a href="#Memory-èšåˆæœç´¢å¹³å°ä¼˜åŒ–ï¼š" class="headerlink" title="Memory èšåˆæœç´¢å¹³å°ä¼˜åŒ–ï¼š"></a>Memory èšåˆæœç´¢å¹³å°ä¼˜åŒ–ï¼š</h5></blockquote>
<ul>
<li>æ–°å¢åšæ–‡æœç´¢ï¼š<strong>åç«¯æä¾›åšæ–‡æœç´¢æ¥å£</strong>ã€<strong>å‰ç«¯æä¾›åšæ–‡åˆ—è¡¨å±•ç¤º</strong></li>
<li>å®Œå–„ Gitee ä»“åº“é¡¹ç›®ä»‹ç»</li>
<li>åšæ–‡æœç´¢å®ç°ï¼šæ–°å¢åšæ–‡æ•°æ®åº“è¡¨ Articleã€ArticleEsDTOã€åšæ–‡ ES åŒ…è£…ç±» ArticleEsDTOã€åšæ–‡é«˜äº®å­—æ®µ ArticleEsHighlightDataã€åšæ–‡æœç´¢æ¥å£ ArticleDataSource <strong>ï¼ˆ2023/11/06æ™šï¼‰</strong></li>
<li>å¾…å®Œæˆï¼š<strong>ES åšæ–‡æ•°æ®åŒæ­¥</strong>ã€<strong>ES åšæ–‡æœç´¢æµ‹è¯•</strong>ï¼ˆES åšæ–‡è®°å½•ï¼‰</li>
</ul>
<h3 id="åˆ†è¯å™¨"><a href="#åˆ†è¯å™¨" class="headerlink" title="åˆ†è¯å™¨"></a>åˆ†è¯å™¨</h3><ul>
<li><h5 id="åˆ†è¯å™¨æ˜¯å¹²å•¥ç”¨çš„ï¼ŸæŒ‡å®šäº†åˆ†è¯çš„è§„åˆ™ï¼ˆ2023-09-20åˆï¼‰"><a href="#åˆ†è¯å™¨æ˜¯å¹²å•¥ç”¨çš„ï¼ŸæŒ‡å®šäº†åˆ†è¯çš„è§„åˆ™ï¼ˆ2023-09-20åˆï¼‰" class="headerlink" title="åˆ†è¯å™¨æ˜¯å¹²å•¥ç”¨çš„ï¼ŸæŒ‡å®šäº†åˆ†è¯çš„è§„åˆ™ï¼ˆ2023/09/20åˆï¼‰"></a>åˆ†è¯å™¨æ˜¯å¹²å•¥ç”¨çš„ï¼ŸæŒ‡å®šäº†åˆ†è¯çš„è§„åˆ™ï¼ˆ2023/09/20åˆï¼‰</h5></li>
</ul>
<h4 id="å†…ç½®åˆ†è¯å™¨"><a href="#å†…ç½®åˆ†è¯å™¨" class="headerlink" title="å†…ç½®åˆ†è¯å™¨"></a>å†…ç½®åˆ†è¯å™¨</h4><ul>
<li><h5 id="https-www-elastic-co-guide-en-elasticsearch-reference-7-17-analysis-analyzers-html"><a href="#https-www-elastic-co-guide-en-elasticsearch-reference-7-17-analysis-analyzers-html" class="headerlink" title="https://www.elastic.co/guide/en/elasticsearch/reference/7.17/analysis-analyzers.html"></a><a target="_blank" rel="noopener" href="https://www.elastic.co/guide/en/elasticsearch/reference/7.17/analysis-analyzers.html">https://www.elastic.co/guide/en/elasticsearch/reference/7.17/analysis-analyzers.html</a></h5></li>
<li><h5 id="äº†è§£ä¸€ä¸‹ï¼Œä¸°å¯Œçš„åˆ†è¯è§„åˆ™"><a href="#äº†è§£ä¸€ä¸‹ï¼Œä¸°å¯Œçš„åˆ†è¯è§„åˆ™" class="headerlink" title="äº†è§£ä¸€ä¸‹ï¼Œä¸°å¯Œçš„åˆ†è¯è§„åˆ™"></a>äº†è§£ä¸€ä¸‹ï¼Œä¸°å¯Œçš„åˆ†è¯è§„åˆ™</h5></li>
</ul>
<h4 id="ç©ºæ ¼åˆ†è¯å™¨"><a href="#ç©ºæ ¼åˆ†è¯å™¨" class="headerlink" title="ç©ºæ ¼åˆ†è¯å™¨"></a>ç©ºæ ¼åˆ†è¯å™¨</h4><ul>
<li>whitespaceï¼ŒæŒ‰ç©ºæ ¼åˆ†è¯</li>
</ul>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs fsharp">POST <span class="hljs-keyword">_analyze</span><br>&#123;<br>  <span class="hljs-string">&quot;analyzer&quot;</span><span class="hljs-operator">:</span> <span class="hljs-string">&quot;whitespace&quot;</span>,<br>  <span class="hljs-string">&quot;text&quot;</span><span class="hljs-operator">:</span>     <span class="hljs-string">&quot;The quick brown fox.&quot;</span><br>&#125;<br></code></pre></td></tr></table></figure>

<h4 id="å…³é”®è¯åˆ†è¯å™¨"><a href="#å…³é”®è¯åˆ†è¯å™¨" class="headerlink" title="å…³é”®è¯åˆ†è¯å™¨"></a>å…³é”®è¯åˆ†è¯å™¨</h4><ul>
<li><h5 id="å°±æ˜¯ä¸åˆ†è¯ï¼Œæ•´å¥è¯å½“ä½œä¸€ä¸ªä¸“ä¸šæœ¯è¯­"><a href="#å°±æ˜¯ä¸åˆ†è¯ï¼Œæ•´å¥è¯å½“ä½œä¸€ä¸ªä¸“ä¸šæœ¯è¯­" class="headerlink" title="å°±æ˜¯ä¸åˆ†è¯ï¼Œæ•´å¥è¯å½“ä½œä¸€ä¸ªä¸“ä¸šæœ¯è¯­"></a>å°±æ˜¯ä¸åˆ†è¯ï¼Œæ•´å¥è¯å½“ä½œä¸€ä¸ªä¸“ä¸šæœ¯è¯­</h5></li>
</ul>
<h4 id="æ ‡å‡†åˆ†è¯è§„åˆ™"><a href="#æ ‡å‡†åˆ†è¯è§„åˆ™" class="headerlink" title="æ ‡å‡†åˆ†è¯è§„åˆ™"></a>æ ‡å‡†åˆ†è¯è§„åˆ™</h4><figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs fsharp">POST <span class="hljs-keyword">_analyze</span><br>&#123;<br>  <span class="hljs-string">&quot;tokenizer&quot;</span><span class="hljs-operator">:</span> <span class="hljs-string">&quot;standard&quot;</span>,<br>  <span class="hljs-string">&quot;filter&quot;</span><span class="hljs-operator">:</span>  [ <span class="hljs-string">&quot;lowercase&quot;</span>, <span class="hljs-string">&quot;asciifolding&quot;</span> ],<br>  <span class="hljs-string">&quot;text&quot;</span><span class="hljs-operator">:</span>      <span class="hljs-string">&quot;Is this dÃ©ja vu?&quot;</span><br>&#125;<br></code></pre></td></tr></table></figure>

<ul>
<li><h5 id="åˆ†è¯å™¨-analyze-å’Œåˆ†è¯è§„åˆ™-tokenizer-æœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼Ÿ"><a href="#åˆ†è¯å™¨-analyze-å’Œåˆ†è¯è§„åˆ™-tokenizer-æœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼Ÿ" class="headerlink" title="åˆ†è¯å™¨ analyze å’Œåˆ†è¯è§„åˆ™ tokenizer æœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼Ÿ"></a>åˆ†è¯å™¨ analyze å’Œåˆ†è¯è§„åˆ™ tokenizer æœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼Ÿ</h5></li>
</ul>
<figure class="highlight coq"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs coq">åœ¨æœç´¢å¼•æ“å’Œæ–‡æœ¬åˆ†æé¢†åŸŸä¸­ï¼Œåˆ†è¯å™¨ï¼ˆAnalyzerï¼‰å’Œåˆ†è¯è§„åˆ™å™¨ï¼ˆTokenizerï¼‰æ˜¯ä¸¤ä¸ªä¸åŒçš„æ¦‚å¿µã€‚<br><br>åˆ†è¯å™¨ï¼ˆAnalyzerï¼‰æ˜¯ä¸€ç§å°†æ–‡æœ¬è½¬æ¢ä¸ºå•è¯ï¼ˆ<span class="hljs-keyword">Term</span>ï¼‰åºåˆ—çš„å·¥å…·ã€‚å®ƒé€šå¸¸åŒ…å«å¤šä¸ªå¤„ç†æ­¥éª¤ï¼Œä¾‹å¦‚è¯æ³•åˆ†æã€å»é™¤åœç”¨è¯ã€å°å†™è½¬æ¢ã€è¯å¹²æå–ç­‰ã€‚åˆ†è¯å™¨çš„ä½œç”¨æ˜¯å°†åŸå§‹çš„æ–‡æœ¬è¾“å…¥è½¬æ¢ä¸ºå¯ä¾›ç´¢å¼•å’Œæœç´¢çš„æ ‡è®°æµã€‚ä¾‹å¦‚ï¼Œåœ¨Elasticsearchä¸­ï¼Œåˆ†è¯å™¨è¢«ç”¨äºé¢„å¤„ç†æ–‡æœ¬æ•°æ®å¹¶å°†å…¶å­˜å‚¨åœ¨å€’æ’ç´¢å¼•ä¸­ï¼Œä»¥æ”¯æŒå…¨æ–‡æœç´¢ã€‚<br><br>åˆ†è¯è§„åˆ™å™¨ï¼ˆTokenizerï¼‰æ˜¯åˆ†è¯å™¨çš„ä¸€ä¸ªç»„æˆéƒ¨åˆ†ã€‚å®ƒæ˜¯æ–‡æœ¬åˆ†æçš„ç¬¬ä¸€ä¸ªå¤„ç†æ­¥éª¤ï¼Œå°†è¾“å…¥çš„æ–‡æœ¬æŒ‰ç…§æŒ‡å®šçš„è§„åˆ™æ‹†åˆ†ä¸ºå•è¯ã€‚å¸¸è§çš„åˆ†è¯è§„åˆ™å™¨æœ‰åŸºäºç©ºæ ¼æ‹†åˆ†çš„ç©ºæ ¼åˆ†è¯å™¨ã€åŸºäºæ ‡ç‚¹ç¬¦å·æ‹†åˆ†çš„æ ‡ç‚¹åˆ†è¯å™¨ç­‰ã€‚åˆ†è¯è§„åˆ™å™¨è´Ÿè´£å®šä¹‰æ–‡æœ¬æ‹†åˆ†çš„æ–¹å¼ï¼Œå†³å®šäº†å“ªäº›å­—ç¬¦ä¼šè¢«è§†ä¸ºè¯æ¡çš„åˆ†éš”ã€‚<br><br>æ€»ç»“æ¥è¯´ï¼Œåˆ†è¯è§„åˆ™å™¨ï¼ˆTokenizerï¼‰æ˜¯åˆ†è¯å™¨ï¼ˆAnalyzerï¼‰çš„ç»„æˆéƒ¨åˆ†ï¼Œç”¨äºå®šä¹‰æ–‡æœ¬çš„æ‹†åˆ†æ–¹å¼ï¼›è€Œåˆ†è¯å™¨ï¼ˆAnalyzerï¼‰åˆ™åŒ…å«å¤šä¸ªå¤„ç†æ­¥éª¤ï¼Œç”¨äºå°†è¾“å…¥æ–‡æœ¬è½¬æ¢ä¸ºæ ‡è®°æµã€‚<br></code></pre></td></tr></table></figure>

<ul>
<li><p>äº†è§£åˆ°è¿™äº›åˆ†è¯å™¨<strong>å¯¹ä¸­æ–‡ä¸å‹å¥½</strong>ï¼Œæˆ‘ä»¬éœ€è¦ä¸‹è½½ <strong>IK åˆ†è¯å™¨</strong> æ’ä»¶ï¼Œå¯¹<strong>ä¸­æ–‡åˆ†è¯æ›´åŠ å‹å¥½</strong>ï¼Œå†…ç½®ä¸¤ç§åˆ†è¯å™¨</p>
<ul>
<li><h5 id="ik-smart"><a href="#ik-smart" class="headerlink" title="ik_smart"></a>ik_smart</h5></li>
<li><h5 id="ik-max-word"><a href="#ik-max-word" class="headerlink" title="ik_max_word"></a>ik_max_word</h5></li>
</ul>
</li>
</ul>
<h3 id="IKåˆ†è¯å™¨ï¼ˆESå†…ç½®æ’ä»¶ï¼‰"><a href="#IKåˆ†è¯å™¨ï¼ˆESå†…ç½®æ’ä»¶ï¼‰" class="headerlink" title="IKåˆ†è¯å™¨ï¼ˆESå†…ç½®æ’ä»¶ï¼‰"></a>IKåˆ†è¯å™¨ï¼ˆESå†…ç½®æ’ä»¶ï¼‰</h3><h4 id="ä¸‹è½½å®‰è£…"><a href="#ä¸‹è½½å®‰è£…" class="headerlink" title="ä¸‹è½½å®‰è£…"></a>ä¸‹è½½å®‰è£…</h4><ul>
<li><h5 id="7-Â·-Releases-Â·-medcl-elasticsearch-analysis-ik-github-com"><a href="#7-Â·-Releases-Â·-medcl-elasticsearch-analysis-ik-github-com" class="headerlink" title="7. Â· Releases Â· medcl/elasticsearch-analysis-ik (github.com)"></a><a target="_blank" rel="noopener" href="https://github.com/medcl/elasticsearch-analysis-ik/releases/tag/v7.17.7">7. Â· Releases Â· medcl/elasticsearch-analysis-ik (github.com)</a></h5></li>
</ul>
<p><img src="https://gitee.com/deng-2022/pictures/raw/master/images/image-20230920115244986.png" alt="image-20230920115244986"></p>
<ul>
<li>ä¸‹è½½å®Œæˆï¼Œå°†å‹ç¼©åŒ…è§£å‹åœ¨ Elasticsearch çš„ <strong>plugins / ikç›®å½•ä¸‹å³å¯</strong> </li>
</ul>
<h4 id="ä¿®æ”¹ç‰ˆæœ¬ä¸€è‡´"><a href="#ä¿®æ”¹ç‰ˆæœ¬ä¸€è‡´" class="headerlink" title="ä¿®æ”¹ç‰ˆæœ¬ä¸€è‡´"></a>ä¿®æ”¹ç‰ˆæœ¬ä¸€è‡´</h4><ul>
<li><p>è§£å‹å®Œæˆåï¼Œä¿®æ”¹plugins / ikç›®å½•ä¸‹çš„ <strong>plugin-descriptor.properties æ–‡ä»¶</strong>ï¼Œå°† ik ç‰ˆæœ¬<strong>ä¿®æ”¹ä¸ºä¸ ES ç‰ˆæœ¬ä¸€è‡´</strong></p>
<ul>
<li><h5 id="æ³¨æ„ï¼šæˆ‘ä½¿ç”¨çš„-ES-ç‰ˆæœ¬ä¸º-7-17-13ï¼Œè€Œ-ik-ç‰ˆæœ¬ä¸º-7-17-7ï¼ˆ2023-09-20åˆï¼‰"><a href="#æ³¨æ„ï¼šæˆ‘ä½¿ç”¨çš„-ES-ç‰ˆæœ¬ä¸º-7-17-13ï¼Œè€Œ-ik-ç‰ˆæœ¬ä¸º-7-17-7ï¼ˆ2023-09-20åˆï¼‰" class="headerlink" title="æ³¨æ„ï¼šæˆ‘ä½¿ç”¨çš„ ES ç‰ˆæœ¬ä¸º 7.17.13ï¼Œè€Œ ik ç‰ˆæœ¬ä¸º 7.17.7ï¼ˆ2023/09/20åˆï¼‰"></a>æ³¨æ„ï¼šæˆ‘ä½¿ç”¨çš„ ES ç‰ˆæœ¬ä¸º 7.17.13ï¼Œè€Œ ik ç‰ˆæœ¬ä¸º 7.17.7ï¼ˆ2023/09/20åˆï¼‰</h5></li>
<li><p>å¯èƒ½ä¼šç”±äº<strong>ç‰ˆæœ¬ä¸å…¼å®¹</strong>ï¼Œè€Œé€ æˆ ES å¯åŠ¨å¤±è´¥ï¼Œæ‰€ä»¥éœ€è¦æ›´æ”¹ ik ç‰ˆæœ¬</p>
</li>
</ul>
</li>
</ul>
<p><img src="https://gitee.com/deng-2022/pictures/raw/master/images/image-20230920115558421.png" alt="image-20230920115558421"></p>
<p><img src="https://gitee.com/deng-2022/pictures/raw/master/images/image-20230920113332061.png" alt="image-20230920113332061"></p>
<h4 id="å¯åŠ¨ESã€Kibana"><a href="#å¯åŠ¨ESã€Kibana" class="headerlink" title="å¯åŠ¨ESã€Kibana"></a>å¯åŠ¨ESã€Kibana</h4><ul>
<li><h5 id="å¯åŠ¨æˆåŠŸï¼š"><a href="#å¯åŠ¨æˆåŠŸï¼š" class="headerlink" title="å¯åŠ¨æˆåŠŸï¼š"></a>å¯åŠ¨æˆåŠŸï¼š</h5></li>
</ul>
<p><img src="https://gitee.com/deng-2022/pictures/raw/master/images/image-20230920120124225.png" alt="image-20230920120124225"></p>
<p><img src="https://gitee.com/deng-2022/pictures/raw/master/images/image-20230920120158428.png" alt="image-20230920120158428"></p>
<h4 id="æµ‹è¯•åˆ†è¯æ•ˆæœ"><a href="#æµ‹è¯•åˆ†è¯æ•ˆæœ" class="headerlink" title="æµ‹è¯•åˆ†è¯æ•ˆæœ"></a>æµ‹è¯•åˆ†è¯æ•ˆæœ</h4><p><img src="https://gitee.com/deng-2022/pictures/raw/master/images/image-20230920120416495.png" alt="image-20230920120416495"></p>
<p><img src="https://gitee.com/deng-2022/pictures/raw/master/images/image-20230920120422210.png" alt="image-20230920120422210"></p>
<ul>
<li><h5 id="æµ‹è¯•æˆåŠŸï¼Œè¿™é‡Œä¹Ÿèƒ½çœ‹å‡ºæ¥-ik-smart-å’Œ-ik-max-word-è¿™ä¸¤ç§ä¸åŒåˆ†è¯æ¨¡å¼çš„åŒºåˆ«äº†ï¼ˆ2023-09-20åˆï¼‰"><a href="#æµ‹è¯•æˆåŠŸï¼Œè¿™é‡Œä¹Ÿèƒ½çœ‹å‡ºæ¥-ik-smart-å’Œ-ik-max-word-è¿™ä¸¤ç§ä¸åŒåˆ†è¯æ¨¡å¼çš„åŒºåˆ«äº†ï¼ˆ2023-09-20åˆï¼‰" class="headerlink" title="æµ‹è¯•æˆåŠŸï¼Œè¿™é‡Œä¹Ÿèƒ½çœ‹å‡ºæ¥ ik_smart å’Œ ik_max_word è¿™ä¸¤ç§ä¸åŒåˆ†è¯æ¨¡å¼çš„åŒºåˆ«äº†ï¼ˆ2023/09/20åˆï¼‰"></a>æµ‹è¯•æˆåŠŸï¼Œè¿™é‡Œä¹Ÿèƒ½çœ‹å‡ºæ¥ ik_smart å’Œ ik_max_word è¿™ä¸¤ç§ä¸åŒåˆ†è¯æ¨¡å¼çš„åŒºåˆ«äº†ï¼ˆ2023/09/20åˆï¼‰</h5><ul>
<li><code>ik_smart</code> æ¨¡å¼æ˜¯ <strong>IK åˆ†è¯å™¨çš„ç®€å•æ¨¡å¼</strong>ï¼Œå®ƒä¼šå¯¹æ–‡æœ¬è¿›è¡Œ<strong>è¾ƒä¸ºç²—ç²’åº¦çš„åˆ‡åˆ†</strong>ï¼Œä¸»è¦ä»¥å°†å¥å­åˆ‡åˆ†ä¸ºä¸€äº›è¾ƒçŸ­çš„è¯è¯­ä¸ºç›®æ ‡ï¼Œé€‚ç”¨äº<strong>å¿«é€Ÿæœç´¢</strong>å’Œä¸€èˆ¬æ–‡æœ¬å¤„ç†åœºæ™¯ã€‚è¯¥æ¨¡å¼ä¸‹çš„åˆ†è¯ç»“æœå€¾å‘äºä¿ç•™çŸ­è¯</li>
<li><code>ik_max_word</code> æ¨¡å¼æ˜¯ <strong>IK åˆ†è¯å™¨çš„ç»†ç²’åº¦æ¨¡å¼</strong>ï¼Œå®ƒä¼šå°½å¯èƒ½å¤šåœ°å°†<strong>æ–‡æœ¬åˆ‡åˆ†ä¸ºæ›´å°çš„è¯è¯­</strong>ï¼ŒåŒ…æ‹¬ä¸€äº›æ›´ç»†è‡´çš„åˆ‡åˆ†ï¼Œå¦‚<strong>æ‹†åˆ†å¤åˆè¯å’Œè¯ç»„</strong>ç­‰ã€‚è¯¥æ¨¡å¼ä¸‹çš„åˆ†è¯ç»“æœå€¾å‘äºå°†æ–‡æœ¬åˆ‡åˆ†ä¸ºæ›´å¤šçš„è¯</li>
</ul>
</li>
</ul>
<h2 id="ES-è°ƒç”¨æ–¹å¼"><a href="#ES-è°ƒç”¨æ–¹å¼" class="headerlink" title="ES è°ƒç”¨æ–¹å¼"></a>ES è°ƒç”¨æ–¹å¼</h2><ul>
<li><h5 id="ä¸€èˆ¬æ¥è®²ï¼Œå¸¸è§çš„æœ‰ä¸‰ç§è°ƒç”¨æ–¹å¼ï¼š"><a href="#ä¸€èˆ¬æ¥è®²ï¼Œå¸¸è§çš„æœ‰ä¸‰ç§è°ƒç”¨æ–¹å¼ï¼š" class="headerlink" title="ä¸€èˆ¬æ¥è®²ï¼Œå¸¸è§çš„æœ‰ä¸‰ç§è°ƒç”¨æ–¹å¼ï¼š"></a>ä¸€èˆ¬æ¥è®²ï¼Œå¸¸è§çš„æœ‰ä¸‰ç§è°ƒç”¨æ–¹å¼ï¼š</h5><ul>
<li><p>HTTP Restful è°ƒç”¨</p>
</li>
<li><p>Kibanaï¼ˆDev toolsï¼‰ï¼Œæœ¬è´¨ä¸Šè¿˜æ˜¯HTTP Restful è°ƒç”¨</p>
</li>
<li><h5 id="å®¢æˆ·ç«¯è°ƒç”¨ï¼šJavaå®¢æˆ·ç«¯ã€Goå®¢æˆ·ç«¯"><a href="#å®¢æˆ·ç«¯è°ƒç”¨ï¼šJavaå®¢æˆ·ç«¯ã€Goå®¢æˆ·ç«¯" class="headerlink" title="å®¢æˆ·ç«¯è°ƒç”¨ï¼šJavaå®¢æˆ·ç«¯ã€Goå®¢æˆ·ç«¯"></a>å®¢æˆ·ç«¯è°ƒç”¨ï¼šJavaå®¢æˆ·ç«¯ã€Goå®¢æˆ·ç«¯</h5></li>
</ul>
</li>
</ul>
<h3 id="Java-æ“ä½œ-ES"><a href="#Java-æ“ä½œ-ES" class="headerlink" title="Java æ“ä½œ ES"></a>Java æ“ä½œ ES</h3><ul>
<li><h5 id="ä¸€èˆ¬æ¥è®²ï¼Œä¹Ÿæœ‰ä¸‰ç§æ–¹å¼ï¼š"><a href="#ä¸€èˆ¬æ¥è®²ï¼Œä¹Ÿæœ‰ä¸‰ç§æ–¹å¼ï¼š" class="headerlink" title="ä¸€èˆ¬æ¥è®²ï¼Œä¹Ÿæœ‰ä¸‰ç§æ–¹å¼ï¼š"></a>ä¸€èˆ¬æ¥è®²ï¼Œä¹Ÿæœ‰ä¸‰ç§æ–¹å¼ï¼š</h5><ul>
<li><p>ES å®˜æ–¹çš„APIï¼š**[Introduction | Elasticsearch Java API Client <a target="_blank" rel="noopener" href="https://www.elastic.co/guide/en/elasticsearch/client/java-api-client/7.17/introduction.html">7.17] | Elastic</a>**</p>
</li>
<li><p>ESä»¥å‰çš„å®˜æ–¹APIï¼šï¼ˆå·²åºŸå¼ƒï¼Œä¸å»ºè®®ç”¨ï¼‰</p>
</li>
<li><h5 id="Spring-Data-Elasticsearchï¼ˆæ¨èï¼‰ï¼šSpring-Data-Elasticsearch-Reference-Documentation"><a href="#Spring-Data-Elasticsearchï¼ˆæ¨èï¼‰ï¼šSpring-Data-Elasticsearch-Reference-Documentation" class="headerlink" title="Spring Data Elasticsearchï¼ˆæ¨èï¼‰ï¼šSpring Data Elasticsearch - Reference Documentation"></a>Spring Data Elasticsearchï¼ˆæ¨èï¼‰ï¼š<a target="_blank" rel="noopener" href="https://docs.spring.io/spring-data/elasticsearch/docs/4.4.10/reference/html/">Spring Data Elasticsearch - Reference Documentation</a></h5></li>
</ul>
</li>
<li><p>Spring-dataç³»åˆ—ï¼šSpring æä¾›çš„æ“ä½œæ•°æ®çš„æ¡†æ¶</p>
<ul>
<li>Spring-data-redisï¼šæ“ä½œredisçš„ä¸€å¥—æ–¹æ³•</li>
<li>Spring-data-mongodbï¼šæ“ä½œmongodbçš„ä¸€å¥—æ–¹æ³•</li>
<li>Spring-data-elasticsearchï¼šæ“ä½œelasticsearchçš„ä¸€å¥—æ–¹æ³•</li>
</ul>
</li>
</ul>
<h3 id="ESå®ç°æœç´¢æ¥å£"><a href="#ESå®ç°æœç´¢æ¥å£" class="headerlink" title="ESå®ç°æœç´¢æ¥å£"></a>ESå®ç°æœç´¢æ¥å£</h3><h4 id="å»ºç«‹ç´¢å¼•"><a href="#å»ºç«‹ç´¢å¼•" class="headerlink" title="å»ºç«‹ç´¢å¼•"></a>å»ºç«‹ç´¢å¼•</h4><ul>
<li><h5 id="åœ¨ESä¸­ï¼Œä¹Ÿå­˜åœ¨å’Œ-MySQLç±»ä¼¼çš„è¡¨ç»“æ„ï¼Œè¿™é‡Œå¯ä»¥å°†äºŒè€…å¯¹æ¯”ä¸€ä¸‹ï¼š"><a href="#åœ¨ESä¸­ï¼Œä¹Ÿå­˜åœ¨å’Œ-MySQLç±»ä¼¼çš„è¡¨ç»“æ„ï¼Œè¿™é‡Œå¯ä»¥å°†äºŒè€…å¯¹æ¯”ä¸€ä¸‹ï¼š" class="headerlink" title="åœ¨ESä¸­ï¼Œä¹Ÿå­˜åœ¨å’Œ MySQLç±»ä¼¼çš„è¡¨ç»“æ„ï¼Œè¿™é‡Œå¯ä»¥å°†äºŒè€…å¯¹æ¯”ä¸€ä¸‹ï¼š"></a>åœ¨ESä¸­ï¼Œä¹Ÿå­˜åœ¨å’Œ MySQLç±»ä¼¼çš„è¡¨ç»“æ„ï¼Œè¿™é‡Œå¯ä»¥å°†äºŒè€…å¯¹æ¯”ä¸€ä¸‹ï¼š</h5></li>
</ul>
<table>
<thead>
<tr>
<th><strong>MySQL</strong></th>
<th align="center"><strong>Elasticsearch</strong></th>
<th><strong>è¯´æ˜</strong></th>
</tr>
</thead>
<tbody><tr>
<td>Table</td>
<td align="center">Index</td>
<td>ç´¢å¼•(index)ï¼Œå°±æ˜¯æ–‡æ¡£çš„é›†åˆï¼Œç±»ä¼¼æ•°æ®åº“çš„è¡¨(table)</td>
</tr>
<tr>
<td>Row</td>
<td align="center">Document</td>
<td>æ–‡æ¡£ï¼ˆDocumentï¼‰ï¼Œå°±æ˜¯ä¸€æ¡æ¡çš„æ•°æ®ï¼Œç±»ä¼¼æ•°æ®åº“ä¸­çš„è¡Œï¼ˆRowï¼‰ï¼Œæ–‡æ¡£éƒ½æ˜¯JSONæ ¼å¼</td>
</tr>
<tr>
<td>Column</td>
<td align="center">Field</td>
<td>å­—æ®µï¼ˆFieldï¼‰ï¼Œå°±æ˜¯JSONæ–‡æ¡£ä¸­çš„å­—æ®µï¼Œç±»ä¼¼æ•°æ®åº“ä¸­çš„åˆ—ï¼ˆColumnï¼‰</td>
</tr>
<tr>
<td>Schema</td>
<td align="center">Mapping</td>
<td>Mappingï¼ˆæ˜ å°„ï¼‰æ˜¯ç´¢å¼•ä¸­æ–‡æ¡£çš„çº¦æŸï¼Œä¾‹å¦‚å­—æ®µç±»å‹çº¦æŸã€‚ç±»ä¼¼æ•°æ®åº“çš„è¡¨ç»“æ„ï¼ˆSchemaï¼‰</td>
</tr>
<tr>
<td>SQL</td>
<td align="center">DSL</td>
<td>DSLæ˜¯elasticsearchæä¾›çš„JSONé£æ ¼çš„è¯·æ±‚è¯­å¥ï¼Œç”¨æ¥æ“ä½œelasticsearchï¼Œå®ç°CRUD</td>
</tr>
</tbody></table>
<ul>
<li><h5 id="æ•°æ®åº“è¡¨ï¼š"><a href="#æ•°æ®åº“è¡¨ï¼š" class="headerlink" title="æ•°æ®åº“è¡¨ï¼š"></a>æ•°æ®åº“è¡¨ï¼š</h5></li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> post<br>(<br>    id         <span class="hljs-type">bigint</span> auto_increment comment <span class="hljs-string">&#x27;id&#x27;</span><br>        <span class="hljs-keyword">primary</span> key,<br>    title      <span class="hljs-type">varchar</span>(<span class="hljs-number">512</span>)                       <span class="hljs-keyword">null</span> comment <span class="hljs-string">&#x27;æ ‡é¢˜&#x27;</span>,<br>    content    text                               <span class="hljs-keyword">null</span> comment <span class="hljs-string">&#x27;å†…å®¹&#x27;</span>,<br>    tags       <span class="hljs-type">varchar</span>(<span class="hljs-number">1024</span>)                      <span class="hljs-keyword">null</span> comment <span class="hljs-string">&#x27;æ ‡ç­¾åˆ—è¡¨ï¼ˆjson æ•°ç»„ï¼‰&#x27;</span>,<br>    thumbNum   <span class="hljs-type">int</span>      <span class="hljs-keyword">default</span> <span class="hljs-number">0</span>                 <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span> comment <span class="hljs-string">&#x27;ç‚¹èµæ•°&#x27;</span>,<br>    favourNum  <span class="hljs-type">int</span>      <span class="hljs-keyword">default</span> <span class="hljs-number">0</span>                 <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span> comment <span class="hljs-string">&#x27;æ”¶è—æ•°&#x27;</span>,<br>    userId     <span class="hljs-type">bigint</span>                             <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span> comment <span class="hljs-string">&#x27;åˆ›å»ºç”¨æˆ· id&#x27;</span>,<br>    createTime datetime <span class="hljs-keyword">default</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span> comment <span class="hljs-string">&#x27;åˆ›å»ºæ—¶é—´&#x27;</span>,<br>    updateTime datetime <span class="hljs-keyword">default</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span> <span class="hljs-keyword">on</span> <span class="hljs-keyword">update</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> comment <span class="hljs-string">&#x27;æ›´æ–°æ—¶é—´&#x27;</span>,<br>    isDelete   tinyint  <span class="hljs-keyword">default</span> <span class="hljs-number">0</span>                 <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span> comment <span class="hljs-string">&#x27;æ˜¯å¦åˆ é™¤&#x27;</span><br>)<br>    comment <span class="hljs-string">&#x27;å¸–å­&#x27;</span> <span class="hljs-keyword">collate</span> <span class="hljs-operator">=</span> utf8mb4_unicode_ci;<br></code></pre></td></tr></table></figure>

<ul>
<li><h5 id="å»ºç«‹ç´¢å¼•è¯­å¥ï¼š"><a href="#å»ºç«‹ç´¢å¼•è¯­å¥ï¼š" class="headerlink" title="å»ºç«‹ç´¢å¼•è¯­å¥ï¼š"></a>å»ºç«‹ç´¢å¼•è¯­å¥ï¼š</h5></li>
<li><p>ES Mappingï¼š</p>
</li>
<li><p>idï¼ˆå¯ä»¥ä¸æ”¾åˆ°å­—æ®µè®¾ç½®é‡Œï¼‰</p>
</li>
<li><p>ES ä¸­ï¼Œå°½é‡å­˜æ”¾<strong>éœ€è¦ç”¨æˆ·ç­›é€‰</strong>ï¼ˆæœç´¢ï¼‰çš„æ•°æ®</p>
</li>
<li><p><strong>aliases</strong>ï¼šåˆ«åï¼ˆä¸ºäº†åç»­æ–¹ä¾¿æ•°æ®è¿ç§»ï¼‰</p>
</li>
<li><p>å­—æ®µç±»å‹æ˜¯ textï¼Œè¿™ä¸ªå­—æ®µæ˜¯å¯è¢«åˆ†è¯çš„ã€å¯æ¨¡ç³ŠæŸ¥è¯¢çš„ï¼›è€Œå¦‚æœæ˜¯ keywordï¼Œåªèƒ½å®Œå…¨åŒ¹é…ã€ç²¾ç¡®æŸ¥è¯¢ã€‚</p>
</li>
<li><p><strong>analyzer</strong>ï¼ˆå­˜å‚¨æ—¶ç”Ÿæ•ˆçš„åˆ†è¯å™¨ï¼‰ï¼šç”¨ ik_max_wordï¼Œæ‹†çš„æ›´ç¢ã€ç´¢å¼•æ›´å¤šï¼Œæ›´æœ‰å¯èƒ½è¢«æœå‡ºæ¥</p>
</li>
<li><p><strong>search_analyzer</strong>ï¼ˆæŸ¥è¯¢æ—¶ç”Ÿæ•ˆçš„åˆ†è¯å™¨ï¼‰ï¼šç”¨ ik_smartï¼Œæ›´åå‘äºç”¨æˆ·æƒ³æœçš„åˆ†è¯</p>
</li>
<li><p>å¦‚æœæƒ³è¦è®© text ç±»å‹çš„åˆ†è¯å­—æ®µä¹Ÿ<strong>æ”¯æŒç²¾ç¡®æŸ¥è¯¢</strong>ï¼Œå¯ä»¥åˆ›å»º keyword ç±»å‹çš„å­å­—æ®µï¼š</p>
</li>
</ul>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs css">POST post_v1<br>&#123;<br>&quot;aliases&quot;: &#123;<br>&quot;post&quot;: &#123;&#125;<br>&#125;,<br>&quot;mappings&quot;: &#123;<br>&quot;properties&quot;: &#123;<br>&quot;title&quot;: &#123;<br>&quot;type&quot;: <span class="hljs-string">&quot;text&quot;</span>,<br><span class="hljs-string">&quot;analyzer&quot;</span>: <span class="hljs-string">&quot;ik_max_word&quot;</span>,<br><span class="hljs-string">&quot;search_analyzer&quot;</span>: <span class="hljs-string">&quot;ik_smart&quot;</span>,<br><span class="hljs-string">&quot;fields&quot;</span>: &#123;<br>&quot;keyword&quot;: &#123;<br>&quot;type&quot;: <span class="hljs-string">&quot;keyword&quot;</span>,<br><span class="hljs-string">&quot;ignore_above&quot;</span>: <span class="hljs-number">256</span><br>&#125;<br>&#125;<br>&#125;,<br>&quot;<span class="hljs-attribute">content</span>&quot;: &#123;<br>&quot;type&quot;: <span class="hljs-string">&quot;text&quot;</span>,<br><span class="hljs-string">&quot;analyzer&quot;</span>: <span class="hljs-string">&quot;ik_max_word&quot;</span>,<br><span class="hljs-string">&quot;search_analyzer&quot;</span>: <span class="hljs-string">&quot;ik_smart&quot;</span>,<br><span class="hljs-string">&quot;fields&quot;</span>: &#123;<br>&quot;keyword&quot;: &#123;<br>&quot;type&quot;: <span class="hljs-string">&quot;keyword&quot;</span>,<br><span class="hljs-string">&quot;ignore_above&quot;</span>: <span class="hljs-number">256</span><br>&#125;<br>&#125;<br>&#125;,<br>&quot;tags&quot;: &#123;<br>&quot;type&quot;: <span class="hljs-string">&quot;keyword&quot;</span><br>&#125;,<br>&quot;userId&quot;: &#123;<br>&quot;type&quot;: <span class="hljs-string">&quot;keyword&quot;</span><br>&#125;,<br>&quot;createTime&quot;: &#123;<br>&quot;type&quot;: <span class="hljs-string">&quot;date&quot;</span><br>&#125;,<br>&quot;updateTime&quot;: &#123;<br>&quot;type&quot;: <span class="hljs-string">&quot;date&quot;</span><br>&#125;,<br>&quot;isDelete&quot;: &#123;<br>&quot;type&quot;: <span class="hljs-string">&quot;keyword&quot;</span><br>  &#125;<br>  &#125;<br> &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<ul>
<li><h5 id="SpringBooté¡¹ç›®ä¸­å¼•å…¥ä¾èµ–ï¼š"><a href="#SpringBooté¡¹ç›®ä¸­å¼•å…¥ä¾èµ–ï¼š" class="headerlink" title="SpringBooté¡¹ç›®ä¸­å¼•å…¥ä¾èµ–ï¼š"></a>SpringBooté¡¹ç›®ä¸­å¼•å…¥ä¾èµ–ï¼š</h5></li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>     <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>     <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-data-elasticsearch<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br> <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure>

<ul>
<li><h5 id="å¼€å¯ESç›¸å…³é…ç½®ï¼š"><a href="#å¼€å¯ESç›¸å…³é…ç½®ï¼š" class="headerlink" title="å¼€å¯ESç›¸å…³é…ç½®ï¼š"></a>å¼€å¯ESç›¸å…³é…ç½®ï¼š</h5></li>
</ul>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">elasticsearch:</span><br>   <span class="hljs-attr">uris:</span> <span class="hljs-string">http://localhost:9200</span><br>   <span class="hljs-attr">username:</span> <span class="hljs-string">root</span><br>   <span class="hljs-attr">password:</span> <span class="hljs-number">123456</span><br></code></pre></td></tr></table></figure>

<ul>
<li><h5 id="ç´¢å¼•ç»“æ„æ˜ å°„ï¼š"><a href="#ç´¢å¼•ç»“æ„æ˜ å°„ï¼š" class="headerlink" title="ç´¢å¼•ç»“æ„æ˜ å°„ï¼š"></a>ç´¢å¼•ç»“æ„æ˜ å°„ï¼š</h5></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Document(indexName = &quot;post&quot;)</span><br><span class="hljs-meta">@Data</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PostEsDTO</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Serializable</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">DATE_TIME_PATTERN</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;yyyy-MM-dd&#x27;T&#x27;HH:mm:ss.SSS&#x27;Z&#x27;&quot;</span>;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * id</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Id</span><br>    <span class="hljs-keyword">private</span> Long id;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æ ‡é¢˜</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> String title;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * å†…å®¹</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> String content;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æ ‡ç­¾åˆ—è¡¨</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> List&lt;String&gt; tags;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * ç‚¹èµæ•°</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> Integer thumbNum;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æ”¶è—æ•°</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> Integer favourNum;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * åˆ›å»ºç”¨æˆ· id</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> Long userId;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * åˆ›å»ºæ—¶é—´</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Field(index = false, store = true, type = FieldType.Date, format = &#123;&#125;, pattern = DATE_TIME_PATTERN)</span><br>    <span class="hljs-keyword">private</span> Date createTime;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æ›´æ–°æ—¶é—´</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Field(index = false, store = true, type = FieldType.Date, format = &#123;&#125;, pattern = DATE_TIME_PATTERN)</span><br>    <span class="hljs-keyword">private</span> Date updateTime;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æ˜¯å¦åˆ é™¤</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> Integer isDelete;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">long</span> <span class="hljs-variable">serialVersionUID</span> <span class="hljs-operator">=</span> <span class="hljs-number">1L</span>;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Gson</span> <span class="hljs-variable">GSON</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Gson</span>();<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * å¯¹è±¡è½¬åŒ…è£…ç±»</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> post</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> PostEsDTO <span class="hljs-title function_">objToDto</span><span class="hljs-params">(Post post)</span> &#123;<br>        <span class="hljs-keyword">if</span> (post == <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>        &#125;<br>        <span class="hljs-type">PostEsDTO</span> <span class="hljs-variable">postEsDTO</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">PostEsDTO</span>();<br>        BeanUtils.copyProperties(post, postEsDTO);<br>        <span class="hljs-type">String</span> <span class="hljs-variable">tagsStr</span> <span class="hljs-operator">=</span> post.getTags();<br>        <span class="hljs-keyword">if</span> (StringUtils.isNotBlank(tagsStr)) &#123;<br>            postEsDTO.setTags(GSON.fromJson(tagsStr, <span class="hljs-keyword">new</span> <span class="hljs-title class_">TypeToken</span>&lt;List&lt;String&gt;&gt;() &#123;<br>            &#125;.getType()));<br>        &#125;<br>        <span class="hljs-keyword">return</span> postEsDTO;<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * åŒ…è£…ç±»è½¬å¯¹è±¡</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> postEsDTO</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Post <span class="hljs-title function_">dtoToObj</span><span class="hljs-params">(PostEsDTO postEsDTO)</span> &#123;<br>        <span class="hljs-keyword">if</span> (postEsDTO == <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>        &#125;<br>        <span class="hljs-type">Post</span> <span class="hljs-variable">post</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Post</span>();<br>        BeanUtils.copyProperties(postEsDTO, post);<br>        List&lt;String&gt; tagList = postEsDTO.getTags();<br>        <span class="hljs-keyword">if</span> (CollectionUtils.isNotEmpty(tagList)) &#123;<br>            post.setTags(GSON.toJson(tagList));<br>        &#125;<br>        <span class="hljs-keyword">return</span> post;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<ul>
<li>ç¼–å†™ DAO å±‚ï¼š</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">PostEsDao</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">ElasticsearchRepository</span>&lt;PostEsDTO, Long&gt; &#123;<br>    List&lt;PostEsDTO&gt; <span class="hljs-title function_">findByUserId</span><span class="hljs-params">(Long userId)</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<h4 id="å¢åˆ æ”¹æŸ¥"><a href="#å¢åˆ æ”¹æŸ¥" class="headerlink" title="å¢åˆ æ”¹æŸ¥"></a>å¢åˆ æ”¹æŸ¥</h4><ul>
<li>æµ‹è¯•å¢åˆ æ”¹æŸ¥ï¼š</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Resource</span><br><span class="hljs-keyword">private</span> PostEsDao postEsDao;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// æ–°å¢ä¸€æ¡æ–‡æ¡£</span><br><span class="hljs-meta">@Test</span><br> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testAdd</span><span class="hljs-params">()</span> &#123;<br>     <span class="hljs-type">PostEsDTO</span> <span class="hljs-variable">postEsDTO</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">PostEsDTO</span>();<br>     postEsDTO.setId(<span class="hljs-number">5L</span>);<br>     postEsDTO.setTitle(<span class="hljs-string">&quot;test&quot;</span>);<br>     postEsDTO.setContent(<span class="hljs-string">&quot;test&quot;</span>);<br>     postEsDTO.setTags(Arrays.asList(<span class="hljs-string">&quot;java&quot;</span>, <span class="hljs-string">&quot;python&quot;</span>));<br>     postEsDTO.setThumbNum(<span class="hljs-number">1</span>);<br>     postEsDTO.setFavourNum(<span class="hljs-number">1</span>);<br>     postEsDTO.setUserId(<span class="hljs-number">1L</span>);<br>     postEsDTO.setCreateTime(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>());<br>     postEsDTO.setUpdateTime(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>());<br>     postEsDTO.setIsDelete(<span class="hljs-number">0</span>);<br>     postEsDao.save(postEsDTO);<br>     System.out.println(postEsDTO.getId());<br> &#125;<br><br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// æŸ¥æ‰¾æ–‡æ¡£</span><br><span class="hljs-meta">@Test</span><br>  <span class="hljs-keyword">void</span> <span class="hljs-title function_">testFindById</span><span class="hljs-params">()</span> &#123;<br>      Optional&lt;PostEsDTO&gt; postEsDTO = postEsDao.findById(<span class="hljs-number">1L</span>);<br>      System.out.println(postEsDTO);<br>  &#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// æŸ¥æ‰¾æ‰€æœ‰æ–‡æ¡£</span><br><span class="hljs-meta">@Test</span><br>  <span class="hljs-keyword">void</span> <span class="hljs-title function_">testSelect</span><span class="hljs-params">()</span> &#123;<br>      System.out.println(postEsDao.count());<br>      Page&lt;PostEsDTO&gt; PostPage = postEsDao.findAll(<br>              PageRequest.of(<span class="hljs-number">0</span>, <span class="hljs-number">5</span>, Sort.by(<span class="hljs-string">&quot;createTime&quot;</span>)));<br>      List&lt;PostEsDTO&gt; postList = PostPage.getContent();<br>      System.out.println(postList);<br>  &#125;<br></code></pre></td></tr></table></figure>

<ul>
<li><h5 id="ç®€å•çš„å¢ã€åˆ ã€æ”¹ã€æŸ¥æµ‹è¯•é€šè¿‡ï¼šï¼ˆ2023-09-20æ™šï¼‰"><a href="#ç®€å•çš„å¢ã€åˆ ã€æ”¹ã€æŸ¥æµ‹è¯•é€šè¿‡ï¼šï¼ˆ2023-09-20æ™šï¼‰" class="headerlink" title="ç®€å•çš„å¢ã€åˆ ã€æ”¹ã€æŸ¥æµ‹è¯•é€šè¿‡ï¼šï¼ˆ2023/09/20æ™šï¼‰"></a>ç®€å•çš„å¢ã€åˆ ã€æ”¹ã€æŸ¥æµ‹è¯•é€šè¿‡ï¼šï¼ˆ2023/09/20æ™šï¼‰</h5></li>
</ul>
<p><img src="https://gitee.com/deng-2022/pictures/raw/master/images/image-20230920172305509.png" alt="image-20230920172305509"></p>
<h4 id="DSLæŸ¥è¯¢"><a href="#DSLæŸ¥è¯¢" class="headerlink" title="DSLæŸ¥è¯¢"></a>DSLæŸ¥è¯¢</h4><ul>
<li><h5 id="å‚è€ƒæ–‡æ¡£ï¼š"><a href="#å‚è€ƒæ–‡æ¡£ï¼š" class="headerlink" title="å‚è€ƒæ–‡æ¡£ï¼š"></a>å‚è€ƒæ–‡æ¡£ï¼š</h5></li>
<li><h5 id="Query-and-filter-context-Elasticsearch-Guide-7-17-Elastic"><a href="#Query-and-filter-context-Elasticsearch-Guide-7-17-Elastic" class="headerlink" title="[Query and filter context | Elasticsearch Guide 7.17] | Elastic"></a>[Query and filter context | Elasticsearch Guide <a target="_blank" rel="noopener" href="https://www.elastic.co/guide/en/elasticsearch/reference/7.17/query-filter-context.html">7.17] | Elastic</a></h5></li>
<li><h5 id="Boolean-query-Elasticsearch-Guide-7-17-Elastic"><a href="#Boolean-query-Elasticsearch-Guide-7-17-Elastic" class="headerlink" title="[Boolean query | Elasticsearch Guide 7.17] | Elastic"></a>[Boolean query | Elasticsearch Guide <a target="_blank" rel="noopener" href="https://www.elastic.co/guide/en/elasticsearch/reference/7.17/query-dsl-bool-query.html">7.17] | Elastic</a></h5></li>
<li><h5 id="è¯¦ç»†çš„DSLæŸ¥è¯¢å­¦ä¹ å¯ä»¥çœ‹å®˜ç½‘å­¦ä¹ ï¼Œå¾…æˆ‘å­¦æˆå½’æ¥ï¼Œå°±åœ¨æ­¤ç•™ä¸‹æˆ‘çš„å­¦ä¹ ç¬”è®°ï¼ˆ2023-09-21æ™šï¼‰"><a href="#è¯¦ç»†çš„DSLæŸ¥è¯¢å­¦ä¹ å¯ä»¥çœ‹å®˜ç½‘å­¦ä¹ ï¼Œå¾…æˆ‘å­¦æˆå½’æ¥ï¼Œå°±åœ¨æ­¤ç•™ä¸‹æˆ‘çš„å­¦ä¹ ç¬”è®°ï¼ˆ2023-09-21æ™šï¼‰" class="headerlink" title="è¯¦ç»†çš„DSLæŸ¥è¯¢å­¦ä¹ å¯ä»¥çœ‹å®˜ç½‘å­¦ä¹ ï¼Œå¾…æˆ‘å­¦æˆå½’æ¥ï¼Œå°±åœ¨æ­¤ç•™ä¸‹æˆ‘çš„å­¦ä¹ ç¬”è®°ï¼ˆ2023/09/21æ™šï¼‰"></a>è¯¦ç»†çš„DSLæŸ¥è¯¢å­¦ä¹ å¯ä»¥çœ‹å®˜ç½‘å­¦ä¹ ï¼Œå¾…æˆ‘å­¦æˆå½’æ¥ï¼Œå°±åœ¨æ­¤ç•™ä¸‹æˆ‘çš„å­¦ä¹ ç¬”è®°ï¼ˆ2023/09/21æ™šï¼‰</h5></li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">GET</span> post<span class="hljs-operator">/</span>_search<br>&#123;<br> &quot;query&quot;: &#123;<br> &quot;bool&quot;: &#123; <span class="hljs-operator">/</span><span class="hljs-operator">/</span> ç»„åˆæ¡ä»¶<br> &quot;must&quot;: [ <span class="hljs-operator">/</span><span class="hljs-operator">/</span> å¿…é¡»éƒ½æ»¡è¶³<br> &#123; &quot;match&quot;: &#123; &quot;title&quot;: &quot;é±¼çš®&quot; &#125;&#125;, <span class="hljs-operator">/</span><span class="hljs-operator">/</span> <span class="hljs-keyword">match</span> æ¨¡ç³ŠæŸ¥è¯¢<br> &#123; &quot;match&quot;: &#123; &quot;content&quot;: &quot;çŸ¥è¯†æ˜Ÿçƒ&quot; &#125;&#125;<br> ],<br> &quot;filter&quot;: [<br> &#123; &quot;term&quot;: &#123; &quot;status&quot;: &quot;published&quot; &#125;&#125;, <span class="hljs-operator">/</span><span class="hljs-operator">/</span> term ç²¾ç¡®æŸ¥è¯¢<br> &#123; &quot;range&quot;: &#123; &quot;publish_date&quot;: &#123; &quot;gte&quot;: &quot;2015-01-01&quot; &#125;&#125;&#125; <span class="hljs-operator">/</span><span class="hljs-operator">/</span> <span class="hljs-keyword">range</span> èŒƒå›´<br> ]<br> &#125;<br> &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<ul>
<li><h5 id="å»ºè®®å…ˆæµ‹è¯•ï¼Œå†ç¿»è¯‘ä¸ºJavaå®¢æˆ·ç«¯æ“ä½œ"><a href="#å»ºè®®å…ˆæµ‹è¯•ï¼Œå†ç¿»è¯‘ä¸ºJavaå®¢æˆ·ç«¯æ“ä½œ" class="headerlink" title="å»ºè®®å…ˆæµ‹è¯•ï¼Œå†ç¿»è¯‘ä¸ºJavaå®¢æˆ·ç«¯æ“ä½œ"></a>å»ºè®®å…ˆæµ‹è¯•ï¼Œå†ç¿»è¯‘ä¸ºJavaå®¢æˆ·ç«¯æ“ä½œ</h5></li>
</ul>
<h2 id="æ•°æ®åŒæ­¥"><a href="#æ•°æ®åŒæ­¥" class="headerlink" title="æ•°æ®åŒæ­¥"></a>æ•°æ®åŒæ­¥</h2><blockquote>
<p>ğŸ¤¡ æ¨èé˜…è¯»ï¼š<a target="_blank" rel="noopener" href="https://juejin.cn/post/7248118049583841336?searchId=2023120321485611272C0B2A87CDE2AEB1">4 ç§ MySQL åŒæ­¥ ES æ–¹æ¡ˆï¼Œyydsï¼ - æ˜é‡‘ (juejin.cn)</a></p>
</blockquote>
<ul>
<li><p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œå¦‚æœåš<strong>æŸ¥è¯¢æœç´¢</strong>åŠŸèƒ½ï¼Œä½¿ç”¨ ES æ¥<strong>æ¨¡ç³Šæœç´¢</strong> <strong>ï¼ˆ2023/09/21æ™šï¼‰</strong></p>
</li>
<li><p>ä½†æ˜¯æ•°æ®æ˜¯å­˜æ”¾åœ¨æ•°æ®åº“ <strong>MySQL</strong> é‡Œ çš„ï¼Œæ‰€ä»¥è¯´æˆ‘ä»¬éœ€è¦æŠŠ <strong>MySQL ä¸­çš„æ•°æ®å’Œ ES è¿›è¡ŒåŒæ­¥</strong>ï¼Œä¿è¯<strong>æ•°æ®ä¸€è‡´</strong>ï¼ˆä»¥ MySQL ä¸ºä¸»ï¼‰</p>
</li>
<li><h5 id="MySQL-gt-ES-ï¼ˆå•å‘ï¼‰"><a href="#MySQL-gt-ES-ï¼ˆå•å‘ï¼‰" class="headerlink" title="MySQL =&gt; ES ï¼ˆå•å‘ï¼‰"></a>MySQL =&gt; ES ï¼ˆå•å‘ï¼‰</h5></li>
<li><p>é¦–æ¬¡å®‰è£…å®Œ ESï¼ŒæŠŠ MySQL æ•°æ®å…¨é‡åŒæ­¥åˆ° ES é‡Œï¼Œå†™ä¸€ä¸ªå•æ¬¡è„šæœ¬ 4 ç§æ–¹å¼ï¼Œå…¨é‡åŒæ­¥ï¼ˆé¦–æ¬¡ï¼‰+ å¢é‡åŒæ­¥ï¼ˆæ–°æ•°æ®ï¼‰ï¼š</p>
<ul>
<li><p><strong>å®šæ—¶ä»»åŠ¡</strong>ï¼šæ¯”å¦‚ 1 åˆ†é’Ÿ 1 æ¬¡ï¼Œæ‰¾åˆ° MySQL ä¸­è¿‡å»å‡ åˆ†é’Ÿå†…ï¼ˆè‡³å°‘æ˜¯å®šæ—¶å‘¨æœŸçš„ 2 å€ï¼‰å‘ ç”Ÿæ”¹å˜çš„æ•°æ®ï¼Œç„¶åæ›´æ–°åˆ° ESã€‚ </p>
<ul>
<li>ä¼˜ç‚¹ï¼šç®€å•æ˜“æ‡‚ã€å ç”¨èµ„æºå°‘ã€ä¸ç”¨å¼•å…¥ç¬¬ä¸‰æ–¹ä¸­é—´ä»¶ </li>
<li>ç¼ºç‚¹ï¼šæœ‰æ—¶é—´å·® åº”ç”¨åœºæ™¯ï¼šæ•°æ®çŸ­æ—¶é—´å†…ä¸åŒæ­¥å½±å“ä¸å¤§ã€æˆ–è€…æ•°æ®å‡ ä¹ä¸å‘ç”Ÿä¿®æ”¹ </li>
</ul>
</li>
<li><p><strong>åŒå†™</strong>ï¼šå†™æ•°æ®çš„æ—¶å€™ï¼Œå¿…é¡»ä¹Ÿå»å†™ ESï¼›æ›´æ–°åˆ é™¤æ•°æ®åº“åŒç†ã€‚</p>
<ul>
<li>äº‹åŠ¡ï¼šå»ºè®®å…ˆä¿è¯  MySQL å†™æˆåŠŸ</li>
<li>å¦‚æœ ES å†™å¤±è´¥äº†ï¼Œå¯ä»¥é€šè¿‡å®šæ—¶ä»»åŠ¡ + æ—¥å¿— + å‘Šè­¦è¿›è¡Œæ£€æµ‹å’Œä¿®å¤ ï¼ˆè¡¥å¿ï¼‰</li>
</ul>
</li>
<li><p><strong>Logstash æ•°æ®åŒæ­¥ç®¡é“</strong>ï¼šï¼ˆä¸€èˆ¬è¦é…åˆ kafka æ¶ˆæ¯é˜Ÿåˆ— + beats é‡‡é›†å™¨ï¼‰</p>
</li>
<li><p><strong>Canal ç›‘å¬ MySQL Binlog</strong>ï¼šå®æ—¶åŒæ­¥ </p>
</li>
</ul>
</li>
</ul>
<h3 id="Logstash"><a href="#Logstash" class="headerlink" title="Logstash"></a>Logstash</h3><ul>
<li><h5 id="Getting-Started-with-Logstash-Logstash-Reference-7-17-Elasticï¼ˆ2023-09-22æ™šï¼‰"><a href="#Getting-Started-with-Logstash-Logstash-Reference-7-17-Elasticï¼ˆ2023-09-22æ™šï¼‰" class="headerlink" title="[Getting Started with Logstash | Logstash Reference 7.17] | Elasticï¼ˆ2023/09/22æ™šï¼‰"></a>[Getting Started with Logstash | Logstash Reference <a target="_blank" rel="noopener" href="https://www.elastic.co/guide/en/logstash/7.17/getting-started-with-logstash.html">7.17] | Elastic</a>ï¼ˆ2023/09/22æ™šï¼‰</h5></li>
<li><h5 id="Running-Logstash-on-Windows-Logstash-Reference-7-17-Elastic"><a href="#Running-Logstash-on-Windows-Logstash-Reference-7-17-Elastic" class="headerlink" title="[Running Logstash on Windows | Logstash Reference 7.17] | Elastic"></a>[Running Logstash on Windows | Logstash Reference <a target="_blank" rel="noopener" href="https://www.elastic.co/guide/en/logstash/7.17/running-logstash-windows.html">7.17] | Elastic</a></h5></li>
<li><p><strong>ä¼ è¾“</strong> å’Œ <strong>å¤„ç† æ•°æ®</strong>çš„ç®¡é“</p>
<ul>
<li>å¥½å¤„ï¼šç”¨èµ·æ¥æ–¹ä¾¿ï¼Œæ’ä»¶å¤š </li>
<li>ç¼ºç‚¹ï¼šæˆæœ¬æ›´å¤§ã€ä¸€èˆ¬è¦é…åˆå…¶ä»–ç»„ä»¶ä½¿ç”¨ï¼ˆæ¯”å¦‚ kafkaï¼‰</li>
</ul>
</li>
<li><p>æœ¬è´¨ä¸Šå°±æ˜¯æŠŠ<strong>ç¼–ç¨‹å¼åŒæ­¥æ”¹ä¸ºé…ç½®å¼åŒæ­¥</strong>ï¼Œæ›´åŠ æ–¹ä¾¿å¿«æ·</p>
</li>
</ul>
<h4 id="ä¸‹è½½å®‰è£…-1"><a href="#ä¸‹è½½å®‰è£…-1" class="headerlink" title="ä¸‹è½½å®‰è£…"></a>ä¸‹è½½å®‰è£…</h4><ul>
<li><h5 id="Download-Logstash-Free-Get-Started-Now-Elastic"><a href="#Download-Logstash-Free-Get-Started-Now-Elastic" class="headerlink" title="Download Logstash Free | Get Started Now | Elastic"></a><a target="_blank" rel="noopener" href="https://www.elastic.co/cn/downloads/logstash">Download Logstash Free | Get Started Now | Elastic</a></h5></li>
</ul>
<h4 id="demoæµ‹è¯•"><a href="#demoæµ‹è¯•" class="headerlink" title="demoæµ‹è¯•"></a>demoæµ‹è¯•</h4><ul>
<li><h5 id="Stashing-Your-First-Event-Logstash-Reference-7-17-Elastic"><a href="#Stashing-Your-First-Event-Logstash-Reference-7-17-Elastic" class="headerlink" title="[Stashing Your First Event | Logstash Reference 7.17] | Elastic"></a>[Stashing Your First Event | Logstash Reference <a target="_blank" rel="noopener" href="https://www.elastic.co/guide/en/logstash/7.17/first-event.html">7.17] | Elastic</a></h5></li>
</ul>
<p><img src="https://gitee.com/deng-2022/pictures/raw/master/images/image-20230922205535009.png" alt="image-20230922205535009"></p>
<ul>
<li><h5 id="æˆ‘ä»¬æ ¹æ®å®˜ç½‘æŒ‡å¼•ï¼Œå¯ä»¥æ‰¾åˆ°è¿™ä¹ˆä¸€æ®µæµ‹è¯•ä»£ç ï¼š"><a href="#æˆ‘ä»¬æ ¹æ®å®˜ç½‘æŒ‡å¼•ï¼Œå¯ä»¥æ‰¾åˆ°è¿™ä¹ˆä¸€æ®µæµ‹è¯•ä»£ç ï¼š" class="headerlink" title="æˆ‘ä»¬æ ¹æ®å®˜ç½‘æŒ‡å¼•ï¼Œå¯ä»¥æ‰¾åˆ°è¿™ä¹ˆä¸€æ®µæµ‹è¯•ä»£ç ï¼š"></a>æˆ‘ä»¬æ ¹æ®å®˜ç½‘æŒ‡å¼•ï¼Œå¯ä»¥æ‰¾åˆ°è¿™ä¹ˆä¸€æ®µæµ‹è¯•ä»£ç ï¼š</h5></li>
</ul>
<figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dust"><span class="language-xml">logstash.bat -e &quot;input </span><span class="hljs-template-variable">&#123; stdin &#123; &#125;</span><span class="language-xml"> &#125; output </span><span class="hljs-template-variable">&#123; stdout &#123;&#125;</span><span class="language-xml"> &#125;&quot;</span><br></code></pre></td></tr></table></figure>

<ul>
<li><p>åœ¨<strong>binç›®å½•ä¸‹</strong>æ‰§è¡Œè¿™æ®µä»£ç ï¼ˆå¯ä»¥ç†è§£ä¸ºï¼šæŒ‡å®šè¾“å…¥è¾“å‡º<strong>é…ç½®å‡ä¸ºé»˜è®¤</strong>ï¼Œ<strong>å¼€å¯ Logstash</strong>ï¼‰</p>
</li>
<li><h5 id="å¾…å¯åŠ¨å®Œæˆåï¼Œéšä¾¿è¾“å…¥å†…å®¹ï¼Œå¦‚æœåœ¨å‘½ä»¤è¡Œä¸­æœ‰è¿”å›ç›¸åŒå†…å®¹ï¼Œåˆ™æµ‹è¯•æˆåŠŸ"><a href="#å¾…å¯åŠ¨å®Œæˆåï¼Œéšä¾¿è¾“å…¥å†…å®¹ï¼Œå¦‚æœåœ¨å‘½ä»¤è¡Œä¸­æœ‰è¿”å›ç›¸åŒå†…å®¹ï¼Œåˆ™æµ‹è¯•æˆåŠŸ" class="headerlink" title="å¾…å¯åŠ¨å®Œæˆåï¼Œéšä¾¿è¾“å…¥å†…å®¹ï¼Œå¦‚æœåœ¨å‘½ä»¤è¡Œä¸­æœ‰è¿”å›ç›¸åŒå†…å®¹ï¼Œåˆ™æµ‹è¯•æˆåŠŸ"></a>å¾…å¯åŠ¨å®Œæˆåï¼Œéšä¾¿è¾“å…¥å†…å®¹ï¼Œå¦‚æœåœ¨å‘½ä»¤è¡Œä¸­æœ‰è¿”å›ç›¸åŒå†…å®¹ï¼Œåˆ™æµ‹è¯•æˆåŠŸ</h5></li>
<li><p>å¦‚å›¾æ‰€ç¤ºï¼š</p>
</li>
</ul>
<p><img src="https://gitee.com/deng-2022/pictures/raw/master/images/image-20230922205958186.png" alt="image-20230922205958186"></p>
<h4 id="è‡ªå®šä¹‰é…ç½®"><a href="#è‡ªå®šä¹‰é…ç½®" class="headerlink" title="è‡ªå®šä¹‰é…ç½®"></a>è‡ªå®šä¹‰é…ç½®</h4><ul>
<li><h5 id="å¿«é€Ÿå¼€å§‹ï¼š-Running-Logstash-on-Windows-Logstash-Reference-7-17-Elasticï¼ˆ2023-09-22æ™šï¼‰"><a href="#å¿«é€Ÿå¼€å§‹ï¼š-Running-Logstash-on-Windows-Logstash-Reference-7-17-Elasticï¼ˆ2023-09-22æ™šï¼‰" class="headerlink" title="å¿«é€Ÿå¼€å§‹ï¼š[Running Logstash on Windows | Logstash Reference 7.17] | Elasticï¼ˆ2023/09/22æ™šï¼‰"></a>å¿«é€Ÿå¼€å§‹ï¼š[Running Logstash on Windows | Logstash Reference <a target="_blank" rel="noopener" href="https://www.elastic.co/guide/en/logstash/7.17/running-logstash-windows.html">7.17] | Elastic</a>ï¼ˆ2023/09/22æ™šï¼‰</h5></li>
<li><p>åœ¨å®˜æ–¹æ–‡æ¡£ä¸­ï¼Œæ‰¾åˆ°è¿™ä¸€æ®µç®€å•çš„ç¤ºä¾‹é…ç½®ï¼š</p>
</li>
</ul>
<p><img src="https://gitee.com/deng-2022/pictures/raw/master/images/image-20230922210307761.png" alt="image-20230922210307761"></p>
<ul>
<li>å°†è¿™æ®µé…ç½®ç²˜è´´è¿› <strong>config ä¸‹</strong>çš„ <strong>logstash-sample.conf é…ç½®æ–‡ä»¶ï¼ˆå¯ä»¥ä¿ç•™è¯¥åŸæ–‡ä»¶ï¼Œå¤åˆ¶ä¸€ä»½é‡å‘½åï¼‰</strong>ä¸­ï¼š</li>
<li>è¿™å‡ è¡Œé…ç½®æ˜¯å¹²ä»€ä¹ˆçš„å‘¢ï¼Ÿç®€å•æ¥è®²å°±æ˜¯<strong>å®šä¹‰äº†è¾“å…¥å’Œè¾“å‡º</strong>ï¼š<strong>ç›‘å¬ UDPï¼Œå¹¶è¾“å‡º</strong></li>
</ul>
<p><img src="https://gitee.com/deng-2022/pictures/raw/master/images/image-20230922210525309.png" alt="image-20230922210525309"></p>
<ul>
<li>æŒ‰å®˜æ–¹æ–‡æ¡£çš„æ“ä½œæ¥ï¼Œå°è¯•<strong>åŠ è½½è¿™ä¸ªé…ç½®æ–‡ä»¶</strong> å¹¶ <strong>å¯åŠ¨ Logstash</strong>ï¼š</li>
</ul>
<figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs livescript">.<span class="hljs-string">\bin\logstash.bat</span> -f .<span class="hljs-string">\config\myTask.conf</span><br></code></pre></td></tr></table></figure>

<ul>
<li><h5 id="Running-Logstash-on-Windows-Logstash-Reference-7-17-Elastic-1"><a href="#Running-Logstash-on-Windows-Logstash-Reference-7-17-Elastic-1" class="headerlink" title="[Running Logstash on Windows | Logstash Reference 7.17] | Elastic"></a>[Running Logstash on Windows | Logstash Reference <a target="_blank" rel="noopener" href="https://www.elastic.co/guide/en/logstash/7.17/running-logstash-windows.html#running-logstash-windows-manual">7.17] | Elastic</a></h5></li>
</ul>
<p><img src="https://gitee.com/deng-2022/pictures/raw/master/images/image-20230922211016754.png" alt="image-20230922211016754"></p>
<ul>
<li><h5 id="è¿è¡Œè¿™è¡Œå‘½ä»¤ï¼Œå¯ä»¥çœ‹åˆ°-Logstash-æˆåŠŸå¯åŠ¨è¿è¡Œäº†"><a href="#è¿è¡Œè¿™è¡Œå‘½ä»¤ï¼Œå¯ä»¥çœ‹åˆ°-Logstash-æˆåŠŸå¯åŠ¨è¿è¡Œäº†" class="headerlink" title="è¿è¡Œè¿™è¡Œå‘½ä»¤ï¼Œå¯ä»¥çœ‹åˆ° Logstash æˆåŠŸå¯åŠ¨è¿è¡Œäº†"></a>è¿è¡Œè¿™è¡Œå‘½ä»¤ï¼Œå¯ä»¥çœ‹åˆ° Logstash æˆåŠŸå¯åŠ¨è¿è¡Œäº†</h5></li>
</ul>
<p><img src="https://gitee.com/deng-2022/pictures/raw/master/images/image-20230922211330283.png" alt="image-20230922211330283"></p>
<h4 id="åŒæ­¥MySQL"><a href="#åŒæ­¥MySQL" class="headerlink" title="åŒæ­¥MySQL"></a>åŒæ­¥MySQL</h4><ul>
<li><h5 id="Jdbc-input-plugin-Logstash-Reference-7-17-Elastic"><a href="#Jdbc-input-plugin-Logstash-Reference-7-17-Elastic" class="headerlink" title="[Jdbc input plugin | Logstash Reference 7.17] | Elastic"></a>[Jdbc input plugin | Logstash Reference <a target="_blank" rel="noopener" href="https://www.elastic.co/guide/en/logstash/7.17/plugins-inputs-jdbc.html">7.17] | Elastic</a></h5></li>
<li><h5 id="åœ¨å®˜æ–¹æ–‡æ¡£ä¸­ï¼Œæ‰¾åˆ°è¿™æ®µé…ç½®ï¼Œç”¨æ¥æŠŠ-inputè¾“å…¥ä¸-MySQLæ•°æ®åº“ä¸­çš„æ•°æ®åŒæ­¥ï¼ˆ2023-09-22æ™šï¼‰"><a href="#åœ¨å®˜æ–¹æ–‡æ¡£ä¸­ï¼Œæ‰¾åˆ°è¿™æ®µé…ç½®ï¼Œç”¨æ¥æŠŠ-inputè¾“å…¥ä¸-MySQLæ•°æ®åº“ä¸­çš„æ•°æ®åŒæ­¥ï¼ˆ2023-09-22æ™šï¼‰" class="headerlink" title="åœ¨å®˜æ–¹æ–‡æ¡£ä¸­ï¼Œæ‰¾åˆ°è¿™æ®µé…ç½®ï¼Œç”¨æ¥æŠŠ inputè¾“å…¥ä¸ MySQLæ•°æ®åº“ä¸­çš„æ•°æ®åŒæ­¥ï¼ˆ2023/09/22æ™šï¼‰"></a>åœ¨å®˜æ–¹æ–‡æ¡£ä¸­ï¼Œæ‰¾åˆ°è¿™æ®µé…ç½®ï¼Œç”¨æ¥æŠŠ inputè¾“å…¥ä¸ MySQLæ•°æ®åº“ä¸­çš„æ•°æ®åŒæ­¥ï¼ˆ2023/09/22æ™šï¼‰</h5></li>
</ul>
<figure class="highlight puppet"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs puppet"><span class="hljs-keyword">input</span> &#123;<br>  jdbc &#123;<br>    <span class="hljs-attr">jdbc_driver_library</span> =&gt; <span class="hljs-string">&quot;mysql-connector-java-5.1.36-bin.jar&quot;</span><br>    <span class="hljs-attr">jdbc_driver_class</span> =&gt; <span class="hljs-string">&quot;com.mysql.jdbc.Driver&quot;</span><br>    <span class="hljs-attr">jdbc_connection_string</span> =&gt; <span class="hljs-string">&quot;jdbc:mysql://localhost:3306/mydb&quot;</span><br>    <span class="hljs-attr">jdbc_user</span> =&gt; <span class="hljs-string">&quot;mysql&quot;</span><br>    <span class="hljs-attr">parameters</span> =&gt; &#123; <span class="hljs-string">&quot;favorite_artist&quot;</span> =&gt; <span class="hljs-string">&quot;Beethoven&quot;</span> &#125;<br>    <span class="hljs-keyword">schedule</span> =&gt; <span class="hljs-string">&quot;* * * * *&quot;</span><br>    statement =&gt; <span class="hljs-string">&quot;SELECT * from songs where artist = :favorite_artist&quot;</span><br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<ul>
<li><p>è¿™äº›é…ç½®æ˜¯ä¸æ˜¯å¾ˆçœ¼ç†Ÿï¼Ÿæˆ‘ä»¬ç®€å•è¯´æ˜ä¸€ä¸‹ï¼š</p>
<ul>
<li><strong>jdbc_driver_library</strong>ï¼šå°±æ˜¯åŠ è½½ MySQL æ•°æ®åº“çš„ jar åŒ…ï¼ˆä¾èµ–ï¼‰</li>
<li>æ¥ä¸‹æ¥çš„å››è¡Œé…ç½®ä¸ç”¨å¤šè¯´ï¼Œè¿æ¥<strong>MySQLçš„é©±åŠ¨</strong>ã€<strong>å¯¹åº”æ•°æ®åº“</strong>ã€<strong>ç”¨æˆ·å</strong>ã€<strong>å¯†ç </strong></li>
<li><strong>statement</strong>ï¼šSQLè¡¨è¾¾å¼ï¼Œç”¨æ¥ä» MySQL ä¸­è·å–æ•°æ®</li>
<li><strong>parameters</strong>ï¼šèµ·åˆ°åŠ¨æ€é…ç½® SQL è¯­å¥ä¸­çš„å‚æ•°çš„ä½œç”¨</li>
<li><strong>schedule</strong>ï¼šCronè¡¨è¾¾å¼ï¼Œå®ç°å®šæ—¶æŸ¥è¯¢</li>
</ul>
</li>
<li><h5 id="æˆ‘ä»¬æŒ‰è‡ªå·±å®é™…çš„çš„éœ€æ±‚ï¼Œå¯ä»¥ç®€å•åœ°ä¿®æ”¹é…ç½®"><a href="#æˆ‘ä»¬æŒ‰è‡ªå·±å®é™…çš„çš„éœ€æ±‚ï¼Œå¯ä»¥ç®€å•åœ°ä¿®æ”¹é…ç½®" class="headerlink" title="æˆ‘ä»¬æŒ‰è‡ªå·±å®é™…çš„çš„éœ€æ±‚ï¼Œå¯ä»¥ç®€å•åœ°ä¿®æ”¹é…ç½®"></a>æˆ‘ä»¬æŒ‰è‡ªå·±å®é™…çš„çš„éœ€æ±‚ï¼Œå¯ä»¥ç®€å•åœ°ä¿®æ”¹é…ç½®</h5></li>
<li><p>å½“ç„¶äº†ï¼Œå¦‚æœæˆ‘ä»¬æˆ‘ä»¬ç°åœ¨åŠ è½½æ­¤é…ç½®ã€å¯åŠ¨ Logstashï¼Œä¸€å®šä¼šæŠ¥é”™ï¼Œå¦‚å›¾æ‰€ç¤ºï¼š</p>
</li>
</ul>
<p><img src="https://gitee.com/deng-2022/pictures/raw/master/images/image-20230922213346119.png" alt="image-20230922213346119"></p>
<ul>
<li><h5 id="åŸå› å¾ˆç®€å•ï¼Œå°±æ˜¯é…ç½®ä¸­çš„-mysql-jaråŒ…æ‰¾ä¸åˆ°ï¼Œæˆ‘ä»¬éœ€è¦è‡ªå·±é…ç½®ä¸€ä¸ª-mysql-jaråŒ…ï¼Œå¹¶æ­£ç¡®é…ç½®å®ƒçš„è·¯å¾„"><a href="#åŸå› å¾ˆç®€å•ï¼Œå°±æ˜¯é…ç½®ä¸­çš„-mysql-jaråŒ…æ‰¾ä¸åˆ°ï¼Œæˆ‘ä»¬éœ€è¦è‡ªå·±é…ç½®ä¸€ä¸ª-mysql-jaråŒ…ï¼Œå¹¶æ­£ç¡®é…ç½®å®ƒçš„è·¯å¾„" class="headerlink" title="åŸå› å¾ˆç®€å•ï¼Œå°±æ˜¯é…ç½®ä¸­çš„ mysql jaråŒ…æ‰¾ä¸åˆ°ï¼Œæˆ‘ä»¬éœ€è¦è‡ªå·±é…ç½®ä¸€ä¸ª mysql jaråŒ…ï¼Œå¹¶æ­£ç¡®é…ç½®å®ƒçš„è·¯å¾„"></a>åŸå› å¾ˆç®€å•ï¼Œå°±æ˜¯é…ç½®ä¸­çš„ mysql jaråŒ…æ‰¾ä¸åˆ°ï¼Œæˆ‘ä»¬éœ€è¦è‡ªå·±é…ç½®ä¸€ä¸ª mysql jaråŒ…ï¼Œå¹¶æ­£ç¡®é…ç½®å®ƒçš„è·¯å¾„</h5></li>
<li><h5 id="è¿™é‡Œæœ‰ä¸ªæŠ€å·§ï¼šåœ¨-IDEA-ä¸­æ‰¾åˆ°é¡¹ç›®æ‰€ä¾èµ–çš„-jar-åŒ…"><a href="#è¿™é‡Œæœ‰ä¸ªæŠ€å·§ï¼šåœ¨-IDEA-ä¸­æ‰¾åˆ°é¡¹ç›®æ‰€ä¾èµ–çš„-jar-åŒ…" class="headerlink" title="è¿™é‡Œæœ‰ä¸ªæŠ€å·§ï¼šåœ¨ IDEA ä¸­æ‰¾åˆ°é¡¹ç›®æ‰€ä¾èµ–çš„ jar åŒ…"></a>è¿™é‡Œæœ‰ä¸ªæŠ€å·§ï¼šåœ¨ IDEA ä¸­æ‰¾åˆ°é¡¹ç›®æ‰€ä¾èµ–çš„ jar åŒ…</h5><ul>
<li>å¦‚å›¾æ‰€ç¤ºï¼Œé€‰æ‹©å¯¹åº”çš„ä¾èµ–åï¼Œå¯ä»¥ç›´æ¥åœ¨æ–‡ä»¶ç®¡ç†å™¨ä¸­æ‰“å¼€</li>
</ul>
<p><img src="https://gitee.com/deng-2022/pictures/raw/master/images/image-20230922213029171.png" alt="image-20230922213029171"></p>
<ul>
<li>ç„¶åç›´æ¥åœ¨æ–‡ä»¶ç®¡ç†å™¨ä¸­å¤åˆ¶ï¼Œç²˜è´´åˆ° Logstash ç›®å½•ä¸‹å³å¯</li>
</ul>
</li>
<li><h5 id="åŠ è½½é…ç½®ã€å¯åŠ¨-Logstashï¼Œå¯åŠ¨æˆåŠŸäº†ï¼š"><a href="#åŠ è½½é…ç½®ã€å¯åŠ¨-Logstashï¼Œå¯åŠ¨æˆåŠŸäº†ï¼š" class="headerlink" title="åŠ è½½é…ç½®ã€å¯åŠ¨ Logstashï¼Œå¯åŠ¨æˆåŠŸäº†ï¼š"></a>åŠ è½½é…ç½®ã€å¯åŠ¨ Logstashï¼Œå¯åŠ¨æˆåŠŸäº†ï¼š</h5></li>
</ul>
<p><img src="https://gitee.com/deng-2022/pictures/raw/master/images/image-20230922215626868.png" alt="image-20230922215626868"></p>
<ul>
<li><h5 id="èŠèŠæˆ‘åœ¨è¿™æ®µé…ç½®ä¸Šè¸©è¿‡çš„å‘å§ï¼š"><a href="#èŠèŠæˆ‘åœ¨è¿™æ®µé…ç½®ä¸Šè¸©è¿‡çš„å‘å§ï¼š" class="headerlink" title="èŠèŠæˆ‘åœ¨è¿™æ®µé…ç½®ä¸Šè¸©è¿‡çš„å‘å§ï¼š"></a>èŠèŠæˆ‘åœ¨è¿™æ®µé…ç½®ä¸Šè¸©è¿‡çš„å‘å§ï¼š</h5><ul>
<li>mysql jar åŒ…è·¯å¾„å¤–å±‚å¤šåŠ äº†ä¸€å±‚åŒå¼•å·</li>
<li>ç”¨æˆ·åã€å¯†ç é…ç½®é”™è¯¯</li>
<li>SQL è¯­å¥ä¸­ where å¤šå†™äº†ä¸€ä¸ª</li>
<li>timestamp å†™æˆ timestampe</li>
</ul>
</li>
<li><h5 id="è¿™æ®µé…ç½®ç»å¯¹ä¸èƒ½å‡ºç°ä»»ä½•é—®é¢˜ï¼Œå¦åˆ™å°±ä¼šå‡ºç°ä¸¥é‡çš„æŠ¥é”™ã€‚æˆ‘çš„æœ€ç»ˆé…ç½®æ˜¯è¿™æ ·çš„ï¼š"><a href="#è¿™æ®µé…ç½®ç»å¯¹ä¸èƒ½å‡ºç°ä»»ä½•é—®é¢˜ï¼Œå¦åˆ™å°±ä¼šå‡ºç°ä¸¥é‡çš„æŠ¥é”™ã€‚æˆ‘çš„æœ€ç»ˆé…ç½®æ˜¯è¿™æ ·çš„ï¼š" class="headerlink" title="è¿™æ®µé…ç½®ç»å¯¹ä¸èƒ½å‡ºç°ä»»ä½•é—®é¢˜ï¼Œå¦åˆ™å°±ä¼šå‡ºç°ä¸¥é‡çš„æŠ¥é”™ã€‚æˆ‘çš„æœ€ç»ˆé…ç½®æ˜¯è¿™æ ·çš„ï¼š"></a>è¿™æ®µé…ç½®ç»å¯¹ä¸èƒ½å‡ºç°ä»»ä½•é—®é¢˜ï¼Œå¦åˆ™å°±ä¼šå‡ºç°ä¸¥é‡çš„æŠ¥é”™ã€‚æˆ‘çš„æœ€ç»ˆé…ç½®æ˜¯è¿™æ ·çš„ï¼š</h5></li>
</ul>
<figure class="highlight puppet"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs puppet"><span class="hljs-comment"># Sample Logstash configuration for receiving</span><br><span class="hljs-comment"># UDP syslog messages over port 514</span><br><br><span class="hljs-keyword">input</span> &#123;<br>  jdbc &#123;<br>    <span class="hljs-attr">jdbc_driver_library</span> =&gt; <span class="hljs-string">&quot;D:\softWare\logstash\logstash-7.17.9\config\mysql-connector-java-8.0.29.jar&quot;</span><br>    <span class="hljs-attr">jdbc_driver_class</span> =&gt; <span class="hljs-string">&quot;com.mysql.jdbc.Driver&quot;</span><br>    <span class="hljs-attr">jdbc_connection_string</span> =&gt; <span class="hljs-string">&quot;jdbc:mysql://localhost:3306/memory_search&quot;</span><br>    <span class="hljs-attr">jdbc_user</span> =&gt; <span class="hljs-string">&quot;root&quot;</span><br>    <span class="hljs-attr">jdbc_password</span> =&gt; <span class="hljs-string">&quot;Dw990831&quot;</span><br>    <span class="hljs-attr">statement</span> =&gt; <span class="hljs-string">&quot;SELECT * from post where 1 = 1&quot;</span><br>    <span class="hljs-attr">schedule</span> =&gt; <span class="hljs-string">&quot;*/5 * * * *&quot;</span><br>  &#125;<br>&#125;<br><br><span class="hljs-keyword">output</span> &#123;<br>  stdout &#123; <span class="hljs-attr">codec</span> =&gt; rubydebug &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<ul>
<li><p>å¯åŠ¨æˆåŠŸåï¼Œç°åœ¨çš„ Logstash æ˜¯æ¯5ç§’ä»æ•°æ®åº“ä¸­åŒæ­¥æ‰€æœ‰æ•°æ®ï¼ˆå½“ç„¶è¿™æ˜¯æ ¹æ®SQLè¯­å¥æ¥æ‰§è¡Œçš„ï¼‰ï¼Œè¿™æ•°æ®é‡å¯èƒ½ä¼šå¾ˆå¤§</p>
<ul>
<li><h5 id="è¿™å°±æ˜¯å…¨é‡åŒæ­¥äº†ï¼Œæˆ‘ä»¬ä¸éœ€è¦åŒæ­¥æ‰€æœ‰æ•°æ®ï¼Œæˆ‘ä»¬å¯ä»¥é€‰æ‹©åŒæ­¥æœ€è¿‘æ›´æ–°çš„æ•°æ®ï¼ˆ2023-09-22æ™šï¼‰"><a href="#è¿™å°±æ˜¯å…¨é‡åŒæ­¥äº†ï¼Œæˆ‘ä»¬ä¸éœ€è¦åŒæ­¥æ‰€æœ‰æ•°æ®ï¼Œæˆ‘ä»¬å¯ä»¥é€‰æ‹©åŒæ­¥æœ€è¿‘æ›´æ–°çš„æ•°æ®ï¼ˆ2023-09-22æ™šï¼‰" class="headerlink" title="è¿™å°±æ˜¯å…¨é‡åŒæ­¥äº†ï¼Œæˆ‘ä»¬ä¸éœ€è¦åŒæ­¥æ‰€æœ‰æ•°æ®ï¼Œæˆ‘ä»¬å¯ä»¥é€‰æ‹©åŒæ­¥æœ€è¿‘æ›´æ–°çš„æ•°æ®ï¼ˆ2023/09/22æ™šï¼‰"></a>è¿™å°±æ˜¯å…¨é‡åŒæ­¥äº†ï¼Œæˆ‘ä»¬ä¸éœ€è¦åŒæ­¥æ‰€æœ‰æ•°æ®ï¼Œæˆ‘ä»¬å¯ä»¥é€‰æ‹©åŒæ­¥æœ€è¿‘æ›´æ–°çš„æ•°æ®ï¼ˆ2023/09/22æ™šï¼‰</h5></li>
</ul>
</li>
<li><p>æ·»åŠ å¦‚ä¸‹é…ç½®ï¼š</p>
</li>
</ul>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-attr">statement</span> =&gt; <span class="hljs-string">&quot;SELECT * from post where updateTime &gt; :sql_last_value&quot;</span><br><span class="hljs-attr">use_column_value</span> =&gt; <span class="hljs-literal">true</span><br><span class="hljs-attr">tracking_column_type</span> =&gt; <span class="hljs-string">&quot;timestamp&quot;</span><br><span class="hljs-attr">tracking_column</span> =&gt; <span class="hljs-string">&quot;updateTime&quot;</span><br><span class="hljs-attr">schedule</span> =&gt; <span class="hljs-string">&quot;*/5 * * * * *&quot;</span><br><span class="hljs-attr">jdbc_default_timezone</span> =&gt; <span class="hljs-string">&quot;Asia/Shanghai&quot;</span><br></code></pre></td></tr></table></figure>

<ul>
<li><h5 id="è¿™æ®µé…ç½®å°±æ˜¯æ ¹æ®-updateTime-å­—æ®µçš„æœ€æ–°å€¼ï¼ŒåŒæ­¥updateTime-å¤§äºæœ€æ–°å€¼çš„æ•°æ®ï¼š"><a href="#è¿™æ®µé…ç½®å°±æ˜¯æ ¹æ®-updateTime-å­—æ®µçš„æœ€æ–°å€¼ï¼ŒåŒæ­¥updateTime-å¤§äºæœ€æ–°å€¼çš„æ•°æ®ï¼š" class="headerlink" title="è¿™æ®µé…ç½®å°±æ˜¯æ ¹æ® updateTime å­—æ®µçš„æœ€æ–°å€¼ï¼ŒåŒæ­¥updateTime å¤§äºæœ€æ–°å€¼çš„æ•°æ®ï¼š"></a>è¿™æ®µé…ç½®å°±æ˜¯æ ¹æ® updateTime å­—æ®µçš„æœ€æ–°å€¼ï¼ŒåŒæ­¥updateTime å¤§äºæœ€æ–°å€¼çš„æ•°æ®ï¼š</h5></li>
</ul>
<p><img src="https://gitee.com/deng-2022/pictures/raw/master/images/image-20230922224744313.png" alt="image-20230922224744313"></p>
<ul>
<li>æ‰€ä»¥è¯´ï¼Œ<strong>sql_last_value æŒ‡å®šçš„æ˜¯ä¸Šæ¬¡æŸ¥åˆ°çš„æ•°æ®çš„æœ€åä¸€è¡Œçš„æŒ‡å®šå­—æ®µ</strong>ï¼Œæ–°çš„æŸ¥è¯¢å°±æ˜¯æ¯”è¾ƒè¿™ä¸ª<strong>æŒ‡å®šå­—æ®µä¸sql_last_valueçš„å¤§å°</strong></li>
<li>ä½†æ˜¯ç»è¿‡å¤šæ¬¡æŸ¥è¯¢å‘ç°ï¼Œè¿™é‡Œçš„ <strong>sql_last_value å§‹ç»ˆä¸å˜</strong><ul>
<li>æˆ‘ä»¬å¯ä»¥åœ¨ data\plugins\inputs\jdbc\logstash_jdbc_last_run çœ‹åˆ° <strong>sql_last_value æŒ‡å®šçš„æ•°æ®</strong>ï¼Œç¡®å®æ²¡æœ‰å˜åŒ–ï¼š</li>
</ul>
</li>
</ul>
<p><img src="https://gitee.com/deng-2022/pictures/raw/master/images/image-20230922230142159.png" alt="image-20230922230142159"></p>
<ul>
<li>å°† tracking_column =&gt; â€œupdateTimeâ€ çš„ <strong>updateTime ä¿®æ”¹ä¸º updatetime</strong>ï¼Œ<strong>æ—¥æœŸåŒæ­¥æˆåŠŸ</strong></li>
</ul>
<p><img src="https://gitee.com/deng-2022/pictures/raw/master/images/image-20230922225440159.png" alt="image-20230922225440159"></p>
<ul>
<li><h5 id="æ›´æ–°ä¸‹æ•°æ®åº“ä¸­çš„æœ€æ–°å€¼ï¼Œå†çœ‹çœ‹æ•ˆæœï¼Œç¡®å®æ‹¿åˆ°äº†æ•°æ®åº“ä¸­æœ€æ–°ä¿®æ”¹çš„å€¼ï¼ˆå‚ç…§ä¸Šæ¬¡ä¿®æ”¹åçš„æœ€æ–°å€¼ï¼‰ï¼š"><a href="#æ›´æ–°ä¸‹æ•°æ®åº“ä¸­çš„æœ€æ–°å€¼ï¼Œå†çœ‹çœ‹æ•ˆæœï¼Œç¡®å®æ‹¿åˆ°äº†æ•°æ®åº“ä¸­æœ€æ–°ä¿®æ”¹çš„å€¼ï¼ˆå‚ç…§ä¸Šæ¬¡ä¿®æ”¹åçš„æœ€æ–°å€¼ï¼‰ï¼š" class="headerlink" title="æ›´æ–°ä¸‹æ•°æ®åº“ä¸­çš„æœ€æ–°å€¼ï¼Œå†çœ‹çœ‹æ•ˆæœï¼Œç¡®å®æ‹¿åˆ°äº†æ•°æ®åº“ä¸­æœ€æ–°ä¿®æ”¹çš„å€¼ï¼ˆå‚ç…§ä¸Šæ¬¡ä¿®æ”¹åçš„æœ€æ–°å€¼ï¼‰ï¼š"></a>æ›´æ–°ä¸‹æ•°æ®åº“ä¸­çš„æœ€æ–°å€¼ï¼Œå†çœ‹çœ‹æ•ˆæœï¼Œç¡®å®æ‹¿åˆ°äº†æ•°æ®åº“ä¸­æœ€æ–°ä¿®æ”¹çš„å€¼ï¼ˆå‚ç…§ä¸Šæ¬¡ä¿®æ”¹åçš„æœ€æ–°å€¼ï¼‰ï¼š</h5></li>
</ul>
<p><img src="https://gitee.com/deng-2022/pictures/raw/master/images/image-20230922230720711.png" alt="image-20230922230720711"></p>
<h4 id="åŒæ­¥ES"><a href="#åŒæ­¥ES" class="headerlink" title="åŒæ­¥ES"></a>åŒæ­¥ES</h4><ul>
<li><p>è°ƒè¯•è¿™ä¹ˆä¹…ï¼ŒLogstash èƒ½å¤Ÿ<strong>æ­£å¸¸åŒæ­¥ MySQL</strong> äº†ï¼Œæ¥ä¸‹æ¥å°±æ˜¯æŠŠåŒæ­¥åˆ° input çš„æ•°æ®ï¼Œ<strong>åŒæ­¥åˆ° ES</strong> ä¸­äº†<strong>ï¼ˆ2023/09/22æ™šï¼‰</strong></p>
</li>
<li><p>ç›´æ¥åœ¨å®˜æ–¹æ–‡æ¡£ä¸­ï¼Œæ‰¾åˆ°è¾“å‡º output çš„ç›¸å…³é…ç½®ï¼š</p>
</li>
</ul>
<p><img src="https://gitee.com/deng-2022/pictures/raw/master/images/image-20230923124744806.png" alt="image-20230923124744806"></p>
<ul>
<li>è·Ÿç€å®˜ç½‘ç®€å•çš„ demo å­¦å°±è¡Œï¼Œé…ç½®è¿‡ä¸€æ¬¡å°±ä¼šäº†ï¼Œè¿™æ˜¯æˆ‘<strong>å®ŒæˆåŒæ­¥ ES åçš„é…ç½®</strong>ï¼šï¼ˆ<strong>éƒ¨åˆ†ç§å¯†ä¿¡æ¯å·²åšå¤„ç†</strong>ï¼‰</li>
</ul>
<figure class="highlight puppet"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs puppet"><span class="hljs-comment"># Sample Logstash configuration for receiving</span><br><span class="hljs-comment"># UDP syslog messages over port 514</span><br><br><span class="hljs-keyword">input</span> &#123;<br>  jdbc &#123;<br>    <span class="hljs-attr">jdbc_driver_library</span> =&gt; <span class="hljs-string">&quot;D:\softWare\logstash\logstash-7.17.9\config\mysql-connector-java-8.0.29.jar&quot;</span><br>    <span class="hljs-attr">jdbc_driver_class</span> =&gt; <span class="hljs-string">&quot;com.mysql.jdbc.Driver&quot;</span><br>    <span class="hljs-attr">jdbc_connection_string</span> =&gt; <span class="hljs-string">&quot;jdbc:mysql://localhost:3306/&quot;</span>******<span class="hljs-string">&quot;&quot;</span><br>    <span class="hljs-attr">jdbc_user</span> =&gt; <span class="hljs-string">&quot;******&quot;</span><br>    <span class="hljs-attr">jdbc_password</span> =&gt; <span class="hljs-string">&quot;&quot;</span>******<span class="hljs-string">&quot;&quot;</span><br>    <span class="hljs-attr">statement</span> =&gt; <span class="hljs-string">&quot;SELECT * from post where updateTime &gt; :sql_last_value&quot;</span><br>    <span class="hljs-attr">use_column_value</span> =&gt; <span class="hljs-keyword">true</span><br>    <span class="hljs-attr">tracking_column_type</span> =&gt; <span class="hljs-string">&quot;timestamp&quot;</span><br>    <span class="hljs-attr">tracking_column</span> =&gt; <span class="hljs-string">&quot;updatetime&quot;</span><br>    <span class="hljs-attr">schedule</span> =&gt; <span class="hljs-string">&quot;*/5 * * * * *&quot;</span><br>    <span class="hljs-attr">jdbc_default_timezone</span> =&gt; <span class="hljs-string">&quot;Asia/Shanghai&quot;</span><br>  &#125;<br>&#125;<br><br><span class="hljs-keyword">output</span> &#123;<br>  stdout &#123; <span class="hljs-attr">codec</span> =&gt; rubydebug &#125;<br><br>  <span class="hljs-keyword">elasticsearch</span> &#123;<br>    <span class="hljs-attr">hosts</span> =&gt; <span class="hljs-string">&quot;127.0.0.1:9200&quot;</span><br>    <span class="hljs-attr">index</span> =&gt; <span class="hljs-string">&quot;post_v1&quot;</span><br>    <span class="hljs-attr">document_id</span> =&gt; <span class="hljs-string">&quot;%&#123;id&#125;&quot;</span><br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<ul>
<li><h5 id="è¿™é‡Œç®€å•ä»‹ç»ä¸‹è¿™å‡ ä¸ªé…ç½®çš„ä½œç”¨ï¼š"><a href="#è¿™é‡Œç®€å•ä»‹ç»ä¸‹è¿™å‡ ä¸ªé…ç½®çš„ä½œç”¨ï¼š" class="headerlink" title="è¿™é‡Œç®€å•ä»‹ç»ä¸‹è¿™å‡ ä¸ªé…ç½®çš„ä½œç”¨ï¼š"></a>è¿™é‡Œç®€å•ä»‹ç»ä¸‹è¿™å‡ ä¸ªé…ç½®çš„ä½œç”¨ï¼š</h5><ul>
<li><strong>host</strong>ï¼šæ ‡è¯†è¦è¿›è¡ŒåŒæ­¥çš„ ES åœ°å€ï¼Œå³æŒ‡å®šäº†ï¼š<strong>æ•°æ®ä» MySQL ä¸­å–å‡ºåï¼Œå‘é€åˆ°å“ª</strong></li>
<li><strong>index</strong>ï¼šç›®æ ‡ç´¢å¼•</li>
<li><strong>document_id</strong>ï¼šæŒ‡å®šç›®æ ‡ç´¢å¼•å†…ï¼Œæ¯ä¸€ä¸ªæ–‡æ¡£çš„ idï¼Œå°±æ˜¯<strong>ä» SELECT * ä¸­è§£æ„å‡º id å€¼</strong></li>
<li><strong>data_stream</strong>ï¼šç‰¹æ®Šçš„æ•°æ®æ ¼å¼ï¼Œæˆ‘ä»¬ä»æ•°æ®åº“ä¸­å–åˆ°çš„éƒ½æ˜¯<strong>æ™®é€šç±»å‹</strong>ï¼Œ<strong>ä¸éœ€è¦è¿™è¡Œé…ç½®</strong></li>
</ul>
</li>
<li><p>å…¶ä»–çš„ç›®å‰æš‚ä¸”ä¸éœ€è¦äº†è§£ï¼Œæ—¥åå†è¿›ä¸€æ­¥å­¦ä¹ </p>
</li>
<li><h5 id="åŠ è½½é…ç½®ï¼Œè¿è¡Œ-Logstashï¼Œå¯ä»¥çœ‹åˆ°è¿è¡ŒæˆåŠŸäº†ï¼Œæ•°æ®åº“ä¸­æœ€æ–°æ›´æ–°çš„æ•°æ®ä¹ŸæˆåŠŸåŒæ­¥åˆ°äº†æœ¬åœ°çš„-ES-ä¸Šäº†ï¼š"><a href="#åŠ è½½é…ç½®ï¼Œè¿è¡Œ-Logstashï¼Œå¯ä»¥çœ‹åˆ°è¿è¡ŒæˆåŠŸäº†ï¼Œæ•°æ®åº“ä¸­æœ€æ–°æ›´æ–°çš„æ•°æ®ä¹ŸæˆåŠŸåŒæ­¥åˆ°äº†æœ¬åœ°çš„-ES-ä¸Šäº†ï¼š" class="headerlink" title="åŠ è½½é…ç½®ï¼Œè¿è¡Œ Logstashï¼Œå¯ä»¥çœ‹åˆ°è¿è¡ŒæˆåŠŸäº†ï¼Œæ•°æ®åº“ä¸­æœ€æ–°æ›´æ–°çš„æ•°æ®ä¹ŸæˆåŠŸåŒæ­¥åˆ°äº†æœ¬åœ°çš„ ES ä¸Šäº†ï¼š"></a>åŠ è½½é…ç½®ï¼Œè¿è¡Œ Logstashï¼Œå¯ä»¥çœ‹åˆ°è¿è¡ŒæˆåŠŸäº†ï¼Œæ•°æ®åº“ä¸­æœ€æ–°æ›´æ–°çš„æ•°æ®ä¹ŸæˆåŠŸåŒæ­¥åˆ°äº†æœ¬åœ°çš„ ES ä¸Šäº†ï¼š</h5></li>
</ul>
<h5 id=""><a href="#" class="headerlink" title=""></a><img src="https://gitee.com/deng-2022/pictures/raw/master/images/image-20230923125842246.png" alt="image-20230923125842246"></h5><ul>
<li><h5 id="ä»åŒæ­¥ç»“æœæ¥çœ‹ï¼Œæˆ‘ä»¬è¿˜éœ€è¦è§£å†³å‡ ä¸ªé—®é¢˜ï¼š"><a href="#ä»åŒæ­¥ç»“æœæ¥çœ‹ï¼Œæˆ‘ä»¬è¿˜éœ€è¦è§£å†³å‡ ä¸ªé—®é¢˜ï¼š" class="headerlink" title="ä»åŒæ­¥ç»“æœæ¥çœ‹ï¼Œæˆ‘ä»¬è¿˜éœ€è¦è§£å†³å‡ ä¸ªé—®é¢˜ï¼š"></a>ä»åŒæ­¥ç»“æœæ¥çœ‹ï¼Œæˆ‘ä»¬è¿˜éœ€è¦è§£å†³å‡ ä¸ªé—®é¢˜ï¼š</h5><ul>
<li>æ’é™¤æŸäº›ä¸éœ€è¦åŒæ­¥çš„å­—æ®µ</li>
<li>ES ä¸­åŒæ­¥è¿‡æ¥çš„æ–‡æ¡£æ•°æ®å­—æ®µéƒ½æ˜¯å…¨å°å†™ï¼Œä¸æ˜¯é©¼å³°å¼</li>
<li>æŸ¥è¯¢ç»“æœæŒ‰ updateTime é™åºæ’åˆ—ï¼Œé¿å…é‡æ’åºï¼Œå¯¼è‡´å¤šåŒæ­¥äº†ä¸å¿…è¦çš„æ•°æ®ï¼Œé€ æˆæ€§èƒ½æµªè´¹</li>
</ul>
</li>
<li><p>è§£å†³è¿™ä¸‰ä¸ªé—®é¢˜å½“ç„¶å¾ˆç®€å•ï¼š</p>
<ul>
<li><h5 id="é¦–å…ˆä¿®æ”¹ä¸‹-SQL-è¯­å¥ï¼šï¼ˆ2023-09-23åˆï¼‰"><a href="#é¦–å…ˆä¿®æ”¹ä¸‹-SQL-è¯­å¥ï¼šï¼ˆ2023-09-23åˆï¼‰" class="headerlink" title="é¦–å…ˆä¿®æ”¹ä¸‹ SQL è¯­å¥ï¼šï¼ˆ2023/09/23åˆï¼‰"></a>é¦–å…ˆä¿®æ”¹ä¸‹ SQL è¯­å¥ï¼šï¼ˆ2023/09/23åˆï¼‰</h5></li>
</ul>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs n1ql">statement =&gt; &quot;<span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">from</span> post <span class="hljs-keyword">where</span> updateTime &gt; :sql_last_value <span class="hljs-keyword">and</span> updateTime &lt; now() <span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> updateTime <span class="hljs-keyword">desc</span><span class="hljs-string">&quot;</span><br></code></pre></td></tr></table></figure>

<ul>
<li><h5 id="å†å†™å…¥å¦‚ä¸‹è¿‡æ»¤é…ç½®ï¼Œå°†å¯¹åº”å­—æ®µè¿›è¡Œé©¼å³°å¼è½¬æ¢ï¼Œå¹¶æ’é™¤ä¸éœ€è¦çš„å­—æ®µï¼š"><a href="#å†å†™å…¥å¦‚ä¸‹è¿‡æ»¤é…ç½®ï¼Œå°†å¯¹åº”å­—æ®µè¿›è¡Œé©¼å³°å¼è½¬æ¢ï¼Œå¹¶æ’é™¤ä¸éœ€è¦çš„å­—æ®µï¼š" class="headerlink" title="å†å†™å…¥å¦‚ä¸‹è¿‡æ»¤é…ç½®ï¼Œå°†å¯¹åº”å­—æ®µè¿›è¡Œé©¼å³°å¼è½¬æ¢ï¼Œå¹¶æ’é™¤ä¸éœ€è¦çš„å­—æ®µï¼š"></a>å†å†™å…¥å¦‚ä¸‹è¿‡æ»¤é…ç½®ï¼Œå°†å¯¹åº”å­—æ®µè¿›è¡Œé©¼å³°å¼è½¬æ¢ï¼Œå¹¶æ’é™¤ä¸éœ€è¦çš„å­—æ®µï¼š</h5></li>
</ul>
<figure class="highlight coq"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs coq">filter &#123;<br>  mutate &#123;<br>    <span class="hljs-built_in">rename</span> =&gt; &#123;<br>      <span class="hljs-string">&quot;updatetime&quot;</span> =&gt; <span class="hljs-string">&quot;updateTime&quot;</span><br>      <span class="hljs-string">&quot;userid&quot;</span> =&gt; <span class="hljs-string">&quot;userId&quot;</span><br>      <span class="hljs-string">&quot;createtime&quot;</span> =&gt; <span class="hljs-string">&quot;createTime&quot;</span><br>      <span class="hljs-string">&quot;isdelete&quot;</span> =&gt; <span class="hljs-string">&quot;isDelete&quot;</span><br>    &#125;<br>    remove_field =&gt; [<span class="hljs-string">&quot;thumbnum&quot;</span>, <span class="hljs-string">&quot;favournum&quot;</span>]<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li>
<li><p>é‡æ–°è¿›è¡ŒåŒæ­¥ï¼Œç»“æœå®Œç¾ï¼Œé¡ºåˆ©å®Œæˆï¼š</p>
</li>
</ul>
<p><img src="https://gitee.com/deng-2022/pictures/raw/master/images/image-20230923144500259.png" alt="image-20230923144500259"></p>
<ul>
<li><h5 id="æœ€åï¼ŒKibana-çš„æ•°æ®é¢æ¿ä¹Ÿå¯ä»¥äº†è§£ä¸‹"><a href="#æœ€åï¼ŒKibana-çš„æ•°æ®é¢æ¿ä¹Ÿå¯ä»¥äº†è§£ä¸‹" class="headerlink" title="æœ€åï¼ŒKibana çš„æ•°æ®é¢æ¿ä¹Ÿå¯ä»¥äº†è§£ä¸‹"></a>æœ€åï¼ŒKibana çš„æ•°æ®é¢æ¿ä¹Ÿå¯ä»¥äº†è§£ä¸‹</h5></li>
</ul>
<h3 id="Logstash-é…ç½®å¤šä¸ªè¾“å…¥-è¾“å‡ºæºï¼ˆå·²åºŸå¼ƒï¼Œå‚è€ƒâ…¡ï¼‰"><a href="#Logstash-é…ç½®å¤šä¸ªè¾“å…¥-è¾“å‡ºæºï¼ˆå·²åºŸå¼ƒï¼Œå‚è€ƒâ…¡ï¼‰" class="headerlink" title="Logstash é…ç½®å¤šä¸ªè¾“å…¥ / è¾“å‡ºæºï¼ˆå·²åºŸå¼ƒï¼Œå‚è€ƒâ…¡ï¼‰"></a>Logstash é…ç½®å¤šä¸ªè¾“å…¥ / è¾“å‡ºæºï¼ˆå·²åºŸå¼ƒï¼Œå‚è€ƒâ…¡ï¼‰</h3><blockquote>
<p>ğŸ”¥ æœ€è¿‘åœ¨ä¼˜åŒ– Memory èšåˆæœç´¢å¹³å°ï¼Œå°è¯•å®ç°åšæ–‡ article çš„å¿«é€Ÿæœç´¢å’Œå…³é”®è¯é«˜äº®æ˜¾ç¤ºç­‰åŠŸèƒ½</p>
<h5 id="ä¸»è¦å·¥ä½œå¦‚ä¸‹ï¼šï¼ˆ2023-11-07æ™šï¼‰"><a href="#ä¸»è¦å·¥ä½œå¦‚ä¸‹ï¼šï¼ˆ2023-11-07æ™šï¼‰" class="headerlink" title="ä¸»è¦å·¥ä½œå¦‚ä¸‹ï¼šï¼ˆ2023/11/07æ™šï¼‰"></a>ä¸»è¦å·¥ä½œå¦‚ä¸‹ï¼š<strong>ï¼ˆ2023/11/07æ™šï¼‰</strong></h5><ul>
<li>æ–°å¢ article å®ä½“ï¼Œ<strong>è¡¨ç»“æ„</strong>å·²ç»™å‡º ğŸ‘‡</li>
<li>æ–°å¢åšæ–‡çš„ <strong>ES åŒ…è£…ç±»</strong>ï¼ˆArticleEsDaoï¼‰ã€<strong>åšæ–‡æŸ¥è¯¢å‚æ•°</strong>ï¼ˆArticleQueryRequestï¼‰ã€<strong>åšæ–‡é«˜äº®å­—æ®µ</strong>ï¼ˆArticleEsHighlightDataï¼‰</li>
<li>ä½¿ç”¨ <strong>Spring Data Elasticsearch</strong> çš„ <strong>QueryBuilder ç»„åˆæ¡ä»¶æŸ¥è¯¢</strong>ï¼Œå®ç°ä½¿ç”¨ ES <strong>å¿«é€Ÿæœç´¢åšæ–‡</strong>å’Œ<strong>å…³é”®è¯é«˜äº®æ˜¾ç¤º</strong></li>
<li>æ–°å¢<strong>åšæ–‡æ•°æ®æºæ¥å£</strong>ï¼ˆArticleDataSourceï¼‰ï¼Œä¾›èšåˆæœç´¢è°ƒç”¨</li>
<li>é…ç½® Logstash å®ç° MySQL å’Œ ES <strong>æ•°æ®åŒæ­¥</strong></li>
</ul>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- åšæ–‡å»ºè¡¨SQLè¯­å¥</span><br><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> article<br>(<br>    id          <span class="hljs-type">bigint</span>                                 <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span> comment <span class="hljs-string">&#x27;æ–‡ç« id&#x27;</span>,<br>    title       <span class="hljs-type">varchar</span>(<span class="hljs-number">256</span>)                           <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span> comment <span class="hljs-string">&#x27;æ–‡ç« æ ‡é¢˜&#x27;</span>,<br>    description <span class="hljs-type">varchar</span>(<span class="hljs-number">256</span>)                           <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span> comment <span class="hljs-string">&#x27;æ–‡ç« æ‘˜è¦&#x27;</span>,<br>    content     <span class="hljs-type">varchar</span>(<span class="hljs-number">2048</span>)                          <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span> comment <span class="hljs-string">&#x27;æ–‡ç« å†…å®¹&#x27;</span>,<br>    author_id   <span class="hljs-type">bigint</span>                                 <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span> comment <span class="hljs-string">&#x27;åˆ›ä½œè€…&#x27;</span>,<br>    <span class="hljs-keyword">view</span>        <span class="hljs-type">int</span>          <span class="hljs-keyword">default</span> <span class="hljs-number">0</span>                 <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span> comment <span class="hljs-string">&#x27;æµè§ˆé‡&#x27;</span>,<br>    likes       <span class="hljs-type">int</span>          <span class="hljs-keyword">default</span> <span class="hljs-number">0</span>                 <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span> comment <span class="hljs-string">&#x27;ç‚¹èµé‡&#x27;</span>,<br>    comments    <span class="hljs-type">varchar</span>(<span class="hljs-number">256</span>) <span class="hljs-keyword">default</span> <span class="hljs-string">&#x27;0&#x27;</span>               <span class="hljs-keyword">null</span> comment <span class="hljs-string">&#x27;è¯„è®ºé‡&#x27;</span>,<br>    create_time datetime     <span class="hljs-keyword">default</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span> comment <span class="hljs-string">&#x27;åˆ›å»ºæ—¶é—´&#x27;</span>,<br>    update_time datetime     <span class="hljs-keyword">default</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span> <span class="hljs-keyword">on</span> <span class="hljs-keyword">update</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> comment <span class="hljs-string">&#x27;æ›´æ–°æ—¶é—´&#x27;</span>,<br>    is_delete   tinyint      <span class="hljs-keyword">default</span> <span class="hljs-number">0</span>                 <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span> comment <span class="hljs-string">&#x27;é€»è¾‘åˆ é™¤&#x27;</span>,<br>    collects    <span class="hljs-type">int</span>                                    <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span> comment <span class="hljs-string">&#x27;æ”¶è—é‡&#x27;</span>,<br>    article_url <span class="hljs-type">varchar</span>(<span class="hljs-number">2048</span>)                          <span class="hljs-keyword">null</span> comment <span class="hljs-string">&#x27;å°é¢å›¾ç‰‡&#x27;</span>,<br>    tags        <span class="hljs-type">varchar</span>(<span class="hljs-number">256</span>)                           <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span> comment <span class="hljs-string">&#x27;æ–‡ç« æ ‡ç­¾&#x27;</span><br>)<br>    comment <span class="hljs-string">&#x27;åšæ–‡&#x27;</span>;<br></code></pre></td></tr></table></figure>

<h4 id="åŒæ­¥é…ç½®"><a href="#åŒæ­¥é…ç½®" class="headerlink" title="åŒæ­¥é…ç½®"></a>åŒæ­¥é…ç½®</h4><ul>
<li>æ–°å¢ article ç›¸å…³å®ä½“çš„è¿‡ç¨‹è¿™é‡Œå…ˆ<strong>ä¸ç»†è®²</strong>ï¼Œé‡ç‚¹è®°å½•ï¼šå¦‚ä½•å®ç° MySQL å’Œ ES <strong>æ•°æ®åŒæ­¥</strong></li>
<li>åœ¨ <strong>Logstash çš„ config ç›®å½•</strong>ä¸‹ï¼Œæˆ‘ä»¬ä½œå¦‚ä¸‹é…ç½®ï¼š<strong>ï¼ˆ2023/11/07æ™šï¼‰</strong></li>
</ul>
<figure class="highlight puppet"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><code class="hljs puppet"><span class="hljs-comment"># Sample Logstash configuration for receiving</span><br><span class="hljs-comment"># UDP syslog messages over port 514</span><br><br><span class="hljs-keyword">input</span> &#123;<br>  jdbc &#123;<br>    <span class="hljs-attr">jdbc_driver_library</span> =&gt; <span class="hljs-string">&quot;D:\softWare\logstash\logstash-7.17.9\config\mysql-connector-java-8.0.29.jar&quot;</span><br>    <span class="hljs-attr">jdbc_driver_class</span> =&gt; <span class="hljs-string">&quot;com.mysql.jdbc.Driver&quot;</span><br>    <span class="hljs-attr">jdbc_connection_string</span> =&gt; <span class="hljs-string">&quot;jdbc:mysql://localhost:3306/******&quot;</span><br>    <span class="hljs-attr">jdbc_user</span> =&gt; <span class="hljs-string">&quot;******&quot;</span><br>    <span class="hljs-attr">jdbc_password</span> =&gt; <span class="hljs-string">&quot;******&quot;</span><br>    <span class="hljs-attr">statement</span> =&gt; <span class="hljs-string">&quot;SELECT * from article where update_time &gt; :sql_last_value and update_time &lt; now() order by update_time desc&quot;</span><br>    <span class="hljs-attr">use_column_value</span> =&gt; <span class="hljs-keyword">true</span><br>    <span class="hljs-attr">tracking_column_type</span> =&gt; <span class="hljs-string">&quot;timestamp&quot;</span><br>    <span class="hljs-attr">tracking_column</span> =&gt; <span class="hljs-string">&quot;update_time&quot;</span><br>    <span class="hljs-attr">schedule</span> =&gt; <span class="hljs-string">&quot;*/5 * * * * *&quot;</span><br>    <span class="hljs-attr">jdbc_default_timezone</span> =&gt; <span class="hljs-string">&quot;Asia/Shanghai&quot;</span><br>  &#125;<br>&#125;<br><br><span class="hljs-keyword">input</span> &#123;<br>  jdbc &#123;<br>    <span class="hljs-attr">jdbc_driver_library</span> =&gt; <span class="hljs-string">&quot;D:\softWare\logstash\logstash-7.17.9\config\mysql-connector-java-8.0.29.jar&quot;</span><br>    <span class="hljs-attr">jdbc_driver_class</span> =&gt; <span class="hljs-string">&quot;com.mysql.jdbc.Driver&quot;</span><br>    <span class="hljs-attr">jdbc_connection_string</span> =&gt; <span class="hljs-string">&quot;jdbc:mysql://localhost:3306/******&quot;</span><br>    <span class="hljs-attr">jdbc_user</span> =&gt; <span class="hljs-string">&quot;******&quot;</span><br>    <span class="hljs-attr">jdbc_password</span> =&gt; <span class="hljs-string">&quot;******&quot;</span><br>    <span class="hljs-attr">statement</span> =&gt; <span class="hljs-string">&quot;SELECT * from post where updateTime &gt; :sql_last_value and updateTime &lt; now() order by updateTime desc&quot;</span><br>    <span class="hljs-attr">use_column_value</span> =&gt; <span class="hljs-keyword">true</span><br>    <span class="hljs-attr">tracking_column_type</span> =&gt; <span class="hljs-string">&quot;timestamp&quot;</span><br>    <span class="hljs-attr">tracking_column</span> =&gt; <span class="hljs-string">&quot;updatetime&quot;</span><br>    <span class="hljs-attr">schedule</span> =&gt; <span class="hljs-string">&quot;*/5 * * * * *&quot;</span><br>    <span class="hljs-attr">jdbc_default_timezone</span> =&gt; <span class="hljs-string">&quot;Asia/Shanghai&quot;</span><br>  &#125;<br>&#125;<br><br><span class="hljs-keyword">filter</span> &#123;<br>  mutate &#123;<br>    <span class="hljs-attr">rename</span> =&gt; &#123;<br>      <span class="hljs-string">&quot;updatetime&quot;</span> =&gt; <span class="hljs-string">&quot;updateTime&quot;</span><br>      <span class="hljs-string">&quot;userid&quot;</span> =&gt; <span class="hljs-string">&quot;userId&quot;</span><br>      <span class="hljs-string">&quot;createtime&quot;</span> =&gt; <span class="hljs-string">&quot;createTime&quot;</span><br>      <span class="hljs-string">&quot;isdelete&quot;</span> =&gt; <span class="hljs-string">&quot;isDelete&quot;</span><br>    &#125;<br>    <span class="hljs-keyword">remove_field</span> =&gt; [<span class="hljs-string">&quot;thumbnum&quot;</span>, <span class="hljs-string">&quot;favournum&quot;</span>]<br>  &#125;<br>&#125;<br><br><span class="hljs-keyword">output</span> &#123;<br>  stdout &#123; <span class="hljs-attr">codec</span> =&gt; rubydebug &#125;<br><br>  <span class="hljs-keyword">elasticsearch</span> &#123;<br>    <span class="hljs-attr">hosts</span> =&gt; <span class="hljs-string">&quot;127.0.0.1:9200&quot;</span><br>    <span class="hljs-attr">index</span> =&gt; <span class="hljs-string">&quot;post_v1&quot;</span><br>    <span class="hljs-attr">document_id</span> =&gt; <span class="hljs-string">&quot;%&#123;id&#125;&quot;</span><br>  &#125;<br>&#125;<br><br><span class="hljs-keyword">output</span> &#123;<br>  stdout &#123; <span class="hljs-attr">codec</span> =&gt; rubydebug &#125;<br><br>  <span class="hljs-keyword">elasticsearch</span> &#123;  <br>    <span class="hljs-attr">hosts</span> =&gt; [<span class="hljs-string">&quot;localhost:9200&quot;</span>]  <br>    <span class="hljs-attr">index</span> =&gt; <span class="hljs-string">&quot;article_v1&quot;</span>  <br>    <span class="hljs-attr">document_id</span> =&gt; <span class="hljs-string">&quot;%&#123;id&#125;&quot;</span>  <br>  &#125;  <br>&#125;<br></code></pre></td></tr></table></figure>

<blockquote>
<h5 id="ğŸ¥£-æˆ‘ä»¬åºŸè¯å°‘è¯´ï¼Œçœ‹æ¸…æ¥šå¦‚ä¸Šé…ç½®-ğŸ‘†"><a href="#ğŸ¥£-æˆ‘ä»¬åºŸè¯å°‘è¯´ï¼Œçœ‹æ¸…æ¥šå¦‚ä¸Šé…ç½®-ğŸ‘†" class="headerlink" title="ğŸ¥£ æˆ‘ä»¬åºŸè¯å°‘è¯´ï¼Œçœ‹æ¸…æ¥šå¦‚ä¸Šé…ç½® ğŸ‘†"></a>ğŸ¥£ æˆ‘ä»¬åºŸè¯å°‘è¯´ï¼Œçœ‹æ¸…æ¥šå¦‚ä¸Šé…ç½® ğŸ‘†</h5><ul>
<li><p>å¦‚æœæƒ³è¦æŒ‡å®šå¤šä¸ªæ•°æ®æºï¼Œå°±<strong>ç¼–å†™å¤šä¸ª input å—</strong></p>
</li>
<li><p>åŒæ ·çš„ï¼Œå¦‚æœæƒ³è¦æŒ‡å®šå¤šä¸ªè¾“å‡ºï¼Œé‚£ä¹ˆå°±<strong>ç¼–å†™å¤šä¸ª output å—</strong></p>
</li>
</ul>
</blockquote>
<ul>
<li>æ¯”è¾ƒæœ‰è¶£çš„æ˜¯ï¼Œæ–°å¢çš„ <strong>article å®ä½“</strong>çš„å­—æ®µæ˜¯<strong>ä¸‹åˆ’çº¿å‘½åæ³•</strong>ï¼Œè€Œ <strong>post å®ä½“</strong>çš„å­—æ®µå´æ˜¯<strong>é©¼å³°å‘½åæ³•</strong>ï¼š</li>
</ul>
<p><img src="https://gitee.com/deng-2022/pictures/raw/master/images/image-20231107223434622.png" alt="image-20231107223434622"></p>
<ul>
<li>è¿™æ ·çš„å±æ€§åè‚¯å®šæ˜¯<strong>ä¸è§„èŒƒçš„</strong>ï¼ˆå½“ç„¶ï¼Œæ˜¯å› ä¸º <strong>article æ˜¯æˆ‘ä» Memory ç¼˜å¿†äº¤å‹ç¤¾åŒºä¸‹ç›´æ¥ç²˜è´´è¿‡æ¥çš„</strong>ï¼‰</li>
<li>ä¸è¿‡ï¼Œæ­£å¥½å¯ä»¥æ¯”å¯¹ä¸‹<strong>ä¸åŒå‘½åè§„èŒƒçš„å±æ€§</strong>ï¼Œåœ¨ Logstash é…ç½®ä¸­çš„å†™æ³•åŒºåˆ«äº†ï¼š<strong>ï¼ˆ2023/11/07æ™šï¼‰</strong></li>
</ul>
<figure class="highlight puppet"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs puppet">-- ä¸‹åˆ’çº¿å‘½åæ³•<br><span class="hljs-keyword">input</span> &#123;  <br>  jdbc &#123;<br>    <span class="hljs-attr">jdbc_driver_library</span> =&gt; <span class="hljs-string">&quot;D:\softWare\logstash\logstash-7.17.9\config\mysql-connector-java-8.0.29.jar&quot;</span><br>    <span class="hljs-attr">jdbc_driver_class</span> =&gt; <span class="hljs-string">&quot;com.mysql.jdbc.Driver&quot;</span><br>    <span class="hljs-attr">jdbc_connection_string</span> =&gt; <span class="hljs-string">&quot;jdbc:mysql://localhost:3306/******&quot;</span><br>    <span class="hljs-attr">jdbc_user</span> =&gt; <span class="hljs-string">&quot;******&quot;</span><br>    <span class="hljs-attr">jdbc_password</span> =&gt; <span class="hljs-string">&quot;******&quot;</span><br>    <span class="hljs-attr">statement</span> =&gt; <span class="hljs-string">&quot;SELECT * from article where update_time &gt; :sql_last_value and update_time &lt; now() order by update_time desc&quot;</span><br>    <span class="hljs-attr">use_column_value</span> =&gt; <span class="hljs-keyword">true</span><br>    <span class="hljs-attr">tracking_column_type</span> =&gt; <span class="hljs-string">&quot;timestamp&quot;</span><br>    <span class="hljs-attr">tracking_column</span> =&gt; <span class="hljs-string">&quot;update_time&quot;</span><br>    <span class="hljs-attr">schedule</span> =&gt; <span class="hljs-string">&quot;*/5 * * * * *&quot;</span><br>    <span class="hljs-attr">jdbc_default_timezone</span> =&gt; <span class="hljs-string">&quot;Asia/Shanghai&quot;</span><br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight puppet"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs puppet">-- é©¼å³°å‘½åæ³•<br><span class="hljs-keyword">input</span> &#123;<br>  jdbc &#123;<br>    <span class="hljs-attr">jdbc_driver_library</span> =&gt; <span class="hljs-string">&quot;D:\softWare\logstash\logstash-7.17.9\config\mysql-connector-java-8.0.29.jar&quot;</span><br>    <span class="hljs-attr">jdbc_driver_class</span> =&gt; <span class="hljs-string">&quot;com.mysql.jdbc.Driver&quot;</span><br>    <span class="hljs-attr">jdbc_connection_string</span> =&gt; <span class="hljs-string">&quot;jdbc:mysql://localhost:3306/******&quot;</span><br>    <span class="hljs-attr">jdbc_user</span> =&gt; <span class="hljs-string">&quot;******&quot;</span><br>    <span class="hljs-attr">jdbc_password</span> =&gt; <span class="hljs-string">&quot;******&quot;</span><br>    <span class="hljs-attr">statement</span> =&gt; <span class="hljs-string">&quot;SELECT * from post where updateTime &gt; :sql_last_value and updateTime &lt; now() order by updateTime desc&quot;</span><br>    <span class="hljs-attr">use_column_value</span> =&gt; <span class="hljs-keyword">true</span><br>    <span class="hljs-attr">tracking_column_type</span> =&gt; <span class="hljs-string">&quot;timestamp&quot;</span><br>    <span class="hljs-attr">tracking_column</span> =&gt; <span class="hljs-string">&quot;updatetime&quot;</span><br>    <span class="hljs-attr">schedule</span> =&gt; <span class="hljs-string">&quot;*/5 * * * * *&quot;</span><br>    <span class="hljs-attr">jdbc_default_timezone</span> =&gt; <span class="hljs-string">&quot;Asia/Shanghai&quot;</span><br>  &#125;<br></code></pre></td></tr></table></figure>

<h4 id="ES-æŸ¥è¯¢"><a href="#ES-æŸ¥è¯¢" class="headerlink" title="ES æŸ¥è¯¢"></a>ES æŸ¥è¯¢</h4><ul>
<li>Logstash åŒæ­¥é…ç½®å†™å®Œä¹‹åï¼Œå½“ç„¶è¦è¿›è¡Œæµ‹è¯•äº†ï¼Œçœ‹çœ‹æ•°æ®æ˜¯å¦æˆåŠŸä» MySQL æˆåŠŸåŒæ­¥åˆ°äº† ES ä¸­</li>
<li>é¦–å…ˆ<strong>æ–°å¢ ES ç´¢å¼•</strong>ï¼Œåœ¨ <strong>Kibana ç›‘æ§é¢æ¿ä¸‹</strong>ï¼Œæ‰§è¡Œå¦‚ä¸‹ DSL è¯­å¥ï¼š</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">PUT /article_v1  <br>&#123;  <br>  <span class="hljs-string">&quot;settings&quot;</span>: &#123;  <br>    <span class="hljs-string">&quot;number_of_shards&quot;</span>: 3,  <br>    <span class="hljs-string">&quot;number_of_replicas&quot;</span>: 2  <br>  &#125;  <br>&#125;<br></code></pre></td></tr></table></figure>

<blockquote>
<h5 id="ğŸ”¥-æ³¨æ„ï¼š"><a href="#ğŸ”¥-æ³¨æ„ï¼š" class="headerlink" title="ğŸ”¥ æ³¨æ„ï¼š"></a>ğŸ”¥ æ³¨æ„ï¼š</h5><ul>
<li><h5 id="ç´¢å¼•åè¦è·Ÿ-Logstash-é…ç½®ä¸­-output-å—ä¸‹çš„-index-å±æ€§å¯¹åº”ï¼š"><a href="#ç´¢å¼•åè¦è·Ÿ-Logstash-é…ç½®ä¸­-output-å—ä¸‹çš„-index-å±æ€§å¯¹åº”ï¼š" class="headerlink" title="ç´¢å¼•åè¦è·Ÿ Logstash é…ç½®ä¸­ output å—ä¸‹çš„ index å±æ€§å¯¹åº”ï¼š"></a>ç´¢å¼•åè¦è·Ÿ Logstash é…ç½®ä¸­ output å—ä¸‹çš„ <code>index</code> å±æ€§å¯¹åº”ï¼š</h5></li>
</ul>
<figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs abnf"><span class="hljs-attribute">index</span> <span class="hljs-operator">=</span>&gt; <span class="hljs-string">&quot;article_v1&quot;</span>  <br></code></pre></td></tr></table></figure>

<ul>
<li><h5 id="è·Ÿ-ArticleEsDao-çš„-Document-å­—æ®µå¯¹åº”ï¼š"><a href="#è·Ÿ-ArticleEsDao-çš„-Document-å­—æ®µå¯¹åº”ï¼š" class="headerlink" title="è·Ÿ ArticleEsDao çš„ Document å­—æ®µå¯¹åº”ï¼š"></a>è·Ÿ ArticleEsDao çš„ <code>Document</code> å­—æ®µå¯¹åº”ï¼š</h5></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Document(indexName = &quot;article_v1&quot;)</span><br></code></pre></td></tr></table></figure>
</blockquote>
<ul>
<li>æŒ‰å®˜æ–¹æ–‡æ¡£çš„æ“ä½œæ¥ï¼Œå°è¯•<strong>åŠ è½½è¿™ä¸ªé…ç½®æ–‡ä»¶</strong> å¹¶ <strong>å¯åŠ¨ Logstash</strong>ï¼š</li>
</ul>
<figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs livescript">.<span class="hljs-string">\bin\logstash.bat</span> -f .<span class="hljs-string">\config\myTask.conf</span><br></code></pre></td></tr></table></figure>

<ul>
<li><strong>éšä¾¿ä¿®æ”¹ä¸€æ¡è®°å½•</strong>ï¼ˆä¸‹é¢çš„<code>å®ç° updateTime å­—æ®µè‡ªåŠ¨æ›´æ–°</code>ä¸€æ ä¸­æœ‰æåˆ°ï¼Œ<strong>æ•°æ®å¼€å§‹åŒæ­¥</strong> ğŸ‘‡ï¼š</li>
</ul>
<p><img src="https://gitee.com/deng-2022/pictures/raw/master/images/image-20231107225828473.png" alt="image-20231107225828473"></p>
<ul>
<li>åœ¨ <strong>Kibana ç›‘æ§é¢æ¿</strong>ä¸‹ï¼Œä½¿ç”¨ DSL è¯­å¥<strong>æ‰§è¡ŒæŸ¥è¯¢</strong>ï¼Œæ•ˆæœå¦‚ä¸‹ï¼š</li>
</ul>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-built_in">GET</span> article_v1/_search<br></code></pre></td></tr></table></figure>

<p><img src="https://gitee.com/deng-2022/pictures/raw/master/images/image-20231107221155736.png" alt="image-20231107221155736"></p>
<ul>
<li>æˆåŠŸå®Œæˆ <code>article</code> å®ä½“çš„<strong>æ•°æ®åŒæ­¥</strong> <strong>ï¼ˆ2023/11/07æ™šï¼‰</strong></li>
</ul>
<h4 id="å®ç°-updateTime-å­—æ®µè‡ªåŠ¨æ›´æ–°"><a href="#å®ç°-updateTime-å­—æ®µè‡ªåŠ¨æ›´æ–°" class="headerlink" title="å®ç° updateTime å­—æ®µè‡ªåŠ¨æ›´æ–°"></a>å®ç° updateTime å­—æ®µè‡ªåŠ¨æ›´æ–°</h4><ul>
<li>ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿæˆ‘ä»¬å¸Œæœ›åœ¨<strong>ä¿®æ”¹å®Œæ•°æ®åº“è¡¨ä¸­çš„è®°å½•</strong>åï¼Œè¯¥æ¡è®°å½•<strong>å¯¹åº”çš„ uodateTime å­—æ®µ</strong>å®ç°<strong>è‡ªåŠ¨æ›´æ–°</strong></li>
<li>å®ç°æ–¹æ³•å¾ˆç®€å•ï¼Œåœ¨ IDEA ä¸­ï¼Œç›´æ¥ä¿®æ”¹è¡¨çš„ updateTime å­—æ®µå±æ€§ï¼Œå¦‚ä¸‹ï¼š</li>
</ul>
<p><img src="https://gitee.com/deng-2022/pictures/raw/master/images/image-20231107224250849.png" alt="image-20231107224250849"></p>
<ul>
<li>å¯¹åº”çš„ <strong><code>DDL</code> è¯­å¥</strong>æ˜¯è¿™æ ·çš„ï¼š</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">updateTime datetime <span class="hljs-keyword">default</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span> <span class="hljs-keyword">on</span> <span class="hljs-keyword">update</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> comment <span class="hljs-string">&#x27;æ›´æ–°æ—¶é—´&#x27;</span>,<br></code></pre></td></tr></table></figure>

<ul>
<li>è¿™æ ·ï¼Œæˆ‘ä»¬<strong>æ›´æ–°è®°å½•</strong>åï¼Œè¯¥è®°å½• updateTime å­—æ®µä¼š<strong>è‡ªåŠ¨æ›´æ–°ä¸ºæœ€è¿‘ä¿®æ”¹æ—¶é—´</strong>ï¼š<strong>ï¼ˆ2023/11/07æ™šï¼‰</strong></li>
</ul>
<p><img src="https://gitee.com/deng-2022/pictures/raw/master/images/image-20231107224550821.png" alt="image-20231107224550821"></p>
<blockquote>
<p>SQLï¼Œå¤šè¾“å…¥ï¼Œå¤šè¾“å‡º</p>
</blockquote>
<p><img src="https://gitee.com/deng-2022/pictures/raw/master/images/image-20231107213230435.png" alt="image-20231107213230435"></p>
<h3 id="Canal-ç›‘æ§æ•°æ®åº“æµæ°´"><a href="#Canal-ç›‘æ§æ•°æ®åº“æµæ°´" class="headerlink" title="Canal ç›‘æ§æ•°æ®åº“æµæ°´"></a>Canal ç›‘æ§æ•°æ®åº“æµæ°´</h3><blockquote>
<p>ğŸ¥£ æ¨èé˜…è¯»ï¼š</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://codingfire.blog.csdn.net/article/details/131420343?spm=1001.2014.3001.5502">Javaå¼€å‘ - Canalçš„åŸºæœ¬ç”¨æ³•_canal java-CSDNåšå®¢</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/alibaba/canal/wiki/ClientExample">ClientExample Â· alibaba/canal Wiki (github.com)</a></li>
</ul>
</blockquote>
<ul>
<li>ä»Šå¤©æ™šä¸Šï¼Œæˆ‘ä»¬å®ç°äº†ç®€å•çš„é€šè¿‡ Canal ç›‘æ§æ•°æ®åº“æµæ°´ï¼Œå®ç°äº†å®æ—¶ç›‘å¬ MySQL ä¸­çš„æ•°æ®å˜æ›´ï¼Œå¹¶å®æ—¶åŒæ­¥å˜æ›´çš„æ•°æ®åˆ° Elasticsearch ä¸­ï¼Œä¸‹é¢ç®€å•åœ°ä»‹ç»ä¸‹ç›¸å…³æµç¨‹ï¼š<strong>ï¼ˆ2023/12/04æ™šï¼‰</strong></li>
</ul>
<h4 id="æœ¬åœ°æ•°æ®åº“é…ç½®"><a href="#æœ¬åœ°æ•°æ®åº“é…ç½®" class="headerlink" title="æœ¬åœ°æ•°æ®åº“é…ç½®"></a>æœ¬åœ°æ•°æ®åº“é…ç½®</h4><ul>
<li>åˆ›å»ºæ–°ç”¨æˆ·ï¼š</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">USER</span> canal IDENTIFIED <span class="hljs-keyword">BY</span> <span class="hljs-string">&#x27;canal&#x27;</span>;  <br><span class="hljs-keyword">GRANT</span> <span class="hljs-keyword">SELECT</span>, REPLICATION SLAVE, REPLICATION CLIENT <span class="hljs-keyword">ON</span> <span class="hljs-operator">*</span>.<span class="hljs-operator">*</span> <span class="hljs-keyword">TO</span> <span class="hljs-string">&#x27;canal&#x27;</span>@<span class="hljs-string">&#x27;%&#x27;</span>;<br><span class="hljs-comment">-- GRANT ALL PRIVILEGES ON *.* TO &#x27;canal&#x27;@&#x27;%&#x27; ;</span><br>FLUSH PRIVILEGES;<br></code></pre></td></tr></table></figure>

<ul>
<li>åœ¨æœ¬åœ° MySQL ä¸­çš„ my.ini æ–‡ä»¶ä¸­åšå¦‚ä¸‹é…ç½®ï¼ˆå°†æœ¬åœ°çš„ MySQL ä½œä¸ºä¸€ä¸ªä¸»èŠ‚ç‚¹ï¼Œå¼€å¯æœ¬åœ° binlog ç”Ÿæˆï¼‰ï¼š</li>
</ul>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-section">[mysqld]</span><br><span class="hljs-attr">log-bin</span>=mysql-bin <span class="hljs-comment"># å¼€å¯ binlog</span><br><span class="hljs-attr">binlog-format</span>=ROW <span class="hljs-comment"># é€‰æ‹© ROW æ¨¡å¼</span><br><span class="hljs-attr">server_id</span>=<span class="hljs-number">1</span> <span class="hljs-comment"># é…ç½® MySQL replaction éœ€è¦å®šä¹‰ï¼Œä¸è¦å’Œ canal çš„ slaveId é‡å¤</span><br></code></pre></td></tr></table></figure>

<h4 id="Canal-çš„ä¸‹è½½å®‰è£…"><a href="#Canal-çš„ä¸‹è½½å®‰è£…" class="headerlink" title="Canal çš„ä¸‹è½½å®‰è£…"></a>Canal çš„ä¸‹è½½å®‰è£…</h4><ul>
<li><a target="_blank" rel="noopener" href="https://github.com/alibaba/canal/wiki/ClientExample">ClientExample Â· alibaba/canal Wiki (github.com)</a></li>
</ul>
<h4 id="Canal-é…ç½®"><a href="#Canal-é…ç½®" class="headerlink" title="Canal é…ç½®"></a>Canal é…ç½®</h4><ul>
<li>åœ¨ <code>\conf\example\instance.properties</code> ç›®å½•ä¸‹åšå¦‚ä¸‹é…ç½®ï¼š</li>
</ul>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-string">canal.instance.master.address=127.0.0.1:3306</span><br><span class="hljs-string">canal.instance.master.journal.name=mysql-bin.000001</span><br><span class="hljs-string">canal.instance.master.position=</span><br><span class="hljs-string">canal.instance.dbUsername=canal</span><br><span class="hljs-string">canal.instance.dbPassword=canal</span><br></code></pre></td></tr></table></figure>

<p><img src="https://gitee.com/deng-2022/pictures/raw/master/images/image-20231204204312817.png" alt="image-20231204204312817"></p>
<h4 id="å¯åŠ¨-Canal"><a href="#å¯åŠ¨-Canal" class="headerlink" title="å¯åŠ¨ Canal"></a>å¯åŠ¨ Canal</h4><ul>
<li>åœ¨ <code>bin</code> ç›®å½•ä¸‹ï¼Œ<strong>è¾“å…¥ä»¥ä¸‹å‘½ä»¤å¯åŠ¨</strong>ï¼š</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">startup.bat<br></code></pre></td></tr></table></figure>

<p><img src="https://gitee.com/deng-2022/pictures/raw/master/images/image-20231204204656098.png" alt="image-20231204204656098"></p>
<h4 id="å¼€å¯æ•°æ®æµæ°´ç›‘æ§"><a href="#å¼€å¯æ•°æ®æµæ°´ç›‘æ§" class="headerlink" title="å¼€å¯æ•°æ®æµæ°´ç›‘æ§"></a>å¼€å¯æ•°æ®æµæ°´ç›‘æ§</h4><ul>
<li><p>åŸºæœ¬çš„é…ç½®å·²ç»åšå¥½äº†ï¼Œæˆ‘ä»¬éœ€è¦åœ¨é¡¹ç›®ä¸­å®é™…æµ‹éªŒä¸€ä¸‹ç›‘æ§æ•°æ®æµæ°´ï¼ˆæ£€æµ‹æ•°æ®å˜æ›´ï¼‰èƒ½å¦æˆåŠŸ<strong>ï¼ˆ2023/12/04æ™šï¼‰</strong></p>
</li>
<li><h5 id="å¯¼å…¥ç›¸å…³ä¾èµ–ï¼š"><a href="#å¯¼å…¥ç›¸å…³ä¾èµ–ï¼š" class="headerlink" title="å¯¼å…¥ç›¸å…³ä¾èµ–ï¼š"></a>å¯¼å…¥ç›¸å…³ä¾èµ–ï¼š</h5></li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba.otter<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>canal.client<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.1.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure>

<ul>
<li>æˆ‘ä»¬æ‹‰å–å®˜ç½‘æä¾›çš„ demo ä»£ç ï¼Œç›´æ¥å¯åŠ¨ï¼š</li>
</ul>
<p><img src="https://gitee.com/deng-2022/pictures/raw/master/images/image-20231204203419273.png" alt="image-20231204203419273"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.alibaba.otter.canal.sample;<br><span class="hljs-keyword">import</span> java.net.InetSocketAddress;<br><span class="hljs-keyword">import</span> java.util.List;<br><br><br><span class="hljs-keyword">import</span> com.alibaba.otter.canal.client.CanalConnectors;<br><span class="hljs-keyword">import</span> com.alibaba.otter.canal.client.CanalConnector;<br><span class="hljs-keyword">import</span> com.alibaba.otter.canal.common.utils.AddressUtils;<br><span class="hljs-keyword">import</span> com.alibaba.otter.canal.protocol.Message;<br><span class="hljs-keyword">import</span> com.alibaba.otter.canal.protocol.CanalEntry.Column;<br><span class="hljs-keyword">import</span> com.alibaba.otter.canal.protocol.CanalEntry.Entry;<br><span class="hljs-keyword">import</span> com.alibaba.otter.canal.protocol.CanalEntry.EntryType;<br><span class="hljs-keyword">import</span> com.alibaba.otter.canal.protocol.CanalEntry.EventType;<br><span class="hljs-keyword">import</span> com.alibaba.otter.canal.protocol.CanalEntry.RowChange;<br><span class="hljs-keyword">import</span> com.alibaba.otter.canal.protocol.CanalEntry.RowData;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SimpleCanalClientExample</span> &#123;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String args[])</span> &#123;<br>        <span class="hljs-comment">// åˆ›å»ºé“¾æ¥</span><br>        <span class="hljs-type">CanalConnector</span> <span class="hljs-variable">connector</span> <span class="hljs-operator">=</span> CanalConnectors<br>                .newSingleConnector(<span class="hljs-keyword">new</span> <span class="hljs-title class_">InetSocketAddress</span>(AddressUtils.getHostIp(),<br>                        <span class="hljs-number">11111</span>), <span class="hljs-string">&quot;example&quot;</span>, <span class="hljs-string">&quot;&quot;</span>, <span class="hljs-string">&quot;&quot;</span>);<br>        <span class="hljs-comment">// è·å–æŒ‡å®šçš„æ•°æ®é‡</span><br>        <span class="hljs-type">int</span> <span class="hljs-variable">batchSize</span> <span class="hljs-operator">=</span> <span class="hljs-number">1000</span>;<br>        <span class="hljs-comment">// ç©ºæ•°æ®è®¡æ•°å™¨</span><br>        <span class="hljs-type">int</span> <span class="hljs-variable">emptyCount</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-comment">// å»ºç«‹ä¸ Canal æœåŠ¡å™¨çš„è¿æ¥</span><br>            connector.connect();<br>            <span class="hljs-comment">// è®¢é˜…æ‰€æœ‰æ•°æ®åº“çš„æ‰€æœ‰è¡¨çš„æ•°æ®å˜æ›´äº‹ä»¶</span><br>            connector.subscribe(<span class="hljs-string">&quot;.*\\..*&quot;</span>);<br>            <span class="hljs-comment">// å›æ»šåˆ°ä¸Šæ¬¡ç¡®è®¤çš„ä½ç½®ï¼Œä»¥ç¡®ä¿ä»ä¸Šæ¬¡æ–­å¼€è¿æ¥åå¼€å§‹æ¥æ”¶æ•°æ®</span><br>            connector.rollback();<br>            <span class="hljs-comment">// è¿›å…¥å¾ªç¯ï¼Œç›´åˆ°è¿ç»­æ”¶åˆ° 120 æ¬¡ç©ºæ¶ˆæ¯ä¸ºæ­¢</span><br>            <span class="hljs-type">int</span> <span class="hljs-variable">totalEmptyCount</span> <span class="hljs-operator">=</span> <span class="hljs-number">120</span>;<br><br>            <span class="hljs-keyword">while</span> (emptyCount &lt; totalEmptyCount) &#123;<br>                <span class="hljs-comment">// è·å–æ¶ˆæ¯æ‰¹æ¬¡IDå’Œæ¶ˆæ¯å¤§å°</span><br>                <span class="hljs-type">Message</span> <span class="hljs-variable">message</span> <span class="hljs-operator">=</span> connector.getWithoutAck(batchSize);<br>                <span class="hljs-type">long</span> <span class="hljs-variable">batchId</span> <span class="hljs-operator">=</span> message.getId();<br>                <span class="hljs-type">int</span> <span class="hljs-variable">size</span> <span class="hljs-operator">=</span> message.getEntries().size();<br><br>                <span class="hljs-comment">// è·å–åˆ°çš„æ¶ˆæ¯çš„æ‰¹æ¬¡ ID ä¸º -1 æˆ–è€…æ¶ˆæ¯çš„å¤§å°ä¸º 0ï¼Œè¡¨ç¤ºæ²¡æœ‰æ•°æ®</span><br>                <span class="hljs-keyword">if</span> (batchId == -<span class="hljs-number">1</span> || size == <span class="hljs-number">0</span>) &#123;<br>                    <span class="hljs-comment">// å°†ç©ºè®¡æ•°å™¨åŠ ä¸€ï¼Œå¹¶æ‰“å°å‡ºå½“å‰çš„ç©ºè®¡æ•°å€¼ã€‚</span><br>                    emptyCount++;<br>                    System.out.println(<span class="hljs-string">&quot;empty count : &quot;</span> + emptyCount);<br>                    <span class="hljs-comment">// çº¿ç¨‹ä¼‘çœ  1 ç§’é’Ÿã€‚</span><br>                    <span class="hljs-keyword">try</span> &#123;<br>                        Thread.sleep(<span class="hljs-number">1000</span>);<br>                    &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>                    &#125;<br>                &#125; <span class="hljs-keyword">else</span> &#123;<br>                    <span class="hljs-comment">// ç©ºæ•°æ®è®¡æ•°å™¨ç½®0</span><br>                    emptyCount = <span class="hljs-number">0</span>;<br>                    System.out.printf(<span class="hljs-string">&quot;message[batchId=%s,size=%s] \n&quot;</span>, batchId, size);<br>                    printEntry(message.getEntries());<br>                &#125;<br><br>                connector.ack(batchId); <span class="hljs-comment">// æäº¤ç¡®è®¤</span><br>                <span class="hljs-comment">// connector.rollback(batchId); // å¤„ç†å¤±è´¥, å›æ»šæ•°æ®</span><br>            &#125;<br><br>            System.out.println(<span class="hljs-string">&quot;empty too many times, exit&quot;</span>);<br>        &#125; <span class="hljs-keyword">finally</span> &#123;<br>            connector.disconnect();<br>        &#125;<br>    &#125;<br><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">printEntry</span><span class="hljs-params">(List&lt;Entry&gt; entrys)</span> &#123;<br>    <span class="hljs-keyword">for</span> (Entry entry : entrys) &#123;<br>        <span class="hljs-keyword">if</span> (entry.getEntryType() == EntryType.TRANSACTIONBEGIN || entry.getEntryType() == EntryType.TRANSACTIONEND) 		&#123;<br>            <span class="hljs-keyword">continue</span>;<br>        &#125;<br><br>        <span class="hljs-type">RowChange</span> <span class="hljs-variable">rowChage</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>        <span class="hljs-keyword">try</span> &#123;<br>            rowChage = RowChange.parseFrom(entry.getStoreValue());<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">&quot;ERROR ## parser of eromanga-event has an error , data:&quot;</span> + entry.toString(),<br>                                       e);<br>        &#125;<br><br>        <span class="hljs-type">EventType</span> <span class="hljs-variable">eventType</span> <span class="hljs-operator">=</span> rowChage.getEventType();<br>        System.out.println(String.format(<span class="hljs-string">&quot;================&amp;gt; binlog[%s:%s] , name[%s,%s] , eventType : %s&quot;</span>,<br>                                         entry.getHeader().getLogfileName(), entry.getHeader().getLogfileOffset(),<br>                                         entry.getHeader().getSchemaName(), entry.getHeader().getTableName(),<br>                                         eventType));<br><br>        <span class="hljs-keyword">for</span> (RowData rowData : rowChage.getRowDatasList()) &#123;<br>            <span class="hljs-keyword">if</span> (eventType == EventType.DELETE) &#123;<br>                printColumn(rowData.getBeforeColumnsList());<br>            &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (eventType == EventType.INSERT) &#123;<br>                printColumn(rowData.getAfterColumnsList());<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                System.out.println(<span class="hljs-string">&quot;-------&amp;gt; before&quot;</span>);<br>                printColumn(rowData.getBeforeColumnsList());<br>                System.out.println(<span class="hljs-string">&quot;-------&amp;gt; after&quot;</span>);<br>                printColumn(rowData.getAfterColumnsList());<br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">printColumn</span><span class="hljs-params">(List&lt;Column&gt; columns)</span> &#123;<br>    <span class="hljs-keyword">for</span> (Column column : columns) &#123;<br>        System.out.println(column.getName() + <span class="hljs-string">&quot; : &quot;</span> + column.getValue() + <span class="hljs-string">&quot;    update=&quot;</span> + column.getUpdated());<br>    &#125;<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h4 id="æœ¬åœ°æ•°æ®åº“ä¿®æ”¹æ•°æ®ï¼Œæµ‹è¯•-Canal-ç›‘æ§æ•°æ®åº“æµæ°´"><a href="#æœ¬åœ°æ•°æ®åº“ä¿®æ”¹æ•°æ®ï¼Œæµ‹è¯•-Canal-ç›‘æ§æ•°æ®åº“æµæ°´" class="headerlink" title="æœ¬åœ°æ•°æ®åº“ä¿®æ”¹æ•°æ®ï¼Œæµ‹è¯• Canal ç›‘æ§æ•°æ®åº“æµæ°´"></a>æœ¬åœ°æ•°æ®åº“ä¿®æ”¹æ•°æ®ï¼Œæµ‹è¯• Canal ç›‘æ§æ•°æ®åº“æµæ°´</h4><ul>
<li>å¦‚ä¸‹ï¼Œæˆ‘ä»¬<strong>ä¿®æ”¹æœ¬åœ°æ•°æ®åº“ä¸­çš„ä¸€æ¡è®°å½•</strong>ï¼Œå‘ç°è¿™æ¬¡æ•°æ®å˜æ›´å·²ç»è¢«æ•æ‰åˆ°å¹¶æ‰“å°å‡ºæ¥äº†</li>
</ul>
<p><img src="https://gitee.com/deng-2022/pictures/raw/master/images/image-20231204204957589.png" alt="image-20231204204957589"></p>
<p>è‡³æ­¤ï¼Œä½¿ç”¨ <strong>Canal å®ç°å®æ—¶ç›‘æ§æ•°æ®å˜æ›´</strong>å°±å®Œæˆäº†ï¼Œå½“ç„¶è¿™åªæ˜¯ç®€å•æµ‹è¯•äº†ä¸€ä¸‹ï¼Œæ—¥åä¼šç€æ‰‹å®ç°åŸºäºè¯¥æ–¹æ³•<strong>åŒæ­¥ MySQL ä¸­çš„å˜æ›´æ•°æ®åˆ° ES ä¸­</strong> <strong>ï¼ˆ2023/12/04æ™šï¼‰</strong></p>
<p>æ•°æ®å¤„ç†å¤±è´¥ï¼Œå‘Šè¯‰ Canal æœåŠ¡å™¨ï¼ŒæŒ‡å®šçš„æ‰¹æ¬¡ <code>batchId</code> çš„æ•°æ®æ²¡æœ‰è¢«æˆåŠŸå¤„ç†ï¼ŒæœåŠ¡å™¨åº”è¯¥é‡æ–°ä¼ é€’è¿™æ‰¹æ•°æ®ã€‚è¿™æ˜¯ä¸€ä¸ªé‡è¯•æœºåˆ¶ï¼Œç¡®ä¿æ•°æ®çš„å®Œæ•´æ€§å’Œä¸€è‡´æ€§ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">int</span> <span class="hljs-variable">maxRetries</span> <span class="hljs-operator">=</span> <span class="hljs-number">3</span>; <span class="hljs-comment">// è®¾ç½®æœ€å¤§é‡è¯•æ¬¡æ•°</span><br><span class="hljs-keyword">while</span> (maxRetries &gt; <span class="hljs-number">0</span>) &#123;<br>    <span class="hljs-keyword">try</span> &#123;<br>        <span class="hljs-comment">// è·å–æ•°æ®å¹¶è¿›è¡Œå¤„ç†</span><br>        List&lt;Entry&gt; entries = connector.getWithoutAck(batchSize);<br>        processEntries(entries); <span class="hljs-comment">// å‡è®¾è¿™æ˜¯ä¸€ä¸ªå¤„ç†æ•°æ®çš„æ–¹æ³•</span><br><br>        <span class="hljs-comment">// å¦‚æœæ•°æ®å¤„ç†æˆåŠŸï¼Œæäº¤ç¡®è®¤</span><br>        connector.ack(batchId);<br>        <span class="hljs-keyword">break</span>; <span class="hljs-comment">// è·³å‡ºå¾ªç¯ï¼Œç»§ç»­ä¸‹ä¸€æ¬¡æ‰¹å¤„ç†</span><br>    &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>        maxRetries--; <span class="hljs-comment">// å‡å°‘å‰©ä½™é‡è¯•æ¬¡æ•°</span><br>        <span class="hljs-keyword">if</span> (maxRetries == <span class="hljs-number">0</span>) &#123;<br>            <span class="hljs-comment">// å¦‚æœè¾¾åˆ°æœ€å¤§é‡è¯•æ¬¡æ•°ï¼Œå›æ»šæ•°æ®</span><br>            connector.rollback(batchId);<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>åœ¨ deployer / bin ç›®å½•ä¸‹ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š<strong>ï¼ˆ2024/02/22æ—©ï¼‰</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">startup.bat<br></code></pre></td></tr></table></figure>

<p><img src="https://gitee.com/deng-2022/pictures/raw/master/images/image-20240222105420902.png" alt="image-20240222105420902"></p>
<p>å¯åŠ¨ SimpleCanalClientExampleï¼š</p>
<p><img src="https://gitee.com/deng-2022/pictures/raw/master/images/image-20240222105218658.png" alt="image-20240222105218658"></p>
<h2 id="å®ç°-ES-åšæ–‡æœç´¢"><a href="#å®ç°-ES-åšæ–‡æœç´¢" class="headerlink" title="å®ç° ES åšæ–‡æœç´¢"></a>å®ç° ES åšæ–‡æœç´¢</h2><h3 id="ä¸¥é‡çš„é—®é¢˜"><a href="#ä¸¥é‡çš„é—®é¢˜" class="headerlink" title="ä¸¥é‡çš„é—®é¢˜"></a>ä¸¥é‡çš„é—®é¢˜</h3><ul>
<li>ç€æ‰‹ä½¿ç”¨ ES å®ç°åšæ–‡å¿«é€Ÿæœç´¢ + å…³é”®è¯é«˜äº®æ˜¾ç¤ºï¼Œé‚£<strong>æ‰§è¡Œæ­¥éª¤å¾ˆç®€å•</strong>ï¼š <strong>ï¼ˆ2023/11/08æ™šï¼‰</strong><ul>
<li>åç«¯æ­£ç¡®è¿”å›åšæ–‡æ•°æ®</li>
<li>å‰ç«¯é¡µé¢å±•ç¤º</li>
</ul>
</li>
<li>ç”±äºä¹‹å‰å¼€å‘è¿‡ <code>post</code> çš„ <strong>ES æ£€ç´¢</strong> + <strong>å…³é”®è¯é«˜äº®æ˜¾ç¤º</strong>ï¼Œè¿™æ¬¡å¼€å‘ä¹Ÿæ˜¯ç›¸å½“è‡ªä¿¡çš„</li>
<li>é¦–å…ˆä½¿ç”¨ DSL è¯­æ³•ï¼Œå°è¯•è·å– ES ä¸­æˆåŠŸåŒæ­¥çš„çš„åšæ–‡æ•°æ®ï¼ŒæŸ¥è¯¢æˆåŠŸï¼š</li>
</ul>
<p><img src="https://gitee.com/deng-2022/pictures/raw/master/images/image-20231108224732635.png" alt="image-20231108224732635"></p>
<ul>
<li>ç»“æœåœ¨æ‰§è¡Œåˆ° <code>ArticleDataSource</code> çš„ <code>searchFromEs()</code> æ–¹æ³•æ—¶ï¼Œå´å§‹ç»ˆæŸ¥è¯¢ä¸åˆ°åšæ–‡æ•°æ®</li>
<li>ç»è¿‡<strong>ä¸€ä¸ªå¤šå°æ—¶çš„ä»”ç»†æ’æŸ¥</strong>ï¼Œæˆ‘ä»¬ç»ˆäºå‘ç°é”™è¯¯å‡ºåœ¨<strong>è¿™æ¡è¯­å¥çš„æ‰§è¡Œ</strong>ä¸Šï¼š<strong>ï¼ˆ2023/11/08æ™šï¼‰</strong></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// idåˆ—è¡¨</span><br>List&lt;Long&gt; articleIdList = searchHitList.stream().map(searchHit -&gt; searchHit.getContent().getId())<br>                  .collect(Collectors.toList());<br><span class="hljs-comment">// æ ¹æ®idæŸ¥æ‰¾æ•°æ®é›†</span><br>List&lt;Article&gt; articleList = baseMapper.selectBatchIds(articleIdList);<br></code></pre></td></tr></table></figure>

<ul>
<li>è¿™æ¡è¯­å¥çš„é€»è¾‘æ˜¯<strong>æ ¹æ®æœç´¢æ¡ä»¶</strong>åœ¨ ES ä¸­æŸ¥è¯¢å‡ºç¬¦åˆæ¡ä»¶çš„<strong>ç´¢å¼• id</strong>ï¼Œå†æ ¹æ®ç´¢å¼• id åœ¨æœ¬åœ° MySQL ä¸­æŸ¥è¯¢<strong>å¯¹åº”è®°å½•çš„è¯¦ç»†ä¿¡æ¯</strong></li>
<li>æŠ¥é”™è¯¦æƒ…çœ‹ä¸‹å›¾æ‰§è¡Œçš„ SQL è¯­å¥ï¼š</li>
</ul>
<p><img src="https://gitee.com/deng-2022/pictures/raw/master/images/image-20231108223638259.png" alt="image-20231108223638259"></p>
<ul>
<li><p>è¿™å°±æ˜¯æˆ‘æ˜¨å¤©åŸ‹ä¸‹çš„å‘ï¼š</p>
<ul>
<li><code>article</code> å’Œ <code>post</code> ä¸¤å¼ è¡¨çš„å±æ€§åˆ†åˆ«æ˜¯ä¸‹åˆ’çº¿å‘½åæ³•å’Œé©¼å³°å‘½åæ³•ï¼ˆå½“æ—¶é¡ºä¾¿å±•ç¤ºäº†<strong>ä¸åŒå‘½åæ³•ä¸‹çš„ logstash æ•°æ®åŒæ­¥é…ç½®</strong>ï¼‰</li>
<li>æ‰§è¡Œ <code>baseMapper.selectBatchIds()</code> æ–¹æ³•æ—¶ï¼Œ<strong>MybatisPlus çš„å­—æ®µæ˜ å°„æ˜¯é©¼å³°æ˜ å°„</strong>ï¼ˆé»˜è®¤çš„ï¼‰</li>
<li>è¿™æ ·å°±æ‰¾ä¸åˆ°å¯¹åº” article è¡¨ä¸­çš„å±æ€§äº†</li>
</ul>
</li>
<li><p>è§£å†³æ–¹æ³•å¾ˆç®€å•ï¼Œå¿…é¡»<strong>ç»Ÿä¸€æ•°æ®åº“ä¸­è¡¨å±æ€§çš„å‘½åæ–¹æ³•</strong>ï¼Œæˆ‘ä»¬å°±<strong>ç»Ÿä¸€ä¸ºé©¼å³°å‘½åæ³•</strong>äº†ï¼ŒåŒæ—¶ä¹Ÿè¦æ³¨æ„ MP é…ç½®ä¸­çš„çš„å­—æ®µæ˜ å°„è§„åˆ™</p>
</li>
<li><p>ä¸è¿‡è¿™æ ·çš„è¯ï¼ŒLogstash config ä¸‹çš„é…ç½®æ–‡ä»¶ä¸­ï¼Œ<strong>article çš„æ•°æ®åŒæ­¥æ˜ å°„é…ç½®</strong>éœ€è¦åšå°å°çš„ä¿®æ”¹äº†ï¼ˆå°é—®é¢˜ï¼‰</p>
</li>
<li><h5 id="æœ‰å…³-MP-é…ç½®ä¸­çš„çš„å­—æ®µæ˜ å°„è§„åˆ™ï¼Œæ˜å¤©æ‰¾æ—¶é—´æ€»ç»“ä¸€ç•ª"><a href="#æœ‰å…³-MP-é…ç½®ä¸­çš„çš„å­—æ®µæ˜ å°„è§„åˆ™ï¼Œæ˜å¤©æ‰¾æ—¶é—´æ€»ç»“ä¸€ç•ª" class="headerlink" title="æœ‰å…³ MP é…ç½®ä¸­çš„çš„å­—æ®µæ˜ å°„è§„åˆ™ï¼Œæ˜å¤©æ‰¾æ—¶é—´æ€»ç»“ä¸€ç•ª"></a>æœ‰å…³ MP é…ç½®ä¸­çš„çš„å­—æ®µæ˜ å°„è§„åˆ™ï¼Œæ˜å¤©æ‰¾æ—¶é—´æ€»ç»“ä¸€ç•ª</h5></li>
</ul>
<figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs clean">org.springframework.jdbc.BadSqlGrammarException: <br>### Error querying database.  Cause: java.sql.SQLSyntaxErrorException: Unknown column <span class="hljs-string">&#x27;authorId&#x27;</span> <span class="hljs-keyword">in</span> <span class="hljs-string">&#x27;field list&#x27;</span><br>### The error may exist <span class="hljs-keyword">in</span> com/yupi/springbootinit/mapper/ArticleMapper.java (best guess)<br>### The error may involve defaultParameterMap<br>### The error occurred while setting parameters<br>### SQL: SELECT id,title,description,content,authorId,view,likes,comments,createTime,updateTime,isDelete,collects,articleUrl,tags FROM article WHERE id IN (   ?  ,  ?  )  AND isDelete=<span class="hljs-number">0</span><br>### Cause: java.sql.SQLSyntaxErrorException: Unknown column <span class="hljs-string">&#x27;authorId&#x27;</span> <span class="hljs-keyword">in</span> <span class="hljs-string">&#x27;field list&#x27;</span><br>; bad SQL grammar []; nested exception is java.sql.SQLSyntaxErrorException: Unknown column <span class="hljs-string">&#x27;authorId&#x27;</span> <span class="hljs-keyword">in</span> <span class="hljs-string">&#x27;field list&#x27;</span><br></code></pre></td></tr></table></figure>

<ul>
<li>å¿™æ´»äº†ä¸€æ™šä¸Šï¼Œåç«¯æ€»ç®—èƒ½æ­£å¸¸æŸ¥è¯¢å‡º ES ä¸­çš„æ•°æ®äº†ï¼Œ<strong>æ•ˆæœå¦‚ä¸‹</strong>ï¼š<strong>ï¼ˆ2023/11/08æ™šï¼‰</strong></li>
</ul>
<p><img src="https://gitee.com/deng-2022/pictures/raw/master/images/image-20231108230233426.png" alt="image-20231108230233426"></p>
<p><img src="https://gitee.com/deng-2022/pictures/raw/master/images/image-20231108230244201.png" alt="image-20231108230244201"></p>
<h3 id="å‰ç«¯é¡µé¢å¼€å‘"><a href="#å‰ç«¯é¡µé¢å¼€å‘" class="headerlink" title="å‰ç«¯é¡µé¢å¼€å‘"></a>å‰ç«¯é¡µé¢å¼€å‘</h3><ul>
<li><strong>æ ¸å¿ƒä»£ç </strong>å±•ç¤ºï¼š</li>
</ul>
<figure class="highlight handlebars"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs handlebars"><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">a-list-item-meta</span>&gt;</span></span><br><span class="language-xml">         <span class="hljs-tag">&lt;<span class="hljs-name">template</span> #<span class="hljs-attr">title</span>&gt;</span></span><br><span class="language-xml">           <span class="hljs-comment">&lt;!--&lt;a @click=&quot;goToRead(item.id)&quot;&gt;</span></span><span class="hljs-template-variable">&#123;&#123; <span class="hljs-name">item.title</span> &#125;&#125;</span><span class="language-xml"><span class="hljs-comment">&lt;/a&gt;--&gt;</span></span><br><span class="language-xml">           <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">v-html</span>=<span class="hljs-string">&quot;item.title&quot;</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;margin-bottom: 10px&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">         <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span></span><br><span class="language-xml"></span><br><span class="language-xml">         <span class="hljs-tag">&lt;<span class="hljs-name">template</span> #<span class="hljs-attr">description</span>&gt;</span></span><br><span class="language-xml">           <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">v-html</span>=<span class="hljs-string">&quot;item.description&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><br><span class="language-xml">         <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span></span><br><span class="language-xml">       <span class="hljs-tag">&lt;/<span class="hljs-name">a-list-item-meta</span>&gt;</span></span><br></code></pre></td></tr></table></figure>

<ul>
<li>åšæ–‡é¡µé¢é»˜è®¤å±•ç¤º<strong>æ–‡ç« è¯¦ç»†ä¿¡æ¯</strong>ï¼š</li>
</ul>
<p><img src="https://gitee.com/deng-2022/pictures/raw/master/images/image-20231109135611922.png" alt="image-20231109135611922"></p>
<ul>
<li>æ‰§è¡Œæœç´¢åï¼Œæ ¹æ® <code>åšæ–‡æ ‡é¢˜ï¼ˆtitleï¼‰</code> å’Œ <code>æ–‡ç« æ‘˜è¦ï¼ˆdescriptionï¼‰</code> å¿«é€Ÿæ£€ç´¢ï¼Œå¹¶å®ç°<strong>å…³é”®è¯é«˜äº®</strong>ï¼š</li>
</ul>
<p><img src="https://gitee.com/deng-2022/pictures/raw/master/images/image-20231109140530297.png" alt="image-20231109140530297"></p>
<ul>
<li>ä¸€ä¸ªå¤šæœˆå‰ï¼Œ<strong>Memory ç¼˜å¿†äº¤å‹ç¤¾åŒº</strong>è‡´åŠ›äºå®ç°çš„<strong>æ ¸å¿ƒåŠŸèƒ½</strong>ï¼Œä»Šå¤©åŸºæœ¬å®ç°äº† <strong>ï¼ˆ2023/11/09åˆï¼‰</strong></li>
<li>åœ¨  æ–°å¢äº†åšæ–‡æ‘˜è¦ï¼ˆdescriptionï¼‰,å®Œæˆæ ¹æ®æ‘˜è¦çš„å…³é”®è¯é«˜äº®æ˜¾ç¤ºï¼š</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Data</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ArticleEsHighlightData</span> &#123;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * id</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> Long id;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æ ‡é¢˜</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> String title;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æ‘˜è¦</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> String description;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * å†…å®¹</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> String content;<br>&#125;<br></code></pre></td></tr></table></figure>

<ul>
<li>åœ¨æ‰§è¡ŒæŸ¥è¯¢å‰ï¼ŒæŒ‡å®šé«˜äº®æ˜¾ç¤ºå­—æ®µ</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// æŸ¥è¯¢å¸¦highlightï¼Œæ ‡é¢˜å’Œæ‘˜è¦éƒ½å¸¦ä¸Š</span><br>       <span class="hljs-type">HighlightBuilder</span> <span class="hljs-variable">highlightBuilder</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">HighlightBuilder</span>()<br>               .field(<span class="hljs-string">&quot;description&quot;</span>)<br>               .requireFieldMatch(<span class="hljs-literal">false</span>)<br>               .preTags(<span class="hljs-string">&quot;&lt;font color=&#x27;#eea6b7&#x27;&gt;&quot;</span>)<br>               .postTags(<span class="hljs-string">&quot;&lt;/font&gt;&quot;</span>);<br>       highlightBuilder.field(<span class="hljs-string">&quot;title&quot;</span>)<br>               .requireFieldMatch(<span class="hljs-literal">false</span>)<br>               .preTags(<span class="hljs-string">&quot;&lt;font color=&#x27;#eea6b7&#x27;&gt;&quot;</span>)<br>               .postTags(<span class="hljs-string">&quot;&lt;/font&gt;&quot;</span>);<br></code></pre></td></tr></table></figure>

<ul>
<li>æ„é€ æŸ¥è¯¢ï¼ˆè¿‡æ»¤ + æ’åº + åˆ†é¡µ + å…³é”®å­—é«˜äº®å­—æ®µï¼‰</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// æ’åº</span><br>       SortBuilder&lt;?&gt; sortBuilder = SortBuilders.scoreSort();<br>       <span class="hljs-keyword">if</span> (StringUtils.isNotBlank(sortField)) &#123;<br>           sortBuilder = SortBuilders.fieldSort(sortField);<br>           sortBuilder.order(CommonConstant.SORT_ORDER_ASC.equals(sortOrder) ? SortOrder.ASC : SortOrder.DESC);<br>       &#125;<br>       <span class="hljs-comment">// åˆ†é¡µ</span><br>       <span class="hljs-type">PageRequest</span> <span class="hljs-variable">pageRequest</span> <span class="hljs-operator">=</span> PageRequest.of((<span class="hljs-type">int</span>) pageNum, (<span class="hljs-type">int</span>) pageSize);<br>       <span class="hljs-comment">// æ„é€ æŸ¥è¯¢</span><br>       <span class="hljs-type">NativeSearchQuery</span> <span class="hljs-variable">searchQuery</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">NativeSearchQueryBuilder</span>()<br>               .withQuery(boolQueryBuilder)<br>               .withHighlightBuilder(highlightBuilder)<br>               .withPageable(pageRequest)<br>               .withSorts(sortBuilder).build();<br>       SearchHits&lt;ArticleEsDTO&gt; searchHits = elasticsearchRestTemplate.search(searchQuery, ArticleEsDTO.class);<br></code></pre></td></tr></table></figure>

<ul>
<li>ä»æŸ¥è¯¢ç»“æœä¸­ï¼Œ<strong>è·å–é«˜äº®å­—æ®µ</strong></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// æŸ¥å‡ºç»“æœåï¼Œä» db è·å–æœ€æ–°åŠ¨æ€æ•°æ®ï¼ˆæ¯”å¦‚ç‚¹èµæ•°ï¼‰</span><br>      <span class="hljs-keyword">if</span> (searchHits.hasSearchHits()) &#123;<br>          List&lt;SearchHit&lt;ArticleEsDTO&gt;&gt; searchHitList = searchHits.getSearchHits();<br>          <span class="hljs-comment">// æœç´¢å…³é”®è¯é«˜äº®</span><br>          Map&lt;Long, ArticleEsHighlightData&gt; highlightDataMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br>          <span class="hljs-keyword">for</span> (SearchHit hit : searchHits.getSearchHits()) &#123;<br>              <span class="hljs-type">ArticleEsHighlightData</span> <span class="hljs-variable">data</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArticleEsHighlightData</span>();<br>              data.setId(Long.valueOf(hit.getId()));<br>              <span class="hljs-keyword">if</span> (hit.getHighlightFields().get(<span class="hljs-string">&quot;title&quot;</span>) != <span class="hljs-literal">null</span>) &#123;<br>                  <span class="hljs-type">String</span> <span class="hljs-variable">highlightTitle</span> <span class="hljs-operator">=</span> String.valueOf(hit.getHighlightFields().get(<span class="hljs-string">&quot;title&quot;</span>));<br>                  data.setTitle(highlightTitle.substring(<span class="hljs-number">1</span>, highlightTitle.length() - <span class="hljs-number">1</span>));<br>                  System.out.println(data.getTitle());<br>              &#125;<br>              <span class="hljs-keyword">if</span> (hit.getHighlightFields().get(<span class="hljs-string">&quot;description&quot;</span>) != <span class="hljs-literal">null</span>) &#123;<br>                  <span class="hljs-type">String</span> <span class="hljs-variable">highlightContent</span> <span class="hljs-operator">=</span> String.valueOf(hit.getHighlightFields().get(<span class="hljs-string">&quot;description&quot;</span>));<br>                  data.setDescription(highlightContent.substring(<span class="hljs-number">1</span>, highlightContent.length() - <span class="hljs-number">1</span>));<br>                  System.out.println(data.getContent());<br>              &#125;<br>              highlightDataMap.put(data.getId(), data);<br>          &#125;<br></code></pre></td></tr></table></figure>

<ul>
<li>ä½¿ç”¨<strong>é«˜äº®å­—æ®µæ›¿ä»£åŸæœ¬</strong>çš„å†…å®¹ï¼š</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">if</span> (idArticleMap.containsKey(articleId)) &#123;<br>                     <span class="hljs-comment">// æœç´¢å…³é”®è¯é«˜äº®æ›¿æ¢</span><br>                     <span class="hljs-type">Article</span> <span class="hljs-variable">article</span> <span class="hljs-operator">=</span> idArticleMap.get(articleId).get(<span class="hljs-number">0</span>);<br>                     <span class="hljs-type">String</span> <span class="hljs-variable">hl_title</span> <span class="hljs-operator">=</span> highlightDataMap.get(articleId).getTitle();<br>                     <span class="hljs-type">String</span> <span class="hljs-variable">hl_des</span> <span class="hljs-operator">=</span> highlightDataMap.get(articleId).getDescription();<br>                     <span class="hljs-keyword">if</span> (hl_title != <span class="hljs-literal">null</span> &amp;&amp; hl_title.trim() != <span class="hljs-string">&quot;&quot;</span>) &#123;<br>                         article.setTitle(hl_title);<br>                     &#125;<br>                     <span class="hljs-keyword">if</span> (hl_des != <span class="hljs-literal">null</span> &amp;&amp; hl_des.trim() != <span class="hljs-string">&quot;&quot;</span>) &#123;<br>                         article.setDescription(hl_des);<br>                     &#125;<br>                     resourceList.add(article);<br>                 &#125;<br></code></pre></td></tr></table></figure>

<ul>
<li>æ€ä¹ˆä¸ªæ›¿æ¢æ³•å‘¢ï¼Ÿçœ‹ä¸‹å›¾å°±èƒ½æ˜ç™½äº†ï¼š</li>
</ul>
<p><img src="https://gitee.com/deng-2022/pictures/raw/master/images/image-20231109234625186.png" alt="image-20231109234625186"></p>
<ul>
<li>è¿™ä¸ª<strong>é«˜äº®å­—æ®µ</strong>æ˜¯æˆ‘ä»¬ç›´æ¥è·å–çš„ï¼Œ<strong>å®˜æ–¹æ–‡æ¡£</strong>ä¸­ä¹Ÿç›´æ¥ç»™äº† demo ç¤ºä¾‹ä»£ç ï¼š</li>
</ul>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">hit.getHighlightFields().<span class="hljs-built_in">get</span>(<span class="hljs-string">&quot;title&quot;</span>)<br></code></pre></td></tr></table></figure>

<ul>
<li><strong>å®˜æ–¹æ–‡æ¡£</strong>ï¼š[Highlighting | Elasticsearch Guide <a target="_blank" rel="noopener" href="https://www.elastic.co/guide/en/elasticsearch/reference/7.17/highlighting.html">7.17] | Elastic</a></li>
<li>æ€»ç®—å®Œæ•´åœ°è¿‡äº†ä¸€é<strong>å…³é”®è¯é«˜äº®æ˜¾ç¤ºæµç¨‹</strong>äº† <strong>ï¼ˆ2023/11/09æ™šï¼‰</strong></li>
</ul>
<h2 id="åšæ–‡é˜…è¯»é¡µé¢å¼€å‘"><a href="#åšæ–‡é˜…è¯»é¡µé¢å¼€å‘" class="headerlink" title="åšæ–‡é˜…è¯»é¡µé¢å¼€å‘"></a>åšæ–‡é˜…è¯»é¡µé¢å¼€å‘</h2><ul>
<li><a target="_blank" rel="noopener" href="https://so.gushiwen.cn/mingjus/default.aspx?cstr=%E4%BA%94%E4%BB%A3">äº”ä»£åå¥_å¤è¯—æ–‡ç½‘ (gushiwen.cn)</a></li>
<li>ç°åœ¨æœ‰è¯—è¯å’Œåšæ–‡ä¸¤ä¸ªèšåˆæœç´ ï¼Œå…³äºè¿™ä¸¤ç±»æ•°æ®çš„æ•°æ®æ¥æºï¼Œæƒ³æ³•æ˜¯è¿™æ ·çš„ï¼š<ul>
<li>åšæ–‡å°±ç›´æ¥å­˜å‚¨åœ¨æœ¬åœ°æ•°æ®åº“ï¼Œå› ä¸ºåœ¨å…¶ä»–ç½‘ç«™ï¼ˆæ˜é‡‘ / CSDNï¼‰åŒæ­¥åˆ°çš„åšæ–‡ä¿¡æ¯æœ‰æ‰€æ¬ ç¼ºï¼ˆæ–‡ç« åˆ›ä½œæ—¶é—´ç­‰ç­‰ï¼‰</li>
<li>å› ä¸ºæˆ‘æƒ³å€Ÿè¿™ä¸ªæœºä¼šï¼Œä¸ä»…å°†åšæ–‡æœç´¢æ¥å…¥èšåˆæœç´¢ä¸­ï¼Œè¿˜æƒ³å®ç°åŸºæœ¬çš„åšæ–‡é˜…è¯»åŠŸèƒ½</li>
<li>è¯—è¯æœç´¢å°±ç›´æ¥è°ƒç”¨å¤–éƒ¨æ¥å£ï¼Œå†åŒæ­¥åˆ°æœ¬åœ°æ•°æ®åº“ï¼Œå¤è¯—è¯ç½‘å°±å¾ˆä¸é”™</li>
</ul>
</li>
</ul>
<h3 id="åšæ–‡é˜…è¯»é¡µè·³è½¬"><a href="#åšæ–‡é˜…è¯»é¡µè·³è½¬" class="headerlink" title="åšæ–‡é˜…è¯»é¡µè·³è½¬"></a>åšæ–‡é˜…è¯»é¡µè·³è½¬</h3><ul>
<li><p>ä¸€åˆ‡éƒ½å¾ˆé¡ºåˆ©ï¼Œç›´æ¥ç²˜è´´ <strong>Memory ç¼˜å¿†äº¤å‹ç¤¾åŒº</strong>çš„ç›¸å…³ä¸šåŠ¡é€»è¾‘ä»£ç å³å¯</p>
</li>
<li><p>å¥¶å¥¶çš„ï¼Œå…¨å±€å“åº”æ‹¦æˆªå™¨å®³äº†æˆ‘ï¼š</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// æ·»åŠ å“åº”æ‹¦æˆªå™¨</span><br>instance.interceptors.response.use(<br>    function (response) &#123;<br>        <span class="hljs-comment">// 2xx èŒƒå›´å†…çš„çŠ¶æ€ç éƒ½ä¼šè§¦å‘è¯¥å‡½æ•°ã€‚</span><br>        <span class="hljs-comment">// å¯¹å“åº”æ•°æ®åšç‚¹ä»€ä¹ˆ</span><br>        <span class="hljs-type">const</span> <span class="hljs-variable">data</span> <span class="hljs-operator">=</span> response.data;<br>        <span class="hljs-keyword">if</span> (data.code === <span class="hljs-number">0</span>) &#123;<br>            <span class="hljs-keyword">return</span> data.data;<br>        &#125;<br>        console.error(<span class="hljs-string">&quot;request error&quot;</span>, data);<br>        <span class="hljs-keyword">return</span> response.data;<br>    &#125;,<br>    function (error) &#123;<br>        <span class="hljs-comment">// è¶…å‡º 2xx èŒƒå›´çš„çŠ¶æ€ç éƒ½ä¼šè§¦å‘è¯¥å‡½æ•°ã€‚</span><br>        <span class="hljs-comment">// å¯¹å“åº”é”™è¯¯åšç‚¹ä»€ä¹ˆ</span><br>        <span class="hljs-keyword">return</span> Promise.reject(error);<br>    &#125;<br>);<br></code></pre></td></tr></table></figure>

<ul>
<li>åªå¥½æ˜¯è¿™æ ·æ¥æ”¶æ–‡ç« äº†</li>
</ul>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs ts"><span class="hljs-keyword">const</span> <span class="hljs-title function_">getArticle</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>  myAxios.<span class="hljs-title function_">get</span>(<span class="hljs-string">&quot;/article/get/VO&quot;</span>, &#123;<br>    <span class="hljs-attr">params</span>: &#123;<br>      <span class="hljs-attr">id</span>: articleId.<span class="hljs-property">value</span><br>    &#125;<br>  &#125;).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span> &#123;<br>    articleInfo.<span class="hljs-property">value</span> = res;<br><br>    <span class="hljs-keyword">const</span> md = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MarkdownIt</span>();<br>    parsedContent.<span class="hljs-property">value</span> = md.<span class="hljs-title function_">render</span>(articleInfo.<span class="hljs-property">value</span>.<span class="hljs-property">content</span>);<br>  &#125;).<span class="hljs-title function_">catch</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;è·å–æ–‡ç« ä¿¡æ¯å¤±è´¥&quot;</span>)<br>  &#125;);<br>&#125;<br></code></pre></td></tr></table></figure>

<p><img src="https://gitee.com/deng-2022/pictures/raw/master/images/image-20231111173705877.png" alt="image-20231111173705877"></p>
<ul>
<li>æ•ˆæœè¿˜å¯ä»¥ï¼Œä¸è¿‡æˆ‘è®¾æƒ³çš„æ˜¯è¿™ä¸ªæœç´¢å¹³å°ä¸éœ€è¦ç™»é™†ï¼Œç”¨æˆ·å°±èƒ½äº«å—æ‰€æœ‰æœåŠ¡</li>
<li>ä¹‹åä¼š<strong>æŠŠç”¨æˆ·ç›¸å…³ä¸šåŠ¡å…¨éƒ¨ä¼˜åŒ–æ‰</strong> <strong>ï¼ˆ2023/11/11æ™šï¼‰</strong></li>
</ul>
<h2 id="å›¾ç‰‡èšåˆæœç´ "><a href="#å›¾ç‰‡èšåˆæœç´ " class="headerlink" title="å›¾ç‰‡èšåˆæœç´ "></a>å›¾ç‰‡èšåˆæœç´ </h2><ul>
<li>äº†è§£ä¸‹ jsoup å·¥å…·å¦‚ä½•å®ç°<strong>ç½‘é¡µæŠ“å–</strong>ï¼Œå¹¶ä½¿ç”¨ HttpClient å®ç°<strong>è§£æç½‘é¡µå†…å®¹</strong></li>
<li>å¼€å‘å…¨æ–°çš„èšåˆæœç´¢ï¼šè§†é¢‘èšåˆæœç´¢</li>
</ul>
<h2 id="è¯—è¯èšåˆæœç´¢"><a href="#è¯—è¯èšåˆæœç´¢" class="headerlink" title="è¯—è¯èšåˆæœç´¢"></a>è¯—è¯èšåˆæœç´¢</h2><ul>
<li>è¯·æ±‚å¤è¯—è¯ç½‘ï¼Œè·å–è¯—è¯ï¼ˆå¦‚ä¸‹å›¾ ğŸ‘‡ï¼‰<strong>ï¼ˆ2023/11/12æ™šï¼‰</strong></li>
</ul>
<p><img src="https://gitee.com/deng-2022/pictures/raw/master/images/image-20231112185151909.png" alt="image-20231112185151909"></p>
<ul>
<li><strong>ç¤ºä¾‹ä»£ç </strong>å¦‚ä¸‹ï¼š</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br>   <span class="hljs-keyword">void</span> <span class="hljs-title function_">testFetchPoem</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>       <span class="hljs-comment">// 1. è·å–æ•°æ®</span><br>       <span class="hljs-type">String</span> <span class="hljs-variable">url</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;https://so.gushiwen.cn/shiwens/default.aspx?page=6&amp;astr=%E6%9D%9C%E7%94%AB&quot;</span>;<br>       <span class="hljs-type">Document</span> <span class="hljs-variable">doc</span> <span class="hljs-operator">=</span> Jsoup.connect(url)<br>               .userAgent(<span class="hljs-string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/116.0.0.0 Safari/537.36 Edg/116.0.1938.62&quot;</span>)<br>               .get();<br>       <span class="hljs-comment">// è¾“å‡ºæ•´ä¸ª HTML æ–‡æ¡£</span><br>       System.out.println(doc);<br>       <br>       <span class="hljs-comment">// æ•è· class = &quot;titletype&quot;</span><br>       <span class="hljs-type">Elements</span> <span class="hljs-variable">elements</span> <span class="hljs-operator">=</span> doc.select(<span class="hljs-string">&quot;.titletype&quot;</span>);<br>       <span class="hljs-keyword">for</span> (Element element : elements) &#123;<br>           System.out.println(element);<br>           System.out.println(element.text());<br><br>       &#125;<br><br>       <span class="hljs-comment">// æ•è· id = &quot;leftZhankai&quot;</span><br>       <span class="hljs-type">Element</span> <span class="hljs-variable">leftZhankai</span> <span class="hljs-operator">=</span> doc.getElementById(<span class="hljs-string">&quot;leftZhankai&quot;</span>);<br>       System.out.println(leftZhankai);<br>       System.out.println(leftZhankai.text());<br>   &#125;<br></code></pre></td></tr></table></figure>

<p><img src="https://gitee.com/deng-2022/pictures/raw/master/images/image-20231112185139366.png" alt="image-20231112185139366"></p>
<h3 id="CSS-é€‰æ‹©å™¨å·©å›º"><a href="#CSS-é€‰æ‹©å™¨å·©å›º" class="headerlink" title="CSS é€‰æ‹©å™¨å·©å›º"></a>CSS é€‰æ‹©å™¨å·©å›º</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// æ•è· id = &quot;leftZhankai&quot;</span><br>       <span class="hljs-type">Element</span> <span class="hljs-variable">leftZhankai</span> <span class="hljs-operator">=</span> doc.getElementById(<span class="hljs-string">&quot;leftZhankai&quot;</span>);<br>       <span class="hljs-type">Elements</span> <span class="hljs-variable">heads</span> <span class="hljs-operator">=</span> leftZhankai.select(<span class="hljs-string">&quot;.sons .cont div:nth-of-type(2)&quot;</span>);<br>       <span class="hljs-keyword">for</span> (Element head : heads) &#123;<br>           <span class="hljs-type">Elements</span> <span class="hljs-variable">title</span> <span class="hljs-operator">=</span> head.select(<span class="hljs-string">&quot;&gt;p:nth-of-type(2)&quot;</span>);<br>           <span class="hljs-comment">// Elements author = head.select(&quot;p:nth-of-type(2)&quot;);</span><br>           <span class="hljs-comment">// System.out.println(title.text() + &quot; &quot; + author.text());</span><br>           System.out.println(<span class="hljs-string">&quot;hhh&quot;</span> + title.text());<br>       &#125;<br></code></pre></td></tr></table></figure>

<p><img src="https://gitee.com/deng-2022/pictures/raw/master/images/image-20231112200526767.png" alt="image-20231112200526767"></p>
<ul>
<li>ç†Ÿæ‚‰ <strong>CSS é€‰æ‹©å™¨</strong>ä¹‹åï¼Œ<strong>è§£æ HTML æ–‡æ¡£</strong>è·å–<strong>æ ‡é¢˜ã€è¯—äººå’Œå†…å®¹</strong>å°±å¾ˆè½»æ¾äº†ï¼š</li>
</ul>
<p><img src="https://gitee.com/deng-2022/pictures/raw/master/images/image-20231112202249521.png" alt="image-20231112202249521"></p>
<h3 id="é—®é¢˜æ€»ç»“"><a href="#é—®é¢˜æ€»ç»“" class="headerlink" title="é—®é¢˜æ€»ç»“"></a>é—®é¢˜æ€»ç»“</h3><ul>
<li>åŸºæœ¬å®ç°äº†è¯—è¯èšåˆæœç´¢ï¼Œä½†æœ‰ä¸¤ä¸ªé—®é¢˜å¾…è§£å†³ï¼š<ul>
<li>logstash æ•°æ®æ•°æ®åŒæ­¥ï¼Œoutput å—å’Œ input å—æ²¡æœ‰ä¸€ä¸€å¯¹åº”</li>
<li>å¯èƒ½ç”±äºåˆ†è¯æœºåˆ¶ï¼Œæˆ‘æœç´¢â€œæœç”«â€å…³é”®è¯ï¼Œä¸ºä»€ä¹ˆåªåŒ¹é…ä¸€æ¡æ•°æ®å‘¢</li>
<li>æŒºå¥‡æ€ªçš„ï¼Œä¸è¿‡ä»Šå¤©å°±åˆ°è¿™é‡Œäº†<strong>ï¼ˆ2023/11/12æ™šï¼‰</strong></li>
</ul>
</li>
</ul>
<h2 id="é˜¶æ®µæ€§é—®é¢˜è§£å†³"><a href="#é˜¶æ®µæ€§é—®é¢˜è§£å†³" class="headerlink" title="é˜¶æ®µæ€§é—®é¢˜è§£å†³"></a>é˜¶æ®µæ€§é—®é¢˜è§£å†³</h2><h3 id="æœç´¢â€œæœç”«â€æœªåŒ¹é…æ–‡æ¡£çš„é—®é¢˜"><a href="#æœç´¢â€œæœç”«â€æœªåŒ¹é…æ–‡æ¡£çš„é—®é¢˜" class="headerlink" title="æœç´¢â€œæœç”«â€æœªåŒ¹é…æ–‡æ¡£çš„é—®é¢˜"></a>æœç´¢â€œæœç”«â€æœªåŒ¹é…æ–‡æ¡£çš„é—®é¢˜</h3><ul>
<li>æ‰¾åˆ°äº†ï¼Œ<strong>ä½¿ç”¨æœç´¢æ¡†è¾“å…¥å…³é”®è¯</strong>æ‰§è¡Œæœç´¢æ—¶ï¼Œæ²¡æœ‰åŒ¹é… <code>author</code> å­—æ®µï¼Œè¡¥å……è¿™æ®µä»£ç å³å¯ï¼š<strong>ï¼ˆ2023/11/13æ™šï¼‰</strong></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// æŒ‰å…³é”®è¯æ£€ç´¢ æ»¡è¶³å…¶ä¸€âˆš</span><br>     <span class="hljs-keyword">if</span> (StringUtils.isNotBlank(searchText)) &#123;<br>         boolQueryBuilder.should(QueryBuilders.matchQuery(<span class="hljs-string">&quot;title&quot;</span>, searchText));<br>         boolQueryBuilder.should(QueryBuilders.matchQuery(<span class="hljs-string">&quot;content&quot;</span>, searchText));<br>         boolQueryBuilder.should(QueryBuilders.matchQuery(<span class="hljs-string">&quot;author&quot;</span>, searchText));<br>         boolQueryBuilder.minimumShouldMatch(<span class="hljs-number">1</span>);<br>     &#125;<br></code></pre></td></tr></table></figure>

<p><img src="https://gitee.com/deng-2022/pictures/raw/master/images/image-20231113213844236.png" alt="image-20231113213844236"></p>
<h3 id="æ— æœç´¢å…³é”®è¯åŒ¹é…æ–‡æ¡£è¿‡å°‘"><a href="#æ— æœç´¢å…³é”®è¯åŒ¹é…æ–‡æ¡£è¿‡å°‘" class="headerlink" title="æ— æœç´¢å…³é”®è¯åŒ¹é…æ–‡æ¡£è¿‡å°‘"></a>æ— æœç´¢å…³é”®è¯åŒ¹é…æ–‡æ¡£è¿‡å°‘</h3><ul>
<li>åœ¨ kibana é¢æ¿ä¸­ï¼Œæ‰§è¡Œè¿™æ ·çš„ DSL æŸ¥è¯¢è¯­å¥ï¼š<strong>ï¼ˆ2023/11/13æ™šï¼‰</strong></li>
</ul>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-built_in">GET</span> post_v1/_search<br>&#123;<br> <span class="hljs-string">&quot;query&quot;</span> : &#123;<br>    <span class="hljs-string">&quot;match_all&quot;</span>: &#123;&#125;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<ul>
<li>æŸ¥è¯¢ç»“æœå¦‚ä¸‹ï¼Œæ˜¾ç¤º post_v1 ç´¢å¼•ä¸‹ä¸€å…±æœ‰ 64 æ¡æ–‡æ¡£ï¼š</li>
</ul>
<p><img src="https://gitee.com/deng-2022/pictures/raw/master/images/image-20231113214120819.png" alt="image-20231113214120819"></p>
<ul>
<li>ä¹Ÿå¯ä»¥æ‰§è¡Œä»¥ä¸‹è¯­å¥ç¡®è®¤æ–‡æ¡£æ¡æ•°ï¼š</li>
</ul>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-built_in">GET</span> post_v1/_count<br></code></pre></td></tr></table></figure>

<p><img src="https://gitee.com/deng-2022/pictures/raw/master/images/image-20231113214149713.png" alt="image-20231113214149713"></p>
<ul>
<li><p>è€Œåœ¨å‰ç«¯é¢æ¿æ‰§è¡Œé»˜è®¤ç©ºå…³é”®è¯æŸ¥è¯¢æ—¶ï¼Œä»…æ˜¾ç¤º 15 æ¡æ•°æ®ï¼Œè¿™ä¸æ˜¯æˆ‘ä»¬æƒ³çœ‹åˆ°çš„</p>
</li>
<li><p>å¦ˆçš„ï¼ŒæŸ¥åˆ°åŸå› äº†ï¼Œè¿™é‡Œæäº†ä¸ª<strong>åˆ†é¡µæŸ¥è¯¢</strong>ï¼š</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// åˆ†é¡µ</span><br>       <span class="hljs-type">PageRequest</span> <span class="hljs-variable">pageRequest</span> <span class="hljs-operator">=</span> PageRequest.of((<span class="hljs-type">int</span>) current, (<span class="hljs-type">int</span>) pageSize);<br>       <span class="hljs-comment">// æ„é€ æŸ¥è¯¢</span><br>       <span class="hljs-type">NativeSearchQuery</span> <span class="hljs-variable">searchQuery</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">NativeSearchQueryBuilder</span>()<br>               .withQuery(boolQueryBuilder)<br>               .withHighlightBuilder(highlightBuilder)<br>               .withPageable(pageRequest)<br>               .withSorts(sortBuilder).build();<br>       SearchHits&lt;PostEsDTO&gt; searchHits = elasticsearchRestTemplate.search(searchQuery, PostEsDTO.class);<br></code></pre></td></tr></table></figure>

<ul>
<li>æŸ¥è¯¢è¿™ä¸ª pageSizeï¼Œå‘ç°æ¥æºäºå‰ç«¯çš„ä¼ å‚ï¼š</li>
</ul>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs ts"><span class="hljs-keyword">const</span> initSearchParams = &#123;<br>  <span class="hljs-attr">type</span>: activeKey,<br>  <span class="hljs-attr">text</span>: <span class="hljs-string">&quot;&quot;</span>,<br>  <span class="hljs-attr">pageSize</span>: <span class="hljs-number">15</span>,<br>  <span class="hljs-attr">pageNum</span>: <span class="hljs-number">1</span>,<br>&#125;;<br></code></pre></td></tr></table></figure>

<ul>
<li>è¿™ä¸ªå°±åº”è¯¥ä¿ç•™ï¼Œè€Œå‰ç«¯åº”è¯¥åŠ ä¸ªåˆ†é¡µæ’ä»¶</li>
<li>å¥¶å¥¶çš„ï¼Œåˆ†é¡µæ’ä»¶ä¸å¥½åšï¼Œæ¢é¡µåï¼Œè¦é‡æ–°åœ¨ post é¡µé¢é‡æ–°æ‰§è¡ŒèšåˆæŸ¥è¯¢ï¼Œè¿˜å¾—æ”¹åŠ¨ä¸å°‘ä»£ç </li>
<li>ç®—äº†ï¼Œä¸æ˜¯ä»€ä¹ˆæ ¸å¿ƒåŠŸèƒ½ï¼Œæ”¹å¤©å†å®Œå–„</li>
</ul>
<h3 id="åšæ–‡-ES-æœç´¢ï¼ŒæŸ¥è¯¢ç»“æœä¸ºç©º"><a href="#åšæ–‡-ES-æœç´¢ï¼ŒæŸ¥è¯¢ç»“æœä¸ºç©º" class="headerlink" title="åšæ–‡ ES æœç´¢ï¼ŒæŸ¥è¯¢ç»“æœä¸ºç©º"></a>åšæ–‡ ES æœç´¢ï¼ŒæŸ¥è¯¢ç»“æœä¸ºç©º</h3><ul>
<li>å¥‡äº†æ€ªäº†ï¼ŒKibana é¢æ¿æ‰§è¡ŒæŸ¥è¯¢ï¼Œæ˜¾ç¤ºæœ‰82æ¡æ•°æ®çš„ï¼š</li>
</ul>
<p><img src="https://gitee.com/deng-2022/pictures/raw/master/images/image-20231115224200545.png" alt="image-20231115224200545"></p>
<ul>
<li>å•Šï¼Ÿä»–çˆ·çˆ·çš„ï¼Œéš”äº†ä¸€æ™šä¸Šï¼Œè¿™æ•°æ®å°±å˜äº†æ˜¯å§ï¼š</li>
</ul>
<p><img src="C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20231116152040439.png" alt="image-20231116152040439"></p>
<p><img src="https://gitee.com/deng-2022/pictures/raw/master/images/image-20231116152213010.png" alt="image-20231116152213010"></p>
<ul>
<li>è¿™å°±å¾ˆå¥‡æ€ªäº†ï¼Œå¯èƒ½æ˜¯æˆ‘æ˜¨æ™šæ²¡æœ‰å¼€å¯ logstash å§ï¼Œä½†è¿™ä¸ªé…ç½®è¿˜æ²¡åšå¥½ï¼Œç›®å‰æ­£åœ¨ç ”ç©¶å¦‚ä½•ä½¿<strong>å¤šç»„ input / output å—ä¸€ä¸€å¯¹åº”</strong></li>
<li><a target="_blank" rel="noopener" href="https://www.python100.com/html/75492.html">logstashå¯åŠ¨å‘½ä»¤_ç¬”è®°å¤§å…¨_è®¾è®¡å­¦é™¢ (python100.com)</a></li>
</ul>
<h3 id="Logstash-é…ç½®å¤šä¸ªè¾“å…¥è¾“å‡ºæºâ…¡"><a href="#Logstash-é…ç½®å¤šä¸ªè¾“å…¥è¾“å‡ºæºâ…¡" class="headerlink" title="Logstash é…ç½®å¤šä¸ªè¾“å…¥è¾“å‡ºæºâ…¡"></a>Logstash é…ç½®å¤šä¸ªè¾“å…¥è¾“å‡ºæºâ…¡</h3><ul>
<li><p>å¦‚ä½•é…ç½®å¤šä¸ª input å—å’Œ output å—ï¼Ÿå¾ˆç®€å•çš„é—®é¢˜ï¼Œå¤šå†™å‡ ä¸ªé…ç½®æ–‡ä»¶å°±å¯ä»¥äº†ï¼š</p>
</li>
<li><h5 id="myTask-confï¼š"><a href="#myTask-confï¼š" class="headerlink" title="myTask.confï¼š"></a><code>myTask.conf</code>ï¼š</h5></li>
</ul>
<figure class="highlight puppet"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs puppet"><span class="hljs-comment"># Sample Logstash configuration for receiving</span><br><span class="hljs-comment"># UDP syslog messages over port 514</span><br><br><span class="hljs-keyword">input</span> &#123;<br>  jdbc &#123;<br>    <span class="hljs-attr">jdbc_driver_library</span> =&gt; <span class="hljs-string">&quot;D:\softWare\logstash\logstash-7.17.9\config\mysql-connector-java-8.0.29.jar&quot;</span><br>    <span class="hljs-attr">jdbc_driver_class</span> =&gt; <span class="hljs-string">&quot;com.mysql.jdbc.Driver&quot;</span><br>    <span class="hljs-attr">jdbc_connection_string</span> =&gt; <span class="hljs-string">&quot;jdbc:mysql://localhost:3306/memory_search&quot;</span><br>    <span class="hljs-attr">jdbc_user</span> =&gt; <span class="hljs-string">&quot;root&quot;</span><br>    <span class="hljs-attr">jdbc_password</span> =&gt; <span class="hljs-string">&quot;Dw990831&quot;</span><br>    <span class="hljs-attr">statement</span> =&gt; <span class="hljs-string">&quot;SELECT * from post where updateTime &gt; :sql_last_value and updateTime &lt; now() order by updateTime desc&quot;</span><br>    <span class="hljs-attr">use_column_value</span> =&gt; <span class="hljs-keyword">true</span><br>    <span class="hljs-attr">tracking_column_type</span> =&gt; <span class="hljs-string">&quot;timestamp&quot;</span><br>    <span class="hljs-attr">tracking_column</span> =&gt; <span class="hljs-string">&quot;updatetime&quot;</span><br>    <span class="hljs-attr">schedule</span> =&gt; <span class="hljs-string">&quot;*/5 * * * * *&quot;</span><br>    <span class="hljs-attr">jdbc_default_timezone</span> =&gt; <span class="hljs-string">&quot;Asia/Shanghai&quot;</span><br>  &#125;<br>&#125;<br><br><span class="hljs-keyword">filter</span> &#123;<br>  mutate &#123;<br>    <span class="hljs-attr">rename</span> =&gt; &#123;<br>      <span class="hljs-string">&quot;updatetime&quot;</span> =&gt; <span class="hljs-string">&quot;updateTime&quot;</span><br>      <span class="hljs-string">&quot;userid&quot;</span> =&gt; <span class="hljs-string">&quot;userId&quot;</span><br>      <span class="hljs-string">&quot;createtime&quot;</span> =&gt; <span class="hljs-string">&quot;createTime&quot;</span><br>      <span class="hljs-string">&quot;isdelete&quot;</span> =&gt; <span class="hljs-string">&quot;isDelete&quot;</span><br>    &#125;<br>    <span class="hljs-keyword">remove_field</span> =&gt; [<span class="hljs-string">&quot;thumbnum&quot;</span>, <span class="hljs-string">&quot;favournum&quot;</span>]<br>  &#125;<br>&#125;<br><br><span class="hljs-keyword">output</span> &#123;<br>  stdout &#123; <span class="hljs-attr">codec</span> =&gt; rubydebug &#125;<br>    <span class="hljs-keyword">elasticsearch</span> &#123;<br>    <span class="hljs-attr">hosts</span> =&gt; <span class="hljs-string">&quot;127.0.0.1:9200&quot;</span><br>    <span class="hljs-attr">index</span> =&gt; <span class="hljs-string">&quot;post_v1&quot;</span><br>    <span class="hljs-attr">document_id</span> =&gt; <span class="hljs-string">&quot;%&#123;id&#125;&quot;</span><br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<ul>
<li><code>myTask2.conf</code>ï¼š</li>
</ul>
<figure class="highlight puppet"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs puppet"><span class="hljs-keyword">input</span> &#123;<br>  jdbc &#123;<br>    <span class="hljs-attr">jdbc_driver_library</span> =&gt; <span class="hljs-string">&quot;D:\softWare\logstash\logstash-7.17.9\config\mysql-connector-java-8.0.29.jar&quot;</span><br>    <span class="hljs-attr">jdbc_driver_class</span> =&gt; <span class="hljs-string">&quot;com.mysql.jdbc.Driver&quot;</span><br>    <span class="hljs-attr">jdbc_connection_string</span> =&gt; <span class="hljs-string">&quot;jdbc:mysql://localhost:3306/memory_search&quot;</span><br>    <span class="hljs-attr">jdbc_user</span> =&gt; <span class="hljs-string">&quot;root&quot;</span><br>    <span class="hljs-attr">jdbc_password</span> =&gt; <span class="hljs-string">&quot;Dw990831&quot;</span><br>    <span class="hljs-attr">statement</span> =&gt; <span class="hljs-string">&quot;SELECT * from article where updateTime &gt; :sql_last_value and updateTime &lt; now() order by updateTime desc&quot;</span><br>    <span class="hljs-attr">use_column_value</span> =&gt; <span class="hljs-keyword">true</span><br>    <span class="hljs-attr">tracking_column_type</span> =&gt; <span class="hljs-string">&quot;timestamp&quot;</span><br>    <span class="hljs-attr">tracking_column</span> =&gt; <span class="hljs-string">&quot;updatetime&quot;</span><br>    <span class="hljs-attr">schedule</span> =&gt; <span class="hljs-string">&quot;*/5 * * * * *&quot;</span><br>    <span class="hljs-attr">jdbc_default_timezone</span> =&gt; <span class="hljs-string">&quot;Asia/Shanghai&quot;</span><br>  &#125;<br>&#125;<br><br><span class="hljs-keyword">filter</span> &#123;<br>  mutate &#123;<br>    <span class="hljs-attr">rename</span> =&gt; &#123;<br>      <span class="hljs-string">&quot;updatetime&quot;</span> =&gt; <span class="hljs-string">&quot;updateTime&quot;</span><br>      <span class="hljs-string">&quot;userid&quot;</span> =&gt; <span class="hljs-string">&quot;userId&quot;</span><br>      <span class="hljs-string">&quot;createtime&quot;</span> =&gt; <span class="hljs-string">&quot;createTime&quot;</span><br>      <span class="hljs-string">&quot;isdelete&quot;</span> =&gt; <span class="hljs-string">&quot;isDelete&quot;</span><br>    &#125;<br>    <span class="hljs-keyword">remove_field</span> =&gt; [<span class="hljs-string">&quot;thumbnum&quot;</span>, <span class="hljs-string">&quot;favournum&quot;</span>]<br>  &#125;<br>&#125;<br><br><span class="hljs-keyword">output</span> &#123;<br>  stdout &#123; <span class="hljs-attr">codec</span> =&gt; rubydebug &#125;<br>    <span class="hljs-keyword">elasticsearch</span> &#123;  <br>    <span class="hljs-attr">hosts</span> =&gt; [<span class="hljs-string">&quot;127.0.0.1:9200&quot;</span>]  <br>    <span class="hljs-attr">index</span> =&gt; <span class="hljs-string">&quot;article_v1&quot;</span>  <br>    <span class="hljs-attr">document_id</span> =&gt; <span class="hljs-string">&quot;%&#123;id&#125;&quot;</span>  <br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<ul>
<li>æ‰§è¡Œè¿™æ¡å‘½ä»¤å³å¯ï¼š</li>
</ul>
<figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs livescript">.<span class="hljs-string">\bin\logstash.bat</span> -f .<span class="hljs-string">\config\myTask.conf</span> -f .<span class="hljs-string">\config\myTask2.conf</span><br></code></pre></td></tr></table></figure>

<ul>
<li>æœ‰å…³ Logstash çš„é…ç½®ï¼Œè¿˜éœ€è¦æ›´å¤šäº†è§£ï¼Œç›®å‰çŸ¥è¯†æŒæ¡äº† MSQL å‘ ES çš„æ˜ å°„é…ç½®<strong>ï¼ˆ2023/11/16æ™šï¼‰</strong></li>
</ul>
<h3 id="Logstash-é…ç½®å¤šä¸ªè¾“å…¥è¾“å‡ºæºâ…¢"><a href="#Logstash-é…ç½®å¤šä¸ªè¾“å…¥è¾“å‡ºæºâ…¢" class="headerlink" title="Logstash é…ç½®å¤šä¸ªè¾“å…¥è¾“å‡ºæºâ…¢"></a>Logstash é…ç½®å¤šä¸ªè¾“å…¥è¾“å‡ºæºâ…¢</h3><blockquote>
<p>ğŸ– æ¨èé˜…è¯»ï¼š<a target="_blank" rel="noopener" href="http://www.51niux.com/?id=205">æŸ´å°‘çš„å®˜æ–¹ç½‘ç«™-Logstashå¤šé…ç½®æ–‡ä»¶å¯åŠ¨ï¼ˆäº”ï¼‰ (51niux.com)</a></p>
</blockquote>
<ul>
<li>ä»Šå¤©ä¸Šåˆï¼Œå‘ç°ä¹‹å‰çš„å‘½ä»¤å¹¶ä¸èƒ½å¤ŸåŒæ—¶åŠ è½½å¤šä¸ªé…ç½®æ–‡ä»¶ï¼Œç»è¿‡ä¸¤ä¸ªå°æ—¶çš„åŠªåŠ›ï¼Œç»ˆäºæ‰¾åˆ°äº†è§£å†³ä¹‹é“ï¼š</li>
<li>æˆ‘æŠŠæœ¬åœ°çš„ä¸¤ä¸ªé…ç½®æ–‡ä»¶ <code>myTask.conf</code> å’Œ <code>myTask.conf2</code> æ”¾åœ¨åŒä¸€ä¸ªæ–‡ä»¶å¤¹ä¸‹ <code>conf</code>ï¼š</li>
</ul>
<p><img src="https://gitee.com/deng-2022/pictures/raw/master/images/image-20231226111957531.png" alt="image-20231226111957531"></p>
<ul>
<li>æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">.\bin\logstash.bat -f .\config\conf<br></code></pre></td></tr></table></figure>

<ul>
<li>å¾ˆæ˜¾ç„¶ï¼Œä¸¤ä¸ªé…ç½®æ–‡ä»¶éƒ½è¢«æˆåŠŸåŠ è½½åˆ°äº†ï¼š<strong>ï¼ˆ2023/12/26æ—©ï¼‰</strong></li>
</ul>
<p><img src="https://gitee.com/deng-2022/pictures/raw/master/images/image-20231226112125543.png" alt="image-20231226112125543"></p>
<h2 id="æœç´¢å»ºè®®"><a href="#æœç´¢å»ºè®®" class="headerlink" title="æœç´¢å»ºè®®"></a>æœç´¢å»ºè®®</h2><ul>
<li>è¿˜éœ€è¦<strong>å®‰è£… suggestion æ’ä»¶</strong>ï¼Œè¿™é‡Œç»™å‡º demo ç¤ºä¾‹ä»£ç ï¼š</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs sql">POST post_v1<span class="hljs-operator">/</span>_search<br>&#123;<br>  &quot;query&quot; : &#123;<br>     &quot;match&quot;: &#123; &quot;content&quot;: &quot;å…¬å­™&quot; &#125;<br>  &#125;,<br>  &quot;suggest&quot; : &#123;<br>    &quot;my-suggestion&quot; : &#123;<br>      &quot;text&quot; : &quot;å…¬å­™&quot;,<br>      &quot;term&quot; : &#123;<br>        &quot;field&quot; : &quot;content&quot;<br>      &#125;<br>    &#125;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h2 id="ä¼˜åŒ–å›¾ç‰‡æœç´¢ä½“éªŒ"><a href="#ä¼˜åŒ–å›¾ç‰‡æœç´¢ä½“éªŒ" class="headerlink" title="ä¼˜åŒ–å›¾ç‰‡æœç´¢ä½“éªŒ"></a>ä¼˜åŒ–å›¾ç‰‡æœç´¢ä½“éªŒ</h2><ul>
<li>é¦–å…ˆä¼˜åŒ–æ‰§è¡Œå…³é”®è¯æ£€ç´¢åçš„åé¦ˆï¼š<strong>ï¼ˆ2023/11/16æ™šï¼‰</strong></li>
</ul>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs ts"><span class="hljs-keyword">if</span> (<span class="hljs-keyword">type</span> === <span class="hljs-string">&quot;post&quot;</span>) &#123;<br>    message.<span class="hljs-title function_">success</span>(<span class="hljs-string">&quot;æˆåŠŸæ£€ç´¢å‡ºæ‚¨æ„Ÿå…´è¶£çš„è¯—è¯~&quot;</span>)<br>  &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">type</span> === <span class="hljs-string">&quot;user&quot;</span>) &#123;<br>    message.<span class="hljs-title function_">success</span>(<span class="hljs-string">&quot;æˆåŠŸæ£€ç´¢å‡ºæ‚¨æ„Ÿå…´è¶£çš„ç”¨æˆ·~&quot;</span>)<br>  &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">type</span> === <span class="hljs-string">&quot;picture&quot;</span>) &#123;<br>    pictureList.<span class="hljs-property">value</span> = [];<br>    <span class="hljs-title function_">getImages</span>()<br>  &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">type</span> === <span class="hljs-string">&quot;article&quot;</span>) &#123;<br>    message.<span class="hljs-title function_">success</span>(<span class="hljs-string">&quot;æˆåŠŸæ£€ç´¢å‡ºæ‚¨æ„Ÿå…´è¶£çš„åšæ–‡~&quot;</span>)<br>  &#125;<br></code></pre></td></tr></table></figure>

<ul>
<li>æä¾›æ£€ç´¢å›¾ç‰‡çš„ä¸‹è½½åœ°å€ï¼Œç”¨æˆ·<strong>å¯ç›´æ¥å¤åˆ¶è¯¥åœ°å€</strong>ï¼š</li>
</ul>
<p><img src="https://gitee.com/deng-2022/pictures/raw/master/images/image-20231116220007316.png" alt="image-20231116220007316"></p>
<ul>
<li>åˆæ˜¯ç»å…¸çš„ç‚¹å‡»æŒ‰é’®åï¼Œ<strong>ä»…å±•ç¤ºæ‰€å±å¼¹çª—</strong>é—®é¢˜ï¼ˆ<strong>ç»‘å®šå”¯ä¸€å€¼</strong>ï¼Œè¿™é‡Œæ˜¯ idï¼‰ï¼š</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;!--ä¸‹è½½--&gt;<br>          &lt;div&gt;<br>            &lt;a-button @click=&quot;showModal(item.title)&quot; type=&quot;primary&quot; shape=&quot;round&quot;&gt;<br>              &lt;template #icon&gt;<br>                &lt;DownloadOutlined/&gt;<br>                Download<br>              &lt;/template&gt;<br>            &lt;/a-button&gt;<br>            &lt;a-modal v-model:visible=&quot;visible[item.title]&quot; title=&quot;Basic Modal&quot; @ok=&quot;handleOk(item.title)&quot;&gt;<br>              &lt;p&gt;&#123;&#123; item.url &#125;&#125;&lt;/p&gt;<br>            &lt;/a-modal&gt;<br>          &lt;/div&gt;<br></code></pre></td></tr></table></figure>

<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs ts"><span class="hljs-comment">// ç‚¹å‡»å¼¹çª—</span><br><span class="hljs-keyword">const</span> visible = <span class="hljs-title function_">ref</span>(&#123;&#125;)<br><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">showModal</span> = (<span class="hljs-params">id: <span class="hljs-built_in">any</span></span>) =&gt; &#123;<br>  visible.<span class="hljs-property">value</span>[id] = <span class="hljs-literal">true</span>;<br>&#125;;<br><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">handleOk</span> = (<span class="hljs-params">id: <span class="hljs-built_in">any</span></span>) =&gt; &#123;<br>  visible.<span class="hljs-property">value</span>[id] = <span class="hljs-literal">true</span>;<br>&#125;;<br></code></pre></td></tr></table></figure>

<ul>
<li>å°†æ¥å¼•å…¥ç¬¬ä¸‰æ–¹åº“ï¼Œå®ç°<strong>ä¸€é”®å¤åˆ¶å›¾ç‰‡åœ°å€åŠŸèƒ½</strong> <strong>ï¼ˆ2023/11/16æ™šï¼‰</strong></li>
</ul>
<h2 id="ä»£ç ä¼˜åŒ–ï¼Œåˆ é™¤å†—ä½™ä»£ç "><a href="#ä»£ç ä¼˜åŒ–ï¼Œåˆ é™¤å†—ä½™ä»£ç " class="headerlink" title="ä»£ç ä¼˜åŒ–ï¼Œåˆ é™¤å†—ä½™ä»£ç "></a>ä»£ç ä¼˜åŒ–ï¼Œåˆ é™¤å†—ä½™ä»£ç </h2><ul>
<li>å¹²æ‰æ‰€æœ‰ User ç›¸å…³ä»£ç </li>
<li>å¯ä»¥äº†ï¼Œä»£ç ç®—æ˜¯åˆ å¹²å‡€äº†</li>
<li>åç»­å‡ å‘¨å†…ä¼šé€æ­¥å¢åŠ è§†é¢‘èšåˆæœç´¢åŠŸèƒ½ï¼Œå¹¶é€æ­¥ä¸Šçº¿è¯¥é¡¹ç›®</li>
<li>é‚£ä¹ˆæ¥ä¸‹æ¥ï¼Œå°±æ˜¯ä¼˜åŒ– Memory API æ¥å£å¼€æ”¾å¹³å°äº†<strong>ï¼ˆ2023/11/18åˆï¼‰</strong></li>
</ul>
<h2 id="Kibana-ç›‘æ§é¢æ¿"><a href="#Kibana-ç›‘æ§é¢æ¿" class="headerlink" title="Kibana ç›‘æ§é¢æ¿"></a>Kibana ç›‘æ§é¢æ¿</h2><ul>
<li><p>å…¶å®æ²¡ä»€ä¹ˆå¥½è®²çš„ï¼Œä¸è¿‡è¿˜æ˜¯ç¨å¾®ä½“éªŒäº†ä¸€ä¸‹ï¼š</p>
</li>
<li><p>ç®€å•åœ°è®°å½•ä¸€ä¸‹å§ï¼š</p>
</li>
<li><h5 id="æ‰¾åˆ°ç›‘æ§çœ‹æ¿ï¼š"><a href="#æ‰¾åˆ°ç›‘æ§çœ‹æ¿ï¼š" class="headerlink" title="æ‰¾åˆ°ç›‘æ§çœ‹æ¿ï¼š"></a>æ‰¾åˆ°ç›‘æ§çœ‹æ¿ï¼š</h5></li>
</ul>
<p><img src="https://gitee.com/deng-2022/pictures/raw/master/images/image-20231203121821257.png" alt="image-20231203121821257"></p>
<ul>
<li><h5 id="åˆ›å»ºå¯è§†åŒ–çœ‹æ¿"><a href="#åˆ›å»ºå¯è§†åŒ–çœ‹æ¿" class="headerlink" title="åˆ›å»ºå¯è§†åŒ–çœ‹æ¿"></a>åˆ›å»ºå¯è§†åŒ–çœ‹æ¿</h5></li>
</ul>
<p><img src="https://gitee.com/deng-2022/pictures/raw/master/images/image-20231203122616094.png" alt="image-20231203122616094"></p>
<ul>
<li><h5 id="è¿›å…¥çœ‹æ¿ç®¡ç†é¡µé¢"><a href="#è¿›å…¥çœ‹æ¿ç®¡ç†é¡µé¢" class="headerlink" title="è¿›å…¥çœ‹æ¿ç®¡ç†é¡µé¢"></a>è¿›å…¥çœ‹æ¿ç®¡ç†é¡µé¢</h5></li>
</ul>
<p><img src="https://gitee.com/deng-2022/pictures/raw/master/images/image-20231203122622671.png" alt="image-20231203122622671"></p>
<ul>
<li><h5 id="æŸ¥çœ‹å·²åˆ›å»ºçš„çœ‹æ¿åˆ—è¡¨ï¼Œåˆ›å»ºæ–°çš„çœ‹æ¿"><a href="#æŸ¥çœ‹å·²åˆ›å»ºçš„çœ‹æ¿åˆ—è¡¨ï¼Œåˆ›å»ºæ–°çš„çœ‹æ¿" class="headerlink" title="æŸ¥çœ‹å·²åˆ›å»ºçš„çœ‹æ¿åˆ—è¡¨ï¼Œåˆ›å»ºæ–°çš„çœ‹æ¿"></a>æŸ¥çœ‹å·²åˆ›å»ºçš„çœ‹æ¿åˆ—è¡¨ï¼Œåˆ›å»ºæ–°çš„çœ‹æ¿</h5></li>
</ul>
<p><img src="https://gitee.com/deng-2022/pictures/raw/master/images/image-20231203122626820.png" alt="image-20231203122626820"></p>
<ul>
<li><h5 id="åˆ›å»ºæ–°çš„çœ‹æ¿"><a href="#åˆ›å»ºæ–°çš„çœ‹æ¿" class="headerlink" title="åˆ›å»ºæ–°çš„çœ‹æ¿"></a>åˆ›å»ºæ–°çš„çœ‹æ¿</h5></li>
</ul>
<blockquote>
<p>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p>çœ‹æ¿çš„å‘½åå¾ˆæœ‰æ„æ€ï¼Œ<strong>çœ‹æ¿çš„å‘½åå¿…é¡»è¦åŒ¹é…åˆ°å·²ç»åˆ›å»ºçš„ç´¢å¼•å</strong>ï¼Œè¿˜ä¸èƒ½é‡å¤ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼š</p>
<p><strong>æ¯ä¸ªç´¢å¼•åªå¯ä»¥åˆ›å»ºä¸€ä¸ªçœ‹æ¿</strong>ï¼Œè‡³å°‘æˆ‘ç›®å‰çš„çœ‹æ³•æ˜¯è¿™æ ·çš„<strong>ï¼ˆ2023/12/03åˆï¼‰</strong></p>
</blockquote>
<p><img src="https://gitee.com/deng-2022/pictures/raw/master/images/image-20231203122632293.png" alt="image-20231203122632293"></p>
<p><img src="https://gitee.com/deng-2022/pictures/raw/master/images/image-20231203122639112.png" alt="image-20231203122639112"></p>
<ul>
<li>åˆ›å»ºå¥½æ–°çš„çœ‹æ¿ä¹‹åï¼Œå°±å¯ä»¥å†æ¬¡è¿›å…¥ <code>DashBorad</code> ç•Œé¢äº†ï¼Œæˆ‘ä»¬åˆ›å»ºçš„å¯è§†åŒ–çœ‹æ¿å¯ä»¥æŠ•å…¥ä½¿ç”¨äº†</li>
<li>è¿™é‡Œ<strong>ç®€å•åœ°ä»‹ç»ä¸‹å„ä¸ªæ¿å—çš„ä½œç”¨</strong>å§ï¼Œå…¶ä»–æ²¡æœ‰ä»€ä¹ˆå¥½è®²çš„ï¼Œæœ‰æ—¶é—´ç©ç©å°±å¯ä»¥</li>
</ul>
<p><img src="https://gitee.com/deng-2022/pictures/raw/master/images/image-20231203123414249.png" alt="image-20231203123414249"></p>
<ul>
<li>ä½¿ç”¨ <code>Kibana</code> å¯è§†åŒ–ç›‘æ§çœ‹æ¿çš„æ•™ç¨‹åˆ°è¿™é‡Œå°±ç»“æŸäº†<strong>ï¼ˆ2023/12/03åˆï¼‰</strong></li>
</ul>
<h2 id="åšæ–‡æœç´¢ä¼˜åŒ–"><a href="#åšæ–‡æœç´¢ä¼˜åŒ–" class="headerlink" title="åšæ–‡æœç´¢ä¼˜åŒ–"></a>åšæ–‡æœç´¢ä¼˜åŒ–</h2><ul>
<li>ä»Šå¤©æ™šä¸Šï¼Œæ€»ç®—æŠ½å‡ºæ—¶é—´ï¼Œç€æ‰‹ä¼˜åŒ–ä¸€ä¸‹åšæ–‡æœç´¢è¿™ä¸€å¤§æ¿å—äº†ï¼š</li>
</ul>
<p><img src="https://gitee.com/deng-2022/pictures/raw/master/images/image-20231220234611498.png" alt="image-20231220234611498"></p>
<ul>
<li>é¡µé¢ä¼˜åŒ–å®Œæˆï¼šï¼ˆ2023/12/21æ™šï¼‰</li>
</ul>
<p><img src="https://gitee.com/deng-2022/pictures/raw/master/images/image-20231222000308888.png" alt="image-20231222000308888"></p>
<h3 id="Vue-å®ç°å¤–éƒ¨å¼•å…¥é¡µé¢ç»„ä»¶"><a href="#Vue-å®ç°å¤–éƒ¨å¼•å…¥é¡µé¢ç»„ä»¶" class="headerlink" title="Vue å®ç°å¤–éƒ¨å¼•å…¥é¡µé¢ç»„ä»¶"></a>Vue å®ç°å¤–éƒ¨å¼•å…¥é¡µé¢ç»„ä»¶</h3><ul>
<li>å¤–éƒ¨é¡µé¢ç»„ä»¶ <code>ArticleList</code> æºå¸¦å‚æ•°ï¼Œå‚æ•°åä¸º <code>compreList</code>ï¼Œå‚æ•°å€¼ä¸º <code>articleList</code></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;a-tabs v-model:activeKey=&quot;activeKey&quot; tab-position=&quot;left&quot;&gt;<br>        &lt;a-tab-pane key=&quot;1&quot; tab=&quot;ç»¼åˆ&quot;&gt;<br>          &lt;CompreArticleList :compre-list=&quot;articleList&quot;/&gt;<br>        &lt;/a-tab-pane&gt;<br>        &lt;a-tab-pane key=&quot;2&quot; tab=&quot;åç«¯&quot;&gt;<br>        ............................<br> &lt;/a-tabs&gt;<br></code></pre></td></tr></table></figure>

<ul>
<li>ç¼–å†™å†…éƒ¨ç»„ä»¶ <code>CompreArticleList</code>ï¼Œæ¥æ”¶å‚æ•° <code>compreList</code>ï¼Œä½¿ç”¨ <code>a-list</code>ç»„ä»¶å±•ç¤º</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs vue"> &lt;a-list<br>          class=&quot;demo-loadmore-list&quot;<br>          item-layout=&quot;horizontal&quot;<br>          :data-source=&quot;props.compreList&quot;<br>          style=&quot;width: 400%&quot;<br>      &gt;<br>  ................................<br>&lt;/a-list&gt;<br></code></pre></td></tr></table></figure>

<ul>
<li>æŒ‡æ˜æ¥æ”¶å‚æ•°å</li>
</ul>
<figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs tsx">&lt;script setup lang=<span class="hljs-string">&quot;ts&quot;</span>&gt;<br><span class="hljs-keyword">import</span> &#123;defineProps, withDefaults&#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;vue/dist/vue&quot;</span>;<br><br>..........................................<br><span class="hljs-keyword">interface</span> <span class="hljs-title class_">Props</span> &#123;<br>  <span class="hljs-attr">compreList</span>: <span class="hljs-built_in">any</span>[];<br>&#125;<br><br><span class="hljs-keyword">const</span> props = <span class="hljs-title function_">withDefaults</span>(defineProps&lt;<span class="hljs-title class_">Props</span>&gt;(), &#123;<br>  <span class="hljs-attr">compreList</span>: <span class="hljs-function">() =&gt;</span> [],<br>&#125;);<br><br>&lt;/script&gt;<br></code></pre></td></tr></table></figure>

<h2 id="çˆ¬å–æ˜é‡‘çƒ­æ¦œæ–‡ç« "><a href="#çˆ¬å–æ˜é‡‘çƒ­æ¦œæ–‡ç« " class="headerlink" title="çˆ¬å–æ˜é‡‘çƒ­æ¦œæ–‡ç« "></a>çˆ¬å–æ˜é‡‘çƒ­æ¦œæ–‡ç« </h2><ul>
<li>åŸºæœ¬å®Œæˆæ–‡ç« çˆ¬å–æµ‹è¯•</li>
</ul>
<h3 id="åˆ†ææ˜é‡‘çƒ­æ¦œåšæ–‡"><a href="#åˆ†ææ˜é‡‘çƒ­æ¦œåšæ–‡" class="headerlink" title="åˆ†ææ˜é‡‘çƒ­æ¦œåšæ–‡"></a>åˆ†ææ˜é‡‘çƒ­æ¦œåšæ–‡</h3><p><img src="https://gitee.com/deng-2022/pictures/raw/master/images/image-20231222125049450.png" alt="image-20231222125049450"></p>
<p><img src="https://gitee.com/deng-2022/pictures/raw/master/images/image-20231222125059824.png" alt="image-20231222125059824"></p>
<p><img src="https://gitee.com/deng-2022/pictures/raw/master/images/image-20231222125104035.png" alt="image-20231222125104035"></p>
<h3 id="ç¼–å†™çˆ¬è™«"><a href="#ç¼–å†™çˆ¬è™«" class="headerlink" title="ç¼–å†™çˆ¬è™«"></a>ç¼–å†™çˆ¬è™«</h3><ul>
<li>ä½¿ç”¨ Hutool å·¥å…·åº“ï¼Œå®ç° I/O çˆ¬è™«ï¼Œè·å–æ˜é‡‘çƒ­æ¦œä¸­çš„æ‰€æœ‰æ–‡ç«  idï¼š</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">void</span> <span class="hljs-title function_">getArticles</span><span class="hljs-params">()</span> &#123;<br>	<span class="hljs-comment">// æºå¸¦å‚æ•°ï¼Œå‘èµ·è¯·æ±‚ï¼Œè·å¾— json æ•°æ®</span><br>    <span class="hljs-type">String</span> <span class="hljs-variable">url</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;https://api.juejin.cn/content_api/v1/content/article_rank?category_id=6809637769959178254&amp;type=hot&amp;aid=2608&amp;uuid=7202969973525005828&amp;spider=0&quot;</span>;<br>    <span class="hljs-type">HttpRequest</span> <span class="hljs-variable">request</span> <span class="hljs-operator">=</span> HttpRequest.get(url);<br>    <span class="hljs-type">HttpResponse</span> <span class="hljs-variable">response</span> <span class="hljs-operator">=</span> request.execute();<br>    <span class="hljs-type">String</span> <span class="hljs-variable">json</span> <span class="hljs-operator">=</span> response.body();<br>    System.out.println(json);<br><br>    System.out.println(<span class="hljs-string">&quot;------------------------&quot;</span>);<br>		<br> <span class="hljs-comment">// ä½¿ç”¨ Jackson çš„ objectMapperï¼Œè§£æ json æ•°æ®</span><br>    <span class="hljs-type">ObjectMapper</span> <span class="hljs-variable">objectMapper</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectMapper</span>();<br>    <span class="hljs-type">JsonNode</span> <span class="hljs-variable">rootNode</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>    <span class="hljs-keyword">try</span> &#123;<br>        rootNode = objectMapper.readTree(json);<br>    &#125; <span class="hljs-keyword">catch</span> (JsonProcessingException e) &#123;<br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(e);<br>    &#125;<br><br>    <span class="hljs-type">JsonNode</span> <span class="hljs-variable">dataNode</span> <span class="hljs-operator">=</span> rootNode.get(<span class="hljs-string">&quot;data&quot;</span>);<br>    <span class="hljs-comment">// æ‹¿å–æ‰€æœ‰æ–‡ç«  id</span><br>    <span class="hljs-keyword">for</span> (JsonNode jsonNode : dataNode) &#123;<br>        <span class="hljs-type">JsonNode</span> <span class="hljs-variable">contentNode</span> <span class="hljs-operator">=</span> jsonNode.get(<span class="hljs-string">&quot;content&quot;</span>);<br>        <span class="hljs-type">String</span> <span class="hljs-variable">contentId</span> <span class="hljs-operator">=</span> contentNode.get(<span class="hljs-string">&quot;content_id&quot;</span>).asText();<br>        System.out.println(<span class="hljs-string">&quot;content_id: &quot;</span> + contentId);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<ul>
<li>æ‹¿åˆ°æ˜é‡‘æ–‡ç«  id åï¼Œä½¿ç”¨ <code>jsoup</code> åº“å‘èµ·è¯·æ±‚ï¼Œè·å– HTML æ–‡æ¡£ï¼Œå¹¶è§£æè·å¾—æ–‡ç« æ•°æ®ï¼š</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">getContents</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-comment">// 1. è·å–æ•°æ®, è·å– HTML æ–‡æ¡£</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">url</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;https://juejin.cn/post/7312376672665075722&quot;</span>;<br>        <span class="hljs-type">Document</span> <span class="hljs-variable">doc</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>        <span class="hljs-keyword">try</span> &#123;<br>            doc = Jsoup.connect(url)<br>                    .userAgent(<span class="hljs-string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/116.0.0.0 Safari/537.36 Edg/116.0.1938.81&quot;</span>)<br>                    .get();<br>        &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(e);<br>        &#125;<br><br>        <span class="hljs-comment">// è¾“å‡ºæ•´ä¸ª HTML æ–‡æ¡£</span><br>        <span class="hljs-comment">// System.out.println(doc);</span><br><br>	    <span class="hljs-comment">// CSS é€‰æ‹©å™¨è·å–æ•°æ®</span><br>        <span class="hljs-type">Elements</span> <span class="hljs-variable">title</span> <span class="hljs-operator">=</span> doc.select(<span class="hljs-string">&quot;title&quot;</span>);<br>        System.out.println(<span class="hljs-string">&quot;æ ¹æ®æ ‡ç­¾: &quot;</span> + title);<br><br>        <span class="hljs-type">Elements</span> <span class="hljs-variable">select</span> <span class="hljs-operator">=</span> doc.select(<span class="hljs-string">&quot;.article-area .article-title&quot;</span>);<br>        System.out.println(<span class="hljs-string">&quot;æ ¹æ® class: &quot;</span> + select);<br><br>        System.out.println(<span class="hljs-string">&quot;----------------------------------&quot;</span>);<br>        <span class="hljs-type">Element</span> <span class="hljs-variable">content</span> <span class="hljs-operator">=</span> doc.getElementById(<span class="hljs-string">&quot;article-root&quot;</span>);<br>        System.out.println(content);<br>    &#125;<br></code></pre></td></tr></table></figure>

<h3 id="çˆ¬å–ç»“æœ"><a href="#çˆ¬å–ç»“æœ" class="headerlink" title="çˆ¬å–ç»“æœ"></a>çˆ¬å–ç»“æœ</h3><p><img src="https://gitee.com/deng-2022/pictures/raw/master/images/image-20231222000216336.png" alt="image-20231222000216336"></p>
<p><img src="https://gitee.com/deng-2022/pictures/raw/master/images/image-20231222000231956.png" alt="image-20231222000231956"></p>
<ul>
<li>è®°å½•ä¸€ä¸‹æ—§çš„æ•°æ®ï¼š</li>
</ul>
<p><img src="https://gitee.com/deng-2022/pictures/raw/master/images/image-20231222215255379.png" alt="image-20231222215255379"></p>
<h3 id="ä¼˜åŒ–æ€è·¯"><a href="#ä¼˜åŒ–æ€è·¯" class="headerlink" title="ä¼˜åŒ–æ€è·¯"></a>ä¼˜åŒ–æ€è·¯</h3><ul>
<li>åšæ–‡æ¥æºï¼šçˆ¬å–æ˜é‡‘æ–‡ç« æ¦œ<strong>ï¼ˆ2023/12/20æ™šï¼‰</strong></li>
<li>ç›®å‰çœ‹æ¥æ¯ä¸ªæ–‡ç« ç±»åˆ«ä¸‹æœ‰ 20 ç¯‡æ–‡ç« ï¼Œé‚£å°±åˆ›å»ºä¸€å¼ è¡¨å§<ul>
<li>æŒ‰ç…§ç±»åˆ«ï¼Œå¯ä»¥å°†åšæ–‡ç®€å•åˆ†ç±»</li>
<li>èšåˆæœç´¢æ—¶ï¼Œé¢å¤–æ·»åŠ ä¸€ä¸ªæ¡ä»¶ï¼šæ ¹æ®æ–‡ç« ç±»åˆ«æŸ¥è¯¢åˆ°å¯¹åº”çš„åšæ–‡ï¼Œè¿™å°±éœ€è¦æŠŠå¯¹åšæ–‡çš„å…¨å±€æœç´¢æ¨è¿Ÿåˆ° <code>ArticleList</code> å®ç°äº†</li>
<li>æ•°æ®åŒæ­¥æ˜¯è¿™ä¸ªé¡¹ç›®çš„ä¸€å¤§äº®ç‚¹ï¼Œä½¿ç”¨ <code>Logstash</code> è¿›è¡Œæ•°æ®åŒæ­¥åœ¨æœ¬åœ°æµ‹è¯•å·²ç»å¾ˆæˆç†Ÿäº†ï¼Œå¯ä»¥è€ƒè™‘é‡‡ç”¨ <code>canal</code> æ–¹æ³•å®ç°</li>
<li>æœç´¢å»ºè®®å’Œå…³é”®è¯é«˜äº®ï¼Œè¿™ä¹Ÿè¯¥é¡¹ç›®çš„ä¸€å¤§äº®ç‚¹ï¼Œå¦‚æœèƒ½æˆåŠŸå®Œæˆå°±å¥½äº†</li>
<li>é™æµï¼Œå››ç§é™æµç®—æ³•ï¼Œå°±è¿™ä¹ˆä¸ªå°é¡¹ç›®ï¼Œè™½ç„¶è¿œä¸è‡³äºç”¨åˆ°é™æµï¼Œä½†æ˜¯å­¦ä¹ é™æµè¿˜æ˜¯å¾ˆæœ‰å¿…è¦çš„</li>
</ul>
</li>
<li>å†™ä¸€ä¸ªå®šæ—¶çˆ¬è™«ï¼Œå®šæ—¶çˆ¬å–å¹¶æ›´æ–°åšæ–‡æ•°æ®</li>
<li>å¼€å‘è€…æ–‡æ¡£ï¼šMemory-Tools å¼€å‘è€…æ–‡æ¡£ï¼Œè¿™ä¸ªæ–‡æ¡£çš„æˆåŠŸå¼€å‘éƒ¨ç½²ï¼Œä½¿å¾—è¿™ä¸ªå·¥ä½œå˜å¾—ç¨å¾®ç®€å•äº†ä¸€äº›</li>
</ul>
<h2 id="å­˜å‚¨æ•°æ®åº“ç¼–ç é”™è¯¯"><a href="#å­˜å‚¨æ•°æ®åº“ç¼–ç é”™è¯¯" class="headerlink" title="å­˜å‚¨æ•°æ®åº“ç¼–ç é”™è¯¯"></a>å­˜å‚¨æ•°æ®åº“ç¼–ç é”™è¯¯</h2><h3 id="é—®é¢˜å¼•å‡º"><a href="#é—®é¢˜å¼•å‡º" class="headerlink" title="é—®é¢˜å¼•å‡º"></a>é—®é¢˜å¼•å‡º</h3><ul>
<li>ä¿å­˜çš„å†…å®¹å­˜åœ¨å›¾æ ‡çš„æ—¶å€™ï¼š</li>
</ul>
<p><img src="https://gitee.com/deng-2022/pictures/raw/master/images/image-20231223221304769.png" alt="image-20231223221304769"></p>
<ul>
<li>ä¼šç›´æ¥æŠ¥é”™ï¼š</li>
</ul>
<figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs clean">org.springframework.jdbc.UncategorizedSQLException: <br>### Error updating database.  Cause: java.sql.SQLException: Incorrect string value: <span class="hljs-string">&#x27;\xF0\x9F\x8D\x84 \xE5...&#x27;</span> for column <span class="hljs-string">&#x27;content&#x27;</span> at row <span class="hljs-number">1</span><br>### The error may exist <span class="hljs-keyword">in</span> com/memory/search/mapper/ArticleMapper.java (best guess)<br>### The error may involve com.memory.search.mapper.ArticleMapper.insert-Inline<br></code></pre></td></tr></table></figure>

<p>è¿™æ˜¯å› ä¸ºä¿å­˜åˆ°æ•°æ®åº“ä¸­çš„å†…å®¹ä¸­ï¼ŒåŒ…å«äº†ä¸èƒ½æ­£ç¡®è§£ç çš„å†…å®¹ï¼Œ è¿™å°±æ˜¯<strong>ç›´æ¥ä¿å­˜</strong>ï¼Œè¯¦ç»†æƒ…å†µå¦‚ä¸‹ï¼š</p>
<h4 id="ç›´æ¥ä¿å­˜"><a href="#ç›´æ¥ä¿å­˜" class="headerlink" title="ç›´æ¥ä¿å­˜"></a>ç›´æ¥ä¿å­˜</h4><p>æ•°æ®åº“ä¸­ï¼Œæ–‡ç« å†…å®¹ content å­—æ®µå±æ€§ä¸º varcharï¼Œç”¨æ¥ä¿å­˜å­—ç¬¦ä¸²ï¼š<strong>ï¼ˆ2023/12/24æ—©ï¼‰</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * æ–‡ç« å†…å®¹</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">private</span> String content;<br></code></pre></td></tr></table></figure>

<p>çˆ¬å–åˆ°æ–‡ç« å†…å®¹ï¼Œç›´æ¥ä¿å­˜æ–‡ç« å†…å®¹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs java"> <span class="hljs-comment">// 1. è·å–æ•°æ®</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">url</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;https://juejin.cn/post/7313418992310976549&quot;</span>;<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-type">Document</span> <span class="hljs-variable">doc</span> <span class="hljs-operator">=</span> Jsoup.connect(url)<br>                    .userAgent(<span class="hljs-string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/116.0.0.0 Safari/537.36 Edg/116.0.1938.81&quot;</span>)<br>                    .get();<br><br><br>            <span class="hljs-type">Elements</span> <span class="hljs-variable">title</span> <span class="hljs-operator">=</span> doc.select(<span class="hljs-string">&quot;.article-area .article-title&quot;</span>);<br>            System.out.println(<span class="hljs-string">&quot;----------------åšæ–‡æ ‡é¢˜----------------&quot;</span>);<br>            System.out.println(title.text());<br><br>            <span class="hljs-type">Elements</span> <span class="hljs-variable">content</span> <span class="hljs-operator">=</span> doc.select(<span class="hljs-string">&quot;.article-viewer p&quot;</span>);<br>            <span class="hljs-comment">// for (Element p : content) &#123;</span><br>            <span class="hljs-comment">//     p.select(&quot;img&quot;).remove();</span><br>            <span class="hljs-comment">//     p.select(&quot;a&quot;).remove();</span><br>            <span class="hljs-comment">// &#125;</span><br><br>            System.out.println(<span class="hljs-string">&quot;---------------åšæ–‡æ­£æ–‡------------------&quot;</span>);<br>            <span class="hljs-comment">// System.out.println(content);</span><br><br>            <span class="hljs-type">byte</span>[] contentBytes = content.toString().getBytes(StandardCharsets.UTF_8);<br><br>            System.out.println(contentBytes);<br>            <span class="hljs-comment">// è·å–åšæ–‡</span><br>            <span class="hljs-type">Article</span> <span class="hljs-variable">article</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Article</span>();<br>            article.setId(Long.valueOf(<span class="hljs-string">&quot;7313418992310976549&quot;</span>));<br>            article.setTitle(title.text());<br>            <br>            <span class="hljs-comment">// ç›´æ¥ä¿å­˜</span><br>            article.setContent(content.toString());<br><br>            <span class="hljs-comment">// article.setContent(Arrays.toString(contentBytes));</span><br>            <span class="hljs-comment">// article.setContent(content.toString());</span><br>            article.setAuthorId(<span class="hljs-number">0L</span>);<br>            article.setView(<span class="hljs-number">0</span>);<br>            article.setLikes(<span class="hljs-number">0</span>);<br>            article.setComments(<span class="hljs-string">&quot;&quot;</span>);<br>            article.setCollects(<span class="hljs-number">0</span>);<br>            article.setTags(<span class="hljs-string">&quot;&quot;</span>);<br><br>            articleService.save(article);<br>        &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(e);<br>        &#125;<br>    &#125;<br>article.setContent(contentBytes);<br></code></pre></td></tr></table></figure>

<p>è¿™é‡Œç›´æ¥ä¿å­˜ï¼Œä¼šå‡ºç°å­—ç¬¦ç¼–ç æ— æ³•è¯†åˆ«è€Œè½¬æ¢é”™è¯¯ï¼Œå°±æ˜¯å› ä¸ºä¿å­˜çš„æ•°æ®è®°å½•ä¸­æœ‰ emoji è¿™æ ·çš„å°å›¾æ ‡</p>
<p>è¿™é‡Œæˆ‘ä¹ŸæŸ¥è¯¢äº†ç›¸å…³æ–‡ç« ï¼Œè§£å†³è¿™ä¸ªé—®é¢˜ï¼Œè™½ç„¶æœ€åæ²¡æœ‰è§£å†³ï¼Œä½†ä»å¯åšå‚è€ƒï¼š</p>
<blockquote>
<p>ğŸ”¥ æ¨èé˜…è¯»ï¼š</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_32684617/article/details/93495460">ç”¨æˆ·æ˜µç§°å«emojiè¡¨æƒ…ä¿å­˜åˆ°æ•°æ®åº“ä¸­æŠ¥é”™SQLException: Incorrect string value: â€˜\xF0\x9F\x91\xA7â€™ for colum n â€¦-CSDNåšå®¢</a></li>
<li><a target="_blank" rel="noopener" href="https://bbs.csdn.net/topics/392268222">javaåå°æ¥æ”¶è·å–å¾®ä¿¡æ˜µç§°ï¼Œæ˜µç§°åŒ…å«å°å›¾æ ‡ä¿å­˜åˆ°æ•°æ®åº“æŠ¥é”™-CSDNç¤¾åŒº</a></li>
</ul>
</blockquote>
<figure class="highlight subunit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs subunit"><span class="hljs-keyword">Error </span>updating database.  Cause: java.sql.SQLException: Incorrect string value: &#x27;\xF0\x9F\x8D\x84 \xE5...&#x27; for column &#x27;content&#x27; at row 1<br></code></pre></td></tr></table></figure>

<h4 id="è½¬äºŒè¿›åˆ¶æ•°ç»„ä¿å­˜"><a href="#è½¬äºŒè¿›åˆ¶æ•°ç»„ä¿å­˜" class="headerlink" title="è½¬äºŒè¿›åˆ¶æ•°ç»„ä¿å­˜"></a>è½¬äºŒè¿›åˆ¶æ•°ç»„ä¿å­˜</h4><p>ä¿å­˜æ•°æ®çš„æ—¶å€™ï¼Œå…ˆè½¬ç ä¿å­˜ï¼ˆè½¬ä¸º<strong>äºŒè¿›åˆ¶å­—ç¬¦æ•°ç»„</strong>ï¼‰ï¼Œå–å‡ºæ•°æ®çš„æ—¶å€™ï¼Œè§£ç åå†ä½¿ç”¨ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"> <span class="hljs-type">byte</span>[] contentBytes = content.toString().getBytes(StandardCharsets.UTF_8);<br> <span class="hljs-comment">// è·å–åšæ–‡</span><br> <span class="hljs-type">Article</span> <span class="hljs-variable">article</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Article</span>();<br> article.setId(Long.valueOf(<span class="hljs-string">&quot;7313418992310976549&quot;</span>));<br> article.setTitle(title.text());<br> article.setContent(Arrays.toString(contentBytes));<br> article.setAuthorId(<span class="hljs-number">0L</span>);<br> article.setView(<span class="hljs-number">0</span>);<br> article.setLikes(<span class="hljs-number">0</span>);<br> article.setComments(<span class="hljs-string">&quot;&quot;</span>);<br> article.setCollects(<span class="hljs-number">0</span>);<br> article.setTags(<span class="hljs-string">&quot;&quot;</span>);<br><br>articleService.save(article);<br><br><span class="hljs-type">String</span> <span class="hljs-variable">decodedContent</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>(contentBytes, StandardCharsets.UTF_8);<br>System.out.println(<span class="hljs-string">&quot;-------------è§£ç å--------------&quot;</span>);<br>System.out.println(decodedContent);<br></code></pre></td></tr></table></figure>

<p><img src="https://gitee.com/deng-2022/pictures/raw/master/images/image-20240213223752469.png" alt="image-20240213223752469"></p>
<p>ä¿å­˜åˆ°æ•°æ®åº“ä¸­çš„é—®é¢˜è§£å†³äº†ï¼Œæ¥ä¸‹æ¥å°±æ˜¯ä¿è¯æ­£ç¡®ä»æ•°æ®åº“ä¸­æ‹¿åˆ°æ•°æ®å¹¶è§£ç å‡ºåŸæ•°æ®ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">String</span> <span class="hljs-variable">contentStr</span> <span class="hljs-operator">=</span> article.getContent();<br><span class="hljs-type">byte</span>[] contentBytes = contentStr.getBytes(StandardCharsets.UTF_8);<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// ç§»é™¤ä¸¤ç«¯çš„æ–¹æ‹¬å·  </span><br><span class="hljs-type">String</span> <span class="hljs-variable">contentStrWithoutBrackets</span> <span class="hljs-operator">=</span> contentStr.substring(<span class="hljs-number">1</span>, contentStr.length() - <span class="hljs-number">1</span>);  <br><span class="hljs-comment">// ä½¿ç”¨é€—å·ä½œä¸ºåˆ†éš”ç¬¦åˆ†å‰²å­—ç¬¦ä¸²  </span><br>String[] byteStrs = contentStrWithoutBrackets.split(<span class="hljs-string">&quot;,&quot;</span>);  <br><span class="hljs-comment">// å°†å­—ç¬¦ä¸²æ•°ç»„è½¬æ¢ä¸ºå­—èŠ‚æ•°ç»„  </span><br><span class="hljs-type">byte</span>[] contentBytes = <span class="hljs-keyword">new</span> <span class="hljs-title class_">byte</span>[byteStrs.length];  <br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; byteStrs.length; i++) &#123;  <br>    contentBytes[i] = Byte.parseByte(byteStrs[i]);  <br>&#125;<br></code></pre></td></tr></table></figure>

<p>ç»å°è¯•ï¼Œä»¥ä¸Šæ–¹æ³•å¹¶ä¸èƒ½æˆåŠŸå°†ä¿å­˜åˆ°æ•°æ®åº“ä¸­çš„äºŒè¿›åˆ¶æ•°ç»„æˆåŠŸè§£ç æˆåŸæ–‡ç« å­—ç¬¦ä¸²ï¼Œè§£ç å¤±è´¥</p>
<p>æˆ‘ä»¬ä¿å­˜äºŒè¿›åˆ¶æ•°ç»„åˆ°æ•°æ®åº“ä¸­ï¼ŒæˆåŠŸé¿å…äº† emoji è¡¨æƒ…è½¬ç ä¿å­˜å¤±è´¥çš„é—®é¢˜ï¼Œä½†æ˜¯è¿™æ ·å­˜å…¥æ•°æ®åº“ï¼Œå–å‡ºæ—¶å°±ä¸å¥½å¤„ç†äº†</p>
<p>å¦‚ä¸Šï¼Œå¯¹ byte [] ç›´æ¥è§£ç æ˜¯å¯ä»¥è·å–åŸæ–‡å†…å®¹ content çš„ï¼Œé‚£å°±å¹²è„†ç›´æ¥ä¿å­˜ byte [] åˆ°æ•°æ®åº“ä¸­äº†ï¼Œæ”¹å˜å­—æ®µ content å±æ€§ä¸º blobï¼š</p>
<p><img src="https://gitee.com/deng-2022/pictures/raw/master/images/image-20231224104321929.png" alt="image-20231224104321929"></p>
<ul>
<li>æ”¹å˜å¯¹åº”å®ä½“ç±»çš„å­—æ®µæ•°æ®ç±»å‹ä¸º byte []ï¼š</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * æ–‡ç« å†…å®¹</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">private</span> <span class="hljs-type">byte</span>[] content;<br></code></pre></td></tr></table></figure>

<ul>
<li>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬é€‰æ‹©ç›´æ¥ä¿å­˜ byte [] åˆ°æ•°æ®åº“ä¸­å³å¯ï¼š</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">article.setContent(contentBytes);<br></code></pre></td></tr></table></figure>

<p>è¿™é‡Œä¹Ÿå¯ä»¥çœ‹å‡ºï¼Œå°† byte [] è½¬å­—ç¬¦ä¸²æ•°ç»„åä¿å­˜å’Œç›´æ¥ä¿å­˜ byte [] åˆ°æ•°æ®åº“ä¸­çš„å½¢å¼æ˜¯å¾ˆä¸ä¸€æ ·çš„ï¼ˆå¦‚ä¸‹å›¾æ‰€ç¤ºï¼‰ï¼š</p>
<p><img src="https://gitee.com/deng-2022/pictures/raw/master/images/image-20231224104532681.png" alt="image-20231224104532681"></p>
<ul>
<li>æ”¹å˜æ•°æ®åº“å­—ç¬¦é›†ä¸€ç‚¹éƒ½ä¸å¥½ä½¿ï¼š<strong>ï¼ˆ2023/12/23æ™šï¼‰</strong></li>
</ul>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_32684617/article/details/93495460">ç”¨æˆ·æ˜µç§°å«emojiè¡¨æƒ…ä¿å­˜åˆ°æ•°æ®åº“ä¸­æŠ¥é”™SQLException: Incorrect string value: â€˜\xF0\x9F\x91\xA7â€™ for colum n â€¦-CSDNåšå®¢</a></p>
<p><a target="_blank" rel="noopener" href="https://bbs.csdn.net/topics/392268222">javaåå°æ¥æ”¶è·å–å¾®ä¿¡æ˜µç§°ï¼Œæ˜µç§°åŒ…å«å°å›¾æ ‡ä¿å­˜åˆ°æ•°æ®åº“æŠ¥é”™-CSDNç¤¾åŒº</a></p>
</blockquote>
<h4 id="ç›´æ¥ä¿å­˜äºŒè¿›åˆ¶"><a href="#ç›´æ¥ä¿å­˜äºŒè¿›åˆ¶" class="headerlink" title="ç›´æ¥ä¿å­˜äºŒè¿›åˆ¶"></a>ç›´æ¥ä¿å­˜äºŒè¿›åˆ¶</h4><p>ç»ˆäºè§£å†³äº†å¦‚ä½•æ­£ç¡®ä¿å­˜å« <code>emoji</code> è¡¨æƒ…æ•°æ®åˆ°æ•°æ®åº“ä¸­çš„é—®é¢˜äº†</p>
<p>ç»è¿‡è¯¸å¤šå°è¯•ï¼Œä»æ— æ³•æ­£ç¡®è§£ç ä¿å­˜ emoji è¡¨æƒ…ï¼Œç»è¿‡æµ‹è¯•ï¼Œè½¬ç ä¿å­˜è§£å†³æŠ¥é”™ï¼š<strong>ï¼ˆ2023/12/24æ—©ï¼‰</strong></p>
<p>ç»è¿‡å‰é¢çš„æµ‹è¯•å‘ç°ï¼Œè½¬ç åä¿å­˜ byte [] å¯ä»¥è§£å†³ç¼–ç é”™è¯¯ï¼Œé—®é¢˜æ˜¯å‡ºåœ¨ä¿å­˜æ•°æ®åº“æ—¶</p>
<p>ç”±äºå­—æ®µ content ä¸º textï¼ˆvarchar ä¹Ÿå¯ä»¥ï¼Œå¯èƒ½ä¼šå‡ºç°è¦ä¿å­˜çš„æ•°æ®è®°å½•è¿‡é•¿è€Œå¯¼è‡´æº¢å‡ºï¼Œå°±é€‰æ‹© text äº†ï¼‰ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨ä¿å­˜ byte [] åˆ°æ•°æ®åº“ä¸­æ—¶ï¼Œæ˜¯å…ˆè½¬æ¢æˆå­—ç¬¦ä¸²å†ä¿å­˜çš„</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">article.setContent(Arrays.toString(contentBytes));<br></code></pre></td></tr></table></figure>

<p>çˆ¬å–æ–‡ç« ï¼Œè·å–æ ‡é¢˜å’Œå†…å®¹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">Document</span> <span class="hljs-variable">doc</span> <span class="hljs-operator">=</span> Jsoup.connect(url)<br>                    .userAgent(<span class="hljs-string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/116.0.0.0 Safari/537.36 Edg/116.0.1938.81&quot;</span>)<br>                    .get();<br><br><br><span class="hljs-type">Elements</span> <span class="hljs-variable">title</span> <span class="hljs-operator">=</span> doc.select(<span class="hljs-string">&quot;.article-area .article-title&quot;</span>);<br>System.out.println(<span class="hljs-string">&quot;----------------åšæ–‡æ ‡é¢˜----------------&quot;</span>);<br>System.out.println(title.text());<br><br><span class="hljs-type">Elements</span> <span class="hljs-variable">content</span> <span class="hljs-operator">=</span> doc.select(<span class="hljs-string">&quot;.article-viewer p&quot;</span>);<br><span class="hljs-comment">// for (Element p : content) &#123;</span><br><span class="hljs-comment">//     p.select(&quot;img&quot;).remove();</span><br><span class="hljs-comment">//     p.select(&quot;a&quot;).remove();</span><br><span class="hljs-comment">// &#125;</span><br><br>System.out.println(<span class="hljs-string">&quot;---------------åšæ–‡æ­£æ–‡------------------&quot;</span>);<br><span class="hljs-comment">// System.out.println(content);</span><br><br><span class="hljs-type">byte</span>[] contentBytes = content.toString().getBytes(StandardCharsets.UTF_8);<br></code></pre></td></tr></table></figure>

<p>å°†æ–‡ç« å†…å®¹è½¬äºŒè¿›åˆ¶åï¼Œä¿å­˜è‡³æ•°æ®åº“ä¸­ï¼š</p>
<p><img src="https://gitee.com/deng-2022/pictures/raw/master/images/image-20240213224057166.png" alt="image-20240213224057166"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * æ–‡ç« å†…å®¹</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">private</span> <span class="hljs-type">byte</span>[] content;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// è·å–åšæ–‡</span><br><span class="hljs-type">Article</span> <span class="hljs-variable">article</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Article</span>();<br>article.setTitle(title.text());<br>article.setContent(contentBytes);<br><span class="hljs-comment">// article.setContent(Arrays.toString(contentBytes));</span><br><span class="hljs-comment">// article.setContent(content.toString());</span><br>article.setAuthorId(<span class="hljs-number">0L</span>);<br>article.setView(<span class="hljs-number">0</span>);<br>article.setLikes(<span class="hljs-number">0</span>);<br>article.setComments(<span class="hljs-string">&quot;&quot;</span>);<br>article.setCollects(<span class="hljs-number">0</span>);<br>article.setTags(<span class="hljs-string">&quot;&quot;</span>);<br><br>articleService.save(article);<br></code></pre></td></tr></table></figure>

<p>å¦‚ä¸‹ï¼ŒæˆåŠŸä¿å­˜æ–‡ç« å†…å®¹è‡³ MySQL æ•°æ®åº“ä¸­ï¼š</p>
<p><img src="https://gitee.com/deng-2022/pictures/raw/master/images/image-20240213224145889.png" alt="image-20240213224145889"></p>
<p>å¦‚éœ€è·å–æ–‡ç« æ•°æ®ï¼Œå–å‡ºäºŒè¿›åˆ¶æ•°ç»„åï¼Œæ˜¯å¯ä»¥ç›´æ¥è§£ç è·å–åŸæ–‡çš„ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">String</span> <span class="hljs-variable">decodedContent</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>(contentBytes, StandardCharsets.UTF_8);<br>            System.out.println(<span class="hljs-string">&quot;-------------è§£ç å--------------&quot;</span>);<br>            System.out.println(decodedContent);<br></code></pre></td></tr></table></figure>

<p><img src="https://gitee.com/deng-2022/pictures/raw/master/images/image-20231224104703715.png" alt="image-20231224104703715"></p>
<ul>
<li>æ¥ä¸‹æ¥ï¼Œå°±å¯ä»¥ç›´æ¥ä»æ•°æ®åº“ä¸­å–å‡ºæ•°æ®å¹¶è§£ç äº†ï¼š</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">Article</span> <span class="hljs-variable">article</span> <span class="hljs-operator">=</span> articleService.getById(<span class="hljs-number">7313418992310976549L</span>);<br><br><span class="hljs-type">Long</span> <span class="hljs-variable">id</span> <span class="hljs-operator">=</span> article.getId();<br><span class="hljs-type">String</span> <span class="hljs-variable">title</span> <span class="hljs-operator">=</span> article.getTitle();<br><span class="hljs-type">byte</span>[] content = article.getContent();<br><br><span class="hljs-type">String</span> <span class="hljs-variable">decodedContent</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>(content, StandardCharsets.UTF_8);<br><span class="hljs-type">Integer</span> <span class="hljs-variable">type</span> <span class="hljs-operator">=</span> article.getType();<br><br>System.out.println(id);<br>System.out.println(title);<br>System.out.println(decodedContent);<br>System.out.println(type);<br></code></pre></td></tr></table></figure>

<ul>
<li>è§£ç ç»“æœå¦‚ä¸‹ï¼š</li>
</ul>
<p><img src="https://gitee.com/deng-2022/pictures/raw/master/images/image-20231224104725599.png" alt="image-20231224104725599"></p>
<ul>
<li>è‡³æ­¤ï¼Œæˆ‘ä»¬æˆåŠŸè§£å†³äº†å¦‚ä½•æ­£ç¡®ä¿å­˜æ•°æ®è®°å½•åˆ°æ•°æ®åº“ä¸­çš„é—®é¢˜ï¼Œå¹¶æˆåŠŸè§£å†³äº†ç¼–ç é—®é¢˜<strong>ï¼ˆ2023/12/24åˆï¼‰</strong></li>
</ul>
<h3 id="å‰ç«¯åç»­"><a href="#å‰ç«¯åç»­" class="headerlink" title="å‰ç«¯åç»­"></a>å‰ç«¯åç»­</h3><ul>
<li>è¿™ä¹ˆä¸€æ”¹ï¼Œå‰ç«¯æŠ¥é”™äº†ï¼š</li>
</ul>
<p><img src="C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20231224164743797.png" alt="image-20231224164743797"></p>
<ul>
<li>åŸå› æ˜¯æ‹¿åˆ°çš„ content å­—æ®µå€¼æ— æ³•è§£æï¼Œé‚£æˆ‘ä»¬å°†å®ä½“ç±» ArticleDTO çš„ content å±æ€§ç±»å‹ä»è®¾ä¸º Stringï¼š</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * æ–‡ç« å†…å®¹</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">private</span> String content;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">   * articleVO ä¸º articleVO</span><br><span class="hljs-comment">   *</span><br><span class="hljs-comment">   * <span class="hljs-doctag">@param</span> article article</span><br><span class="hljs-comment">   * <span class="hljs-doctag">@return</span> articleVO</span><br><span class="hljs-comment">   */</span><br>  <span class="hljs-keyword">public</span> ArticleVO <span class="hljs-title function_">getArticleVOByArticle</span><span class="hljs-params">(Article article)</span> &#123;<br>      <span class="hljs-type">ArticleVO</span> <span class="hljs-variable">articleVO</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArticleVO</span>();<br><br>      articleVO.setId(article.getId());<br>      articleVO.setTitle(article.getTitle());<br>      articleVO.setDescription(article.getDescription());<br><br>      <span class="hljs-type">byte</span>[] contentBytes = article.getContent();<br>      <span class="hljs-type">String</span> <span class="hljs-variable">content</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>(contentBytes, StandardCharsets.UTF_8);<br>      articleVO.setContent(content);<br>      <br>      ..........................<br></code></pre></td></tr></table></figure>

<h3 id="ç¼–ç ä¸ä¸€è‡´-ES-åŒæ­¥å¤±è´¥"><a href="#ç¼–ç ä¸ä¸€è‡´-ES-åŒæ­¥å¤±è´¥" class="headerlink" title="ç¼–ç ä¸ä¸€è‡´ ES åŒæ­¥å¤±è´¥"></a>ç¼–ç ä¸ä¸€è‡´ ES åŒæ­¥å¤±è´¥</h3><ul>
<li>ä»–çˆ·çˆ·çš„ï¼ŒåŒæ­¥ MySQL å’Œ ES æ•°æ®çš„æ—¶å€™åˆå‡ºç°äº†é—®é¢˜ï¼Œæˆ‘è¿˜å¾—æå¦‚ä½•åœ¨ ES ä¸­å­˜å‚¨ byte [] æ•°æ®ï¼š</li>
</ul>
<p><img src="https://gitee.com/deng-2022/pictures/raw/master/images/image-20231224161918436.png" alt="image-20231224161918436"></p>
<ul>
<li>é‚£å°±é‡æ–°åˆ›å»ºä¸€ä¸ªç´¢å¼•ï¼Œèƒ½å¤Ÿä½¿ content å­—æ®µå­˜æ”¾äºŒè¿›åˆ¶è®°å½•ï¼š<strong>ï¼ˆ2023/12/24æ™šï¼‰</strong></li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs sql">PUT <span class="hljs-operator">/</span>article_v3<br>&#123;  <br>  &quot;mappings&quot;: &#123;<br>    &quot;properties&quot;: &#123;  <br>    &quot;title&quot;: &#123;  <br>      &quot;type&quot;: &quot;text&quot;,  <br>      &quot;analyzer&quot;: &quot;ik_max_word&quot;,  <br>      &quot;search_analyzer&quot;: &quot;ik_smart&quot;,  <br>      &quot;fields&quot;: &#123;  <br>        &quot;keyword&quot;: &#123;  <br>          &quot;type&quot;: &quot;keyword&quot;,  <br>          &quot;ignore_above&quot;: <span class="hljs-number">256</span>  <br>        &#125;,  <br>        &quot;suggest&quot;: &#123;  <br>          &quot;type&quot;: &quot;completion&quot;,  <br>          &quot;analyzer&quot;: &quot;ik_max_word&quot;  <br>        &#125;  <br>      &#125;  <br>    &#125;,  <br>    &quot;content&quot;: &#123;  <br>      &quot;type&quot;: &quot;binary&quot;,  <br>      &quot;fields&quot;: &#123;  <br>        &quot;suggest&quot;: &#123;  <br>          &quot;type&quot;: &quot;completion&quot;,  <br>          &quot;analyzer&quot;: &quot;ik_max_word&quot;  <br>        &#125;  <br>      &#125;  <br>    &#125;  <br>  &#125;  <br>  &#125; <br>&#125;<br></code></pre></td></tr></table></figure>

<ul>
<li>å¦ˆçš„ï¼Œæ‰§è¡Œä¸€æ¬¡æŸ¥è¯¢åï¼ŒES åˆæŠ¥é”™ï¼š</li>
</ul>
<p><img src="C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20231224170549612.png" alt="image-20231224170549612"></p>
<ul>
<li>è¿™æ˜¯ä»€ä¹ˆé—®é¢˜ï¼ŸES ä¸­ article_v4 ç´¢å¼•ä¸­çš„å­—æ®µ content æ˜¯ <code>binary</code> å±æ€§ï¼Œè€ŒäºŒè¿›åˆ¶æ•°æ®æ˜¯ä¸æ”¯æŒ <code>match queries</code> ç­›é€‰æ“ä½œçš„ï¼š</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// æŒ‰å…³é”®è¯æ£€ç´¢ æ»¡è¶³å…¶ä¸€ âˆš</span><br>       <span class="hljs-keyword">if</span> (StringUtils.isNotBlank(searchText)) &#123;<br>           boolQueryBuilder.should(QueryBuilders.matchQuery(<span class="hljs-string">&quot;title&quot;</span>, searchText));<br>           boolQueryBuilder.should(QueryBuilders.matchQuery(<span class="hljs-string">&quot;description&quot;</span>, searchText));<br>           boolQueryBuilder.should(QueryBuilders.matchQuery(<span class="hljs-string">&quot;content&quot;</span>, searchText));<br>           boolQueryBuilder.minimumShouldMatch(<span class="hljs-number">1</span>);<br>       &#125;<br></code></pre></td></tr></table></figure>

<ul>
<li>åœ¨ç¼–å†™ DSL è¯­å¥æ’å…¥æ–°ç´¢å¼•æ—¶ä¹Ÿä¸èƒ½å¯¹ binary å±æ€§çš„å­—æ®µæ·»åŠ  <code>analyzer</code> å’Œ <code>search_analyzer</code>ï¼š</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs sql">&quot;content&quot;: &#123;  <br>  &quot;type&quot;: &quot;binary&quot;,  <br>  &quot;analyzer&quot;: &quot;ik_max_word&quot;,  <br>  &quot;search_analyzer&quot;: &quot;ik_smart&quot;,  <br>  &quot;fields&quot;: &#123;  <br>    &quot;suggest&quot;: &#123;  <br>      &quot;type&quot;: &quot;completion&quot;,  <br>      &quot;analyzer&quot;: &quot;ik_max_word&quot;  <br>    &#125;  <br>  &#125;  <br>&#125; <br></code></pre></td></tr></table></figure>

<ul>
<li>é‚£æˆ‘ä¸æäº†ï¼ŒåŒæ­¥åšæ–‡æ•°æ®æ—¶ï¼Œä¸åŒæ­¥ content å­—æ®µäº†ï¼Œä½¿ç”¨ ES æŸ¥è¯¢åˆ° idï¼Œå†æ‹¿ id å»æŸ¥è¯¢æ•°æ®åº“å°±è¡Œäº†</li>
</ul>
<h2 id="æœç´¢å»ºè®®-1"><a href="#æœç´¢å»ºè®®-1" class="headerlink" title="æœç´¢å»ºè®®"></a>æœç´¢å»ºè®®</h2><h3 id="åç«¯-3"><a href="#åç«¯-3" class="headerlink" title="åç«¯"></a>åç«¯</h3><ul>
<li>æ–°å¢ç´¢å¼•ï¼Œç‰¹åˆ«æŒ‡å®š <code>title</code> å­—æ®µæ”¯æŒ <code>suggest</code> æœç´¢è¯å»ºè®®ï¼š<strong>ï¼ˆ2023/12/24æ™šï¼‰</strong></li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs sql">PUT <span class="hljs-operator">/</span>article_v4<br>&#123;  <br>  &quot;mappings&quot;: &#123;  <br>    &quot;properties&quot;: &#123;  <br>      &quot;title&quot;: &#123;  <br>        &quot;type&quot;: &quot;text&quot;,  <br>        &quot;analyzer&quot;: &quot;ik_max_word&quot;,  <br>        &quot;search_analyzer&quot;: &quot;ik_smart&quot;,  <br>        &quot;fields&quot;: &#123;  <br>          &quot;keyword&quot;: &#123;  <br>            &quot;type&quot;: &quot;keyword&quot;,  <br>            &quot;ignore_above&quot;: <span class="hljs-number">256</span>  <br>          &#125;,  <br>          &quot;suggest&quot;: &#123;    <br>            &quot;type&quot;: &quot;completion&quot;,   <br>            &quot;analyzer&quot;: &quot;ik_max_word&quot;    <br>          &#125;  <br>        &#125;  <br>      &#125;<br>    &#125;  <br>  &#125;  <br>&#125;<br></code></pre></td></tr></table></figure>

<ul>
<li>ä½¿ç”¨ <code>Logstash</code> åŒæ­¥ <code>MySQL</code> å’Œ <code>ES</code>ï¼Œè¯¥å†™æ•°æ®åŒæ­¥é…ç½®æ–‡ä»¶ï¼ˆæ’é™¤ <code>content</code> å­—æ®µï¼‰ï¼Œå¼€å¯æ•°æ®åŒæ­¥ï¼š</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">filter</span> &#123;<br>  mutate &#123;<br>    rename <span class="hljs-operator">=</span><span class="hljs-operator">&gt;</span> &#123;<br>      &quot;updatetime&quot; <span class="hljs-operator">=</span><span class="hljs-operator">&gt;</span> &quot;updateTime&quot;<br>      &quot;userid&quot; <span class="hljs-operator">=</span><span class="hljs-operator">&gt;</span> &quot;userId&quot;<br>      &quot;createtime&quot; <span class="hljs-operator">=</span><span class="hljs-operator">&gt;</span> &quot;createTime&quot;<br>      &quot;isdelete&quot; <span class="hljs-operator">=</span><span class="hljs-operator">&gt;</span> &quot;isDelete&quot;<br>    &#125;<br>    remove_field <span class="hljs-operator">=</span><span class="hljs-operator">&gt;</span> [&quot;thumbnum&quot;, &quot;favournum&quot;,&quot;content&quot;]<br>  &#125;<br>&#125;<br><br>output &#123;<br>  stdout &#123; codec <span class="hljs-operator">=</span><span class="hljs-operator">&gt;</span> rubydebug &#125;<br>    elasticsearch &#123;  <br>    hosts <span class="hljs-operator">=</span><span class="hljs-operator">&gt;</span> [&quot;127.0.0.1:9200&quot;]  <br>    index <span class="hljs-operator">=</span><span class="hljs-operator">&gt;</span> &quot;article_v4&quot;  <br>    document_id <span class="hljs-operator">=</span><span class="hljs-operator">&gt;</span> &quot;%&#123;id&#125;&quot;  <br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<ul>
<li>é…ç½®æœç´¢å»ºè®®</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Resource</span><br>  <span class="hljs-keyword">private</span> ElasticsearchRestTemplate elasticsearchRestTemplate;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// æœç´¢å»ºè®®</span><br>        <span class="hljs-type">SuggestBuilder</span> <span class="hljs-variable">suggestBuilder</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SuggestBuilder</span>()<br>                .addSuggestion(<span class="hljs-string">&quot;suggestionTitle&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">CompletionSuggestionBuilder</span>(<span class="hljs-string">&quot;title.suggest&quot;</span>).skipDuplicates(<span class="hljs-literal">true</span>).size(<span class="hljs-number">5</span>).prefix(searchText));<br></code></pre></td></tr></table></figure>

<ul>
<li>æ³¨æ„ï¼Œè¿™é‡Œçš„æœç´¢å»ºè®®é…ç½®è·Ÿè¿™æ¡ DSL è¯­å¥æ˜¯å¯¹åº”çš„ï¼š</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">GET</span> article_v4<span class="hljs-operator">/</span>_search<br>&#123;<br>  &quot;query&quot;: &#123;<br>    &quot;match&quot;: &#123; &quot;title&quot;: &quot;æµ‹è¯•&quot; &#125;<br>  &#125;,<br>    &quot;highlight&quot;: &#123;<br>    &quot;fields&quot;: &#123;<br>      &quot;title&quot;: &#123;&#125;<br>    &#125;<br>  &#125;,<br>    &quot;suggest&quot;: &#123;<span class="hljs-operator">/</span><span class="hljs-operator">/</span>è¿™ä¸ªå­—æ®µæ˜¯å…³é”®å­—,ä¸èƒ½éšä¾¿èµ·å<br>    &quot;my-suggest&quot;: &#123; <span class="hljs-operator">/</span><span class="hljs-operator">/</span> è¿™ä¸ªæ˜¯è‡ªå·±èµ·çš„åå­—<br>      &quot;prefix&quot;: &quot;æµ‹è¯•&quot;, <span class="hljs-operator">/</span><span class="hljs-operator">/</span> è¿™ä¸ªæ˜¯å‰ç¼€<br>      &quot;completion&quot;: &#123;<br>        &quot;field&quot;: &quot;title.suggest&quot; <span class="hljs-operator">/</span><span class="hljs-operator">/</span>è¿™ä¸ªæ˜¯ä½ è‡ªå·±å®šä¹‰çš„ç´¢å¼•<br>      &#125;<br>    &#125;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<ul>
<li>æ„é€ æŸ¥è¯¢</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// åˆ†é¡µ</span><br>    <span class="hljs-type">PageRequest</span> <span class="hljs-variable">pageRequest</span> <span class="hljs-operator">=</span> PageRequest.of((<span class="hljs-type">int</span>) pageNum, (<span class="hljs-type">int</span>) pageSize);<br>    <span class="hljs-comment">// æ„é€ æŸ¥è¯¢</span><br>    <span class="hljs-type">NativeSearchQuery</span> <span class="hljs-variable">searchQuery</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">NativeSearchQueryBuilder</span>()<br>            .withQuery(boolQueryBuilder)<br>            .withHighlightBuilder(highlightBuilder)<br>            .withPageable(pageRequest)<br>            .withSorts(sortBuilder)<br>            .withSuggestBuilder(suggestBuilder)<br>            .build();<br>    SearchHits&lt;ArticleEsDTO&gt; searchHits = elasticsearchRestTemplate.search(searchQuery, ArticleEsDTO.class);<br></code></pre></td></tr></table></figure>

<ul>
<li>æ ¹æ®æœç´¢è¯ <code>searchText</code> ä» <code>SearchResponse</code> ä¸­è·å–å»ºè®®ï¼š</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// ä» SearchResponse ä¸­è·å–å»ºè®®</span><br>     <span class="hljs-type">Suggest</span> <span class="hljs-variable">suggest</span> <span class="hljs-operator">=</span> searchHits.getSuggest();<br>     <span class="hljs-keyword">if</span> (suggest != <span class="hljs-literal">null</span>) &#123;<br>         <span class="hljs-comment">// è·å–ç‰¹å®šçš„å»ºè®®ç»“æœ</span><br>         Suggest.Suggestion&lt;? <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Suggest</span>.Suggestion.Entry&lt;? <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Suggest</span>.Suggestion.Entry.Option&gt;&gt; termSuggestion = suggest.getSuggestion(<span class="hljs-string">&quot;suggestionTitle&quot;</span>);<br>         <span class="hljs-keyword">if</span> (termSuggestion != <span class="hljs-literal">null</span>) &#123;<br>             <span class="hljs-comment">// éå†å»ºè®®é€‰é¡¹</span><br>             <span class="hljs-keyword">for</span> (Suggest.Suggestion.Entry&lt;? <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Suggest</span>.Suggestion.Entry.Option&gt; entry : termSuggestion.getEntries()) &#123;<br>                 <span class="hljs-comment">// å¤„ç†æ¯ä¸ªå»ºè®®é€‰é¡¹ï¼Œä¾‹å¦‚æ‰“å°å®ƒä»¬</span><br>                 System.out.println(entry.getText());<br>                 System.out.println(entry.getOptions().get(<span class="hljs-number">0</span>).getText());<br>                 System.out.println(entry.getOptions().get(<span class="hljs-number">1</span>).getText());<br>             &#125;<br>         &#125;<br>     &#125;<br></code></pre></td></tr></table></figure>

<ul>
<li>æ³¨æ„çœ‹ï¼Œè¿™é‡Œå¯ä»¥é€‰å–çš„<code>å»ºè®®é€‰é¡¹</code>è·Ÿè¿™é‡Œæ˜¯ä¸€ä¸€å¯¹åº”çš„ï¼š</li>
</ul>
<p><img src="https://gitee.com/deng-2022/pictures/raw/master/images/image-20231224221008892.png" alt="image-20231224221008892"></p>
<ul>
<li>æ‰§è¡ŒæŸ¥è¯¢ï¼ŒæˆåŠŸè·å–åˆ°æœç´¢å…³é”®è¯å¯¹åº”çš„æŸ¥è¯¢å»ºè®®ï¼š<strong>ï¼ˆ2023/12/24æ™šï¼‰</strong></li>
</ul>
<p><img src="https://gitee.com/deng-2022/pictures/raw/master/images/image-20231224221206525.png" alt="image-20231224221206525"></p>
<h3 id="å‰ç«¯-3"><a href="#å‰ç«¯-3" class="headerlink" title="å‰ç«¯"></a>å‰ç«¯</h3><ul>
<li>è‡ªåŠ¨å®Œæˆè¾“å…¥æ¡†<strong>ï¼ˆ2023/12/25åˆï¼‰</strong></li>
</ul>
<figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs tsx">&lt;a-auto-complete<br>        v-<span class="hljs-attr">model</span>:value=<span class="hljs-string">&quot;searchText&quot;</span><br>        :options=<span class="hljs-string">&quot;options&quot;</span><br>        style=<span class="hljs-string">&quot;width: 200px&quot;</span><br>        placeholder=<span class="hljs-string">&quot;è¯·è¾“å…¥æœç´¢å…³é”®è¯&quot;</span><br>        <span class="hljs-meta">@select</span>=<span class="hljs-string">&quot;onSelect&quot;</span><br>        <span class="hljs-meta">@search</span>=<span class="hljs-string">&quot;onSearch&quot;</span><br>    /&gt;     <span class="hljs-comment">// æœç´¢å»ºè®®</span><br></code></pre></td></tr></table></figure>

<ul>
<li>å‘èµ·è¯·æ±‚ï¼Œè·å–æœç´¢å»ºè®®è¯ï¼Œä¿å­˜è¿”å›ç»“æœå¹¶è§£æ<strong>ï¼ˆ2023/12/27æ—©ï¼‰</strong></li>
</ul>
<figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs tsx"><span class="hljs-comment">// æœç´¢å»ºè®®è¯</span><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">onSearchSuggest</span> = (<span class="hljs-params">suggestText: <span class="hljs-built_in">string</span></span>) =&gt; &#123;<br>  myAxios.<span class="hljs-title function_">get</span>(<span class="hljs-string">&quot;/search/suggest&quot;</span>, &#123;<br>    <span class="hljs-attr">params</span>: &#123;<br>      <span class="hljs-attr">suggestText</span>: suggestText,<br>    &#125;<br>  &#125;).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">res: <span class="hljs-built_in">any</span></span>) =&gt;</span> &#123;<br>    <span class="hljs-comment">// console.log(&quot;res = &quot; + res)</span><br><br>    <span class="hljs-comment">// æœç´¢å»ºè®®è¯ä¸ä¸ºç©º</span><br>    <span class="hljs-keyword">if</span> (res) &#123;<br>      suggestionList.<span class="hljs-property">value</span> = res<br>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;res = &quot;</span> + suggestionList.<span class="hljs-property">value</span>)<br>    &#125;<br>  &#125;)<br><br>  options.<span class="hljs-property">value</span> = !suggestText<br>      ? []<br>      : [<span class="hljs-title function_">getSuggest</span>(suggestionList.<span class="hljs-property">value</span>[<span class="hljs-number">0</span>]), <span class="hljs-title function_">getSuggest</span>(suggestionList.<span class="hljs-property">value</span>[<span class="hljs-number">1</span>]),<br>        <span class="hljs-title function_">getSuggest</span>(suggestionList.<span class="hljs-property">value</span>[<span class="hljs-number">2</span>]), <span class="hljs-title function_">getSuggest</span>(suggestionList.<span class="hljs-property">value</span>[<span class="hljs-number">3</span>]), <span class="hljs-title function_">getSuggest</span>(suggestionList.<span class="hljs-property">value</span>[<span class="hljs-number">4</span>])];<br>&#125;;<br></code></pre></td></tr></table></figure>

<ul>
<li>ç»‘å®šæœç´¢å»ºè®®è¯åˆ°<code>a-auto-complete</code>ä¸­ï¼Œå±•ç¤ºæœç´¢å»ºè®®</li>
</ul>
<figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs tsx"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">Suggest</span> &#123;<br>  <span class="hljs-attr">value</span>: <span class="hljs-built_in">string</span>;<br>&#125;<br><br><span class="hljs-comment">// è¯·æ±‚è·å¾—å»ºè®®è¯</span><br><span class="hljs-keyword">const</span> getSuggest = (<span class="hljs-attr">sug</span>:<span class="hljs-built_in">string</span>): <span class="hljs-function"><span class="hljs-params">Suggest</span> =&gt;</span> &#123;<br>  <span class="hljs-keyword">return</span> &#123;<br>    <span class="hljs-attr">value</span>: sug,<br>  &#125;;<br>&#125;;<br></code></pre></td></tr></table></figure>

<ul>
<li>æ”¯æŒä»æœç´¢å»ºè®®åˆ—è¡¨ä¸­ï¼Œå•å‡»é€‰æ‹©å…¶ä¸­ä¸€é¡¹å¡«å……åˆ°<code>a-auto-complete</code>è¾“å…¥æ¡†ä¸­</li>
</ul>
<figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs tsx"><span class="hljs-comment">// å»ºè®®åˆ—è¡¨</span><br><span class="hljs-keyword">const</span> options = ref&lt;<span class="hljs-title class_">Suggest</span>[]&gt;([]);<br><br><span class="hljs-comment">// ä»å»ºè®®åˆ—è¡¨ä¸­é€‰æ‹©ä¸€é¡¹</span><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">onSelect</span> = (<span class="hljs-params">value: <span class="hljs-built_in">string</span></span>) =&gt; &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;onSelect&#x27;</span>, value);<br>&#125;;<br></code></pre></td></tr></table></figure>

<ul>
<li>æ ¹æ®æœç´¢å…³é”®è¯ï¼Œæ‰§è¡Œæœç´¢ï¼Œè·å–å¹¶è§£ææœç´¢ç»“æœ</li>
</ul>
<figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs tsx"><span class="hljs-comment">// æ‰§è¡Œæœç´¢</span><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">onSearch</span> = (<span class="hljs-params">searchText: <span class="hljs-built_in">string</span></span>) =&gt; &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(searchText)<br>  router.<span class="hljs-title function_">push</span>(&#123;<br>    <span class="hljs-attr">query</span>: &#123;<br>      ...searchParams.<span class="hljs-property">value</span>,<br>      <span class="hljs-attr">text</span>: searchText,<br>    &#125;,<br>  &#125;);<br><br>  <span class="hljs-title function_">loadData</span>(searchParams.<span class="hljs-property">value</span>);<br>  <span class="hljs-keyword">const</span> <span class="hljs-keyword">type</span> = route.<span class="hljs-property">params</span>.<span class="hljs-property">category</span>;<br><br>  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">type</span> === <span class="hljs-string">&quot;post&quot;</span>) &#123;<br>    message.<span class="hljs-title function_">success</span>(<span class="hljs-string">&quot;æˆåŠŸæ£€ç´¢å‡ºæ‚¨æ„Ÿå…´è¶£çš„è¯—è¯~&quot;</span>)<br>  &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">type</span> === <span class="hljs-string">&quot;user&quot;</span>) &#123;<br>    message.<span class="hljs-title function_">success</span>(<span class="hljs-string">&quot;æˆåŠŸæ£€ç´¢å‡ºæ‚¨æ„Ÿå…´è¶£çš„ç”¨æˆ·~&quot;</span>)<br>  &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">type</span> === <span class="hljs-string">&quot;picture&quot;</span>) &#123;<br>    pictureList.<span class="hljs-property">value</span> = [];<br>    <span class="hljs-title function_">getImages</span>()<br>  &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">type</span> === <span class="hljs-string">&quot;article&quot;</span>) &#123;<br>    message.<span class="hljs-title function_">success</span>(<span class="hljs-string">&quot;æˆåŠŸæ£€ç´¢å‡ºæ‚¨æ„Ÿå…´è¶£çš„åšæ–‡~&quot;</span>)<br>  &#125;<br>&#125;;<br></code></pre></td></tr></table></figure>

<ul>
<li>ç›®å‰å®ç°çš„æ•ˆæœå¦‚ä¸‹ï¼š<strong>ï¼ˆ2023/12/25åˆï¼‰</strong></li>
</ul>
<p><img src="https://gitee.com/deng-2022/pictures/raw/master/images/image-20231225001413628.png" alt="image-20231225001413628"></p>
<ul>
<li>åœ¨è¾“å…¥æ¡†ä¸­è¾“å…¥å†…å®¹ï¼Œå³å¯æ˜¾ç¤ºå»ºè®®åˆ—è¡¨</li>
<li>æˆåŠŸå®ç°è·å–æœç´¢å»ºè®®è¯ï¼Œå®ç°ä»£ç å·²ç»åœ¨ä¸Šè¿°ä»£ç ä¸­æ›´æ–°ï¼Œæœ€ç»ˆæ•ˆæœå¦‚ä¸‹ï¼š<strong>ï¼ˆ2023/12/27æ—©ï¼‰</strong></li>
</ul>
<p><img src="https://gitee.com/deng-2022/pictures/raw/master/images/image-20231227105751531.png" alt="image-20231227105751531"></p>
<h2 id="onSearch-å‡½æ•°æœªä¼ å‚å¼•å‘çš„é—®é¢˜"><a href="#onSearch-å‡½æ•°æœªä¼ å‚å¼•å‘çš„é—®é¢˜" class="headerlink" title="onSearch å‡½æ•°æœªä¼ å‚å¼•å‘çš„é—®é¢˜"></a><code>onSearch</code> å‡½æ•°æœªä¼ å‚å¼•å‘çš„é—®é¢˜</h2><ul>
<li>åˆè§£å†³äº†ä¸€ä¸ªå°é—®é¢˜ï¼š<strong>ï¼ˆ2023/12/25æ™šï¼‰</strong></li>
<li>å°†ä¹‹å‰çš„æœç´¢æ¡†æ‹†åˆ†æˆä¸¤ä¸ªï¼š<strong>è‡ªåŠ¨å®Œæˆè¾“å…¥æ¡†</strong>å’Œä¸€ä¸ª <code>Button</code>æŒ‰é’®ï¼š</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;!--æœç´¢æ¡†--&gt;<br>&lt;a-input-search<br>    v-model:value=&quot;searchText&quot;<br>    placeholder=&quot;è¯·è¾“å…¥æœç´¢å…³é”®è¯&quot;<br>    enter-button=&quot;æœç´¢&quot;<br>    size=&quot;large&quot;<br>    @search=&quot;onSearch&quot;<br>/&gt;<br></code></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;a-auto-complete<br>    v-model:value=&quot;searchText&quot;<br>    :options=&quot;options&quot;<br>    style=&quot;width: 200px&quot;<br>    placeholder=&quot;è¯·è¾“å…¥æœç´¢å…³é”®è¯&quot;<br>    @select=&quot;onSelect&quot;<br>    @search=&quot;onSearchSuggest&quot;<br>/&gt;<br><br>&lt;a-button type=&quot;primary&quot; @click=&quot;onSearch(searchText)&quot;&gt;æœç´¢æ¡†&lt;/a-button&gt;<br></code></pre></td></tr></table></figure>

<ul>
<li>è¿™ä¸¤ä¸ªæœç´¢å‡½æ•°åˆ†åˆ«æ‰§è¡Œäº†<code>æœç´¢å»ºè®®è¯æœç´¢</code>å’Œ<code>æ•°æ®åº“è®°å½•æœç´¢</code>ï¼š</li>
</ul>
<figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs tsx"><span class="hljs-comment">// æœç´¢å»ºè®®è¯</span><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">onSearchSuggest</span> = (<span class="hljs-params">suggestText: <span class="hljs-built_in">string</span></span>) =&gt; &#123;<br>  myAxios.<span class="hljs-title function_">get</span>(<span class="hljs-string">&quot;/search/suggest&quot;</span>, &#123;<br>    <span class="hljs-attr">params</span>: &#123;<br>      <span class="hljs-attr">suggestText</span>: suggestText,<br>    &#125;<br>  &#125;).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">res: <span class="hljs-built_in">any</span></span>) =&gt;</span> &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;res = &quot;</span> + res)<br>  &#125;)<br><br>  options.<span class="hljs-property">value</span> = !suggestText<br>      ? []<br>      : [<span class="hljs-title function_">getSuggest</span>(), <span class="hljs-title function_">getSuggest</span>(), <span class="hljs-title function_">getSuggest</span>()];<br>&#125;;<br></code></pre></td></tr></table></figure>

<figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs tsx"><span class="hljs-comment">// æ‰§è¡Œæœç´¢</span><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">onSearch</span> = (<span class="hljs-params">searchText: <span class="hljs-built_in">string</span></span>) =&gt; &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(searchText)<br>  router.<span class="hljs-title function_">push</span>(&#123;<br>    <span class="hljs-attr">query</span>: &#123;<br>      ...searchParams.<span class="hljs-property">value</span>,<br>      <span class="hljs-attr">text</span>: searchText,<br>    &#125;,<br>  &#125;);<br><br>  <span class="hljs-title function_">loadData</span>(searchParams.<span class="hljs-property">value</span>);<br>  <span class="hljs-keyword">const</span> <span class="hljs-keyword">type</span> = route.<span class="hljs-property">params</span>.<span class="hljs-property">category</span>;<br><br>  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">type</span> === <span class="hljs-string">&quot;post&quot;</span>) &#123;<br>    message.<span class="hljs-title function_">success</span>(<span class="hljs-string">&quot;æˆåŠŸæ£€ç´¢å‡ºæ‚¨æ„Ÿå…´è¶£çš„è¯—è¯~&quot;</span>)<br>  &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">type</span> === <span class="hljs-string">&quot;user&quot;</span>) &#123;<br>    message.<span class="hljs-title function_">success</span>(<span class="hljs-string">&quot;æˆåŠŸæ£€ç´¢å‡ºæ‚¨æ„Ÿå…´è¶£çš„ç”¨æˆ·~&quot;</span>)<br>  &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">type</span> === <span class="hljs-string">&quot;picture&quot;</span>) &#123;<br>    pictureList.<span class="hljs-property">value</span> = [];<br>    <span class="hljs-title function_">getImages</span>()<br>  &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">type</span> === <span class="hljs-string">&quot;article&quot;</span>) &#123;<br>    message.<span class="hljs-title function_">success</span>(<span class="hljs-string">&quot;æˆåŠŸæ£€ç´¢å‡ºæ‚¨æ„Ÿå…´è¶£çš„åšæ–‡~&quot;</span>)<br>  &#125;<br>&#125;;<br></code></pre></td></tr></table></figure>

<ul>
<li>ç»“æœå°±æ˜¯å› ä¸ºè½¬æ¢æˆä½¿ç”¨ä¸€ä¸ª Button é‚£æŒ‰é’®æ‰§è¡Œæœç´¢æ“ä½œï¼Œæ²¡æœ‰åŠæ—¶æ”¹æ­£è¯­æ³•æ ¼å¼ï¼Œå†™æˆäº†ï¼š</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;a-button type=&quot;primary&quot; @click=&quot;onSearch&quot;&gt;æœç´¢æ¡†&lt;/a-button&gt;<br></code></pre></td></tr></table></figure>

<ul>
<li>æ˜¾è€Œæ˜“è§ï¼Œ<code>onSearch</code> å‡½æ•°å¹¶æ²¡æœ‰ä¼ é€’å‚æ•°ï¼Œè¿™å°±å¯¼è‡´äº† Â·onSearchÂ· å‡½æ•°ä¸€ç›´ä¸ä¼šè¢«æ­£ç¡®æ‰§è¡Œ</li>
<li>è¿˜å¥½æˆ‘æ¯”è¾ƒèªæ˜ï¼Œå‘ç°äº†è¿™ä¸ªé—®é¢˜<strong>ï¼ˆ2023/12/25æ™šï¼‰</strong></li>
</ul>
<h2 id="çƒ­æœè¯ç»Ÿè®¡"><a href="#çƒ­æœè¯ç»Ÿè®¡" class="headerlink" title="çƒ­æœè¯ç»Ÿè®¡"></a>çƒ­æœè¯ç»Ÿè®¡</h2><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_29752857/article/details/132169845">RedisTemplate.opsForZSet()ç”¨æ³•ç®€ä»‹å¹¶ä¸¾ä¾‹-CSDNåšå®¢</a></p>
<p>æ€è·¯ä¸€ï¼š</p>
<p>key å€¼å­˜å‚¨æœç´¢è¯æ¡ï¼Œvalue å€¼ç”¨ String æ•°æ®ç»“æ„ï¼Œå­˜å‚¨ï¼š<strong>ç”¨æˆ· id + æœç´¢æ¬¡æ•° + æœç´¢æ—¶é—´</strong>ï¼Œæ–¹ä¾¿æ ¹æ®æœç´¢è¯æ¡æŸ¥è¯¢è¯æ¡ç›¸å…³ä¿¡æ¯ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> List&lt;Message&gt; <span class="hljs-title function_">setHotWords</span><span class="hljs-params">(String suggestTextStr, HttpServletRequest request)</span> &#123;<br>       <span class="hljs-comment">// è·å–å½“å‰ç™»å½•ç”¨æˆ·</span><br>       <span class="hljs-comment">// User loginUser = (User) request.getSession().getAttribute(USER_LOGIN_STATE);</span><br>       <span class="hljs-comment">//</span><br>       <span class="hljs-comment">// Long userId = loginUser.getId();</span><br><br>       <span class="hljs-keyword">if</span> (com.qcloud.cos.utils.StringUtils.isNullOrEmpty(suggestTextStr)) &#123;<br>           <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>       &#125;<br><br>       <span class="hljs-comment">// æŒ‰ç©ºæ ¼ï¼Œè·å–æ¯ä¸ªæœç´¢è¯</span><br>       String[] suggestTexts = suggestTextStr.split(<span class="hljs-string">&quot; &quot;</span>);<br><br>       ArrayList&lt;Message&gt; messageList = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br>       <span class="hljs-keyword">for</span> (String suggestText : suggestTexts) &#123;<br>           <span class="hljs-comment">// ä» Redis ä¸­è·å–åŸå§‹æ¶ˆæ¯</span><br>           <span class="hljs-type">String</span> <span class="hljs-variable">messageStr</span> <span class="hljs-operator">=</span> redisTemplate.opsForValue().get(String.format(REDIS_KEY_TEMPLATE, suggestText));<br><br>           <span class="hljs-type">Message</span> <span class="hljs-variable">message</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>           <span class="hljs-type">Gson</span> <span class="hljs-variable">gson</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Gson</span>();<br>           <span class="hljs-comment">// æ£€æŸ¥åŸå§‹æ¶ˆæ¯æ˜¯å¦ä¸ºç©º</span><br>           <span class="hljs-keyword">if</span> (ObjectUtils.isNotEmpty(messageStr)) &#123;<br>               <span class="hljs-comment">// è·å–åŸå§‹æ¶ˆæ¯ä¸­çš„ searchNum å­—æ®µå¹¶å¢åŠ  1</span><br>               <span class="hljs-type">Message</span> <span class="hljs-variable">mes</span> <span class="hljs-operator">=</span> gson.fromJson(messageStr, Message.class);<br>               <span class="hljs-type">Integer</span> <span class="hljs-variable">searchNum</span> <span class="hljs-operator">=</span> mes.getSearchNum();<br>               <span class="hljs-type">Integer</span> <span class="hljs-variable">newSearchNum</span> <span class="hljs-operator">=</span> searchNum + <span class="hljs-number">1</span>;<br><br>               <span class="hljs-comment">// åˆ›å»ºæ–°çš„ Message å¯¹è±¡</span><br>               message = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Message</span>(MESSAGE_ID, suggestText, newSearchNum);<br>           &#125; <span class="hljs-keyword">else</span> &#123;<br>               <span class="hljs-comment">// åˆ›å»ºæ–°çš„ Message å¯¹è±¡</span><br>               message = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Message</span>(MESSAGE_ID, suggestText, SEARCH_NUM);<br>           &#125;<br>           <span class="hljs-type">boolean</span> <span class="hljs-variable">add</span> <span class="hljs-operator">=</span> messageList.add(message);<br>           ThrowUtils.throwIf(!add, ErrorCode.OPERATION_ERROR, <span class="hljs-string">&quot;è®°å½•çƒ­æœè¯å¤±è´¥&quot;</span>);<br><br>           <span class="hljs-comment">// å°†æ–°çš„ Message å¯¹è±¡å­˜å› Redis ä¸­ï¼Œè®¾ç½®è¿‡æœŸæ—¶é—´ä¸º 30 å¤©</span><br>           redisTemplate.opsForValue()<br>                    .set(String.format(REDIS_KEY_TEMPLATE, suggestText), gson.toJson(message), <span class="hljs-number">30</span>, TimeUnit.DAYS);<br>       &#125;<br><br>       <span class="hljs-keyword">return</span> messageList;<br>   &#125;<br></code></pre></td></tr></table></figure>

<p><img src="https://gitee.com/deng-2022/pictures/raw/master/images/image-20240204002441626.png" alt="image-20240204002441626"></p>
<p>å¾ˆæ–¹ä¾¿æŸ¥è¯¢æ‰€æœ‰<strong>æœç´¢è¯æ¡ç›¸å…³ä¿¡æ¯</strong>ï¼Œä½†æ ¹æ® value å€¼å†…çš„ <code>searchNum</code> æŒ‰åºæŸ¥è¯¢<strong>å‰åæ¡æ•°æ®</strong>è¾ƒå›°éš¾ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> List&lt;Message&gt; <span class="hljs-title function_">getHotWords</span><span class="hljs-params">()</span> &#123;<br>    Set&lt;String&gt; keys = redisTemplate.keys(<span class="hljs-string">&quot;search:hot*&quot;</span>);<br><br>    ArrayList&lt;Message&gt; hotWordList = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br>    <span class="hljs-type">Gson</span> <span class="hljs-variable">gson</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Gson</span>();<br>    <span class="hljs-keyword">for</span> (String key : Objects.requireNonNull(keys)) &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">messageStr</span> <span class="hljs-operator">=</span> redisTemplate.opsForValue().get(key);<br>        <span class="hljs-type">Message</span> <span class="hljs-variable">message</span> <span class="hljs-operator">=</span> gson.fromJson(messageStr, Message.class);<br>        hotWordList.add(message);<br>    &#125;<br><br>    System.out.println(keys);<br>    <span class="hljs-keyword">return</span> hotWordList;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>è¯æ¡ç›¸å…³ä¿¡æ¯ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Data</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Message</span> &#123;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æœç´¢è¯æ¡</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> Long userId;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æœç´¢è¯æ¡</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> String searchText;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æœç´¢è¯æ¡</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> Integer searchNum;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Message</span><span class="hljs-params">(Long userId, String searchText, Integer searchNum)</span> &#123;<br>        <span class="hljs-built_in">this</span>.userId = userId;<br>        <span class="hljs-built_in">this</span>.searchText = searchText;<br>        <span class="hljs-built_in">this</span>.searchNum = searchNum;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Message</span><span class="hljs-params">(Long userId, Integer searchNum)</span> &#123;<br>        <span class="hljs-built_in">this</span>.userId = userId;<br>        <span class="hljs-built_in">this</span>.searchNum = searchNum;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>æ€è·¯äºŒï¼š</p>
<p>ä½¿ç”¨ ZSet æ•°æ®ç»“æ„ï¼Œkey å€¼å­˜å‚¨æœç´¢æ—¶é—´ï¼Œå¯ç»Ÿè®¡ä¸åŒæ—¶é—´æ®µå†…çš„çƒ­é—¨æœç´¢è¯</p>
<p>value å€¼å­˜å‚¨ï¼š<strong>ç”¨æˆ· id + æœç´¢æ¬¡æ•° + æœç´¢æ—¶é—´</strong>ï¼Œç»´æŠ¤ score åˆ†æ•°ï¼Œæ›´æ–°æœç´¢è¯æ¡<code>searchNum</code>ï¼Œå³æ›´æ–°<code>score</code>åˆ†æ•°ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> List&lt;Message&gt; <span class="hljs-title function_">setHotWords</span><span class="hljs-params">(String searchTextStr, HttpServletRequest request)</span> &#123;<br>    <span class="hljs-comment">// è·å–å½“å‰ç™»å½•ç”¨æˆ·</span><br>    <span class="hljs-comment">// User loginUser = (User) request.getSession().getAttribute(USER_LOGIN_STATE);</span><br>    <span class="hljs-comment">//</span><br>    <span class="hljs-comment">// Long userId = loginUser.getId();</span><br><br>    <span class="hljs-keyword">if</span> (com.qcloud.cos.utils.StringUtils.isNullOrEmpty(searchTextStr)) &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>    &#125;<br><br>    <span class="hljs-comment">// æŒ‰ç©ºæ ¼ï¼Œè·å–æ¯ä¸ªæœç´¢è¯</span><br>    String[] searchTexts = searchTextStr.split(<span class="hljs-string">&quot; &quot;</span>);<br><br>    ArrayList&lt;Message&gt; messageList = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br>    <span class="hljs-keyword">for</span> (String searchText : searchTexts) &#123;<br>        <span class="hljs-comment">// ä» Redis ä¸­è·å–åŸå§‹æ¶ˆæ¯</span><br>        <span class="hljs-type">Long</span> <span class="hljs-variable">size</span> <span class="hljs-operator">=</span> redisTemplate.opsForZSet()<br>                .zCard(String.format(REDIS_KEY_TEMPLATE, SEARCH_TIME));<br><br>        <span class="hljs-type">Message</span> <span class="hljs-variable">message</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>        <span class="hljs-type">Gson</span> <span class="hljs-variable">gson</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Gson</span>();<br>        <span class="hljs-comment">// åŸå§‹æ¶ˆæ¯ä¸ä¸ºç©º</span><br>        <span class="hljs-keyword">if</span> (size &gt; <span class="hljs-number">0</span>) &#123;<br>            <span class="hljs-comment">// è·å–åŸå§‹æ¶ˆæ¯ä¸­çš„ searchNum å­—æ®µå¹¶å¢åŠ  1</span><br>            <span class="hljs-type">Message</span> <span class="hljs-variable">mes</span> <span class="hljs-operator">=</span> gson.fromJson(SEARCH_TIME, Message.class);<br>            <span class="hljs-type">Double</span> <span class="hljs-variable">searchNum</span> <span class="hljs-operator">=</span> mes.getSearchNum();<br><br>            <span class="hljs-comment">// åˆ›å»ºæ–°çš„ Message å¯¹è±¡</span><br>            message = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Message</span>(MESSAGE_ID, searchText, ++searchNum);<br>            <span class="hljs-comment">// å­˜å…¥ Redisï¼Œæ›´æ–° score</span><br>            redisTemplate.opsForZSet()<br>                    .incrementScore(String.format(REDIS_KEY_TEMPLATE, SEARCH_TIME), gson.toJson(message), <span class="hljs-number">1</span>);<br><br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-comment">// åˆ›å»ºæ–°çš„ Message å¯¹è±¡</span><br>            message = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Message</span>(MESSAGE_ID, searchText, SEARCH_NUM);<br><br>            <span class="hljs-comment">// å°†æ–°çš„ Message å¯¹è±¡å­˜å› Redis ä¸­</span><br>            redisTemplate.opsForZSet()<br>                    .add(String.format(REDIS_KEY_TEMPLATE, SEARCH_TIME), gson.toJson(message), SEARCH_NUM);<br>        &#125;<br>        <span class="hljs-type">boolean</span> <span class="hljs-variable">add</span> <span class="hljs-operator">=</span> messageList.add(message);<br>        ThrowUtils.throwIf(!add, ErrorCode.OPERATION_ERROR, <span class="hljs-string">&quot;è®°å½•çƒ­æœè¯å¤±è´¥&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">return</span> messageList;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>æ ¹æ® <code>score</code> æœç´¢æ¬¡æ•°ï¼Œååˆ†ä¾¿æ·åœ°æŸ¥è¯¢å‡ºå‰åæ¡è¯æ¡ä¿¡æ¯ï¼Œå³<strong>çƒ­é—¨æœç´¢è¯æ¡</strong>ï¼š<strong>ï¼ˆ2024/02/05ï¼‰</strong></p>
<p><img src="https://gitee.com/deng-2022/pictures/raw/master/images/image-20240204213220142.png" alt="image-20240204213220142"></p>
<p><img src="https://gitee.com/deng-2022/pictures/raw/master/images/image-20240204213224414.png" alt="image-20240204213224414"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> List&lt;MessageVO&gt; <span class="hljs-title function_">getHotWords</span><span class="hljs-params">()</span> &#123;<br>       <span class="hljs-comment">// æ ¹æ® score è·å–å‰åæ¡æœç´¢è¯æ¡</span><br>       Set&lt;String&gt; messageSet = redisTemplate.opsForZSet()<br>               .range(String.format(REDIS_KEY_TEMPLATE, SEARCH_TIME), <span class="hljs-number">0</span>, <span class="hljs-number">9</span>);<br><br>       ArrayList&lt;MessageVO&gt; messageVOList = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br>       <span class="hljs-type">Gson</span> <span class="hljs-variable">gson</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Gson</span>();<br>       <span class="hljs-keyword">for</span> (String messageStr : Objects.requireNonNull(messageSet)) &#123;<br>           <span class="hljs-type">Message</span> <span class="hljs-variable">message</span> <span class="hljs-operator">=</span> gson.fromJson(messageStr, Message.class);<br>           <span class="hljs-comment">// æŸ¥è¯¢æœç´¢è¯æ¡å¯¹åº” score</span><br>           <span class="hljs-type">Double</span> <span class="hljs-variable">score</span> <span class="hljs-operator">=</span> redisTemplate.opsForZSet()<br>                   .score(String.format(REDIS_KEY_TEMPLATE, SEARCH_TIME), messageStr);<br>           <span class="hljs-comment">// å°è£… messageVO</span><br>           <span class="hljs-type">MessageVO</span> <span class="hljs-variable">messageVO</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MessageVO</span>();<br>           BeanUtils.copyProperties(message, messageVO);<br>           messageVO.setSearchNum(score);<br><br>           <span class="hljs-type">boolean</span> <span class="hljs-variable">add</span> <span class="hljs-operator">=</span> messageVOList.add(messageVO);<br>           ThrowUtils.throwIf(!add, ErrorCode.OPERATION_ERROR, <span class="hljs-string">&quot;è·å–çƒ­æœè¯å¤±è´¥&quot;</span>);<br>       &#125;<br><br>       <span class="hljs-keyword">return</span> messageVOList;<br>   &#125;<br></code></pre></td></tr></table></figure>

<p>è¯æ¡ç›¸å…³ä¿¡æ¯ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Data</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Message</span> &#123;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * ç”¨æˆ·</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> Long userId;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æœç´¢è¯æ¡</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> String searchText;<br><br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Message</span><span class="hljs-params">(Long userId, String searchText)</span> &#123;<br>        <span class="hljs-built_in">this</span>.userId = userId;<br>        <span class="hljs-built_in">this</span>.searchText = searchText;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Data</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MessageVO</span> &#123;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * ç”¨æˆ·</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> Long userId;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æœç´¢è¯æ¡</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> String searchText;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æœç´¢è¯æ¡</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> Double searchNum;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">MessageVO</span><span class="hljs-params">()</span> &#123;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">MessageVO</span><span class="hljs-params">(Long userId, String searchText, Double searchNum)</span> &#123;<br>        <span class="hljs-built_in">this</span>.userId = userId;<br>        <span class="hljs-built_in">this</span>.searchText = searchText;<br>        <span class="hljs-built_in">this</span>.searchNum = searchNum;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>



<h2 id="æƒé™æ ¡éªŒ"><a href="#æƒé™æ ¡éªŒ" class="headerlink" title="æƒé™æ ¡éªŒ"></a>æƒé™æ ¡éªŒ</h2><p>å…¨å±€è¯·æ±‚è¿‡æ»¤å™¨ï¼ŒThreadLocal è®°å½•ç™»å½•ç”¨æˆ·ä¿¡æ¯</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// 4.éœ€è¦å¤„ç†çš„ç”¨æˆ·çš„è¯·æ±‚,åˆ™åˆ¤æ–­ç™»å½•çŠ¶æ€,å¦‚æœå·²ç»ç™»å½•,åˆ™ç›´æ¥æ”¾è¡Œ</span><br>Long userId;<br><span class="hljs-type">User</span> <span class="hljs-variable">currentUser</span> <span class="hljs-operator">=</span> (User) request.getSession().getAttribute(USER_LOGIN_STATE);<br><br><span class="hljs-keyword">if</span> (currentUser != <span class="hljs-literal">null</span>) &#123;<span class="hljs-comment">// Sessionä¸­å­˜å‚¨ç€ç”¨æˆ·id(ç™»å½•æˆåŠŸ)</span><br>    userId = currentUser.getId();<br>    log.info(<span class="hljs-string">&quot;è¯¥ç”¨æˆ·å·²ç™»å½•,idä¸º&#123;&#125;&quot;</span>, userId);<br><br>    BaseContext.setCurrentId(userId);<span class="hljs-comment">// ThreadLocal</span><br><br>    filterChain.doFilter(request, response);<span class="hljs-comment">// æ”¾è¡Œè¯·æ±‚</span><br>    <span class="hljs-keyword">return</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>æŸ¥è¯¢æ–‡ç« ï¼Œæºå¸¦æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">Long</span> <span class="hljs-variable">currentId</span> <span class="hljs-operator">=</span> BaseContext.getCurrentId();<br><span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> userService.getById(currentId);<br><span class="hljs-type">UserVO</span> <span class="hljs-variable">userVO</span> <span class="hljs-operator">=</span> userService.getUserVO(user);<br>articleVO.setUserVO(userVO);<br></code></pre></td></tr></table></figure>

<p><img src="C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\image-20240205223255475.png" alt="image-20240205223255475"></p>
<p>æˆåŠŸæŸ¥è¯¢åˆ°ç”¨æˆ·ä¿¡æ¯</p>
<p><img src="https://gitee.com/deng-2022/pictures/raw/master/images/image-20240205223302449.png" alt="image-20240205223302449"></p>
<h2 id="ç½‘ç«™é¦–é¡µ"><a href="#ç½‘ç«™é¦–é¡µ" class="headerlink" title="ç½‘ç«™é¦–é¡µ"></a>ç½‘ç«™é¦–é¡µ</h2><p><img src="https://gitee.com/deng-2022/pictures/raw/master/images/image-20240206132159098.png" alt="image-20240206132159098"></p>
<p><img src="https://gitee.com/deng-2022/pictures/raw/master/images/image-20240206224443746.png" alt="image-20240206224443746"></p>
<p><a target="_blank" rel="noopener" href="https://theme-hope.vuejs.press/zh/">ä¸»é¡µ | vuepress-theme-hope (vuejs.press)</a></p>
<p>å…³äºè¯¥ä¸»é¢˜çš„ä½¿ç”¨æ–¹æ³•ï¼Œåœ¨æ­¤ç®€å•äºˆä»¥è¯´æ˜ï¼š</p>
<p>é¦–é¡µé…ç½®ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">---<br>home: <span class="hljs-literal">true</span><br>icon: home<br>title: é¡¹ç›®ä¸»é¡µ<br>heroImage: /logo.svg<br>bgImage: /img/winter2.jpg<br>bgImageDark: https://theme-hope-assets.vuejs.press/bg/6-dark.svg<br>bgImageStyle:<br>  background-attachment: fixed<br>heroText: MemorySearch å¿†æœé˜<br>tagline: ä¸€ä¸ªå¼ºå¤§çš„ã€å†…å®¹ä¸°å¯Œçš„èšåˆæœç´¢ä¸­å°<br></code></pre></td></tr></table></figure>



<h2 id="æ³¨å†Œç”¨æˆ·ç®¡ç†"><a href="#æ³¨å†Œç”¨æˆ·ç®¡ç†" class="headerlink" title="æ³¨å†Œç”¨æˆ·ç®¡ç†"></a>æ³¨å†Œç”¨æˆ·ç®¡ç†</h2><p>å¯ç®—å‘æ­»æˆ‘äº†ï¼š</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs ts">&lt;a-table<br>          :columns=<span class="hljs-string">&quot;userColumns&quot;</span><br>          :data=<span class="hljs-string">&quot;userList ? userList : []&quot;</span><br>          :bordered=<span class="hljs-string">&quot;true&quot;</span><br>          :hoverable=<span class="hljs-string">&quot;true&quot;</span><br>          :stripe=<span class="hljs-string">&quot;true&quot;</span><br>          :show-header=<span class="hljs-string">&quot;true&quot;</span><br>          :pagination=<span class="hljs-string">&quot;pagination&quot;</span><br>      /&gt;<br></code></pre></td></tr></table></figure>

<p>åƒä¸‡ä¸èƒ½å†™æˆï¼š :data=â€:data=â€userList ? [] : userListâ€ï¼Œå®Œå…¨ä½çº§é”™è¯¯ï¼Œä¸å¥½å‘ç°</p>
<h2 id="å›¾ç‰‡ç¼“å­˜å®ç°"><a href="#å›¾ç‰‡ç¼“å­˜å®ç°" class="headerlink" title="å›¾ç‰‡ç¼“å­˜å®ç°"></a>å›¾ç‰‡ç¼“å­˜å®ç°</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// Redis ä¿å­˜æœç´¢å›¾ç‰‡ ä¸¤å°æ—¶</span><br>  redisTemplate.opsForValue()<br>          .set(String.format(SEARCH_TEXT_KEY, String.valueOf(currentId)),<br>                  GSON.toJson(pictureList), <span class="hljs-number">2</span>, TimeUnit.HOURS);<br><br></code></pre></td></tr></table></figure>

<p><img src="https://gitee.com/deng-2022/pictures/raw/master/images/image-20240207191513830.png" alt="image-20240207191513830"></p>
<p>Open API ç”Ÿæˆè¯·æ±‚æ¥å£ï¼Œè¿˜ç»è¿‡ Spring è¿‡æ»¤å™¨ï¼š</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">openapi --input http:<span class="hljs-regexp">//</span>localhost:<span class="hljs-number">8104</span><span class="hljs-regexp">/api/</span>v2<span class="hljs-regexp">/api-docs?group=memory-search --output ./g</span>enerated --client axios<br></code></pre></td></tr></table></figure>

<p><img src="https://gitee.com/deng-2022/pictures/raw/master/images/image-20240207195455834.png" alt="image-20240207195455834"></p>
<h2 id="çƒ­é—¨è¯åˆ†æ"><a href="#çƒ­é—¨è¯åˆ†æ" class="headerlink" title="çƒ­é—¨è¯åˆ†æ"></a>çƒ­é—¨è¯åˆ†æ</h2><p>å®˜æ–¹æ–‡æ¡£ï¼š[Aggregations | Elasticsearch Guide <a target="_blank" rel="noopener" href="https://www.elastic.co/guide/en/elasticsearch/reference/7.17/search-aggregations.html">7.17] | Elastic</a></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">GET</span> <span class="hljs-operator">/</span>my<span class="hljs-operator">-</span>index<span class="hljs-number">-000001</span><span class="hljs-operator">/</span>_search<br>&#123;<br>  &quot;aggs&quot;: &#123;<br>    &quot;my-first-agg-name&quot;: &#123;<br>      &quot;terms&quot;: &#123;<br>        &quot;field&quot;: &quot;my-field&quot;<br>      &#125;<br>    &#125;,<br>    &quot;my-second-agg-name&quot;: &#123;<br>      &quot;avg&quot;: &#123;<br>        &quot;field&quot;: &quot;my-other-field&quot;<br>      &#125;<br>    &#125;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><img src="https://gitee.com/deng-2022/pictures/raw/master/images/image-20240214194406065.png" alt="image-20240214194406065"></p>
<p>å¦‚ä¸Šï¼Œåˆ†åˆ«æ ¹æ® title å’Œ description å­—æ®µåˆ†ç»„èšåˆæŸ¥è¯¢å‡ºçƒ­é—¨è¯é¢˜ï¼Œè¿™æ ·åœ¨ä»£ç ä¸­å°±éœ€è¦å¤„ç†å¤šä¸ª</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java">Map&lt;String, Aggregation&gt; asMap = aggregations1.getAsMap();<br>       System.out.println(asMap);<br>       <span class="hljs-type">Aggregation</span> <span class="hljs-variable">terms</span> <span class="hljs-operator">=</span> asMap.get(<span class="hljs-string">&quot;search_terms&quot;</span>);<br>       <span class="hljs-type">String</span> <span class="hljs-variable">name</span> <span class="hljs-operator">=</span> terms.getName();<br>       <span class="hljs-type">String</span> <span class="hljs-variable">type</span> <span class="hljs-operator">=</span> terms.getType();<br>       Map&lt;String, Object&gt; metadata = terms.getMetadata();<br><br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// æ·»åŠ èšåˆæ¡ä»¶</span><br><span class="hljs-type">TermsAggregationBuilder</span> <span class="hljs-variable">search_terms</span> <span class="hljs-operator">=</span> AggregationBuilders.terms(<span class="hljs-string">&quot;search_terms&quot;</span>).field(<span class="hljs-string">&quot;message&quot;</span>).size(<span class="hljs-number">10</span>);<br><br><span class="hljs-comment">// åˆ›å»ºæŸ¥è¯¢</span><br><span class="hljs-type">NativeSearchQuery</span> <span class="hljs-variable">searchQuery</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">NativeSearchQueryBuilder</span>()<br>        .withAggregations(search_terms)   <span class="hljs-comment">// æ·»åŠ èšåˆæ¡ä»¶</span><br>        .build();<br><br><span class="hljs-comment">// æ‰§è¡Œæœç´¢ï¼Œè·å–æœç´¢ç»“æœ</span><br>SearchHits&lt;MessageTest&gt; searchHits = elasticsearchRestTemplate.search(searchQuery, MessageTest.class);<br><br><span class="hljs-comment">// è·å–Spring Data Elasticsearchçš„èšåˆç»“æœ</span><br><span class="hljs-type">ElasticsearchAggregations</span> <span class="hljs-variable">searchHitsAggregations</span> <span class="hljs-operator">=</span> (ElasticsearchAggregations) searchHits.getAggregations();<br><span class="hljs-type">Aggregations</span> <span class="hljs-variable">aggregations</span> <span class="hljs-operator">=</span> Objects.requireNonNull(searchHitsAggregations).aggregations();<br>List&lt;Aggregation&gt; aggregationList = aggregations.asList();<br><span class="hljs-keyword">for</span> (Aggregation aggregation : aggregationList) &#123;<br>    System.out.println(aggregation);<br>    aggregation.getName();<br>    <span class="hljs-comment">// æ£€æŸ¥èšåˆç±»å‹å¹¶è½¬æ¢ä¸ºç›¸åº”çš„èšåˆå¯¹è±¡</span><br>    <span class="hljs-keyword">if</span> (aggregation <span class="hljs-keyword">instanceof</span> Terms) &#123;<br>        <span class="hljs-type">Terms</span> <span class="hljs-variable">termsAggregation</span> <span class="hljs-operator">=</span> (Terms) aggregation;<br><br>        <span class="hljs-comment">// è·å–buckets</span><br>        List&lt;? <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Terms</span>.Bucket&gt; buckets = termsAggregation.getBuckets();<br><br>        <span class="hljs-comment">// éå†buckets</span><br>        <span class="hljs-keyword">for</span> (Terms.Bucket bucket : buckets) &#123;<br>            System.out.println(<span class="hljs-string">&quot;Bucket Key: &quot;</span> + bucket.getKeyAsString());<br>            System.out.println(<span class="hljs-string">&quot;Bucket Doc Count: &quot;</span> + bucket.getDocCount());<br>            <span class="hljs-comment">// å¦‚æœéœ€è¦ï¼Œè¿˜å¯ä»¥è·å–å…¶ä»–bucketä¿¡æ¯ï¼Œå¦‚èšåˆçš„å­èšåˆç­‰</span><br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><img src="https://gitee.com/deng-2022/pictures/raw/master/images/image-20240211233736902.png" alt="image-20240211233736902"></p>
<p><img src="https://gitee.com/deng-2022/pictures/raw/master/images/image-20240211233800313.png" alt="image-20240211233800313"></p>
<h2 id="è¯—è¯æŠ“å–"><a href="#è¯—è¯æŠ“å–" class="headerlink" title="è¯—è¯æŠ“å–"></a>è¯—è¯æŠ“å–</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">void</span> <span class="hljs-title function_">testFetchPoemByOnce</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>    <span class="hljs-comment">// newä¸€ä¸ªStopWatchå¯¹è±¡</span><br>    <span class="hljs-type">StopWatch</span> <span class="hljs-variable">stopWatch</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StopWatch</span>();<br>    <span class="hljs-comment">// è®¡æ—¶å¼€å§‹</span><br>    stopWatch.start();<br><br>    <span class="hljs-comment">// æŒ‰ä½œè€…æ‰¹é‡è·å–è¯—è¯</span><br>    String[] stringArray = &#123;<span class="hljs-string">&quot;æç™½&quot;</span>, <span class="hljs-string">&quot;æœç”«&quot;</span>, <span class="hljs-string">&quot;è‹è½¼&quot;</span>, <span class="hljs-string">&quot;ç‹ç»´&quot;</span>, <span class="hljs-string">&quot;æœç‰§&quot;</span>, <span class="hljs-string">&quot;é™†æ¸¸&quot;</span>, <span class="hljs-string">&quot;æç…œ&quot;</span>, <span class="hljs-string">&quot;å…ƒç¨¹&quot;</span>, <span class="hljs-string">&quot;éŸ©æ„ˆ&quot;</span>, <span class="hljs-string">&quot;å²‘å‚&quot;</span>, <span class="hljs-string">&quot;é½å·±&quot;</span>&#125;;<br>    List&lt;String&gt; authorList = Arrays.asList(stringArray);<br><br>    <span class="hljs-type">String</span> <span class="hljs-variable">originUrl</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;https://so.gushiwen.cn/shiwens/default.aspx?page=%d&amp;tstr=&amp;astr=%s&amp;cstr=&amp;xstr=&quot;</span>;<br><br>    <span class="hljs-keyword">for</span> (String authorStr : authorList) &#123;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>; i &lt; <span class="hljs-number">5</span>; i++) &#123;<br>            <span class="hljs-type">String</span> <span class="hljs-variable">url</span> <span class="hljs-operator">=</span> String.format(originUrl, i, authorStr);<br>            <span class="hljs-comment">// 1. è·å–æ•°æ®</span><br>            <span class="hljs-type">Document</span> <span class="hljs-variable">doc</span> <span class="hljs-operator">=</span> Jsoup.connect(url)<br>                    .userAgent(<span class="hljs-string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/116.0.0.0 Safari/537.36 Edg/116.0.1938.81&quot;</span>)<br>                    .get();<br><br>            <span class="hljs-comment">// æ•è· id = &quot;leftZhankai&quot;</span><br>            <span class="hljs-type">Element</span> <span class="hljs-variable">leftZhankai</span> <span class="hljs-operator">=</span> doc.getElementById(<span class="hljs-string">&quot;leftZhankai&quot;</span>);<br>            <span class="hljs-type">Elements</span> <span class="hljs-variable">heads</span> <span class="hljs-operator">=</span> leftZhankai.select(<span class="hljs-string">&quot;.sons .cont div:nth-of-type(2)&quot;</span>);<br><br>            ArrayList&lt;Post&gt; postList = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br>            <span class="hljs-keyword">for</span> (Element head : heads) &#123;<br>                <span class="hljs-type">Post</span> <span class="hljs-variable">post</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Post</span>();<br><br>                <span class="hljs-type">String</span> <span class="hljs-variable">title</span> <span class="hljs-operator">=</span> head.select(<span class="hljs-string">&quot;&gt;p:nth-of-type(1)&quot;</span>).text();<br>                <span class="hljs-type">String</span> <span class="hljs-variable">author</span> <span class="hljs-operator">=</span> head.select(<span class="hljs-string">&quot;&gt;p:nth-of-type(2)&quot;</span>).text();<br>                <span class="hljs-type">String</span> <span class="hljs-variable">content</span> <span class="hljs-operator">=</span> head.select(<span class="hljs-string">&quot;.contson&quot;</span>).text();<br>                System.out.println(title);<br>                System.out.println(author);<br>                System.out.println(content);<br><br>                System.out.println(<span class="hljs-string">&quot;------------------------------------&quot;</span>);<br><br>                post.setTitle(title);<br>                post.setAuthor(author);<br>                post.setContent(content);<br>                postList.add(post);<br>            &#125;<br><br>            <span class="hljs-type">boolean</span> <span class="hljs-variable">saveBatch</span> <span class="hljs-operator">=</span> postService.saveBatch(postList);<br>            ThrowUtils.throwIf(!saveBatch, ErrorCode.OPERATION_ERROR, <span class="hljs-string">&quot;æ‰¹é‡æ’å…¥è¯—è¯å¤±è´¥&quot;</span>);<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-comment">// è®¡æ—¶ç»“æŸ</span><br>    stopWatch.stop();<br>    <span class="hljs-comment">// è®¡ç®—æ’å…¥æ‰€ç”¨æ€»æ—¶é—´</span><br>    System.out.println(stopWatch.getTotalTimeMillis() + <span class="hljs-string">&quot;ms&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure>

<p><img src="https://gitee.com/deng-2022/pictures/raw/master/images/image-20240213123016392.png" alt="image-20240213123016392"></p>
<p>1993 msï¼Œ2066msï¼Œ2847msï¼Œ2211msï¼Œ2459ms</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testFetchPoemByCompletable</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-comment">// newä¸€ä¸ªStopWatchå¯¹è±¡</span><br>    <span class="hljs-type">StopWatch</span> <span class="hljs-variable">stopWatch</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StopWatch</span>();<br>    <span class="hljs-comment">// è®¡æ—¶å¼€å§‹</span><br>    stopWatch.start();<br><br>    <span class="hljs-comment">// æŒ‰ä½œè€…æ‰¹é‡è·å–è¯—è¯</span><br>    String[] stringArray = &#123;<span class="hljs-string">&quot;æç™½&quot;</span>, <span class="hljs-string">&quot;æœç”«&quot;</span>, <span class="hljs-string">&quot;è‹è½¼&quot;</span>, <span class="hljs-string">&quot;ç‹ç»´&quot;</span>, <span class="hljs-string">&quot;æœç‰§&quot;</span>, <span class="hljs-string">&quot;é™†æ¸¸&quot;</span>, <span class="hljs-string">&quot;æç…œ&quot;</span>, <span class="hljs-string">&quot;å…ƒç¨¹&quot;</span>, <span class="hljs-string">&quot;éŸ©æ„ˆ&quot;</span>, <span class="hljs-string">&quot;å²‘å‚&quot;</span>, <span class="hljs-string">&quot;é½å·±&quot;</span>&#125;;<br>    List&lt;String&gt; authorList = Arrays.asList(stringArray);<br><br>    <span class="hljs-type">String</span> <span class="hljs-variable">originUrl</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;https://so.gushiwen.cn/shiwens/default.aspx?page=%d&amp;tstr=&amp;astr=%s&amp;cstr=&amp;xstr=&quot;</span>;<br><br>    <span class="hljs-comment">// åˆ›å»ºè‡ªå®šä¹‰çº¿ç¨‹æ± </span><br>    <span class="hljs-type">ExecutorService</span> <span class="hljs-variable">executorService</span> <span class="hljs-operator">=</span> Executors.newFixedThreadPool(<span class="hljs-number">5</span>);<br><br>    <span class="hljs-comment">// å­˜å‚¨æ‰€æœ‰çš„å¼‚æ­¥ä»»åŠ¡</span><br>    List&lt;CompletableFuture&lt;Void&gt;&gt; futures = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br><br>    <span class="hljs-keyword">for</span> (String authorStr : authorList) &#123;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>; i &lt; <span class="hljs-number">5</span>; i++) &#123;<br>            <span class="hljs-type">String</span> <span class="hljs-variable">url</span> <span class="hljs-operator">=</span> String.format(originUrl, i, authorStr);<br>            <span class="hljs-comment">// åˆ›å»ºå¼‚æ­¥ä»»åŠ¡</span><br>            CompletableFuture&lt;Void&gt; future = CompletableFuture.runAsync(() -&gt; &#123;<br>                <span class="hljs-keyword">try</span> &#123;<br>                    <span class="hljs-comment">// 1. è·å–æ•°æ®</span><br>                    <span class="hljs-type">Document</span> <span class="hljs-variable">doc</span> <span class="hljs-operator">=</span> Jsoup.connect(url)<br>                            .userAgent(<span class="hljs-string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/116.0.0.0 Safari/537.36 Edg/116.0.1938.81&quot;</span>)<br>                            .get();<br><br>                    <span class="hljs-comment">// æ•è· id = &quot;leftZhankai&quot;</span><br>                    <span class="hljs-type">Element</span> <span class="hljs-variable">leftZhankai</span> <span class="hljs-operator">=</span> doc.getElementById(<span class="hljs-string">&quot;leftZhankai&quot;</span>);<br>                    <span class="hljs-type">Elements</span> <span class="hljs-variable">heads</span> <span class="hljs-operator">=</span> leftZhankai.select(<span class="hljs-string">&quot;.sons .cont div:nth-of-type(2)&quot;</span>);<br><br>                    ArrayList&lt;Post&gt; postList = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br>                    <span class="hljs-keyword">for</span> (Element head : heads) &#123;<br>                        <span class="hljs-type">Post</span> <span class="hljs-variable">post</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Post</span>();<br><br>                        <span class="hljs-type">String</span> <span class="hljs-variable">title</span> <span class="hljs-operator">=</span> head.select(<span class="hljs-string">&quot;&gt;p:nth-of-type(1)&quot;</span>).text();<br>                        <span class="hljs-type">String</span> <span class="hljs-variable">author</span> <span class="hljs-operator">=</span> head.select(<span class="hljs-string">&quot;&gt;p:nth-of-type(2)&quot;</span>).text();<br>                        <span class="hljs-type">String</span> <span class="hljs-variable">content</span> <span class="hljs-operator">=</span> head.select(<span class="hljs-string">&quot;.contson&quot;</span>).text();<br>                        System.out.println(title);<br>                        System.out.println(author);<br>                        System.out.println(content);<br><br>                        System.out.println(<span class="hljs-string">&quot;------------------------------------&quot;</span>);<br><br>                        post.setTitle(title);<br>                        post.setAuthor(author);<br>                        post.setContent(content);<br>                        postList.add(post);<br>                    &#125;<br><br>                    <span class="hljs-type">boolean</span> <span class="hljs-variable">saveBatch</span> <span class="hljs-operator">=</span> postService.saveBatch(postList);<br>                    ThrowUtils.throwIf(!saveBatch, ErrorCode.OPERATION_ERROR, <span class="hljs-string">&quot;æ‰¹é‡æ’å…¥è¯—è¯å¤±è´¥&quot;</span>);<br>                &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>                    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(e);<br>                &#125;<br>            &#125;, executorService);<br><br>            <span class="hljs-comment">// å°†å¼‚æ­¥ä»»åŠ¡æ·»åŠ åˆ°åˆ—è¡¨ä¸­</span><br>            futures.add(future);<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-comment">// ç­‰å¾…æ‰€æœ‰å¼‚æ­¥ä»»åŠ¡å®Œæˆ</span><br>    CompletableFuture.allOf(futures.toArray(<span class="hljs-keyword">new</span> <span class="hljs-title class_">CompletableFuture</span>[<span class="hljs-number">0</span>])).join();<br>    <span class="hljs-comment">// å…³é—­çº¿ç¨‹æ± </span><br>    executorService.shutdown();<br>    <span class="hljs-comment">// è®¡æ—¶ç»“æŸ</span><br>    stopWatch.stop();<br>    <span class="hljs-comment">// è®¡ç®—æ’å…¥æ‰€ç”¨æ€»æ—¶é—´</span><br>    System.out.println(stopWatch.getTotalTimeMillis() + <span class="hljs-string">&quot;ms&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure>

<p><img src="https://gitee.com/deng-2022/pictures/raw/master/images/image-20240213125219270.png" alt="image-20240213125219270"></p>
<p>1445msï¼Œ1265msï¼Œ1400msï¼Œ1199msï¼Œ1312ms</p>
<p>æŒ‰ä½œè€…æ‰¹é‡è·å–è¯—è¯ï¼ŒäºŒåå››ä¸ªä½œè€…ï¼Œæ¯ä½ä½œè€…å››é¡µï¼Œæ¯é¡µ10é¦–ï¼Œæ‰¹é‡æ’å…¥è¯—è¯è®°å½•åˆ°æ•°æ®åº“ï¼ˆé¢˜ç›®ï¼Œä½œè€…ï¼Œå†…å®¹ï¼‰</p>
<p>æ™®é€šæ‰¹é‡æ’å…¥ï¼š4168ms ï¼Œå¼‚æ­¥ç¼–ç¨‹æ‰¹é‡æ’å…¥ï¼š1719ms</p>
<p><img src="https://gitee.com/deng-2022/pictures/raw/master/images/image-20240213150539496.png" alt="image-20240213150539496"></p>
<p><img src="https://gitee.com/deng-2022/pictures/raw/master/images/image-20240213150326802.png" alt="image-20240213150326802"></p>
<h2 id="æœç´¢è¯å»ºè®®-1"><a href="#æœç´¢è¯å»ºè®®-1" class="headerlink" title="æœç´¢è¯å»ºè®®"></a>æœç´¢è¯å»ºè®®</h2><p>ä¼˜åŒ–<strong>çƒ­é—¨æœç´¢ç»Ÿè®¡</strong>ï¼š</p>
<figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs tsx"><span class="hljs-comment">// ä¿å­˜æœç´¢è¯</span><br> <span class="hljs-keyword">const</span> res = <span class="hljs-keyword">await</span> <span class="hljs-title class_">SearchControllerService</span>.<span class="hljs-title function_">setHotWordsUsingGet</span>(searchText).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span> &#123;<br>   <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(res.<span class="hljs-property">data</span>)<br> &#125;)<br></code></pre></td></tr></table></figure>

<p>æ‰§è¡Œæœç´¢ï¼ŒåŒæ­¥å­˜æ”¾æœç´¢è¯åˆ° Elasticsearch ç´¢å¼•ä¸­ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// åŒæ­¥ä¿å­˜æœç´¢è¯åˆ° Elasticsearch ä¸­</span><br><span class="hljs-type">MessageEsDTO</span> <span class="hljs-variable">messageEsDTO</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MessageEsDTO</span>();<br>BeanUtils.copyProperties(messageDTO, messageEsDTO);<br><br><span class="hljs-comment">// ç”Ÿæˆå”¯ä¸€ id</span><br><span class="hljs-type">String</span> <span class="hljs-variable">uniqueId</span> <span class="hljs-operator">=</span> getUniqueId(searchText);<br>messageEsDTO.setId(uniqueId);<br><span class="hljs-type">MessageEsDTO</span> <span class="hljs-variable">save</span> <span class="hljs-operator">=</span> elasticsearchRestTemplate.save(messageEsDTO);<br>ThrowUtils.throwIf(ObjectUtils.isEmpty(save), ErrorCode.OPERATION_ERROR);<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * æœç´¢è¯ ES åŒ…è£…ç±»</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> memory</span><br><span class="hljs-comment"> **/</span><br><span class="hljs-meta">@Document(indexName = &quot;search_text&quot;)</span><br><span class="hljs-meta">@Data</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MessageEsDTO</span> &#123;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æ–‡ç« id</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Id</span><br>    <span class="hljs-keyword">private</span> String id;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * ç”¨æˆ·</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> Long userId;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æœç´¢è¯æ¡</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> String searchText;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>æ ¹æ®æœç´¢è¯å†…å®¹ï¼Œä½¿ç”¨ <strong>MD5 æ‘˜è¦ç®—æ³•</strong>ç”Ÿæˆå”¯ä¸€ idï¼ŒåŒæ­¥ä¿å­˜æ•°æ®åˆ° Elasticsearch ä¸­ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * ç”Ÿæˆå”¯ä¸€ id</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> searchText æœç´¢è¯</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@return</span> å”¯ä¸€ id</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">private</span> String <span class="hljs-title function_">getUniqueId</span><span class="hljs-params">(String searchText)</span> &#123;<br>    <span class="hljs-keyword">try</span> &#123;<br>        <span class="hljs-comment">// è·å–MD5ä¿¡æ¯æ‘˜è¦å®ä¾‹</span><br>        <span class="hljs-type">MessageDigest</span> <span class="hljs-variable">md</span> <span class="hljs-operator">=</span> MessageDigest.getInstance(<span class="hljs-string">&quot;MD5&quot;</span>);<br>        <span class="hljs-comment">// è®¡ç®—æœç´¢è¯çš„MD5å“ˆå¸Œå€¼</span><br>        <span class="hljs-type">byte</span>[] hashBytes = md.digest(searchText.getBytes());<br><br>        <span class="hljs-type">StringBuilder</span> <span class="hljs-variable">hexString</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringBuilder</span>();<br>        <span class="hljs-comment">// å°†å­—èŠ‚æ•°ç»„è½¬æ¢ä¸ºåå…­è¿›åˆ¶å­—ç¬¦ä¸²</span><br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">byte</span> b : hashBytes) &#123;<br>            <span class="hljs-type">String</span> <span class="hljs-variable">hex</span> <span class="hljs-operator">=</span> Integer.toHexString(<span class="hljs-number">0xff</span> &amp; b);<br>            <span class="hljs-keyword">if</span> (hex.length() == <span class="hljs-number">1</span>) hexString.append(<span class="hljs-string">&#x27;0&#x27;</span>);<br>            hexString.append(hex);<br>        &#125;<br><br>        <span class="hljs-comment">// ç”Ÿæˆæœ€ç»ˆçš„å”¯ä¸€IDï¼Œä½¿ç”¨uniqueIdä½œä¸ºæ–‡æ¡£çš„ID</span><br>        <span class="hljs-keyword">return</span> hexString.toString();<br>    &#125; <span class="hljs-keyword">catch</span> (NoSuchAlgorithmException e) &#123;<br>        <span class="hljs-comment">// å¤„ç†å¼‚å¸¸</span><br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(e);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>æ•ˆæœå¦‚ä¸‹ï¼ŒElasticsearch ç´¢å¼•ä¸­ä»…ä¿å­˜æœç´¢è¯æ¡ï¼Œæ— éœ€å…³æ³¨è¯æ¡è¢«æœç´¢æ¬¡æ•°</p>
<p><img src="https://gitee.com/deng-2022/pictures/raw/master/images/image-20240213181525090.png" alt="image-20240213181525090"></p>
<p>æ–°å¢æœç´¢è¯ç´¢å¼•ï¼ŒsearchText å­—æ®µæ·»åŠ  suggest å±æ€§ï¼Œæ”¯æŒ<strong>å‰ç¼€æœç´¢å»ºè®®</strong>ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs bash">PUT /search_text<br>&#123;<br>    <span class="hljs-string">&quot;mappings&quot;</span> : &#123;<br>      <span class="hljs-string">&quot;properties&quot;</span> : &#123;<br>          <span class="hljs-string">&quot;id&quot;</span> : &#123;<br>          <span class="hljs-string">&quot;type&quot;</span> : <span class="hljs-string">&quot;text&quot;</span>,<br>          <span class="hljs-string">&quot;fields&quot;</span> : &#123;<br>            <span class="hljs-string">&quot;keyword&quot;</span> : &#123;<br>              <span class="hljs-string">&quot;type&quot;</span> : <span class="hljs-string">&quot;keyword&quot;</span>,<br>              <span class="hljs-string">&quot;ignore_above&quot;</span> : 256<br>            &#125;<br>          &#125;<br>        &#125;,<br>        <span class="hljs-string">&quot;searchText&quot;</span> : &#123;<br>           <span class="hljs-string">&quot;type&quot;</span> : <span class="hljs-string">&quot;text&quot;</span>,<br>          <span class="hljs-string">&quot;fields&quot;</span> : &#123;<br>            <span class="hljs-string">&quot;keyword&quot;</span> : &#123;<br>              <span class="hljs-string">&quot;type&quot;</span> : <span class="hljs-string">&quot;keyword&quot;</span>,<br>              <span class="hljs-string">&quot;ignore_above&quot;</span> : 256<br>            &#125;,<br>            <span class="hljs-string">&quot;suggest&quot;</span> : &#123;<br>              <span class="hljs-string">&quot;type&quot;</span> : <span class="hljs-string">&quot;completion&quot;</span>,<br>              <span class="hljs-string">&quot;analyzer&quot;</span> : <span class="hljs-string">&quot;ik_max_word&quot;</span>,<br>              <span class="hljs-string">&quot;preserve_separators&quot;</span> : <span class="hljs-literal">true</span>,<br>              <span class="hljs-string">&quot;preserve_position_increments&quot;</span> : <span class="hljs-literal">true</span>,<br>              <span class="hljs-string">&quot;max_input_length&quot;</span> : 50<br>            &#125;<br>          &#125;,<br>          <span class="hljs-string">&quot;analyzer&quot;</span> : <span class="hljs-string">&quot;ik_max_word&quot;</span>,<br>          <span class="hljs-string">&quot;search_analyzer&quot;</span> : <span class="hljs-string">&quot;ik_smart&quot;</span><br>        &#125;,<br>        <span class="hljs-string">&quot;userId&quot;</span> : &#123;<br>          <span class="hljs-string">&quot;type&quot;</span> : <span class="hljs-string">&quot;long&quot;</span><br>        &#125;<br>    &#125;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>æ‰§è¡Œæœç´¢ï¼Œä¿å­˜æœç´¢è¯æ¡åˆ° Elasticsearch ç´¢å¼•ä¸­ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// åŒæ­¥ä¿å­˜æœç´¢è¯åˆ° Elasticsearch ä¸­</span><br><span class="hljs-type">MessageEsDTO</span> <span class="hljs-variable">messageEsDTO</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MessageEsDTO</span>();<br>BeanUtils.copyProperties(messageDTO, messageEsDTO);<br><br><span class="hljs-comment">// ç”Ÿæˆå”¯ä¸€ id</span><br><span class="hljs-type">String</span> <span class="hljs-variable">uniqueId</span> <span class="hljs-operator">=</span> getUniqueId(searchText);<br>messageEsDTO.setId(uniqueId);<br><span class="hljs-type">MessageEsDTO</span> <span class="hljs-variable">save</span> <span class="hljs-operator">=</span> elasticsearchRestTemplate.save(messageEsDTO);<br>ThrowUtils.throwIf(ObjectUtils.isEmpty(save), ErrorCode.OPERATION_ERROR);<br></code></pre></td></tr></table></figure>

<p><img src="https://gitee.com/deng-2022/pictures/raw/master/images/image-20240213191453168.png" alt="image-20240213191453168"></p>
<p>æ ¹æ®æœç´¢è¯æ¡ï¼Œä»å†å²æœç´¢è¯æ¡ä¸­è¿”å›æœç´¢å»ºè®®ï¼ˆå¯ä¼˜åŒ–ï¼Œä»çƒ­é—¨è¯æ¡ä¸­è¿”å›æœç´¢å»ºè®®ï¼‰ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// æœç´¢å»ºè®®</span><br><span class="hljs-type">SuggestBuilder</span> <span class="hljs-variable">suggestBuilder</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SuggestBuilder</span>()<br>        .addSuggestion(<span class="hljs-string">&quot;suggestionTitle&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">CompletionSuggestionBuilder</span>(<span class="hljs-string">&quot;searchText.suggest&quot;</span>).skipDuplicates(<span class="hljs-literal">true</span>).size(<span class="hljs-number">5</span>).prefix(suggestText));<br><br><span class="hljs-comment">// æ„é€ æŸ¥è¯¢</span><br><span class="hljs-type">NativeSearchQuery</span> <span class="hljs-variable">searchQuery</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">NativeSearchQueryBuilder</span>()<br>        .withSuggestBuilder(suggestBuilder)<br>        .build();<br><br><span class="hljs-comment">// æ‰§è¡Œæœç´¢</span><br>SearchHits&lt;MessageEsDTO&gt; searchHits = elasticsearchRestTemplate.search(searchQuery, MessageEsDTO.class);<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// æœç´¢å»ºè®®è¯åˆ—è¡¨</span><br>ArrayList&lt;String&gt; suggestionList = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br><br><span class="hljs-comment">// ä» SearchResponse ä¸­è·å–å»ºè®®</span><br><span class="hljs-type">Suggest</span> <span class="hljs-variable">suggest</span> <span class="hljs-operator">=</span> searchHits.getSuggest();<br><span class="hljs-keyword">if</span> (suggest != <span class="hljs-literal">null</span>) &#123;<br>    <span class="hljs-comment">// è·å–ç‰¹å®šçš„å»ºè®®ç»“æœ</span><br>    Suggest.Suggestion&lt;? <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Suggest</span>.Suggestion.Entry&lt;? <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Suggest</span>.Suggestion.Entry.Option&gt;&gt; termSuggestion = suggest.getSuggestion(<span class="hljs-string">&quot;suggestionTitle&quot;</span>);<br>    <span class="hljs-comment">// éå†å»ºè®®é€‰é¡¹</span><br>    <span class="hljs-keyword">for</span> (Suggest.Suggestion.Entry&lt;? <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Suggest</span>.Suggestion.Entry.Option&gt; entry : termSuggestion.getEntries()) &#123;<br>        <span class="hljs-comment">// å¤„ç†æ¯ä¸ªå»ºè®®é€‰é¡¹ï¼Œä¾‹å¦‚æ‰“å°å®ƒä»¬</span><br>        <span class="hljs-keyword">for</span> (Suggest.Suggestion.Entry.Option option : entry.getOptions()) &#123;<br>            <span class="hljs-keyword">if</span> (option != <span class="hljs-literal">null</span>) &#123;<br>                <span class="hljs-type">String</span> <span class="hljs-variable">text</span> <span class="hljs-operator">=</span> option.getText();<br>                suggestionList.add(text);<br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><img src="https://gitee.com/deng-2022/pictures/raw/master/images/image-20240213194835349.png" alt="image-20240213194835349"></p>
<h2 id="æ–‡ç« çˆ¬å–"><a href="#æ–‡ç« çˆ¬å–" class="headerlink" title="æ–‡ç« çˆ¬å–"></a>æ–‡ç« çˆ¬å–</h2><p>å¦ˆçš„ï¼Œæ ‡é¢˜è¿˜æœ‰å¸¦è¡¨æƒ…çš„ï¼š</p>
<p><img src="https://gitee.com/deng-2022/pictures/raw/master/images/image-20240213232409333.png"></p>
<h2 id="äº®ç‚¹"><a href="#äº®ç‚¹" class="headerlink" title="äº®ç‚¹"></a>äº®ç‚¹</h2><p>è®¾è®¡æ¨¡å¼ï¼šé€‚é…å™¨æ¨¡å¼ï¼Œæ³¨å†Œå™¨æ¨¡å¼ï¼Œé—¨é¢æ¨¡å¼</p>
<p>æ•°æ®æŠ“å–ï¼š</p>
<ul>
<li>çˆ¬è™«è·å–å¤–éƒ¨èµ„æºï¼Œçˆ¬å–å›¾ç‰‡ã€è§†é¢‘ï¼Œ<strong>å¼‚æ­¥å¤„ç†</strong>è€—æ—¶è¯·æ±‚</li>
<li>å®šæ—¶ä»»åŠ¡ï¼š<strong>å®šæ—¶</strong>åŒæ­¥ï¼ˆçˆ¬å–ï¼‰å¤–éƒ¨æ–‡ç« èµ„æº</li>
<li>è¯—è¯æŠ“å–ï¼šå¼‚æ­¥ç¼–ç¨‹ï¼ŒæŒ‰ä½œè€…æ‰¹é‡è·å–è¯—è¯ï¼ŒäºŒåå››ä¸ªä½œè€…ï¼Œæ¯ä½ä½œè€…å››é¡µï¼Œæ¯é¡µ10é¦–ï¼Œæ‰¹é‡æ’å…¥è¯—è¯è®°å½•åˆ°æ•°æ®åº“ï¼ˆé¢˜ç›®ï¼Œä½œè€…ï¼Œå†…å®¹ï¼‰</li>
<li>æ–‡ç« çˆ¬å–ï¼š</li>
<li>å›¾ç‰‡çˆ¬å–ï¼š</li>
</ul>
<p>æ•°æ®åŒæ­¥æ–¹å¼ï¼š</p>
<ul>
<li>è‡ªä¸»ç¼–ç å®ç° MySQL -&gt; ES æ•°æ®åŒæ­¥ï¼›ç°æˆä¸­é—´ä»¶ï¼š</li>
<li>Logstash æ•°æ®åŒæ­¥ç®¡é“ï¼Œé…ç½®è¾“å…¥è¾“å‡ºæºï¼›</li>
<li>Canal + MQ å®ç°ç›‘å¬æ•°æ®åº“æµæ°´ï¼ˆè®¾æƒ³ï¼‰</li>
</ul>
<p>Elastic Stack æŠ€æœ¯æ ˆï¼š</p>
<ul>
<li>ES å’Œ MySQL çš„æ¯”è¾ƒï¼ŒES çš„æ¦‚å¿µï¼Œè¦è§£å†³çš„é—®é¢˜</li>
<li>DSL è¯­æ³•ï¼šç®€å•ç´¢å¼•çš„å¢åˆ æ”¹ï¼Œæ–‡æ¡£çš„å¢åˆ æ”¹ï¼Œå¤åˆæŸ¥è¯¢ã€å…¨æ–‡æœç´¢ã€term æŸ¥è¯¢ã€èšåˆæŸ¥è¯¢ã€å¸ƒå°”æŸ¥è¯¢ï¼Œæœç´¢å»ºè®®è¯ã€å…³é”®è¯</li>
<li>åˆ†è¯å™¨ï¼šå†…ç½®åˆ†è¯å™¨ã€IK åˆ†è¯å™¨</li>
<li>Java æ“ä½œ ESï¼šES å®˜æ–¹æä¾› APIã€Spring Data Elasticsearch</li>
<li>Logstash æ•°æ®åŒæ­¥ç®¡é“ï¼šé…ç½®è¾“å…¥è¾“å‡ºæºï¼ŒåŒæ­¥ MySQL -&gt; ES çš„æ•°æ®</li>
<li>Kibana æ•°æ®çœ‹æ¿ï¼šæ­å»ºæ•°æ®çœ‹æ¿ï¼Œæ•°æ®åˆ†æ</li>
<li>ES å®ç°æœç´¢è¯æ¡å»ºè®®ã€å…³é”®è¯è¯­é«˜äº®ã€çƒ­é—¨æœç´¢ç»Ÿè®¡ã€çƒ­é—¨è¯é¢˜åˆ†æ</li>
</ul>
<p>Redisï¼š</p>
<ul>
<li><p>Redis åŸºæœ¬çš„æ•°æ®ç»“æ„ç±»å‹</p>
</li>
<li><p>ä½¿ç”¨ Zset å®ç°çƒ­é—¨æœç´¢è¯ï¼ˆæ’è¡Œæ¦œï¼‰</p>
</li>
<li><p>ä¿ç•™è¿‘æœŸå†…çš„æœç´¢æ•°æ®ï¼ˆå›¾ç‰‡ï¼Œè§†é¢‘ï¼‰ï¼Œä¿å­˜ 24 å°æ—¶</p>
</li>
</ul>
<p>ç”¨æˆ·ï¼š</p>
<ul>
<li>sessionId / ThreadLocal ä¿å­˜ç™»å½•ç”¨æˆ·ä¿¡æ¯</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">ç”¨æˆ·ä¼šè¯ç®¡ç†ï¼šåœ¨Webåº”ç”¨ä¸­ï¼Œä¸ºäº†è·Ÿè¸ªç”¨æˆ·çš„ä¼šè¯ä¿¡æ¯ï¼Œé€šå¸¸ä¼šå°†ç”¨æˆ·ä¼šè¯æ•°æ®å­˜å‚¨åœ¨HttpSessionå¯¹è±¡ä¸­ã€‚ç„¶è€Œï¼Œç”±äºæ¯ä¸ªè¯·æ±‚å¯èƒ½ç”±ä¸åŒçš„çº¿ç¨‹å¤„ç†ï¼Œç›´æ¥ä½¿ç”¨HttpSessionä¼šå¯¼è‡´çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚ä½¿ç”¨ThreadLocalå¯ä»¥å°†ç”¨æˆ·ä¼šè¯æ•°æ®å­˜å‚¨åœ¨æ¯ä¸ªçº¿ç¨‹ä¸­ï¼Œç¡®ä¿æ¯ä¸ªçº¿ç¨‹éƒ½èƒ½ç‹¬ç«‹åœ°è®¿é—®ç”¨æˆ·ä¼šè¯æ•°æ®ã€‚<br></code></pre></td></tr></table></figure>

<ul>
<li>ä½¿ç”¨ Markdown ç¼–è¾‘å™¨å‘å¸ƒæ–‡ç« ï¼Œ<strong>äº¤ç”±å®¡æ ¸</strong></li>
<li>å•è®¾å¤‡ç™»å½•é™åˆ¶</li>
</ul>
<p>æƒé™æ ¡éªŒï¼š</p>
<ul>
<li>å‰ç«¯ï¼Œæ ¡éªŒæ˜¯å¦ç™»å½•ï¼›æ ¹æ®ç”¨æˆ·èº«ä»½ï¼Œé™åˆ¶æ™®é€šç”¨æˆ·è®¿é—®é¡µé¢</li>
<li>åç«¯ï¼šå…¨å±€è¿‡æ»¤å™¨ï¼Œé™åˆ¶é¡µé¢è®¿é—®æƒé™ï¼Œæ ¡éªŒç™»å½•</li>
<li>Spring AOP + è‡ªå®šä¹‰æ³¨è§£ï¼Œå®ç°å…¨å±€è¯·æ±‚å“åº”æ‹¦æˆªå’Œæƒé™æ ¡éªŒ</li>
</ul>
<p>é«˜æµé‡ï¼šå¦‚ä½•æŠµå¾¡å¤§é‡æœç´¢è¯·æ±‚ï¼Œä¿è¯æ•°æ®è®°å½•æ­£ç¡®</p>
<ul>
<li>ç¼“å­˜ï¼šä¿ç•™è¿‘æœŸå†…çš„æœç´¢æ•°æ®ï¼ˆå›¾ç‰‡ï¼Œè§†é¢‘ï¼‰ï¼Œä¿å­˜ 24 å°æ—¶</li>
<li>é™æµï¼šå››å¤§é™æµç®—æ³•ï¼Œç®€å•é™æµã€æ»‘åŠ¨çª—å£é™æµã€æ¼æ¡¶é™æµã€ä»¤ç‰Œæ¡¶é™æµ</li>
<li>é™çº§ï¼š</li>
</ul>
<p>å¹¶å‘ç¼–ç¨‹ï¼šå¯¹äºè€—æ—¶è¯·æ±‚ï¼Œå¼‚æ­¥å¤„ç†ï¼šä»å¤–æºæœç´¢å›¾ç‰‡ã€è§†é¢‘</p>
<p>Springï¼š</p>
<ul>
<li>Spring AOP + è‡ªå®šä¹‰æ³¨è§£ï¼Œå®ç°å…¨å±€è¯·æ±‚å“åº”æ‹¦æˆªå’Œæƒé™æ ¡éªŒ</li>
<li>å¤šç¯å¢ƒé…ç½®ï¼šé…ç½® å¼€å‘ç¯å¢ƒã€ç”Ÿäº§ç¯å¢ƒï¼Œæ–¹ä¾¿é¡¹ç›®å¼€å‘ã€æµ‹è¯•ã€éƒ¨ç½²ä¸Šçº¿</li>
</ul>
<p>å…¶ä»–ï¼š</p>
<p>æ¥å£æ–‡æ¡£ã€Markdown æ–‡æ¡£ç¼–è¾‘å™¨</p>
<h2 id="æ€è€ƒï¼š"><a href="#æ€è€ƒï¼š" class="headerlink" title="æ€è€ƒï¼š"></a>æ€è€ƒï¼š</h2><h3 id="å¦‚ä½•åˆ†ææ–‡ç« çƒ­åº¦ï¼Ÿ"><a href="#å¦‚ä½•åˆ†ææ–‡ç« çƒ­åº¦ï¼Ÿ" class="headerlink" title="å¦‚ä½•åˆ†ææ–‡ç« çƒ­åº¦ï¼Ÿ"></a>å¦‚ä½•åˆ†ææ–‡ç« çƒ­åº¦ï¼Ÿ</h3><h3 id="Elasticseach-æ•°æ®å­˜å‚¨åœ¨ç¡¬ç›˜å†…ï¼Œå¦‚ä½•é€‰æ‹©åˆé€‚çš„åˆ é™¤ç­–ç•¥ï¼Œæ¸…ç†è¿‡æœŸæ•°æ®å‘¢"><a href="#Elasticseach-æ•°æ®å­˜å‚¨åœ¨ç¡¬ç›˜å†…ï¼Œå¦‚ä½•é€‰æ‹©åˆé€‚çš„åˆ é™¤ç­–ç•¥ï¼Œæ¸…ç†è¿‡æœŸæ•°æ®å‘¢" class="headerlink" title="Elasticseach æ•°æ®å­˜å‚¨åœ¨ç¡¬ç›˜å†…ï¼Œå¦‚ä½•é€‰æ‹©åˆé€‚çš„åˆ é™¤ç­–ç•¥ï¼Œæ¸…ç†è¿‡æœŸæ•°æ®å‘¢"></a>Elasticseach æ•°æ®å­˜å‚¨åœ¨ç¡¬ç›˜å†…ï¼Œå¦‚ä½•é€‰æ‹©åˆé€‚çš„åˆ é™¤ç­–ç•¥ï¼Œæ¸…ç†è¿‡æœŸæ•°æ®å‘¢</h3><p>Elasticsearchä¸€ä¸ªç´¢å¼•å†…å¯ä»¥å­˜æ”¾çš„æ•°æ®æ¡æ•°å¹¶æ²¡æœ‰å›ºå®šçš„ä¸Šé™ï¼Œå®ƒä¸»è¦å–å†³äºä»¥ä¸‹å‡ ä¸ªå› ç´ ï¼š</p>
<ol>
<li><strong>ç£ç›˜ç©ºé—´</strong>ï¼šç´¢å¼•çš„å¤§å°å—é™äºå¯ç”¨ç£ç›˜ç©ºé—´ã€‚Elasticsearchä¼šå°†ç´¢å¼•æ•°æ®å­˜å‚¨åœ¨ç£ç›˜ä¸Šï¼Œå› æ­¤ç£ç›˜ç©ºé—´æ˜¯é™åˆ¶ç´¢å¼•å¤§å°çš„ä¸»è¦å› ç´ ã€‚</li>
<li><strong>åˆ†ç‰‡é…ç½®</strong>ï¼šElasticsearché€šè¿‡åˆ†ç‰‡ï¼ˆshardsï¼‰æ¥æ°´å¹³æ‰©å±•æ•°æ®ï¼Œæ¯ä¸ªç´¢å¼•å¯ä»¥åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªåˆ†ç‰‡ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œä¸€ä¸ªç´¢å¼•ä¼šæœ‰5ä¸ªä¸»åˆ†ç‰‡ï¼ˆprimary shardsï¼‰ï¼Œä½†å¯ä»¥åœ¨åˆ›å»ºç´¢å¼•æ—¶æŒ‡å®šä¸åŒçš„åˆ†ç‰‡æ•°ã€‚åˆ†ç‰‡æ•°è¶Šå¤šï¼Œç´¢å¼•å¯ä»¥å®¹çº³çš„æ•°æ®é‡å°±è¶Šå¤§ï¼Œä½†åŒæ—¶ä¹Ÿä¼šå¢åŠ é›†ç¾¤çš„ç®¡ç†å¤æ‚æ€§ã€‚</li>
<li><strong>æ–‡æ¡£å¤§å°</strong>ï¼šå•ä¸ªæ–‡æ¡£çš„å¤§å°ä¹Ÿä¼šå½±å“ç´¢å¼•çš„å®¹é‡ã€‚è™½ç„¶Elasticsearchæ”¯æŒéå¸¸å¤§çš„æ–‡æ¡£ï¼Œä½†è¿‡å¤§çš„æ–‡æ¡£å¯èƒ½ä¼šé™ä½å†™å…¥æ€§èƒ½å¹¶å¢åŠ ç´¢å¼•çš„å­˜å‚¨éœ€æ±‚ã€‚</li>
</ol>
<p>å½“ç´¢å¼•è¾¾åˆ°å…¶å­˜å‚¨é™åˆ¶æ—¶ï¼ŒElasticsearchä¸ä¼šç›´æ¥æ‹’ç»æ–°çš„æ•°æ®å†™å…¥ã€‚ç›¸åï¼Œå®ƒä¼šæ ¹æ®é…ç½®çš„ç­–ç•¥æ¥å¤„ç†è¿™ç§æƒ…å†µã€‚å¸¸è§çš„åˆ é™¤ç­–ç•¥åŒ…æ‹¬ï¼š</p>
<ol>
<li><strong>åŸºäºæ—¶é—´çš„åˆ é™¤</strong>ï¼šä½¿ç”¨ç´¢å¼•ç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼ˆILMï¼‰ç­–ç•¥ï¼Œæ ¹æ®æ—¶é—´æˆ³å­—æ®µè‡ªåŠ¨åˆ é™¤æ—§æ•°æ®ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥è®¾ç½®ä¸€ä¸ªç­–ç•¥ï¼Œä½¿å¾—ç´¢å¼•åœ¨åˆ›å»ºåçš„ä¸€å®šæ—¶é—´åè¢«åˆ é™¤ã€‚</li>
<li><strong>åŸºäºå¤§å°çš„åˆ é™¤</strong>ï¼šå½“ç´¢å¼•è¾¾åˆ°ä¸€å®šçš„å¤§å°æ—¶ï¼Œå¯ä»¥é…ç½®ILMç­–ç•¥æ¥åˆ é™¤æ—§æ•°æ®ï¼Œæˆ–è€…é€šè¿‡æ‰‹åŠ¨å¹²é¢„æ¥åˆ é™¤ä¸éœ€è¦çš„æ•°æ®ã€‚</li>
<li><strong>åŸºäºæ–‡æ¡£æ•°é‡çš„åˆ é™¤</strong>ï¼šè™½ç„¶Elasticsearchä¸ç›´æ¥åŸºäºæ–‡æ¡£æ•°é‡é™åˆ¶ç´¢å¼•å¤§å°ï¼Œä½†å¯ä»¥é€šè¿‡åˆ é™¤æ—§æ–‡æ¡£æ¥ç®¡ç†ç´¢å¼•çš„å¤§å°ã€‚è¿™å¯ä»¥é€šè¿‡ç¼–å†™åˆ é™¤æŸ¥è¯¢æˆ–ä½¿ç”¨ILMç­–ç•¥æ¥å®ç°ã€‚</li>
<li><strong>æ»šåŠ¨ç´¢å¼•</strong>ï¼šåœ¨æŸäº›åœºæ™¯ä¸­ï¼Œå¯ä»¥ä½¿ç”¨æ»šåŠ¨ç´¢å¼•ï¼ˆrolling indicesï¼‰æ¨¡å¼ï¼Œå³å®šæœŸåˆ›å»ºæ–°çš„ç´¢å¼•æ¥å­˜å‚¨æ–°æ•°æ®ï¼Œè€Œæ—§ç´¢å¼•å¯ä»¥è¢«åˆ é™¤æˆ–å½’æ¡£ã€‚è¿™ç§ç­–ç•¥å¸¸è§äºæ—¥å¿—æ”¶é›†å’Œåˆ†æåœºæ™¯ã€‚</li>
</ol>
<p>åœ¨å®é™…åº”ç”¨ä¸­ï¼Œå»ºè®®æ ¹æ®ä¸šåŠ¡éœ€æ±‚å’Œæ•°æ®ç‰¹ç‚¹æ¥é€‰æ‹©åˆé€‚çš„åˆ é™¤ç­–ç•¥ã€‚åŒæ—¶ï¼Œç›‘æ§Elasticsearché›†ç¾¤çš„å¥åº·çŠ¶å†µå’Œæ€§èƒ½ï¼Œç¡®ä¿æ•°æ®çš„æœ‰æ•ˆç®¡ç†å’Œç³»ç»Ÿçš„ç¨³å®šè¿è¡Œã€‚</p>
<p>Elasticsearch é»˜è®¤ä¸æä¾›è‡ªåŠ¨åˆ é™¤æ—§æ•°æ®çš„ç­–ç•¥ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œç´¢å¼•ä¼šä¸€ç›´å­˜åœ¨ï¼Œç›´åˆ°ä½ æ‰‹åŠ¨åˆ é™¤å®ƒä»¬æˆ–è€…ç£ç›˜ç©ºé—´è€—å°½ã€‚ä½†æ˜¯ï¼ŒElasticsearch æä¾›äº†ç´¢å¼•ç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼ˆILMï¼‰åŠŸèƒ½ï¼Œå…è®¸ä½ å®šä¹‰è‡ªå·±çš„åˆ é™¤ç­–ç•¥ã€‚</p>
<p>å½“ä½ åˆ›å»ºä¸€ä¸ªç´¢å¼•æ—¶ï¼Œé™¤éä½ æ˜ç¡®æŒ‡å®šäº†ILMç­–ç•¥ï¼Œå¦åˆ™è¯¥ç´¢å¼•ä¸ä¼šå—åˆ°ä»»ä½•è‡ªåŠ¨åˆ é™¤ç­–ç•¥çš„å½±å“ã€‚è¿™æ„å‘³ç€ä½ éœ€è¦ä¸»åŠ¨ç®¡ç†ç´¢å¼•çš„ç”Ÿå‘½å‘¨æœŸï¼ŒåŒ…æ‹¬å†³å®šä½•æ—¶åˆ é™¤ä¸å†éœ€è¦çš„ç´¢å¼•ã€‚</p>
<p>åœ¨ILMä¸­ï¼Œä½ å¯ä»¥å®šä¹‰ç­–ç•¥æ¥æ ¹æ®ç´¢å¼•çš„å¹´é¾„ã€å¤§å°æˆ–å…¶ä»–æ¡ä»¶è‡ªåŠ¨å°†ç´¢å¼•ç§»åŠ¨åˆ°åªè¯»çŠ¶æ€ï¼Œå¹¶æœ€ç»ˆåˆ é™¤å®ƒä»¬ã€‚ä½†æ˜¯ï¼Œå¦‚æœä½ ä¸é…ç½®ILMæˆ–ä½¿ç”¨é»˜è®¤çš„ILMç­–ç•¥ï¼Œç´¢å¼•å°†ä¸ä¼šè‡ªåŠ¨è¢«åˆ é™¤ã€‚</p>
<p>å› æ­¤ï¼Œä¸ºäº†æœ‰æ•ˆåœ°ç®¡ç†Elasticsearchä¸­çš„ç´¢å¼•å’Œæ•°æ®ï¼Œå»ºè®®é…ç½®é€‚å½“çš„ILMç­–ç•¥ï¼Œä»¥ç¡®ä¿æ—§æ•°æ®åœ¨ä¸å†éœ€è¦æ—¶è¢«è‡ªåŠ¨åˆ é™¤ï¼Œä»è€Œé‡Šæ”¾ç£ç›˜ç©ºé—´å¹¶ä¼˜åŒ–é›†ç¾¤æ€§èƒ½ã€‚</p>
<h3 id="å¦‚ä½•ç¡®ä¿-Elasticsearch-æ–‡æ¡£çš„-id-å”¯ä¸€æ€§ï¼Ÿ"><a href="#å¦‚ä½•ç¡®ä¿-Elasticsearch-æ–‡æ¡£çš„-id-å”¯ä¸€æ€§ï¼Ÿ" class="headerlink" title="å¦‚ä½•ç¡®ä¿ Elasticsearch æ–‡æ¡£çš„ id å”¯ä¸€æ€§ï¼Ÿ"></a>å¦‚ä½•ç¡®ä¿ Elasticsearch æ–‡æ¡£çš„ id å”¯ä¸€æ€§ï¼Ÿ</h3><p>åœ¨Elasticsearchä¸­è®°å½•æœç´¢è¯ï¼Œæ¯æ¡æœç´¢è¯ä½œä¸ºä¸€ä¸ªæ–‡æ¡£ï¼Œä¿è¯æ•°æ®IDçš„å”¯ä¸€æ€§æ˜¯éå¸¸é‡è¦çš„ã€‚Elasticsearchä½¿ç”¨æ–‡æ¡£IDæ¥å”¯ä¸€æ ‡è¯†æ¯ä¸ªæ–‡æ¡£ï¼Œå› æ­¤ä½ éœ€è¦ç¡®ä¿æ¯ä¸ªæœç´¢è¯éƒ½è¢«åˆ†é…ä¸€ä¸ªå”¯ä¸€çš„IDã€‚ä»¥ä¸‹æ˜¯ä¸€äº›æ–¹æ³•æ¥å®ç°è¿™ä¸€ç‚¹ï¼š</p>
<ol>
<li><p><strong>ä½¿ç”¨UUID</strong>ï¼š<br>UUIDï¼ˆUniversally Unique Identifierï¼‰æ˜¯ä¸€ç§å¹¿æ³›ä½¿ç”¨çš„å”¯ä¸€æ ‡è¯†ç¬¦ç”Ÿæˆæ–¹æ³•ã€‚ä½ å¯ä»¥ä¸ºæ¯ä¸ªæœç´¢è¯ç”Ÿæˆä¸€ä¸ªUUIDï¼Œå¹¶å°†å…¶ç”¨ä½œæ–‡æ¡£çš„IDã€‚UUIDå…·æœ‰å…¨å±€å”¯ä¸€æ€§ï¼Œå¯ä»¥ç¡®ä¿å³ä½¿åœ¨ä¸åŒçš„ç³»ç»Ÿæˆ–æ—¶é—´ç‚¹ä¸Šç”Ÿæˆçš„IDä¹Ÿä¸ä¼šå†²çªã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> java.util.UUID;  <br> <br><span class="hljs-type">String</span> <span class="hljs-variable">uniqueId</span> <span class="hljs-operator">=</span> UUID.randomUUID().toString();  <br><span class="hljs-comment">// ä½¿ç”¨uniqueIdä½œä¸ºæ–‡æ¡£çš„ID</span><br></code></pre></td></tr></table></figure></li>
<li><p><strong>åŸºäºæ—¶é—´æˆ³å’Œæœç´¢è¯ç”ŸæˆID</strong>ï¼š<br>å¦‚æœä½ çš„æœç´¢è¯é‡ä¸æ˜¯ç‰¹åˆ«å¤§ï¼Œå¹¶ä¸”ä½ å¸Œæœ›IDå…·æœ‰ä¸€å®šçš„å¯è¯»æ€§æˆ–è€…é¡ºåºæ€§ï¼Œä½ å¯ä»¥è€ƒè™‘ä½¿ç”¨æ—¶é—´æˆ³å’Œæœç´¢è¯æ¥ç”ŸæˆIDã€‚ä¾‹å¦‚ï¼Œä½ å¯ä»¥å°†æ—¶é—´æˆ³å’Œæœç´¢è¯æ‹¼æ¥èµ·æ¥ï¼Œå¹¶å¯èƒ½åŠ ä¸Šä¸€ä¸ªå‰ç¼€æˆ–åç¼€æ¥ç¡®ä¿å”¯ä¸€æ€§ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> java.time.Instant;  <br> <br><span class="hljs-type">String</span> <span class="hljs-variable">timestamp</span> <span class="hljs-operator">=</span> Instant.now().toString().replace(<span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;&quot;</span>); <span class="hljs-comment">// ç§»é™¤æ—¶é—´æˆ³ä¸­çš„&quot;-&quot;å­—ç¬¦  </span><br><span class="hljs-type">String</span> <span class="hljs-variable">searchTerm</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;ä½ çš„æœç´¢è¯&quot;</span>;  <br><span class="hljs-type">String</span> <span class="hljs-variable">uniqueId</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;search-&quot;</span> + timestamp + <span class="hljs-string">&quot;-&quot;</span> + searchTerm;  <br><span class="hljs-comment">// ä½¿ç”¨uniqueIdä½œä¸ºæ–‡æ¡£çš„ID</span><br></code></pre></td></tr></table></figure></li>
<li><p><strong>ä½¿ç”¨è‡ªå¢ID</strong>ï¼š<br>å¦‚æœä½ çš„æœç´¢è¯é‡ä¸æ˜¯å¾ˆå¤§ï¼Œå¹¶ä¸”ä½ ä¸éœ€è¦è·¨å¤šä¸ªèŠ‚ç‚¹æˆ–é›†ç¾¤ä¿è¯å”¯ä¸€æ€§ï¼Œä½ å¯ä»¥è€ƒè™‘ä½¿ç”¨è‡ªå¢çš„IDã€‚ä½†æ˜¯ï¼Œè¯·æ³¨æ„ï¼Œå¦‚æœä½ æœ‰å¤šä¸ªèŠ‚ç‚¹æˆ–è€…éœ€è¦æ‰©å±•é›†ç¾¤ï¼Œè‡ªå¢IDå¯èƒ½ä¼šå¯¼è‡´IDå†²çªã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">AtomicInteger</span> <span class="hljs-variable">counter</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AtomicInteger</span>(<span class="hljs-number">0</span>);  <br><span class="hljs-type">String</span> <span class="hljs-variable">uniqueId</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;search-&quot;</span> + counter.getAndIncrement();  <br><span class="hljs-comment">// ä½¿ç”¨uniqueIdä½œä¸ºæ–‡æ¡£çš„ID</span><br></code></pre></td></tr></table></figure></li>
<li><p><strong>ä½¿ç”¨å“ˆå¸Œå‡½æ•°</strong>ï¼š<br>å¦‚æœä½ å¸Œæœ›IDæ›´çŸ­ï¼Œä½ å¯ä»¥è€ƒè™‘ä½¿ç”¨å“ˆå¸Œå‡½æ•°ï¼ˆå¦‚MD5æˆ–SHA-1ï¼‰å¯¹æœç´¢è¯è¿›è¡Œå“ˆå¸Œå¤„ç†ï¼Œå¹¶å°†ç»“æœä½œä¸ºæ–‡æ¡£çš„IDã€‚ä½†è¯·æ³¨æ„ï¼Œå“ˆå¸Œå‡½æ•°å¯èƒ½ä¼šäº§ç”Ÿç›¸åŒçš„è¾“å‡ºï¼ˆå³å“ˆå¸Œç¢°æ’ï¼‰ï¼Œå°½ç®¡è¿™ç§å¯èƒ½æ€§éå¸¸ä½ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> java.security.MessageDigest;  <br><span class="hljs-keyword">import</span> java.security.NoSuchAlgorithmException;  <br> <br><span class="hljs-type">String</span> <span class="hljs-variable">searchTerm</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;ä½ çš„æœç´¢è¯&quot;</span>;  <br><span class="hljs-keyword">try</span> &#123;  <br>    <span class="hljs-type">MessageDigest</span> <span class="hljs-variable">md</span> <span class="hljs-operator">=</span> MessageDigest.getInstance(<span class="hljs-string">&quot;MD5&quot;</span>);  <br>    <span class="hljs-type">byte</span>[] hashBytes = md.digest(searchTerm.getBytes());  <br>    <span class="hljs-type">StringBuilder</span> <span class="hljs-variable">hexString</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringBuilder</span>();  <br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">byte</span> b : hashBytes) &#123;  <br>        <span class="hljs-type">String</span> <span class="hljs-variable">hex</span> <span class="hljs-operator">=</span> Integer.toHexString(<span class="hljs-number">0xff</span> &amp; b);  <br>        <span class="hljs-keyword">if</span> (hex.length() == <span class="hljs-number">1</span>) hexString.append(<span class="hljs-string">&#x27;0&#x27;</span>);  <br>        hexString.append(hex);  <br>    &#125;  <br>    <span class="hljs-type">String</span> <span class="hljs-variable">uniqueId</span> <span class="hljs-operator">=</span> hexString.toString();  <br>    <span class="hljs-comment">// ä½¿ç”¨uniqueIdä½œä¸ºæ–‡æ¡£çš„ID  </span><br>&#125; <span class="hljs-keyword">catch</span> (NoSuchAlgorithmException e) &#123;  <br>    <span class="hljs-comment">// å¤„ç†å¼‚å¸¸  </span><br>&#125;<br></code></pre></td></tr></table></figure></li>
</ol>
<p>æ— è®ºä½ é€‰æ‹©å“ªç§æ–¹æ³•ï¼Œéƒ½éœ€è¦ç¡®ä¿ç”Ÿæˆçš„IDåœ¨æ•´ä¸ªElasticsearché›†ç¾¤ä¸­æ˜¯å”¯ä¸€çš„ã€‚å¦‚æœä½ ä½¿ç”¨äº†å¤šèŠ‚ç‚¹é›†ç¾¤ï¼Œå¹¶ä¸”éœ€è¦åœ¨ä¸åŒèŠ‚ç‚¹ä¹‹é—´ä¿è¯IDçš„å”¯ä¸€æ€§ï¼Œé‚£ä¹ˆä½¿ç”¨UUIDæˆ–åŸºäºæ—¶é—´æˆ³å’Œæœç´¢è¯çš„æ–¹æ³•é€šå¸¸æ˜¯æ›´å¥½çš„é€‰æ‹©ã€‚</p>
<h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><h2 id="è¸©å‘è®°å½•"><a href="#è¸©å‘è®°å½•" class="headerlink" title="è¸©å‘è®°å½•"></a>è¸©å‘è®°å½•</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> Page&lt;User&gt; <span class="hljs-title function_">listUserVOByPage</span><span class="hljs-params">(UserQueryRequest userQueryRequest, HttpServletRequest request)</span> &#123;<br>    <span class="hljs-type">long</span> <span class="hljs-variable">pageSize</span> <span class="hljs-operator">=</span> userQueryRequest.getPageSize();<br>    <span class="hljs-type">long</span> <span class="hljs-variable">current</span> <span class="hljs-operator">=</span> userQueryRequest.getCurrent();<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.page(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Page</span>&lt;&gt;(pageSize, current),<br>            <span class="hljs-built_in">this</span>.getQueryWrapper(userQueryRequest));<br>&#125;<br></code></pre></td></tr></table></figure>

<ul>
<li><h5 id="Pageå¯¹è±¡çš„pageSizeå’ŒcurrentPageå†™åäº†ï¼Œæ‹¿å–ç¬¬1é¡µã€å…±10æ¡æ•°æ®ï¼Œç»“æœå˜æˆäº†ç¬¬10é¡µï¼Œå…±1æ¡ã€‚ï¼ˆ2023-08-31åˆï¼‰"><a href="#Pageå¯¹è±¡çš„pageSizeå’ŒcurrentPageå†™åäº†ï¼Œæ‹¿å–ç¬¬1é¡µã€å…±10æ¡æ•°æ®ï¼Œç»“æœå˜æˆäº†ç¬¬10é¡µï¼Œå…±1æ¡ã€‚ï¼ˆ2023-08-31åˆï¼‰" class="headerlink" title="Pageå¯¹è±¡çš„pageSizeå’ŒcurrentPageå†™åäº†ï¼Œæ‹¿å–ç¬¬1é¡µã€å…±10æ¡æ•°æ®ï¼Œç»“æœå˜æˆäº†ç¬¬10é¡µï¼Œå…±1æ¡ã€‚ï¼ˆ2023/08/31åˆï¼‰"></a>Pageå¯¹è±¡çš„pageSizeå’ŒcurrentPageå†™åäº†ï¼Œæ‹¿å–ç¬¬1é¡µã€å…±10æ¡æ•°æ®ï¼Œç»“æœå˜æˆäº†ç¬¬10é¡µï¼Œå…±1æ¡ã€‚ï¼ˆ2023/08/31åˆï¼‰</h5></li>
</ul>
<h3 id="æœç´¢è¯æ¡ä¸å…¼å®¹ä¸­æ–‡"><a href="#æœç´¢è¯æ¡ä¸å…¼å®¹ä¸­æ–‡" class="headerlink" title="æœç´¢è¯æ¡ä¸å…¼å®¹ä¸­æ–‡"></a>æœç´¢è¯æ¡ä¸å…¼å®¹ä¸­æ–‡</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">if</span> (StringUtils.isNotBlank(searchText)) &#123;<br>    searchText = URLEncoder.encode(searchText, <span class="hljs-string">&quot;UTF-8&quot;</span>);<br>&#125;<br><span class="hljs-type">String</span> <span class="hljs-variable">url</span> <span class="hljs-operator">=</span> String.format(<span class="hljs-string">&quot;https://cn.bing.com/images/search?q=%s&amp;first=%s&quot;</span>, searchText, current);<br></code></pre></td></tr></table></figure>

<ul>
<li><h5 id="è½¬ç å°±å¯ä»¥è§£å†³ï¼Œå¦‚ä¸ŠğŸ‘†"><a href="#è½¬ç å°±å¯ä»¥è§£å†³ï¼Œå¦‚ä¸ŠğŸ‘†" class="headerlink" title="è½¬ç å°±å¯ä»¥è§£å†³ï¼Œå¦‚ä¸ŠğŸ‘†"></a>è½¬ç å°±å¯ä»¥è§£å†³ï¼Œå¦‚ä¸ŠğŸ‘†</h5></li>
</ul>
<h3 id="é€‚é…å™¨æ¨¡å¼-1"><a href="#é€‚é…å™¨æ¨¡å¼-1" class="headerlink" title="é€‚é…å™¨æ¨¡å¼"></a>é€‚é…å™¨æ¨¡å¼</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Resource</span><br>  <span class="hljs-keyword">private</span> UserDataSource userDataSource;<br>  <span class="hljs-meta">@Resource</span><br>  <span class="hljs-keyword">private</span> PostDataSource postDataSource;<br>  <span class="hljs-meta">@Resource</span><br>  <span class="hljs-keyword">private</span> PictureDataSource pictureDataSource;<br><br>  <span class="hljs-meta">@Override</span><br>  <span class="hljs-keyword">public</span> SearchVO <span class="hljs-title function_">searchAll</span><span class="hljs-params">(SearchQueryRequest searchQueryRequest, HttpServletRequest request)</span> &#123;<br>      <span class="hljs-comment">// 1.æ ¡éªŒå‚æ•°type</span><br>      <span class="hljs-comment">// 1.1.æ£€æŸ¥typeç±»å‹</span><br>      <span class="hljs-type">String</span> <span class="hljs-variable">type</span> <span class="hljs-operator">=</span> searchQueryRequest.getType();<br>      <span class="hljs-comment">// 1.2.æ ¡éªŒå‚æ•°æ­£ç¡®æ€§</span><br>      ThrowUtils.throwIf(StringUtils.isEmpty(type), ErrorCode.PARAMS_ERROR);<br>      <span class="hljs-comment">// 1.3.è·å–é¡µé¢ç±»å‹</span><br>      <span class="hljs-type">SearchTypeEnum</span> <span class="hljs-variable">enumByValue</span> <span class="hljs-operator">=</span> SearchTypeEnum.getEnumByValue(type);<br><br>      <span class="hljs-type">String</span> <span class="hljs-variable">searchText</span> <span class="hljs-operator">=</span> searchQueryRequest.getSearchText();<br>      <span class="hljs-type">long</span> <span class="hljs-variable">pageSize</span> <span class="hljs-operator">=</span> searchQueryRequest.getPageSize();<br>      <span class="hljs-type">long</span> <span class="hljs-variable">current</span> <span class="hljs-operator">=</span> searchQueryRequest.getCurrent();<br><br>      <span class="hljs-comment">// 2.æ‰§è¡ŒæŸ¥è¯¢å…¨éƒ¨æ•°æ®</span><br>      <span class="hljs-type">SearchVO</span> <span class="hljs-variable">searchVO</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br><br>      <span class="hljs-keyword">if</span> (enumByValue == <span class="hljs-literal">null</span>) &#123;<br>          <span class="hljs-comment">// è·å–æ–‡ç« </span><br>          CompletableFuture&lt;Page&lt;PostVO&gt;&gt; postTask = CompletableFuture.supplyAsync(() -&gt; &#123;<br>              <span class="hljs-keyword">return</span> postDataSource.search(searchText, pageSize, current);<br>          &#125;);<br><br>          <span class="hljs-comment">// è·å–ç”¨æˆ·</span><br>          CompletableFuture&lt;Page&lt;User&gt;&gt; userTask = CompletableFuture.supplyAsync(() -&gt; &#123;<br>              <span class="hljs-keyword">return</span> userDataSource.search(searchText, pageSize, current);<br>          &#125;);<br><br>          <span class="hljs-comment">// è·å–å›¾ç‰‡</span><br>          CompletableFuture&lt;Page&lt;Picture&gt;&gt; pictureTask = CompletableFuture.supplyAsync(() -&gt; &#123;<br>              <span class="hljs-keyword">try</span> &#123;<br>                  <span class="hljs-keyword">return</span> pictureDataSource.search(searchText,pageSize,current);<br>              &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>                  <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(e);<br>              &#125;<br>          &#125;);<br><br>          CompletableFuture.allOf(userTask, postTask, pictureTask).join();<br><br>          <span class="hljs-keyword">try</span> &#123;<br>              Page&lt;PostVO&gt; postVOPage = postTask.get();<br>              Page&lt;User&gt; userPage = userTask.get();<br>              Page&lt;Picture&gt; picturePage = pictureTask.get();<br><br>              searchVO = <span class="hljs-keyword">new</span> <span class="hljs-title class_">SearchVO</span>();<br>              searchVO.setUserList(userPage.getRecords());<br>              searchVO.setPostList(postVOPage.getRecords());<br>              searchVO.setPictureList(picturePage.getRecords());<br>          &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>              <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(e);<br>          &#125; <span class="hljs-keyword">catch</span> (ExecutionException e) &#123;<br>              <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(e);<br>          &#125;<br>      &#125; <br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">else</span> &#123;<br>           <span class="hljs-comment">// åˆ†ç±»æŸ¥è¯¢</span><br>           searchVO = <span class="hljs-keyword">new</span> <span class="hljs-title class_">SearchVO</span>();<br>           <span class="hljs-keyword">switch</span> (enumByValue) &#123;<br>               <span class="hljs-keyword">case</span> POST:<br>                   <span class="hljs-type">PostQueryRequest</span> <span class="hljs-variable">postQueryRequest</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">PostQueryRequest</span>();<br>                   postQueryRequest.setSearchText(searchText);<br>                   postQueryRequest.setPageSize(pageSize);<br>                   postQueryRequest.setCurrent(current);<br>                   Page&lt;PostVO&gt; postVOPage = postService.listPostVOByPage(postQueryRequest, request);<br><br>                   searchVO.setPostList(postVOPage.getRecords());<br>               <span class="hljs-keyword">case</span> USER:<br>                   <span class="hljs-type">UserQueryRequest</span> <span class="hljs-variable">userQueryRequest</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserQueryRequest</span>();<br>                   userQueryRequest.setUserName(searchText);<br>                   userQueryRequest.setPageSize(pageSize);<br>                   userQueryRequest.setCurrent(current);<br>                   Page&lt;User&gt; userPage = userService.listUserVOByPage(userQueryRequest, request);<br><br>                   searchVO.setUserList(userPage.getRecords());<br>               <span class="hljs-keyword">case</span> PICTURE:<br>                   Page&lt;Picture&gt; picturePage = <span class="hljs-literal">null</span>;<br>                   <span class="hljs-keyword">try</span> &#123;<br>                       picturePage = pictureService.listPictureVOByPage(searchText, pageSize, current);<br>                   &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>                       <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(e);<br>                   &#125; <span class="hljs-keyword">finally</span> &#123;<br>                       searchVO.setPictureList(picturePage.getRecords());<br>                   &#125;<br>           &#125;<br>       &#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-comment">// åˆ†ç±»æŸ¥è¯¢</span><br>            searchVO = <span class="hljs-keyword">new</span> <span class="hljs-title class_">SearchVO</span>();<br>            DataSource&lt;?&gt; dataSourceByType = dataSourceRegistry.getDataSourceByType(type);<br>            <span class="hljs-keyword">try</span> &#123;<br>                Page&lt;?&gt; page = dataSourceByType.search(searchText, pageSize, current);<br>                searchVO.setDataList(page.getRecords());<br>            &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(e);<br>            &#125;<br>        &#125;<br>        <span class="hljs-keyword">return</span> searchVO;<br></code></pre></td></tr></table></figure>

<h3 id="ç´¢å¼•å…³é—­"><a href="#ç´¢å¼•å…³é—­" class="headerlink" title="ç´¢å¼•å…³é—­"></a>ç´¢å¼•å…³é—­</h3><p><img src="https://gitee.com/deng-2022/pictures/raw/master/images/image-20231203203034571.png" alt="image-20231203203034571"></p>
<ul>
<li>æœ¬æ¥å¥½å¥½çš„ï¼Œçªç„¶å°±è¿™æ ·äº†ï¼Œè¿™ç´¢å¼•è®°å½•ä¹Ÿæ²¡åˆ å‘¢<strong>ï¼ˆ2023/12/03æ™šï¼‰</strong></li>
</ul>
<blockquote>
<p>Elasticsearch ä¸­çš„ç´¢å¼•å¯ä»¥è¢«å…³é—­ï¼Œè¿™æ˜¯ä¸ºäº†ä¼˜åŒ–æ€§èƒ½å’Œèµ„æºä½¿ç”¨ã€‚ä¸€æ—¦ç´¢å¼•è¢«å…³é—­ï¼Œå°±ä¸èƒ½å†å¯¹å…¶è¿›è¡Œå†™å…¥æ“ä½œï¼Œä½†ä»ç„¶å¯ä»¥è¿›è¡Œè¯»å–æ“ä½œã€‚å¦‚æœä½ è¯•å›¾å¯¹ä¸€ä¸ªå·²å…³é—­çš„ç´¢å¼•è¿›è¡Œå†™å…¥æ“ä½œï¼Œå°±ä¼šé‡åˆ° â€œindex_closed_exceptionâ€ é”™è¯¯ã€‚</p>
<p>è§£å†³æ–¹æ¡ˆï¼šé‡æ–°æ‰“å¼€ä½ çš„ç´¢å¼•ã€‚ä½ å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤é‡æ–°æ‰“å¼€ä¸€ä¸ªç´¢å¼•ï¼š</p>
</blockquote>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">POST <span class="hljs-regexp">/post_v1/</span>_open<br></code></pre></td></tr></table></figure>

<p><img src="https://gitee.com/deng-2022/pictures/raw/master/images/image-20231203203222431.png" alt="image-20231203203222431"></p>
<ul>
<li>è¿™æ ·å°±æ­£å¸¸æŸ¥è¯¢äº†ï¼ŒåŒæ ·çš„ï¼Œä¹Ÿå¯ä»¥å…³é—­ç´¢å¼•ï¼š<strong>ï¼ˆ2023/12/03æ™šï¼‰</strong></li>
</ul>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">POST <span class="hljs-regexp">/post_v1/</span>_close<br></code></pre></td></tr></table></figure>



<h2 id="TODO"><a href="#TODO" class="headerlink" title="TODO"></a>TODO</h2>
                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/blog/categories/%E9%A1%B9%E7%9B%AE/" class="category-chain-item">é¡¹ç›®</a>
  
  
    <span>></span>
    
  <a href="/blog/categories/%E9%A1%B9%E7%9B%AE/%E5%BC%80%E5%8F%91%E7%BB%8F%E9%AA%8C/" class="category-chain-item">å¼€å‘ç»éªŒ</a>
  
  
    <span>></span>
    
  <a href="/blog/categories/%E9%A1%B9%E7%9B%AE/%E5%BC%80%E5%8F%91%E7%BB%8F%E9%AA%8C/Elasticsearch/" class="category-chain-item">Elasticsearch</a>
  
  
    <span>></span>
    
  <a href="/blog/categories/%E9%A1%B9%E7%9B%AE/%E5%BC%80%E5%8F%91%E7%BB%8F%E9%AA%8C/Elasticsearch/Logstash/" class="category-chain-item">Logstash</a>
  
  
    <span>></span>
    
  <a href="/blog/categories/%E9%A1%B9%E7%9B%AE/%E5%BC%80%E5%8F%91%E7%BB%8F%E9%AA%8C/Elasticsearch/Logstash/Kibana/" class="category-chain-item">Kibana</a>
  
  

  

  

  

  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/blog/tags/%E9%A1%B9%E7%9B%AE/">#é¡¹ç›®</a>
      
        <a href="/blog/tags/%E5%BC%80%E5%8F%91%E7%BB%8F%E9%AA%8C/">#å¼€å‘ç»éªŒ</a>
      
        <a href="/blog/tags/Elasticsearch/">#Elasticsearch</a>
      
        <a href="/blog/tags/Logstash/">#Logstash</a>
      
        <a href="/blog/tags/Kibana/">#Kibana</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>MemorySearch å¿†æœé˜-å¼€å‘æ–‡æ¡£</div>
      <div>https://deng-2022.gitee.io/blog/2023/08/26/MemorySearch å¿†æœé˜-å¼€å‘æ–‡æ¡£/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>ä½œè€…</div>
          <div>Memory</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>å‘å¸ƒäº</div>
          <div>2023å¹´8æœˆ26æ—¥</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>æ›´æ–°äº</div>
          <div>2024å¹´2æœˆ19æ—¥</div>
        </div>
      
      
        <div class="license-meta-item">
          <div>è®¸å¯åè®®</div>
          <div>
            
              
              
                <a target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - ç½²å">
                    <i class="iconfont icon-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/blog/2023/09/10/Memory%20%E7%BC%98%E5%BF%86%E4%BA%A4%E5%8F%8B%E7%A4%BE%E5%8C%BA-%E5%BC%80%E5%8F%91%E6%96%87%E6%A1%A3/" title="Memory ç¼˜å¿†äº¤å‹ç¤¾åŒº-å¼€å‘æ–‡æ¡£">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">Memory ç¼˜å¿†äº¤å‹ç¤¾åŒº-å¼€å‘æ–‡æ¡£</span>
                        <span class="visible-mobile">ä¸Šä¸€ç¯‡</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/blog/2023/08/24/Maven%E5%A5%87%E6%8A%80%E6%B7%AB%E5%B7%A7%EF%BC%9A%E4%BC%98%E5%8C%96%E9%A1%B9%E7%9B%AE%E6%9E%84%E5%BB%BA%E4%B8%8E%E6%80%A7%E8%83%BD%E8%B0%83%E4%BC%98/" title="Mavenå¥‡æŠ€æ·«å·§ï¼šä¼˜åŒ–é¡¹ç›®æ„å»ºä¸æ€§èƒ½è°ƒä¼˜">
                        <span class="hidden-mobile">Mavenå¥‡æŠ€æ·«å·§ï¼šä¼˜åŒ–é¡¹ç›®æ„å»ºä¸æ€§èƒ½è°ƒä¼˜</span>
                        <span class="visible-mobile">ä¸‹ä¸€ç¯‡</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
  
  
    <article id="comments">
      

    </article>
  


          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>ç›®å½•</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">æœç´¢</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">å…³é”®è¯</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.fluid-dev.com/docs/guide/" target="_blank" rel="nofollow noopener"> <span>Memory | ä¸ªäººæ–‡æ¡£ç«™ç‚¹</span> </a>
<i class="iconfont icon-love"></i> <a href="https://hexo.fluid-dev.com/docs/guide/" target="_blank" rel="nofollow noopener"> <span>é…ç½®æŒ‡å— | Hexo Fluid ç”¨æˆ·æ‰‹å†Œ</span> </a>   
    </div>
  
  
    <div class="statistics">
  
  

  
    
      <span id="leancloud-site-pv-container" style="display: none">
        æ€»è®¿é—®é‡ 
        <span id="leancloud-site-pv"></span>
         æ¬¡
      </span>
    
    
      <span id="leancloud-site-uv-container" style="display: none">
        æ€»è®¿å®¢æ•° 
        <span id="leancloud-site-uv"></span>
         äºº
      </span>
    
    

  
</div>

  
  
    <!-- å¤‡æ¡ˆä¿¡æ¯ ICP for China -->
    <div class="beian">
  <span>
    <a href="http://beian.miit.gov.cn/" target="_blank" rel="nofollow noopener">
      äº¬ICPè¯123456å·
    </a>
  </span>
  
    
      <span>
        <a
          href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=12345678"
          rel="nofollow noopener"
          class="beian-police"
          target="_blank"
        >
          
            <span style="visibility: hidden; width: 0">|</span>
            <img src="/blog/img/police_beian.png" alt="police-icon"/>
          
          <span>äº¬å…¬ç½‘å®‰å¤‡12345678å·</span>
        </a>
      </span>
    
  
</div>

  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.0/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/blog/js/events.js" ></script>
<script  src="/blog/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>







  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.18.2/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/blog/js/local-search.js" ></script>

  <script defer src="/blog/js/leancloud.js" ></script>





<!-- ä¸»é¢˜çš„å¯åŠ¨é¡¹ï¼Œå°†å®ƒä¿æŒåœ¨æœ€åº•éƒ¨ -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/blog/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">åšå®¢åœ¨å…è®¸ JavaScript è¿è¡Œçš„ç¯å¢ƒä¸‹æµè§ˆæ•ˆæœæ›´ä½³</div>
  </noscript>
</body>
</html>
